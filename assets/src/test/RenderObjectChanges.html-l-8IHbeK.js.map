{"version":3,"file":"RenderObjectChanges.html-l-8IHbeK.js","sources":["../../../../examples/src/test/RenderObjectChanges.ts"],"sourcesContent":["import { reactive } from '@feng3d/reactivity';\nimport { Submit, RenderObject } from '@feng3d/render-api';\nimport { WebGL } from '@feng3d/webgl';\n\nconst init = async (canvas: HTMLCanvasElement) =>\n{\n    const devicePixelRatio = window.devicePixelRatio || 1;\n\n    canvas.width = canvas.clientWidth * devicePixelRatio;\n    canvas.height = canvas.clientHeight * devicePixelRatio;\n\n    const webgl = new WebGL({ canvasId: 'glcanvas', webGLcontextId: 'webgl' }); // 初始化WebGL\n\n    const renderObject: RenderObject = { // 渲染对象\n        pipeline: { // 渲染管线\n            vertex: { // 顶点着色器\n                code: `\n                attribute vec4 position;\n\n                void main() {\n                    gl_Position = position;\n                }\n                ` },\n            fragment: { // 片段着色器\n                code: `\n                precision highp float;\n                uniform vec4 color;\n                void main() {\n                    gl_FragColor = color;\n                }\n                ` },\n        },\n        vertices: {\n            position: { data: new Float32Array([0.0, 0.5, -0.5, -0.5, 0.5, -0.5]), format: 'float32x2' }, // 顶点坐标数据\n        },\n        indices: new Uint16Array([0, 1, 2]), // 顶点索引数据\n        draw: { __type__: 'DrawIndexed', indexCount: 3 }, // 绘制命令\n        bindingResources: { color: { value: [1, 0, 0, 1] } }, // Uniform 颜色值。\n    };\n\n    const submit: Submit = { // 一次GPU提交\n        commandEncoders: [ // 命令编码列表\n            {\n                passEncoders: [ // 通道编码列表\n                    { // 渲染通道\n                        descriptor: { // 渲染通道描述\n                            colorAttachments: [{ // 颜色附件\n                                clearValue: [0.0, 0.0, 0.0, 1.0], // 渲染前填充颜色\n                            }],\n                        },\n                        renderPassObjects: [renderObject],\n                    },\n                ],\n            },\n        ],\n    };\n\n    function render()\n    {\n        webgl.submit(submit); // 提交GPU执行\n        requestAnimationFrame(render);\n    }\n\n    render();\n\n    window.onclick = () =>\n    {\n        // 修改顶点着色器代码\n        reactive(renderObject.pipeline.vertex).code = `\n                attribute vec4 position;\n\n                void main() {\n                    vec4 pos = position;\n                pos.x = pos.x + 0.5;\n                    gl_Position = pos;\n                }\n                `;\n\n        // 修改片段着色器代码\n        reactive(renderObject.pipeline.fragment).code = `\n                precision highp float;\n                uniform vec4 color;\n                void main() {\n                    vec4 col = color;\n                    col.x = 0.5;\n                    col.y = 0.6;\n                    col.z = 0.7;\n                    gl_FragColor = col;\n                }\n                `;\n        //\n        // renderObject.uniforms.color = [0, 1, 0, 1];\n    };\n};\n\nlet webglCanvas = document.querySelector('#glcanvas') as HTMLCanvasElement;\n\nif (!webglCanvas)\n{\n    webglCanvas = document.createElement('canvas');\n    webglCanvas.id = 'webgpu';\n    webglCanvas.style.width = '400px';\n    webglCanvas.style.height = '300px';\n    document.body.appendChild(webglCanvas);\n}\ninit(webglCanvas);"],"names":["init","canvas","devicePixelRatio","webgl","WebGL","renderObject","submit","render","reactive","webglCanvas"],"mappings":"oGAIA,MAAMA,EAAO,MAAOC,GACpB,CACI,MAAMC,EAAmB,OAAO,kBAAoB,EAEpDD,EAAO,MAAQA,EAAO,YAAcC,EACpCD,EAAO,OAASA,EAAO,aAAeC,EAEtC,MAAMC,EAAQ,IAAIC,EAAM,CAAE,SAAU,WAAY,eAAgB,QAAS,EAEnEC,EAA6B,CAC/B,SAAU,CACN,OAAQ,CACJ,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAA,EAOV,SAAU,CACN,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAA,CAMJ,EAEV,SAAU,CACN,SAAU,CAAE,KAAM,IAAI,aAAa,CAAC,EAAK,GAAK,IAAM,IAAM,GAAK,GAAI,CAAC,EAAG,OAAQ,WAAA,CAAY,EAE/F,QAAS,IAAI,YAAY,CAAC,EAAG,EAAG,CAAC,CAAC,EAClC,KAAM,CAAE,SAAU,cAAe,WAAY,CAAA,EAC7C,iBAAkB,CAAE,MAAO,CAAE,MAAO,CAAC,EAAG,EAAG,EAAG,CAAC,CAAA,CAAE,CAAE,EAGjDC,EAAiB,CACnB,gBAAiB,CACb,CACI,aAAc,CACV,CACI,WAAY,CACR,iBAAkB,CAAC,CACf,WAAY,CAAC,EAAK,EAAK,EAAK,CAAG,CAAA,CAClC,CAAA,EAEL,kBAAmB,CAACD,CAAY,CAAA,CACpC,CACJ,CACJ,CACJ,EAGJ,SAASE,GACT,CACIJ,EAAM,OAAOG,CAAM,EACnB,sBAAsBC,CAAM,CAChC,CAEAA,EAAA,EAEA,OAAO,QAAU,IACjB,CAEIC,EAASH,EAAa,SAAS,MAAM,EAAE,KAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAW9CG,EAASH,EAAa,SAAS,QAAQ,EAAE,KAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAapD,CACJ,EAEA,IAAII,EAAc,SAAS,cAAc,WAAW,EAE/CA,IAEDA,EAAc,SAAS,cAAc,QAAQ,EAC7CA,EAAY,GAAK,SACjBA,EAAY,MAAM,MAAQ,QAC1BA,EAAY,MAAM,OAAS,QAC3B,SAAS,KAAK,YAAYA,CAAW,GAEzCT,EAAKS,CAAW"}