{"version":3,"file":"fbo_multisample.html-Ad6LLOA6.js","sources":["../../../../examples/src/WebGL2Samples/fbo_multisample.ts"],"sourcesContent":["import { CanvasContext, RenderPass, RenderPassDescriptor, RenderPipeline, Sampler, Texture, VertexAttributes } from '@feng3d/render-api';\nimport { WebGL } from '@feng3d/webgl';\nimport { mat4, vec3 } from 'gl-matrix';\nimport { getShaderSource } from './utility';\n\nconst canvas = document.createElement('canvas');\n\ncanvas.id = 'glcanvas';\ncanvas.width = Math.min(window.innerWidth, window.innerHeight);\ncanvas.height = canvas.width;\ndocument.body.appendChild(canvas);\n\nconst renderingContext: CanvasContext = { canvasId: 'glcanvas', webGLcontextId: 'webgl2' };\nconst webgl = new WebGL(renderingContext);\n\n// -- Init program\nconst PROGRAM = {\n    TEXTURE: 0,\n    SPLASH: 1,\n    MAX: 2,\n};\n\nconst programs: RenderPipeline[] = [\n    {\n        vertex: { code: getShaderSource('vs-render') },\n        fragment: { code: getShaderSource('fs-render') },\n        primitive: { topology: 'triangle-list' },\n    },\n    {\n        vertex: { code: getShaderSource('vs-splash') },\n        fragment: { code: getShaderSource('fs-splash') },\n        primitive: { topology: 'triangle-list' },\n    },\n];\n\n// -- Init primitive data\nconst vertexCount = 18;\nconst data = new Float32Array(vertexCount * 2);\nlet angle: number;\nconst radius = 0.1;\n\nfor (let i = 0; i < vertexCount; i++)\n{\n    angle = Math.PI * 2 * i / vertexCount;\n    data[2 * i] = radius * Math.sin(angle);\n    data[2 * i + 1] = radius * Math.cos(angle);\n}\n\n// -- Init buffers\n\nconst positions = new Float32Array([\n    -1.0, -1.0,\n    1.0, -1.0,\n    1.0, 1.0,\n    1.0, 1.0,\n    -1.0, 1.0,\n    -1.0, -1.0,\n]);\n\nconst texCoords = new Float32Array([\n    0.0, 1.0,\n    1.0, 1.0,\n    1.0, 0.0,\n    1.0, 0.0,\n    0.0, 0.0,\n    0.0, 1.0,\n]);\n\n// -- Init Texture\n// used for draw framebuffer storage\nconst FRAMEBUFFER_SIZE = {\n    x: canvas.width,\n    y: canvas.height,\n};\nconst texture: Texture = {\n    descriptor: {\n        format: 'rgba8unorm',\n        size: [FRAMEBUFFER_SIZE.x, FRAMEBUFFER_SIZE.y],\n    },\n};\nconst sampler: Sampler = { minFilter: 'nearest', magFilter: 'nearest' };\n\n// -- Init Frame Buffers\nconst framebuffer: RenderPassDescriptor = {\n    colorAttachments: [{ view: { texture, baseMipLevel: 0 }, clearValue: [0.0, 0.0, 0.0, 1.0] }],\n    sampleCount: 4, // 多重采样\n};\n\n// -- Init VertexArray\nconst vertexArrays: { vertices?: VertexAttributes }[] = [\n    {\n        vertices: { position: { data, format: 'float32x2' } },\n    },\n    {\n        vertices: {\n            position: { data: positions, format: 'float32x2' },\n            texcoord: { data: texCoords, format: 'float32x2' },\n        },\n    },\n];\n\nconst IDENTITY = mat4.create();\n\n// -- Render\n\n// Pass 1\nconst renderPass1: RenderPass = {\n    descriptor: framebuffer,\n    renderPassObjects: [{\n        pipeline: {\n            ...programs[PROGRAM.TEXTURE],\n            primitive: { topology: 'LINE_LOOP' },\n        },\n        bindingResources: { MVP: { value: IDENTITY as Float32Array } },\n        vertices: vertexArrays[PROGRAM.TEXTURE].vertices,\n        draw: { __type__: 'DrawVertex', vertexCount },\n    }],\n};\n\n// Pass 2\n\nconst scaleVector3 = vec3.create();\n\nvec3.set(scaleVector3, 8.0, 8.0, 8.0);\nconst mvp = mat4.create();\n\nmat4.scale(mvp, IDENTITY, scaleVector3);\n\nconst renderPass2: RenderPass = {\n    descriptor: { colorAttachments: [{ clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: 'clear' }] },\n    renderPassObjects: [\n        {\n            pipeline: programs[PROGRAM.SPLASH],\n            bindingResources: { diffuse: { texture, sampler }, MVP: { value: mvp as Float32Array } },\n            vertices: vertexArrays[PROGRAM.SPLASH].vertices,\n            draw: { __type__: 'DrawVertex', vertexCount: 6 },\n        },\n    ],\n};\n\nwebgl.submit({\n    commandEncoders: [{\n        passEncoders: [renderPass1,\n            // blitFramebuffer,\n            renderPass2],\n    }],\n});\n\n// -- Delete WebGL resources\nwebgl.deleteTexture(texture);\nwebgl.deleteSampler(sampler);\nwebgl.deleteFramebuffer(framebuffer);\nwebgl.deleteProgram(programs[PROGRAM.TEXTURE]);\nwebgl.deleteProgram(programs[PROGRAM.SPLASH]);\n\nwebgl;"],"names":["canvas","renderingContext","webgl","WebGL","PROGRAM","programs","getShaderSource","vertexCount","data","angle","radius","i","positions","texCoords","FRAMEBUFFER_SIZE","texture","sampler","framebuffer","vertexArrays","IDENTITY","mat4.create","renderPass1","scaleVector3","vec3.create","vec3.set","mvp","mat4.scale","renderPass2"],"mappings":"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"}