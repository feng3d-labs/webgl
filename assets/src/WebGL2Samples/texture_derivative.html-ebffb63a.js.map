{"version":3,"file":"texture_derivative.html-ebffb63a.js","sources":["../../../../examples/src/WebGL2Samples/texture_derivative.ts"],"sourcesContent":["import { CanvasContext, RenderObject, RenderPass, RenderPipeline, Sampler, Texture, VertexAttributes } from \"@feng3d/render-api\";\nimport { WebGL } from \"@feng3d/webgl\";\n\nimport { mat4, vec3 } from \"gl-matrix\";\nimport { getShaderSource, loadImage } from \"./utility\";\nimport { reactive } from \"@feng3d/reactivity\";\n\n(function ()\n{\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"glcanvas\";\n    canvas.width = Math.min(window.innerWidth, window.innerHeight);\n    canvas.height = canvas.width;\n    document.body.appendChild(canvas);\n\n    const rc: CanvasContext = { canvasId: \"glcanvas\", webGLcontextId: \"webgl2\" };\n    const webgl = new WebGL(rc);\n\n    // -- Init program\n    const program: RenderPipeline = {\n        vertex: { code: getShaderSource(\"vs\") }, fragment: {\n            code: getShaderSource(\"fs\"), targets: [{\n\n            }]\n        },\n        depthStencil: {},\n        primitive: { topology: \"triangle-list\", cullFace: \"back\" },\n    };\n\n    // -- Init buffers\n\n    const positions = new Float32Array([\n        // Front face\n        -1.0, -1.0, 1.0,\n        1.0, -1.0, 1.0,\n        1.0, 1.0, 1.0,\n        -1.0, 1.0, 1.0,\n\n        // Back face\n        -1.0, -1.0, -1.0,\n        -1.0, 1.0, -1.0,\n        1.0, 1.0, -1.0,\n        1.0, -1.0, -1.0,\n\n        // Top face\n        -1.0, 1.0, -1.0,\n        -1.0, 1.0, 1.0,\n        1.0, 1.0, 1.0,\n        1.0, 1.0, -1.0,\n\n        // Bottom face\n        -1.0, -1.0, -1.0,\n        1.0, -1.0, -1.0,\n        1.0, -1.0, 1.0,\n        -1.0, -1.0, 1.0,\n\n        // Right face\n        1.0, -1.0, -1.0,\n        1.0, 1.0, -1.0,\n        1.0, 1.0, 1.0,\n        1.0, -1.0, 1.0,\n\n        // Left face\n        -1.0, -1.0, -1.0,\n        -1.0, -1.0, 1.0,\n        -1.0, 1.0, 1.0,\n        -1.0, 1.0, -1.0\n    ]);\n\n    const texCoords = new Float32Array([\n        // Front face\n        0.0, 0.0,\n        0.0, 1.0,\n        1.0, 1.0,\n        1.0, 0.0,\n\n        // Back face\n        1.0, 1.0,\n        1.0, 0.0,\n        0.0, 0.0,\n        0.0, 1.0,\n\n        // Top face\n        1.0, 0.0,\n        0.0, 0.0,\n        0.0, 1.0,\n        1.0, 1.0,\n\n        // Bottom face\n        0.0, 0.0,\n        0.0, 1.0,\n        1.0, 1.0,\n        1.0, 0.0,\n\n        // Right face\n        0.0, 0.0,\n        0.0, 1.0,\n        1.0, 1.0,\n        1.0, 0.0,\n\n        // Left face\n        0.0, 0.0,\n        0.0, 1.0,\n        1.0, 1.0,\n        1.0, 0.0\n    ]);\n\n    // Element buffer\n\n    const cubeVertexIndices = [\n        0, 1, 2, 0, 2, 3, // front\n        4, 5, 6, 4, 6, 7, // back\n        8, 9, 10, 8, 10, 11, // top\n        12, 13, 14, 12, 14, 15, // bottom\n        16, 17, 18, 16, 18, 19, // right\n        20, 21, 22, 20, 22, 23 // left\n    ];\n\n    // -- Init VertexArray\n    const vertexArray: { vertices?: VertexAttributes } = {\n        vertices: {\n            position: { data: positions, format: \"float32x3\" },\n            texcoord: { data: texCoords, format: \"float32x2\" },\n        },\n    };\n\n    // -- Init Texture\n\n    const imageUrl = \"../../assets/img/Di-3d.png\";\n    let texture: Texture;\n    let sampler: Sampler;\n    loadImage(imageUrl, function (image)\n    {\n        // -- Init 2D Texture\n        texture = {\n            format: \"rgba8unorm\",\n            mipLevelCount: 1,\n            size: [512, 512],\n            sources: [{\n                image, flipY: false,\n            }]\n        };\n        sampler = {\n            minFilter: \"nearest\",\n            magFilter: \"nearest\",\n            addressModeU: \"clamp-to-edge\",\n            addressModeV: \"clamp-to-edge\",\n        };\n\n        // // -- Allocate storage for the texture\n        // gl.texStorage2D(gl.TEXTURE_2D, 1, gl.RGB8, 512, 512);\n        // gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, gl.RGB, gl.UNSIGNED_BYTE, image);\n\n        requestAnimationFrame(render);\n    });\n\n    // -- Initialize render variables\n    const orientation = [0.0, 0.0, 0.0];\n\n    const modelMatrix = mat4.create();\n\n    const mvMatrix = mat4.create();\n    const translate = vec3.create();\n    vec3.set(translate, 0, 0, -10);\n    mat4.translate(mvMatrix, modelMatrix, translate);\n    const perspectiveMatrix = mat4.create();\n    mat4.perspective(perspectiveMatrix, 0.785, 1, 1, 1000);\n\n    // -- Mouse Behaviour\n\n    let mouseDown = false;\n    let lastMouseX = 0;\n    let lastMouseY = 0;\n\n    canvas.onmousedown = function (event)\n    {\n        mouseDown = true;\n        lastMouseX = event.clientX;\n        lastMouseY = event.clientY;\n    };\n\n    canvas.onmouseup = function (event)\n    {\n        mouseDown = false;\n    };\n\n    canvas.onmousemove = function (event)\n    {\n        const newX = event.clientX;\n        const newY = event.clientY;\n\n        const deltaX = newX - lastMouseX;\n        const deltaY = newY - lastMouseY;\n\n        const m = mat4.create();\n\n        mat4.rotateX(m, m, deltaX / 100.0);\n        mat4.rotateY(m, m, deltaY / 100.0);\n\n        const scale = vec3.create();\n        vec3.set(scale, (1 + deltaX / 1000.0), (1 + deltaX / 1000.0), (1 + deltaX / 1000.0));\n        mat4.scale(m, m, scale);\n\n        mat4.multiply(mvMatrix, mvMatrix, m);\n\n        lastMouseX = newX;\n        lastMouseY = newY;\n    };\n\n    const ro: RenderObject = {\n        pipeline: program,\n        bindingResources: {},\n        vertices: vertexArray.vertices,\n        indices: new Uint16Array(cubeVertexIndices),\n        draw: { __type__: \"DrawIndexed\", indexCount: 36 },\n    };\n\n    const rp: RenderPass = {\n        descriptor: { colorAttachments: [{ clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: \"clear\" }] },\n        renderPassObjects: [ro]\n    };\n\n    function render()\n    {\n        // -- Render\n        orientation[0] = 0.00020; // yaw\n        orientation[1] = 0.00010; // pitch\n        orientation[2] = 0.00005; // roll\n\n        mat4.rotateX(mvMatrix, mvMatrix, orientation[0] * Math.PI);\n        mat4.rotateY(mvMatrix, mvMatrix, orientation[1] * Math.PI);\n        mat4.rotateZ(mvMatrix, mvMatrix, orientation[2] * Math.PI);\n\n        reactive(ro.bindingResources).mvMatrix = mvMatrix;\n        reactive(ro.bindingResources).pMatrix = perspectiveMatrix;\n        reactive(ro.bindingResources).diffuse = { texture, sampler };\n\n        webgl.submit({ commandEncoders: [{ passEncoders: [rp] }] });\n\n        requestAnimationFrame(render);\n    }\n\n    // If you have a long-running page, and need to delete WebGL resources, use:\n    //\n    // gl.deleteBuffer(vertexPosBuffer);\n    // gl.deleteBuffer(vertexTexBuffer);\n    // gl.deleteBuffer(indexBuffer);\n    // gl.deleteTexture(texture);\n    // gl.deleteProgram(program);\n    // gl.deleteVertexArray(vertexArray);\n})();\n"],"names":["canvas","rc","webgl","WebGL","program","getShaderSource","positions","texCoords","cubeVertexIndices","vertexArray","imageUrl","texture","sampler","loadImage","image","render","orientation","modelMatrix","mat4.create","mvMatrix","translate","vec3.create","vec3.set","mat4.translate","perspectiveMatrix","mat4.perspective","lastMouseX","lastMouseY","event","newX","newY","deltaX","deltaY","m","mat4.rotateX","mat4.rotateY","scale","mat4.scale","mat4.multiply","ro","rp","mat4.rotateZ","reactive"],"mappings":"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"}