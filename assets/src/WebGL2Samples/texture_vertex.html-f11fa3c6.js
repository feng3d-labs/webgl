import"../../modulepreload-polyfill-3cfb730f.js";import{g as X,l as k}from"../../utility-e972c1ee.js";import{W as q,v as C}from"../../WebGL-b4686ab5.js";import{G as $}from"../../gltf-loader-223361d8.js";import{c as a,l as J,m as S,p as Z,r as P,b as z,e as K,d as Q}from"../../mat4-90bd9af0.js";import{c as T,s as y}from"../../vec3-5d562fd8.js";import"../../common-d8a29b8a.js";(function(){const g={0:"point-list",3:"line-strip",2:"LINE_LOOP",1:"line-list",5:"triangle-strip",6:"TRIANGLE_FAN",4:"triangle-list"},c=Object.freeze({5126:"FLOAT",5120:"BYTE",5122:"SHORT",5121:"UNSIGNED_BYTE",5123:"UNSIGNED_SHORT",5131:"HALF_FLOAT",5124:"INT",5125:"UNSIGNED_INT",36255:"INT_2_10_10_10_REV",33640:"UNSIGNED_INT_2_10_10_10_REV"}),s=document.createElement("canvas");s.id="glcanvas",s.width=Math.min(window.innerWidth,window.innerHeight),s.height=s.width,document.body.appendChild(s);const h={canvasId:"glcanvas",webGLcontextId:"webgl2",webGLContextAttributes:{antialias:!1}},p=new q(h),B={vertex:{code:X("vs")},fragment:{code:X("fs")},depthStencil:{depthCompare:"less"}},v={};let l,i,I,A,N,w;const j=new $;let f;const H="../../assets/gltf/plane.gltf";j.loadGLTF(H,function(e){f=e.scenes[e.defaultScene];let r,t;for(const o in f.meshes)for(l=f.meshes[o],v[o]=[],r=0,t=l.primitives.length;r<t;++r){i=l.primitives[r],I=i.vertexBuffer,A=i.indices;const _=i.attributes.POSITION,x=i.attributes.NORMAL,M=i.attributes.TEXCOORD_0;v[o].push({vertices:{position:{data:I,format:L(_.size,c[_.type]),arrayStride:_.stride,offset:_.offset},normal:{data:I,format:L(x.size,c[x.type]),arrayStride:x.stride,offset:x.offset},texcoord:{data:I,format:L(M.size,c[M.type]),arrayStride:M.stride,offset:M.offset}},indices:A})}k("../../assets/img/heightmap.jpg",function(o){N={format:"rgba8unorm",mipLevelCount:1,size:[256,256],sources:[{image:o,flipY:!1}]},w={minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},requestAnimationFrame(D)})});const d=[0,0,0],E=a(),W=a(),F=T();y(F,4,3,1);const G=T();y(G,0,.5,0);const V=T();y(V,0,1,0);const Y=a();J(Y,F,G,V);const n=a();S(n,Y,W);const R=a();Z(R,.785,1,1,1e3);let b=0,O=0;s.onmousedown=function(e){b=e.clientX,O=e.clientY},s.onmouseup=function(e){},s.onmousemove=function(e){const r=e.clientX,t=e.clientY,u=r-b,o=t-O,m=a();P(m,m,u/100),z(m,m,o/100),S(E,n,m),K(n,E),b=r,O=t};const U=a();function D(){const e=[],r={descriptor:{colorAttachments:[{clearValue:[0,0,0,1],loadOp:"clear"}],depthStencilAttachment:{depthLoadOp:"clear"}},renderPassObjects:e};d[0]=2e-4,d[1]=1e-4,d[2]=5e-5,P(n,n,d[0]*Math.PI),z(n,n,d[1]*Math.PI),Q(n,n,d[2]*Math.PI);let t,u;for(const o in f.meshes)for(l=f.meshes[o],t=0,u=l.primitives.length;t<u;++t)i=l.primitives[t],S(U,n,i.matrix),e.push({pipeline:{...B,primitive:{topology:g[i.mode]}},bindingResources:{mvMatrix:U,pMatrix:R,displacementMap:{texture:N,sampler:w},diffuse:{texture:N,sampler:w}},vertices:v[o][t].vertices,indices:v[o][t].indices,draw:{__type__:"DrawIndexed",indexCount:i.indices.length}});p.submit({commandEncoders:[{passEncoders:[r]}]}),requestAnimationFrame(D)}})();function L(g,c="FLOAT",s=!1){for(const h in C){const p=C[h];if(p.numComponents===g&&p.type===c&&!p.normalized==!s)return h}console.error(`没有找到与 ${JSON.stringify({numComponents:g,type:c,normalized:s})} 对应的顶点数据格式！`)}
//# sourceMappingURL=texture_vertex.html-f11fa3c6.js.map
