{"version":3,"file":"fbo_rtt_depth_texture.html-3e93fcd9.js","sources":["../../../../examples/src/WebGL2Samples/fbo_rtt_depth_texture.ts"],"sourcesContent":["import { CanvasContext, RenderPass, RenderPassDescriptor, RenderPipeline, Sampler, Texture, VertexAttributes } from \"@feng3d/render-api\";\nimport { WebGL } from \"@feng3d/webgl\";\nimport { getShaderSource } from \"./utility\";\n\nconst canvas = document.createElement(\"canvas\");\ncanvas.id = \"glcanvas\";\ncanvas.width = window.innerWidth;\ncanvas.height = window.innerHeight;\ndocument.body.appendChild(canvas);\n\nconst renderingContext: CanvasContext = { canvasId: \"glcanvas\", webGLcontextId: \"webgl2\", webGLContextAttributes: { antialias: false } };\nconst webgl = new WebGL(renderingContext);\n\nconst windowSize = {\n    x: canvas.width,\n    y: canvas.height\n};\n\n// -- Initialize program\n\n// Depth shaders\nconst depthProgram: RenderPipeline = {\n    vertex: { code: getShaderSource(\"vs-depth\") }, fragment: { code: getShaderSource(\"fs-depth\") },\n    depthStencil: {},\n};\n\n// Draw shaders\nconst drawProgram: RenderPipeline = {\n    vertex: { code: getShaderSource(\"vs-draw\") }, fragment: { code: getShaderSource(\"fs-draw\") },\n};\n\n// -- Initialize buffer\n\nconst triPositions = new Float32Array([\n    -0.5, -0.5, -1.0,\n    0.5, -0.5, -1.0,\n    0.0, 0.5, 1.0\n]);\n\nconst quadPositions = new Float32Array([\n    -1.0, -1.0,\n    1.0, -1.0,\n    1.0, 1.0,\n    1.0, 1.0,\n    -1.0, 1.0,\n    -1.0, -1.0\n]);\n\nconst quadTexcoords = new Float32Array([\n    0.0, 0.0,\n    1.0, 0.0,\n    1.0, 1.0,\n    1.0, 1.0,\n    0.0, 1.0,\n    0.0, 0.0\n]);\n\n// -- Initialize vertex array\n\nconst triVertexArray: { vertices?: VertexAttributes } = {\n    vertices: {\n        position: { data: triPositions, format: \"float32x3\" },\n    }\n};\n\nconst quadVertexArray: { vertices?: VertexAttributes } = {\n    vertices: {\n        position: { data: quadPositions, format: \"float32x2\" },\n        textureCoordinates: { data: quadTexcoords, format: \"float32x2\" },\n    }\n};\n\n// -- Initialize depth texture\n\n// the proper texture format combination can be found here\n// https://www.khronos.org/registry/OpenGL-Refpages/es3.0/html/glTexImage2D.xhtml\nconst depthTexture: Texture = {\n    size: [windowSize.x, windowSize.y],\n    format: \"depth16unorm\",\n};\nconst depthSampler: Sampler = { addressModeU: \"clamp-to-edge\", addressModeV: \"clamp-to-edge\", minFilter: \"nearest\", magFilter: \"nearest\" };\n\n// -- Initialize frame buffer\n\nconst frameBuffer: RenderPassDescriptor = {\n    colorAttachments: [],\n    depthStencilAttachment: { view: { texture: depthTexture, baseMipLevel: 0 }, depthLoadOp: \"clear\" },\n};\n\n// -- Render\n\n// Pass 1: Depth\nconst renderPass: RenderPass = {\n    descriptor: frameBuffer,\n    renderObjects: [{\n        pipeline: depthProgram,\n        geometry: {\n            primitive: { topology: \"triangle-list\" },\n            vertices: triVertexArray.vertices,\n            draw: { __type__: \"DrawVertex\", vertexCount: 3 },\n        }\n    }],\n\n};\n\n// Pass 2: Draw\nconst rp2: RenderPass = {\n    descriptor: {\n        colorAttachments: [{ clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: \"clear\" }],\n    },\n    renderObjects: [{\n        pipeline: drawProgram,\n        bindingResources: { depthMap: { texture: depthTexture, sampler: depthSampler } },\n        geometry: {\n            primitive: { topology: \"triangle-list\" },\n            vertices: quadVertexArray.vertices,\n            draw: { __type__: \"DrawVertex\", vertexCount: 6 },\n        }\n    }],\n};\n\nwebgl.submit({ commandEncoders: [{ passEncoders: [renderPass, rp2] }] });\n\n// Clean up\nwebgl.deleteFramebuffer(frameBuffer);\nwebgl.deleteTexture(depthTexture);\nwebgl.deleteProgram(depthProgram);\nwebgl.deleteProgram(drawProgram);\n\n"],"names":["canvas","renderingContext","webgl","WebGL","windowSize","depthProgram","getShaderSource","drawProgram","triPositions","quadPositions","quadTexcoords","triVertexArray","quadVertexArray","depthTexture","depthSampler","frameBuffer","renderPass","rp2"],"mappings":"2IAIA,MAAMA,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,GAAK,WACZA,EAAO,MAAQ,OAAO,WACtBA,EAAO,OAAS,OAAO,YACvB,SAAS,KAAK,YAAYA,CAAM,EAEhC,MAAMC,EAAkC,CAAE,SAAU,WAAY,eAAgB,SAAU,uBAAwB,CAAE,UAAW,EAAA,GACzHC,EAAQ,IAAIC,EAAMF,CAAgB,EAElCG,EAAa,CACf,EAAGJ,EAAO,MACV,EAAGA,EAAO,MACd,EAKMK,EAA+B,CACjC,OAAQ,CAAE,KAAMC,EAAgB,UAAU,CAAE,EAAG,SAAU,CAAE,KAAMA,EAAgB,UAAU,CAAE,EAC7F,aAAc,CAAC,CACnB,EAGMC,EAA8B,CAChC,OAAQ,CAAE,KAAMD,EAAgB,SAAS,CAAE,EAAG,SAAU,CAAE,KAAMA,EAAgB,SAAS,CAAE,CAC/F,EAIME,EAAe,IAAI,aAAa,CAClC,IAAM,IAAM,GACZ,GAAK,IAAM,GACX,EAAK,GAAK,CACd,CAAC,EAEKC,EAAgB,IAAI,aAAa,CACnC,GAAM,GACN,EAAK,GACL,EAAK,EACL,EAAK,EACL,GAAM,EACN,GAAM,EACV,CAAC,EAEKC,EAAgB,IAAI,aAAa,CACnC,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,CACT,CAAC,EAIKC,EAAkD,CACpD,SAAU,CACN,SAAU,CAAE,KAAMH,EAAc,OAAQ,WAAY,CACxD,CACJ,EAEMI,EAAmD,CACrD,SAAU,CACN,SAAU,CAAE,KAAMH,EAAe,OAAQ,WAAY,EACrD,mBAAoB,CAAE,KAAMC,EAAe,OAAQ,WAAY,CACnE,CACJ,EAMMG,EAAwB,CAC1B,KAAM,CAACT,EAAW,EAAGA,EAAW,CAAC,EACjC,OAAQ,cACZ,EACMU,EAAwB,CAAE,aAAc,gBAAiB,aAAc,gBAAiB,UAAW,UAAW,UAAW,WAIzHC,EAAoC,CACtC,iBAAkB,CAAC,EACnB,uBAAwB,CAAE,KAAM,CAAE,QAASF,EAAc,aAAc,CAAA,EAAK,YAAa,OAAQ,CACrG,EAKMG,EAAyB,CAC3B,WAAYD,EACZ,cAAe,CAAC,CACZ,SAAUV,EACV,SAAU,CACN,UAAW,CAAE,SAAU,eAAgB,EACvC,SAAUM,EAAe,SACzB,KAAM,CAAE,SAAU,aAAc,YAAa,CAAE,CACnD,CAAA,CACH,CAEL,EAGMM,EAAkB,CACpB,WAAY,CACR,iBAAkB,CAAC,CAAE,WAAY,CAAC,EAAK,EAAK,EAAK,CAAG,EAAG,OAAQ,QAAS,CAC5E,EACA,cAAe,CAAC,CACZ,SAAUV,EACV,iBAAkB,CAAE,SAAU,CAAE,QAASM,EAAc,QAASC,EAAe,EAC/E,SAAU,CACN,UAAW,CAAE,SAAU,eAAgB,EACvC,SAAUF,EAAgB,SAC1B,KAAM,CAAE,SAAU,aAAc,YAAa,CAAE,CACnD,CAAA,CACH,CACL,EAEAV,EAAM,OAAO,CAAE,gBAAiB,CAAC,CAAE,aAAc,CAACc,EAAYC,CAAG,EAAG,CAAA,CAAG,EAGvEf,EAAM,kBAAkBa,CAAW,EACnCb,EAAM,cAAcW,CAAY,EAChCX,EAAM,cAAcG,CAAY,EAChCH,EAAM,cAAcK,CAAW"}