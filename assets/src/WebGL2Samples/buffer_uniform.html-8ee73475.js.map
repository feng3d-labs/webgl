{"version":3,"file":"buffer_uniform.html-8ee73475.js","sources":["../../../../examples/src/WebGL2Samples/buffer_uniform.ts"],"sourcesContent":["import { CanvasContext, RenderObject, RenderPass, RenderPipeline, Submit, VertexAttributes } from \"@feng3d/render-api\";\nimport { WebGL } from \"@feng3d/webgl\";\nimport { getShaderSource } from \"./utility\";\n\n(function ()\n{\n    // --Init Canvas\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"glcanvas\";\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n    document.body.appendChild(canvas);\n\n    // --Init WebGL Context\n    const rc: CanvasContext = { canvasId: \"glcanvas\", webGLcontextId: \"webgl2\" };\n    const webgl = new WebGL(rc);\n\n    // -- Init Program\n    const program: RenderPipeline = {\n        vertex: { code: getShaderSource(\"vs\") }, fragment: { code: getShaderSource(\"fs\") },\n    };\n\n    // -- Init Buffer\n    const elementData = new Uint16Array([\n        0, 1, 2,\n        2, 3, 0\n    ]);\n\n    //vec3 position, vec3 normal, vec4 color\n    const vertices = new Float32Array([\n        -1.0, -1.0, -0.5, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0,\n        1.0, -1.0, -0.5, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0,\n        1.0, 1.0, -0.5, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0,\n        -1.0, 1.0, -0.5, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0\n    ]);\n\n    //mat4 P, mat4 MV, mat3 Mnormal\n    const transforms = {\n        transform: {\n            P: [1.0, 0.0, 0.0, 0.0,\n                0.0, 1.0, 0.0, 0.0,\n                0.0, 0.0, 1.0, 0.0,\n                0.0, 0.0, 0.0, 1.0,\n            ],\n            MV: [0.5, 0.0, 0.0, 0.0,\n                0.0, 0.5, 0.0, 0.0,\n                0.0, 0.0, 0.5, 0.0,\n                0.0, 0.0, 0.0, 1.0,\n            ],\n            Mnormal: [\n                1.0, 0.0, 0.0, 0.0,\n                0.0, 1.0, 0.0, 0.0,\n                0.0, 0.0, 1.0, 0.0,\n                0.0, 0.0, 0.0, 1.0,\n            ],\n        }\n    };\n\n    const lightPos = {\n        light: {\n            position: [0.0, 0.0, 0.0]\n        }\n    };\n\n    //vec3 ambient, diffuse, specular, float shininess\n    const material = {\n        material: {\n            ambient: [0.1, 0.0, 0.0],\n            diffuse: [0.5, 0.0, 0.0],\n            specular: [1.0, 1.0, 1.0],\n            shininess: 4.0,\n        }\n    };\n\n    // -- Init Vertex Array\n    const vertexArray: { vertices?: VertexAttributes } = {\n        vertices: {\n            position: { data: vertices, format: \"float32x3\", arrayStride: 40, offset: 0 },\n            normal: { data: vertices, format: \"float32x3\", arrayStride: 40, offset: 12 },\n            color: { data: vertices, format: \"float32x4\", arrayStride: 40, offset: 24 },\n        },\n    };\n\n    const ro: RenderObject = {\n        pipeline: program,\n        bindingResources: {\n            PerDraw: transforms,\n            PerPass: lightPos,\n            PerScene: material,\n        },\n        vertices: vertexArray.vertices,\n        indices: elementData,\n        draw: { __type__: \"DrawIndexed\", indexCount: 6, firstIndex: 0 }\n    };\n\n    const rp: RenderPass = {\n        descriptor: { colorAttachments: [{ clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: \"clear\" }] },\n        renderPassObjects: [ro],\n    };\n\n    const submit: Submit = { commandEncoders: [{ passEncoders: [rp] }] };\n\n    let uTime = 0;\n    function render()\n    {\n        uTime += 0.01;\n\n        // -- update uniform buffer\n        transforms.transform.MV[0] = 0.1 * Math.cos(uTime) + 0.4;\n        transforms.transform.MV = transforms.transform.MV; // 强制更新\n\n        lightPos.light.position[0] = Math.cos(3 * uTime);\n        lightPos.light.position[1] = Math.sin(6 * uTime);\n        lightPos.light.position = lightPos.light.position; // 强制更新\n\n        webgl.submit(submit);\n\n        requestAnimationFrame(render);\n    }\n\n    render();\n})();\n"],"names":["canvas","rc","webgl","WebGL","program","getShaderSource","elementData","vertices","transforms","lightPos","ro","submit","uTime","render"],"mappings":"4IAIC,UACD,CAEU,MAAAA,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,GAAK,WACZA,EAAO,MAAQ,OAAO,WACtBA,EAAO,OAAS,OAAO,YACd,SAAA,KAAK,YAAYA,CAAM,EAGhC,MAAMC,EAAoB,CAAE,SAAU,WAAY,eAAgB,QAAS,EACrEC,EAAQ,IAAIC,EAAMF,CAAE,EAGpBG,EAA0B,CAC5B,OAAQ,CAAE,KAAMC,EAAgB,IAAI,CAAE,EAAG,SAAU,CAAE,KAAMA,EAAgB,IAAI,CAAE,CAAA,EAI/EC,EAAc,IAAI,YAAY,CAChC,EAAG,EAAG,EACN,EAAG,EAAG,CAAA,CACT,EAGKC,EAAW,IAAI,aAAa,CAC9B,GAAM,GAAM,IAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAChD,EAAK,GAAM,IAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAC/C,EAAK,EAAK,IAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAC9C,GAAM,EAAK,IAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,CAAA,CAClD,EAGKC,EAAa,CACf,UAAW,CACP,EAAG,CAAC,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,CACnB,EACA,GAAI,CAAC,GAAK,EAAK,EAAK,EAChB,EAAK,GAAK,EAAK,EACf,EAAK,EAAK,GAAK,EACf,EAAK,EAAK,EAAK,CACnB,EACA,QAAS,CACL,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,CACnB,CACJ,CAAA,EAGEC,EAAW,CACb,MAAO,CACH,SAAU,CAAC,EAAK,EAAK,CAAG,CAC5B,CAAA,EAsBEC,EAAmB,CACrB,SAAUN,EACV,iBAAkB,CACd,QAASI,EACT,QAASC,EACT,SAvBS,CACb,SAAU,CACN,QAAS,CAAC,GAAK,EAAK,CAAG,EACvB,QAAS,CAAC,GAAK,EAAK,CAAG,EACvB,SAAU,CAAC,EAAK,EAAK,CAAG,EACxB,UAAW,CACf,CAAA,CAkBA,EACA,SAfiD,CACjD,SAAU,CACN,SAAU,CAAE,KAAMF,EAAU,OAAQ,YAAa,YAAa,GAAI,OAAQ,CAAE,EAC5E,OAAQ,CAAE,KAAMA,EAAU,OAAQ,YAAa,YAAa,GAAI,OAAQ,EAAG,EAC3E,MAAO,CAAE,KAAMA,EAAU,OAAQ,YAAa,YAAa,GAAI,OAAQ,EAAG,CAC9E,CAAA,EAUsB,SACtB,QAASD,EACT,KAAM,CAAE,SAAU,cAAe,WAAY,EAAG,WAAY,CAAE,CAAA,EAQ5DK,EAAiB,CAAE,gBAAiB,CAAC,CAAE,aAAc,CALpC,CACnB,WAAY,CAAE,iBAAkB,CAAC,CAAE,WAAY,CAAC,EAAK,EAAK,EAAK,CAAG,EAAG,OAAQ,OAAS,CAAA,CAAE,EACxF,kBAAmB,CAACD,CAAE,CAAA,CAGoC,CAAG,CAAA,GAEjE,IAAIE,EAAQ,EACZ,SAASC,GACT,CACaD,GAAA,IAGEJ,EAAA,UAAU,GAAG,CAAC,EAAI,GAAM,KAAK,IAAII,CAAK,EAAI,GAC1CJ,EAAA,UAAU,GAAKA,EAAW,UAAU,GAE/CC,EAAS,MAAM,SAAS,CAAC,EAAI,KAAK,IAAI,EAAIG,CAAK,EAC/CH,EAAS,MAAM,SAAS,CAAC,EAAI,KAAK,IAAI,EAAIG,CAAK,EACtCH,EAAA,MAAM,SAAWA,EAAS,MAAM,SAEzCP,EAAM,OAAOS,CAAM,EAEnB,sBAAsBE,CAAM,CAChC,CAEOA,GACX,GAAG"}