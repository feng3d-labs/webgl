{"version":3,"file":"batch.html-3ba475ab.js","sources":["../../../../examples/src/regl-examples/batch.ts"],"sourcesContent":["import { reactive } from \"@feng3d/reactivity\";\nimport { RenderObject, RenderPipeline, Submit, VertexAttributes } from \"@feng3d/render-api\";\nimport { WebGL } from \"@feng3d/webgl\";\n\nconst canvas = document.createElement(\"canvas\");\ncanvas.id = \"glcanvas\";\ncanvas.width = window.innerWidth;\ncanvas.height = window.innerHeight;\ndocument.body.appendChild(canvas);\n\nconst webgl = new WebGL({ canvasId: \"glcanvas\" });\n\nlet batchId = 0;\nlet tick = 0;\nconst offsets = [{ offset: [-1, -1] },\n{ offset: [-1, 0] },\n{ offset: [-1, 1] },\n{ offset: [0, -1] },\n{ offset: [0, 0] },\n{ offset: [0, 1] },\n{ offset: [1, -1] },\n{ offset: [1, 0] },\n{ offset: [1, 1] }];\n\nconst pipeline: RenderPipeline = {\n    vertex: {\n        code: `precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }` },\n    fragment: {\n        code: `precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }` },\n    depthStencil: { depthWriteEnabled: false },\n};\n\nconst vertexArray: { vertices?: VertexAttributes } = {\n    vertices: {\n        position: {\n            data: new Float32Array([\n                0.5, 0,\n                0, 0.5,\n                1, 1\n            ]),\n            format: \"float32x2\",\n        },\n    }\n};\n\nfunction getRenderObject(batchId: number)\n{\n    const renderObject: RenderObject = {\n        vertices: vertexArray.vertices,\n        draw: { __type__: \"DrawVertex\", vertexCount: 3 },\n        bindingResources: {\n            offset: offsets[batchId].offset,\n        },\n        pipeline,\n    };\n\n    return renderObject;\n}\n\nconst renderObjects: RenderObject[] = [];\nfor (let i = 0; i < offsets.length; i++)\n{\n    renderObjects.push(getRenderObject(i));\n}\n\nconst submit: Submit = {\n    commandEncoders: [{\n        passEncoders: [\n            {\n                descriptor: { colorAttachments: [{ clearValue: [0, 0, 0, 1] }] },\n                renderPassObjects: renderObjects\n            }\n        ]\n    }]\n};\n\nfunction draw()\n{\n    canvas.width = canvas.clientWidth;\n    canvas.height = canvas.clientHeight;\n\n    tick++;\n\n    for (let i = 0; i < offsets.length; i++)\n    {\n        batchId = i;\n        //\n        const ro = renderObjects[i];\n        reactive(ro.bindingResources).color = [\n            Math.sin(0.02 * ((0.1 + Math.sin(batchId)) * tick + 3.0 * batchId)),\n            Math.cos(0.02 * (0.02 * tick + 0.1 * batchId)),\n            Math.sin(0.02 * ((0.3 + Math.cos(2.0 * batchId)) * tick + 0.8 * batchId)),\n            1];\n        reactive(ro.bindingResources).angle = 0.01 * tick;\n    }\n\n    webgl.submit(submit);\n\n    requestAnimationFrame(draw);\n}\ndraw();\n"],"names":["canvas","webgl","WebGL","batchId","tick","offsets","pipeline","vertexArray","getRenderObject","renderObjects","i","submit","draw","ro","reactive"],"mappings":"yIAIA,MAAMA,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,GAAK,WACZA,EAAO,MAAQ,OAAO,WACtBA,EAAO,OAAS,OAAO,YACvB,SAAS,KAAK,YAAYA,CAAM,EAEhC,MAAMC,EAAQ,IAAIC,EAAM,CAAE,SAAU,UAAY,CAAA,EAEhD,IAAIC,EAAU,EACVC,EAAO,EACX,MAAMC,EAAU,CAAC,CAAE,OAAQ,CAAC,GAAI,EAAE,CAAE,EACpC,CAAE,OAAQ,CAAC,GAAI,CAAC,CAAE,EAClB,CAAE,OAAQ,CAAC,GAAI,CAAC,CAAE,EAClB,CAAE,OAAQ,CAAC,EAAG,EAAE,CAAE,EAClB,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAE,EACjB,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAE,EACjB,CAAE,OAAQ,CAAC,EAAG,EAAE,CAAE,EAClB,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAE,EACjB,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAE,CAAC,EAEZC,EAA2B,CAC7B,OAAQ,CACJ,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQP,EACH,SAAU,CACN,KAAM;AAAA;AAAA;AAAA;AAAA,MAIP,EACH,aAAc,CAAE,kBAAmB,EAAM,CAC7C,EAEMC,EAA+C,CACjD,SAAU,CACN,SAAU,CACN,KAAM,IAAI,aAAa,CACnB,GAAK,EACL,EAAG,GACH,EAAG,CAAA,CACN,EACD,OAAQ,WACZ,CACJ,CACJ,EAEA,SAASC,EAAgBL,EACzB,CAUW,MAT4B,CAC/B,SAAUI,EAAY,SACtB,KAAM,CAAE,SAAU,aAAc,YAAa,CAAE,EAC/C,iBAAkB,CACd,OAAQF,EAAQF,CAAO,EAAE,MAC7B,EACA,SAAAG,CAAA,CAIR,CAEA,MAAMG,EAAgC,CAAA,EACtC,QAASC,EAAI,EAAGA,EAAIL,EAAQ,OAAQK,IAElBD,EAAA,KAAKD,EAAgBE,CAAC,CAAC,EAGzC,MAAMC,EAAiB,CACnB,gBAAiB,CAAC,CACd,aAAc,CACV,CACI,WAAY,CAAE,iBAAkB,CAAC,CAAE,WAAY,CAAC,EAAG,EAAG,EAAG,CAAC,CAAA,CAAG,CAAE,EAC/D,kBAAmBF,CACvB,CACJ,CAAA,CACH,CACL,EAEA,SAASG,GACT,CACIZ,EAAO,MAAQA,EAAO,YACtBA,EAAO,OAASA,EAAO,aAEvBI,IAEA,QAASM,EAAI,EAAGA,EAAIL,EAAQ,OAAQK,IACpC,CACcP,EAAAO,EAEJ,MAAAG,EAAKJ,EAAcC,CAAC,EACjBI,EAAAD,EAAG,gBAAgB,EAAE,MAAQ,CAClC,KAAK,IAAI,MAAS,GAAM,KAAK,IAAIV,CAAO,GAAKC,EAAO,EAAMD,EAAQ,EAClE,KAAK,IAAI,KAAQ,IAAOC,EAAO,GAAMD,EAAQ,EAC7C,KAAK,IAAI,MAAS,GAAM,KAAK,IAAI,EAAMA,CAAO,GAAKC,EAAO,GAAMD,EAAQ,EACxE,CAAA,EACJW,EAASD,EAAG,gBAAgB,EAAE,MAAQ,IAAOT,CACjD,CAEAH,EAAM,OAAOU,CAAM,EAEnB,sBAAsBC,CAAI,CAC9B,CACAA,EAAK"}