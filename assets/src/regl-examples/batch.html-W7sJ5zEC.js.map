{"version":3,"file":"batch.html-W7sJ5zEC.js","sources":["../../../../examples/src/regl-examples/batch.ts"],"sourcesContent":["import { reactive } from '@feng3d/reactivity';\nimport { RenderObject, RenderPipeline, Submit, VertexAttributes } from '@feng3d/render-api';\nimport { WebGL } from '@feng3d/webgl';\n\nconst canvas = document.createElement('canvas');\n\ncanvas.id = 'glcanvas';\ncanvas.width = window.innerWidth;\ncanvas.height = window.innerHeight;\ndocument.body.appendChild(canvas);\n\nconst webgl = new WebGL({ canvasId: 'glcanvas' });\n\nlet batchId = 0;\nlet tick = 0;\nconst offsets = [{ offset: [-1, -1] },\n    { offset: [-1, 0] },\n    { offset: [-1, 1] },\n    { offset: [0, -1] },\n    { offset: [0, 0] },\n    { offset: [0, 1] },\n    { offset: [1, -1] },\n    { offset: [1, 0] },\n    { offset: [1, 1] }];\n\nconst pipeline: RenderPipeline = {\n    vertex: {\n        code: `precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }` },\n    fragment: {\n        code: `precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }` },\n    depthStencil: { depthWriteEnabled: false },\n};\n\nconst vertexArray: { vertices?: VertexAttributes } = {\n    vertices: {\n        position: {\n            data: new Float32Array([\n                0.5, 0,\n                0, 0.5,\n                1, 1,\n            ]),\n            format: 'float32x2',\n        },\n    },\n};\n\nfunction getRenderObject(batchId: number)\n{\n    const renderObject: RenderObject = {\n        vertices: vertexArray.vertices,\n        draw: { __type__: 'DrawVertex', vertexCount: 3 },\n        bindingResources: {\n            offset: { value: offsets[batchId].offset },\n        },\n        pipeline,\n    };\n\n    return renderObject;\n}\n\nconst renderObjects: RenderObject[] = [];\n\nfor (let i = 0; i < offsets.length; i++)\n{\n    renderObjects.push(getRenderObject(i));\n}\n\nconst submit: Submit = {\n    commandEncoders: [{\n        passEncoders: [\n            {\n                descriptor: { colorAttachments: [{ clearValue: [0, 0, 0, 1] }] },\n                renderPassObjects: renderObjects,\n            },\n        ],\n    }],\n};\n\nfunction draw()\n{\n    canvas.width = canvas.clientWidth;\n    canvas.height = canvas.clientHeight;\n\n    tick++;\n\n    for (let i = 0; i < offsets.length; i++)\n    {\n        batchId = i;\n        //\n        const ro = renderObjects[i];\n\n        reactive(ro.bindingResources).color = { value: [\n            Math.sin(0.02 * ((0.1 + Math.sin(batchId)) * tick + 3.0 * batchId)),\n            Math.cos(0.02 * (0.02 * tick + 0.1 * batchId)),\n            Math.sin(0.02 * ((0.3 + Math.cos(2.0 * batchId)) * tick + 0.8 * batchId)),\n            1] };\n        reactive(ro.bindingResources).angle = { value: 0.01 * tick };\n    }\n\n    webgl.submit(submit);\n\n    requestAnimationFrame(draw);\n}\ndraw();\n"],"names":["canvas","webgl","WebGL","batchId","tick","offsets","pipeline","vertexArray","getRenderObject","renderObjects","i","submit","draw","ro","reactive"],"mappings":"oGAIA,MAAMA,EAAS,SAAS,cAAc,QAAQ,EAE9CA,EAAO,GAAK,WACZA,EAAO,MAAQ,OAAO,WACtBA,EAAO,OAAS,OAAO,YACvB,SAAS,KAAK,YAAYA,CAAM,EAEhC,MAAMC,EAAQ,IAAIC,EAAM,CAAE,SAAU,WAAY,EAEhD,IAAIC,EAAU,EACVC,EAAO,EACX,MAAMC,EAAU,CAAC,CAAE,OAAQ,CAAC,GAAI,EAAE,CAAA,EAC9B,CAAE,OAAQ,CAAC,GAAI,CAAC,CAAA,EAChB,CAAE,OAAQ,CAAC,GAAI,CAAC,CAAA,EAChB,CAAE,OAAQ,CAAC,EAAG,EAAE,CAAA,EAChB,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAA,EACf,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAA,EACf,CAAE,OAAQ,CAAC,EAAG,EAAE,CAAA,EAChB,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAA,EACf,CAAE,OAAQ,CAAC,EAAG,CAAC,CAAA,CAAG,EAEhBC,EAA2B,CAC7B,OAAQ,CACJ,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAA,EASV,SAAU,CACN,KAAM;AAAA;AAAA;AAAA;AAAA,MAAA,EAKV,aAAc,CAAE,kBAAmB,EAAA,CACvC,EAEMC,EAA+C,CACjD,SAAU,CACN,SAAU,CACN,KAAM,IAAI,aAAa,CACnB,GAAK,EACL,EAAG,GACH,EAAG,CAAA,CACN,EACD,OAAQ,WAAA,CACZ,CAER,EAEA,SAASC,EAAgBL,EACzB,CAUI,MATmC,CAC/B,SAAUI,EAAY,SACtB,KAAM,CAAE,SAAU,aAAc,YAAa,CAAA,EAC7C,iBAAkB,CACd,OAAQ,CAAE,MAAOF,EAAQF,CAAO,EAAE,MAAA,CAAO,EAE7C,SAAAG,CAAA,CAIR,CAEA,MAAMG,EAAgC,CAAA,EAEtC,QAASC,EAAI,EAAGA,EAAIL,EAAQ,OAAQK,IAEhCD,EAAc,KAAKD,EAAgBE,CAAC,CAAC,EAGzC,MAAMC,EAAiB,CACnB,gBAAiB,CAAC,CACd,aAAc,CACV,CACI,WAAY,CAAE,iBAAkB,CAAC,CAAE,WAAY,CAAC,EAAG,EAAG,EAAG,CAAC,CAAA,CAAG,CAAA,EAC7D,kBAAmBF,CAAA,CACvB,CACJ,CACH,CACL,EAEA,SAASG,GACT,CACIZ,EAAO,MAAQA,EAAO,YACtBA,EAAO,OAASA,EAAO,aAEvBI,IAEA,QAASM,EAAI,EAAGA,EAAIL,EAAQ,OAAQK,IACpC,CACIP,EAAUO,EAEV,MAAMG,EAAKJ,EAAcC,CAAC,EAE1BI,EAASD,EAAG,gBAAgB,EAAE,MAAQ,CAAE,MAAO,CAC3C,KAAK,IAAI,MAAS,GAAM,KAAK,IAAIV,CAAO,GAAKC,EAAO,EAAMD,EAAQ,EAClE,KAAK,IAAI,KAAQ,IAAOC,EAAO,GAAMD,EAAQ,EAC7C,KAAK,IAAI,MAAS,GAAM,KAAK,IAAI,EAAMA,CAAO,GAAKC,EAAO,GAAMD,EAAQ,EACxE,CAAA,CAAC,EACLW,EAASD,EAAG,gBAAgB,EAAE,MAAQ,CAAE,MAAO,IAAOT,CAAA,CAC1D,CAEAH,EAAM,OAAOU,CAAM,EAEnB,sBAAsBC,CAAI,CAC9B,CACAA,EAAA"}