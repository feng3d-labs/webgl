{"version":3,"file":"cube.html-BGrn6zhk.js","sources":["../../../../examples/src/regl-examples/cube.ts"],"sourcesContent":["import { reactive } from '@feng3d/reactivity';\nimport { RenderObject, Submit } from '@feng3d/render-api';\nimport { SamplerTexture, WebGL } from '@feng3d/webgl';\nimport * as mat4 from './stackgl/gl-mat4';\n\n(async () =>\n{\n    const canvas = document.createElement('canvas');\n\n    canvas.id = 'glcanvas';\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n    document.body.appendChild(canvas);\n\n    const webgl = new WebGL({ canvasId: 'glcanvas' });\n\n    const cubePosition = [\n        [-0.5, +0.5, +0.5], [+0.5, +0.5, +0.5], [+0.5, -0.5, +0.5], [-0.5, -0.5, +0.5], // positive z face.\n        [+0.5, +0.5, +0.5], [+0.5, +0.5, -0.5], [+0.5, -0.5, -0.5], [+0.5, -0.5, +0.5], // positive x face\n        [+0.5, +0.5, -0.5], [-0.5, +0.5, -0.5], [-0.5, -0.5, -0.5], [+0.5, -0.5, -0.5], // negative z face\n        [-0.5, +0.5, -0.5], [-0.5, +0.5, +0.5], [-0.5, -0.5, +0.5], [-0.5, -0.5, -0.5], // negative x face.\n        [-0.5, +0.5, -0.5], [+0.5, +0.5, -0.5], [+0.5, +0.5, +0.5], [-0.5, +0.5, +0.5], // top face\n        [-0.5, -0.5, -0.5], [+0.5, -0.5, -0.5], [+0.5, -0.5, +0.5], [-0.5, -0.5, +0.5], // bottom face\n    ];\n\n    const cubeUv = [\n        [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0], // positive z face.\n        [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0], // positive x face.\n        [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0], // negative z face.\n        [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0], // negative x face.\n        [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0], // top face\n        [0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0], // bottom face\n    ];\n\n    const cubeElements = [\n        [2, 1, 0], [2, 0, 3], // positive z face.\n        [6, 5, 4], [6, 4, 7], // positive x face.\n        [10, 9, 8], [10, 8, 11], // negative z face.\n        [14, 13, 12], [14, 12, 15], // negative x face.\n        [18, 17, 16], [18, 16, 19], // top face.\n        [20, 21, 22], [23, 20, 22], // bottom face\n    ];\n\n    const positions = cubePosition.reduce((pv: number[], cv: number[]) =>\n    {\n        cv.forEach((v) =>\n        {\n            pv.push(v);\n        });\n\n        return pv;\n    }, []);\n\n    const uvs = cubeUv.reduce((pv: number[], cv: number[]) =>\n    {\n        cv.forEach((v) =>\n        {\n            pv.push(v);\n        });\n\n        return pv;\n    }, []);\n\n    const indices = cubeElements.reduce((pv: number[], cv: number[]) =>\n    {\n        cv.forEach((v) =>\n        {\n            pv.push(v);\n        });\n\n        return pv;\n    }, []);\n\n    let tick = 0;\n    let viewportWidth = 1;\n    let viewportHeight = 1;\n\n    const renderObject: RenderObject = {\n        vertices: {\n            position: { data: new Float32Array(positions), format: 'float32x3' },\n            uv: { data: new Float32Array(uvs), format: 'float32x2' },\n        },\n        indices: new Uint16Array(indices),\n        draw: { __type__: 'DrawIndexed', indexCount: indices.length },\n        bindingResources: {},\n        pipeline: {\n            vertex: {\n                code: `precision mediump float;\n        attribute vec3 position;\n        attribute vec2 uv;\n        varying vec2 vUv;\n        uniform mat4 projection, view;\n        void main() {\n          vUv = uv;\n          gl_Position = projection * view * vec4(position, 1);\n        }` },\n            fragment: {\n                code: `precision mediump float;\n        varying vec2 vUv;\n        uniform sampler2D tex;\n        void main () {\n          gl_FragColor = texture2D(tex,vUv);\n        }`,\n                targets: [{ blend: {} }],\n            },\n            depthStencil: { depthWriteEnabled: true },\n        },\n    };\n\n    const submit: Submit = {\n        commandEncoders: [{\n            passEncoders: [\n                {\n                    descriptor: { colorAttachments: [{ clearValue: [0, 0, 0, 1] }] },\n                    renderPassObjects: [renderObject],\n                },\n            ],\n        }],\n    };\n\n    function draw()\n    {\n        tick++;\n\n        viewportWidth = canvas.width = canvas.clientWidth;\n        viewportHeight = canvas.height = canvas.clientHeight;\n\n        const t = 0.01 * tick;\n\n        reactive(renderObject.bindingResources).view = {\n            value: mat4.lookAt([],\n                [5 * Math.cos(t), 2.5 * Math.sin(t), 5 * Math.sin(t)],\n                [0, 0.0, 0],\n                [0, 1, 0]),\n        };\n        reactive(renderObject.bindingResources).projection = {\n            value: mat4.perspective([],\n                Math.PI / 4,\n                viewportWidth / viewportHeight,\n                0.01,\n                1000),\n        };\n\n        webgl.submit(submit);\n\n        requestAnimationFrame(draw);\n    }\n\n    const img = new Image();\n\n    img.src = '../../assets/peppers.png';\n    await img.decode();\n\n    const diffuse: SamplerTexture = {\n        texture: {\n            descriptor: {\n                size: [img.width, img.height],\n            },\n            sources: [{ image: img }],\n        }, sampler: { minFilter: 'linear' },\n    };\n\n    reactive(renderObject.bindingResources).tex = diffuse;\n\n    draw();\n})();"],"names":["canvas","webgl","WebGL","cubePosition","cubeUv","cubeElements","positions","pv","cv","v","uvs","indices","tick","viewportWidth","viewportHeight","renderObject","submit","draw","t","reactive","mat4.lookAt","mat4.perspective","img","diffuse"],"mappings":"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"}