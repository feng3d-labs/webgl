{"version":3,"file":"sample4.html-DKEWhVHw.js","sources":["../../../../examples/src/webgl-examples/sample4.ts"],"sourcesContent":["import { reactive } from '@feng3d/reactivity';\nimport { RenderPass, RenderObject } from '@feng3d/render-api';\nimport { WebGL } from '@feng3d/webgl';\nimport { mat4 } from 'gl-matrix';\n\nlet squareRotation = 0.0;\n\nmain();\n\n//\n// Start here\n//\nfunction main()\n{\n    const canvas = document.querySelector('#glcanvas') as HTMLCanvasElement;\n\n    const webgl = new WebGL({ canvasId: 'glcanvas', webGLcontextId: 'webgl' });\n\n    const renderObject: RenderObject = {\n        pipeline: {\n            vertex: {\n                code: `\n        attribute vec4 aVertexPosition;\n        attribute vec4 aVertexColor;\n    \n        uniform mat4 uModelViewMatrix;\n        uniform mat4 uProjectionMatrix;\n    \n        varying lowp vec4 vColor;\n    \n        void main(void) {\n          gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n          vColor = aVertexColor;\n        }\n      ` }, fragment: {\n                code: `\n        varying lowp vec4 vColor;\n    \n        void main(void) {\n          gl_FragColor = vColor;\n        }\n      ` },\n            depthStencil: { depthCompare: 'less-equal' },\n            primitive: { topology: 'triangle-strip' },\n        },\n        vertices: {\n            aVertexPosition: {\n                format: 'float32x2',\n                data: new Float32Array([\n                    1.0, 1.0,\n                    -1.0, 1.0,\n                    1.0, -1.0,\n                    -1.0, -1.0,\n                ]),\n            },\n            aVertexColor: {\n                format: 'float32x4',\n                data: new Float32Array([\n                    1.0, 1.0, 1.0, 1.0, // white\n                    1.0, 0.0, 0.0, 1.0, // red\n                    0.0, 1.0, 0.0, 1.0, // green\n                    0.0, 0.0, 1.0, 1.0, // blue\n                ]),\n            },\n        },\n        draw: { __type__: 'DrawVertex', firstVertex: 0, vertexCount: 4 },\n        bindingResources: {},\n    };\n\n    const renderPass: RenderPass = {\n        descriptor: {\n            colorAttachments: [{\n                clearValue: [0.0, 0.0, 0.0, 1.0],\n                loadOp: 'clear',\n            }],\n            depthStencilAttachment: {\n                depthClearValue: 1.0,\n                depthLoadOp: 'clear',\n            },\n        },\n        renderPassObjects: [renderObject],\n    };\n\n    let then = 0;\n\n    // Draw the scene repeatedly\n    function render(now: number)\n    {\n        now *= 0.001; // convert to seconds\n        const deltaTime = now - then;\n\n        then = now;\n\n        const { projectionMatrix, modelViewMatrix } = drawScene(canvas, deltaTime);\n\n        reactive(renderObject.bindingResources).uProjectionMatrix = { value: projectionMatrix as Float32Array };\n        reactive(renderObject.bindingResources).uModelViewMatrix = { value: modelViewMatrix as Float32Array };\n\n        webgl.submit({ commandEncoders: [{ passEncoders: [renderPass] }] });\n\n        requestAnimationFrame(render);\n    }\n    requestAnimationFrame(render);\n}\n\n//\n// Draw the scene.\n//\nfunction drawScene(canvas: HTMLCanvasElement, deltaTime: number)\n{\n    // Create a perspective matrix, a special matrix that is\n    // used to simulate the distortion of perspective in a camera.\n    // Our field of view is 45 degrees, with a width/height\n    // ratio that matches the display size of the canvas\n    // and we only want to see objects between 0.1 units\n    // and 100 units away from the camera.\n\n    const fieldOfView = 45 * Math.PI / 180; // in radians\n    const aspect = canvas.clientWidth / canvas.clientHeight;\n    const zNear = 0.1;\n    const zFar = 100.0;\n    const projectionMatrix = mat4.create();\n\n    // note: glmatrix.js always has the first argument\n    // as the destination to receive the result.\n    mat4.perspective(projectionMatrix,\n        fieldOfView,\n        aspect,\n        zNear,\n        zFar);\n\n    // Set the drawing position to the \"identity\" point, which is\n    // the center of the scene.\n    const modelViewMatrix = mat4.create();\n\n    // Now move the drawing position a bit to where we want to\n    // start drawing the square.\n\n    mat4.translate(modelViewMatrix, // destination matrix\n        modelViewMatrix, // matrix to translate\n        [-0.0, 0.0, -6.0]); // amount to translate\n    mat4.rotate(modelViewMatrix, // destination matrix\n        modelViewMatrix, // matrix to rotate\n        squareRotation, // amount to rotate in radians\n        [0, 0, 1]); // axis to rotate around\n\n    // Update the rotation for the next draw\n\n    squareRotation += deltaTime;\n\n    return { projectionMatrix, modelViewMatrix };\n}\n"],"names":["squareRotation","main","canvas","webgl","WebGL","renderObject","renderPass","then","render","now","deltaTime","projectionMatrix","modelViewMatrix","drawScene","reactive","fieldOfView","aspect","zNear","zFar","mat4.create","mat4.perspective","mat4.translate","mat4.rotate"],"mappings":"gOAKA,IAAIA,EAAiB,EAErBC,EAAA,EAKA,SAASA,GACT,CACI,MAAMC,EAAS,SAAS,cAAc,WAAW,EAE3CC,EAAQ,IAAIC,EAAM,CAAE,SAAU,WAAY,eAAgB,QAAS,EAEnEC,EAA6B,CAC/B,SAAU,CACN,OAAQ,CACJ,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAA,EAaX,SAAU,CACL,KAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAA,EAOV,aAAc,CAAE,aAAc,YAAA,EAC9B,UAAW,CAAE,SAAU,gBAAA,CAAiB,EAE5C,SAAU,CACN,gBAAiB,CACb,OAAQ,YACR,KAAM,IAAI,aAAa,CACnB,EAAK,EACL,GAAM,EACN,EAAK,GACL,GAAM,EAAA,CACT,CAAA,EAEL,aAAc,CACV,OAAQ,YACR,KAAM,IAAI,aAAa,CACnB,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,EACf,EAAK,EAAK,EAAK,CAAA,CAClB,CAAA,CACL,EAEJ,KAAM,CAAE,SAAU,aAAc,YAAa,EAAG,YAAa,CAAA,EAC7D,iBAAkB,CAAA,CAAC,EAGjBC,EAAyB,CAC3B,WAAY,CACR,iBAAkB,CAAC,CACf,WAAY,CAAC,EAAK,EAAK,EAAK,CAAG,EAC/B,OAAQ,OAAA,CACX,EACD,uBAAwB,CACpB,gBAAiB,EACjB,YAAa,OAAA,CACjB,EAEJ,kBAAmB,CAACD,CAAY,CAAA,EAGpC,IAAIE,EAAO,EAGX,SAASC,EAAOC,EAChB,CACIA,GAAO,KACP,MAAMC,EAAYD,EAAMF,EAExBA,EAAOE,EAEP,KAAM,CAAE,iBAAAE,EAAkB,gBAAAC,CAAA,EAAoBC,EAAUX,EAAQQ,CAAS,EAEzEI,EAAST,EAAa,gBAAgB,EAAE,kBAAoB,CAAE,MAAOM,CAAA,EACrEG,EAAST,EAAa,gBAAgB,EAAE,iBAAmB,CAAE,MAAOO,CAAA,EAEpET,EAAM,OAAO,CAAE,gBAAiB,CAAC,CAAE,aAAc,CAACG,CAAU,CAAA,CAAG,EAAG,EAElE,sBAAsBE,CAAM,CAChC,CACA,sBAAsBA,CAAM,CAChC,CAKA,SAASK,EAAUX,EAA2BQ,EAC9C,CAQI,MAAMK,EAAc,GAAK,KAAK,GAAK,IAC7BC,EAASd,EAAO,YAAcA,EAAO,aACrCe,EAAQ,GACRC,EAAO,IACPP,EAAmBQ,EAAK,EAI9BC,EAAiBT,EACbI,EACAC,EACAC,EACAC,CAAA,EAIJ,MAAMN,EAAkBO,EAAK,EAK7BE,OAAAA,EAAeT,EACXA,EACA,CAAC,GAAM,EAAK,EAAI,CAAA,EACpBU,EAAYV,EACRA,EACAZ,EACA,CAAC,EAAG,EAAG,CAAC,CAAA,EAIZA,GAAkBU,EAEX,CAAE,iBAAAC,EAAkB,gBAAAC,CAAA,CAC/B"}