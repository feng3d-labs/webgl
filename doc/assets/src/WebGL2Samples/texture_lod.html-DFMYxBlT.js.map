{"version":3,"file":"texture_lod.html-DFMYxBlT.js","sources":["../../../../examples/src/WebGL2Samples/texture_lod.ts"],"sourcesContent":["import { CanvasContext, RenderObject, RenderPass, RenderPassObject, RenderPipeline, Sampler, Texture, VertexAttributes } from '@feng3d/render-api';\nimport { WebGL } from '@feng3d/webgl';\n\nimport { getShaderSource, loadImage } from './utility';\n\n(function ()\n{\n    const canvas = document.createElement('canvas');\n\n    canvas.id = 'glcanvas';\n    canvas.width = Math.min(window.innerWidth, window.innerHeight);\n    canvas.height = canvas.width;\n    document.body.appendChild(canvas);\n\n    const rc: CanvasContext = { canvasId: 'glcanvas', webGLcontextId: 'webgl2', webGLContextAttributes: { antialias: false } };\n    const webgl = new WebGL(rc);\n\n    // -- Mouse Behaviour\n    let scale = 1.0;\n    let mouseDown = false;\n    let lastMouseY = 0;\n\n    window.onmousedown = function (event)\n    {\n        mouseDown = true;\n        lastMouseY = event.clientY;\n    };\n    window.onmouseup = function (event)\n    {\n        mouseDown = false;\n    };\n    window.onmousemove = function (event)\n    {\n        if (!mouseDown)\n        {\n            return;\n        }\n        const newY = event.clientY;\n\n        const deltaY = newY - lastMouseY;\n\n        scale += deltaY / 100;\n\n        lastMouseY = newY;\n    };\n\n    // -- Divide viewport\n    const windowSize = {\n        x: canvas.width,\n        y: canvas.height,\n    };\n\n    const Corners = {\n        TOP_LEFT: 0,\n        TOP_RIGHT: 1,\n        BOTTOM_RIGHT: 2,\n        BOTTOM_LEFT: 3,\n        MAX: 4,\n    };\n\n    const viewport: { x: number, y: number, z: number, w: number }[] = new Array(Corners.MAX);\n\n    viewport[Corners.BOTTOM_LEFT] = {\n        x: 0,\n        y: 0,\n        z: windowSize.x / 2,\n        w: windowSize.y / 2,\n    };\n\n    viewport[Corners.BOTTOM_RIGHT] = {\n        x: windowSize.x / 2,\n        y: 0,\n        z: windowSize.x / 2,\n        w: windowSize.y / 2,\n    };\n\n    viewport[Corners.TOP_RIGHT] = {\n        x: windowSize.x / 2,\n        y: windowSize.y / 2,\n        z: windowSize.x / 2,\n        w: windowSize.y / 2,\n    };\n\n    viewport[Corners.TOP_LEFT] = {\n        x: 0,\n        y: windowSize.y / 2,\n        z: windowSize.x / 2,\n        w: windowSize.y / 2,\n    };\n\n    // -- Initialize program\n    const program: RenderPipeline = {\n        vertex: { code: getShaderSource('vs') }, fragment: { code: getShaderSource('fs') },\n    };\n\n    // -- Initialize buffer\n    const positions = new Float32Array([\n        -1.0, -1.0,\n        1.0, -1.0,\n        1.0, 1.0,\n        1.0, 1.0,\n        -1.0, 1.0,\n        -1.0, -1.0,\n    ]);\n\n    const texcoords = new Float32Array([\n        0.0, 1.0,\n        1.0, 1.0,\n        1.0, 0.0,\n        1.0, 0.0,\n        0.0, 0.0,\n        0.0, 1.0,\n    ]);\n\n    // -- Initialize vertex array\n    const vertexArray: { vertices?: VertexAttributes } = {\n        vertices: {\n            position: { data: positions, format: 'float32x2' },\n            textureCoordinates: { data: texcoords, format: 'float32x2' },\n        },\n    };\n\n    // -- Load texture then render\n    const imageUrl = '../../assets/img/Di-3d.png';\n    const textures: Texture[] = new Array(Corners.MAX);\n    const samplers: Sampler[] = new Array(Corners.MAX);\n\n    loadImage(imageUrl, function (image)\n    {\n        textures[Corners.TOP_LEFT] = {\n            descriptor: {\n                size: [image.width, image.height],\n                format: 'rgba8unorm',\n                generateMipmap: true,\n            },\n            sources: [{ mipLevel: 0, image }],\n        };\n        samplers[Corners.TOP_LEFT] = {\n            minFilter: 'linear',\n            magFilter: 'linear',\n            mipmapFilter: 'linear',\n        };\n\n        textures[Corners.TOP_RIGHT] = {\n            descriptor: {\n                size: [image.width, image.height],\n                format: 'rgba8unorm',\n                generateMipmap: true,\n            },\n            sources: [{ mipLevel: 0, image }],\n        };\n        samplers[Corners.TOP_RIGHT] = {\n            minFilter: 'linear',\n            magFilter: 'linear',\n            mipmapFilter: 'linear',\n            lodMinClamp: 3.0,\n            lodMaxClamp: 3.0,\n        };\n\n        textures[Corners.BOTTOM_LEFT] = {\n            descriptor: {\n                size: [image.width, image.height],\n                format: 'rgba8unorm',\n                generateMipmap: true,\n            },\n            sources: [{ mipLevel: 0, image }],\n        };\n        samplers[Corners.BOTTOM_LEFT] = {\n            minFilter: 'linear',\n            magFilter: 'linear',\n            mipmapFilter: 'linear',\n            lodMinClamp: 0.0,\n            lodMaxClamp: 10.0,\n        };\n\n        textures[Corners.BOTTOM_RIGHT] = {\n            descriptor: {\n                size: [image.width, image.height],\n                format: 'rgba8unorm',\n                generateMipmap: true,\n            },\n            sources: [{ mipLevel: 0, image }],\n        };\n        samplers[Corners.BOTTOM_RIGHT] = {\n            minFilter: 'linear',\n            magFilter: 'linear',\n            mipmapFilter: 'linear',\n            lodMinClamp: 0.0,\n            lodMaxClamp: 10.0,\n        };\n\n        render();\n    });\n\n    function render()\n    {\n        const renderObjects: RenderPassObject[] = [];\n        // Clear color buffer\n        const rp: RenderPass = {\n            descriptor: { colorAttachments: [{ clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: 'clear' }] },\n            renderPassObjects: renderObjects,\n        };\n\n        const matrix = new Float32Array([\n            scale, 0.0, 0.0, 0.0,\n            0.0, scale, 0.0, 0.0,\n            0.0, 0.0, scale, 0.0,\n            0.0, 0.0, 0.0, 1.0,\n        ]);\n\n        const ro: RenderObject = {\n            pipeline: program,\n            bindingResources: {\n                mvp: { value: matrix },\n            },\n            vertices: vertexArray.vertices,\n            draw: { __type__: 'DrawVertex', vertexCount: 6 },\n        };\n\n        const lodBiasArray = [0.0, 0.0, 0.0, 0.0];\n\n        lodBiasArray[Corners.BOTTOM_LEFT] = 3.5;\n        lodBiasArray[Corners.BOTTOM_RIGHT] = 4.0;\n        for (let i = 0; i < Corners.MAX; ++i)\n        {\n            renderObjects.push(\n                {\n                    viewport: { x: viewport[i].x, y: viewport[i].y, width: viewport[i].z, height: viewport[i].w },\n                    ...ro,\n                    bindingResources: {\n                        mvp: { value: matrix },\n                        lodBias: { value: lodBiasArray[i] },\n                        diffuse: { texture: textures[i], sampler: samplers[i] },\n                    },\n                });\n        }\n\n        webgl.submit({ commandEncoders: [{ passEncoders: [rp] }] });\n\n        requestAnimationFrame(render);\n    }\n\n    // If you have a long-running page, and need to delete WebGL resources, use:\n    //\n    // gl.deleteBuffer(vertexPosBuffer);\n    // gl.deleteBuffer(vertexTexBuffer);\n    // for (var j = 0; j < textures.length; ++j) {\n    //     gl.deleteTexture(textures[j]);\n    // }\n    // gl.deleteVertexArray(vertexArray);\n    // gl.deleteProgram(program);\n})();\n"],"names":["canvas","rc","webgl","WebGL","scale","mouseDown","lastMouseY","event","newY","deltaY","windowSize","Corners","viewport","program","getShaderSource","positions","texcoords","vertexArray","imageUrl","textures","samplers","loadImage","image","render","renderObjects","rp","matrix","ro","lodBiasArray","i"],"mappings":"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"}