{"version":3,"file":"glsl_centroid.html-C-_UbFAU.js","sources":["../../../../examples/src/WebGL2Samples/glsl_centroid.ts"],"sourcesContent":["import { CanvasContext, PassEncoder, RenderObject, RenderPass, RenderPassDescriptor, RenderPassObject, RenderPipeline, Sampler, Texture, VertexAttributes, Viewport } from '@feng3d/render-api';\nimport { WebGL } from '@feng3d/webgl';\nimport { mat4, vec3 } from 'gl-matrix';\nimport { getShaderSource } from './utility';\n\nconst canvas = document.createElement('canvas');\n\ncanvas.id = 'glcanvas';\ncanvas.width = window.innerWidth;\ncanvas.height = window.innerHeight;\ndocument.body.appendChild(canvas);\n\nconst rc: CanvasContext = { canvasId: 'glcanvas', webGLcontextId: 'webgl2' };\nconst webgl = new WebGL(rc);\n\n// -- Divide viewport\nconst canvasSize = {\n    x: canvas.width,\n    y: canvas.height,\n};\n\nconst VIEWPORTS = {\n    LEFT: 0,\n    RIGHT: 1,\n    MAX: 2,\n};\n\nconst viewport: Viewport[] = new Array(VIEWPORTS.MAX);\n\nviewport[VIEWPORTS.LEFT] = {\n    x: 0,\n    y: canvasSize.y - canvasSize.x / 2 - 50,\n    width: canvasSize.x / 2,\n    height: canvasSize.x / 2,\n};\n\nviewport[VIEWPORTS.RIGHT] = {\n    x: canvasSize.x / 2,\n    y: canvasSize.y - canvasSize.x / 2 - 50,\n    width: canvasSize.x / 2,\n    height: canvasSize.x / 2,\n};\n\n// -- Init program\nconst PROGRAM = {\n    TEXTURE: 0,\n    TEXTURE_CENTROID: 1,\n    SPLASH: 2,\n    MAX: 3,\n};\n\nconst programs: RenderPipeline[] = [\n    {\n        vertex: { code: getShaderSource('vs-render') }, fragment: { code: getShaderSource('fs-render') },\n        primitive: { topology: 'triangle-list' },\n    },\n    {\n        vertex: { code: getShaderSource('vs-render-centroid') }, fragment: { code: getShaderSource('fs-render-centroid') },\n        primitive: { topology: 'triangle-list' },\n    },\n    {\n        vertex: { code: getShaderSource('vs-splash') }, fragment: { code: getShaderSource('fs-splash') },\n        primitive: { topology: 'triangle-list' },\n    },\n];\n\n// -- Init primitive data\nconst vertexCount = 3;\nconst scaleFactor = 0.1;\nconst positions = new Float32Array([\n    scaleFactor * 0.0, scaleFactor * 0.8,\n    scaleFactor * -0.8, scaleFactor * -0.4,\n    Number(scaleFactor), scaleFactor * -0.8,\n]);\n\nconst data = new Float32Array([\n    0.0, 0.0, 1.0,\n]);\n\n// -- Init buffers\n\n// Draw the rect texture\n// This can be discarded when gl_VertexID is available\nconst textureVertexPositions = new Float32Array([\n    -1.0, -1.0,\n    1.0, -1.0,\n    1.0, 1.0,\n    1.0, 1.0,\n    -1.0, 1.0,\n    -1.0, -1.0,\n]);\n\nconst textureVertexTexCoords = new Float32Array([\n    0.0, 1.0,\n    1.0, 1.0,\n    1.0, 0.0,\n    1.0, 0.0,\n    0.0, 0.0,\n    0.0, 1.0,\n]);\n\n// -- Init Texture\n// used for draw framebuffer storage\nconst FRAMEBUFFER_SIZE = {\n    x: canvas.width,\n    y: canvas.height,\n};\nconst textures: Texture[] = [];\nconst samplers: Sampler[] = [];\n\nfor (let i = 0; i < VIEWPORTS.MAX; ++i)\n{\n    textures[i] = {\n        descriptor: {\n            format: 'rgba8unorm',\n            size: [FRAMEBUFFER_SIZE.x, FRAMEBUFFER_SIZE.y],\n        },\n    };\n    samplers[i] = { minFilter: 'nearest', magFilter: 'nearest' };\n}\n\n// -- Init Frame Buffers\n\nconst FRAMEBUFFER = {\n    RENDERBUFFER: 0,\n    RENDERBUFFER_CENTROID: 1,\n    COLORBUFFER: 2,\n    COLORBUFFER_CENTROID: 3,\n};\n\nconst framebuffers: RenderPassDescriptor[] = [\n    { colorAttachments: [{ view: { texture: textures[0], baseMipLevel: 0 }, clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: 'clear' }], sampleCount: 4 },\n    { colorAttachments: [{ view: { texture: textures[1], baseMipLevel: 0 }, clearValue: [0.0, 0.0, 0.0, 1.0], loadOp: 'clear' }], sampleCount: 4 },\n];\n\n// -- Init VertexArray\nconst vertexArrays: { vertices?: VertexAttributes }[] = [\n    {\n        vertices: {\n            position: { data: positions, format: 'float32x2' },\n            data: { data, format: 'float32' },\n        },\n    },\n    {\n        vertices: {\n            position: { data: positions, format: 'float32x2' },\n            data: { data, format: 'float32' },\n        },\n    },\n    {\n        vertices: {\n            position: { data: textureVertexPositions, format: 'float32x2' },\n            texcoord: { data: textureVertexTexCoords, format: 'float32x2' },\n        },\n    },\n];\n\n// -- Render\nconst passEncoders: PassEncoder[] = [];\n\n// Pass 1\nconst IDENTITY = mat4.create();\n\nfor (let i = 0; i < VIEWPORTS.MAX; ++i)\n{\n    // render buffers\n    const rp: RenderPass = {\n        descriptor: framebuffers[i],\n        renderPassObjects: [{\n            pipeline: programs[i],\n            bindingResources: { MVP: { value: IDENTITY as Float32Array } },\n            vertices: vertexArrays[i].vertices,\n            draw: { __type__: 'DrawVertex', vertexCount },\n        }],\n    };\n\n    passEncoders.push(rp);\n}\n\nconst renderObjects: RenderPassObject[] = [];\n// Pass 2\nconst rp2: RenderPass = {\n    descriptor: { colorAttachments: [{ clearValue: [0, 0, 0, 1] }] },\n    renderPassObjects: renderObjects,\n};\nconst ro: RenderObject = {\n    pipeline: programs[PROGRAM.SPLASH],\n    vertices: vertexArrays[PROGRAM.SPLASH].vertices,\n    draw: { __type__: 'DrawVertex', vertexCount: 6 },\n};\n\nconst scaleVector3 = vec3.create();\nconst invScaleFactor = 0.8 / scaleFactor;\n\nvec3.set(scaleVector3, invScaleFactor, invScaleFactor, invScaleFactor);\nconst mvp = mat4.create();\n\nmat4.scale(mvp, IDENTITY, scaleVector3);\n\nfor (let i = 0; i < VIEWPORTS.MAX; ++i)\n{\n    renderObjects.push(\n        {\n            ...ro,\n            viewport: viewport[i],\n            bindingResources: {\n                MVP: { value: mvp as Float32Array },\n                diffuse: { texture: textures[i], sampler: samplers[i] },\n            },\n            draw: { __type__: 'DrawVertex', vertexCount: 6 },\n        },\n    );\n}\npassEncoders.push(rp2);\n\nwebgl.submit({ commandEncoders: [{ passEncoders }] });\n\n// -- Delete WebGL resources\n\nwebgl.deleteTexture(textures[PROGRAM.TEXTURE]);\nwebgl.deleteTexture(textures[PROGRAM.TEXTURE_CENTROID]);\n\nwebgl.deleteSampler(samplers[PROGRAM.TEXTURE]);\nwebgl.deleteSampler(samplers[PROGRAM.TEXTURE_CENTROID]);\n\nwebgl.deleteFramebuffer(framebuffers[FRAMEBUFFER.RENDERBUFFER]);\nwebgl.deleteFramebuffer(framebuffers[FRAMEBUFFER.COLORBUFFER]);\n\nwebgl.deleteFramebuffer(framebuffers[FRAMEBUFFER.RENDERBUFFER_CENTROID]);\nwebgl.deleteFramebuffer(framebuffers[FRAMEBUFFER.COLORBUFFER_CENTROID]);\n\nwebgl.deleteProgram(programs[PROGRAM.TEXTURE]);\nwebgl.deleteProgram(programs[PROGRAM.TEXTURE_CENTROID]);\nwebgl.deleteProgram(programs[PROGRAM.SPLASH]);\n"],"names":["canvas","rc","webgl","WebGL","canvasSize","VIEWPORTS","viewport","PROGRAM","programs","getShaderSource","vertexCount","scaleFactor","positions","data","textureVertexPositions","textureVertexTexCoords","FRAMEBUFFER_SIZE","textures","samplers","i","FRAMEBUFFER","framebuffers","vertexArrays","passEncoders","IDENTITY","mat4.create","rp","renderObjects","rp2","ro","scaleVector3","vec3.create","invScaleFactor","vec3.set","mvp","mat4.scale"],"mappings":"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"}