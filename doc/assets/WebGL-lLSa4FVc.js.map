{"version":3,"file":"WebGL-lLSa4FVc.js","sources":["../../node_modules/@feng3d/render-api/dist/index.js","../../src/data/polyfills/CanvasContext.ts","../../node_modules/@feng3d/reactivity/dist/index.js","../../src/caches/getGLBuffer.ts","../../src/caches/Capabilities.ts","../../src/caches/getGLCanvasContext.ts","../../src/caches/getGLRenderbuffer.ts","../../src/caches/getGLTextureFormats.ts","../../src/caches/getGLRenderPassDescriptorWithMultisample.ts","../../node_modules/@feng3d/watcher/dist/index.js","../../src/caches/getGLTextureTarget.ts","../../src/caches/getGLTexture.ts","../../src/caches/getGLFramebuffer.ts","../../src/const/GLUniformType.ts","../../src/caches/getGLProgram.ts","../../src/runs/getGLCompareFunction.ts","../../src/caches/getGLSampler.ts","../../src/caches/getGLTransformFeedback.ts","../../src/const/const.ts","../../src/caches/getGLRenderOcclusionQuery.ts","../../src/caches/getGLDrawMode.ts","../../src/internal/renderObject/runDrawIndexed.ts","../../src/internal/renderObject/runDrawVertex.ts","../../src/internal/renderObject/runPrimitiveState.ts","../../src/internal/runDepthState.ts","../../src/internal/runColorTargetStates.ts","../../src/internal/runProgram.ts","../../src/internal/runStencilState.ts","../../src/internal/renderObject/runRenderPipeline.ts","../../src/internal/renderObject/runScissor.ts","../../src/utils/updateBufferBinding.ts","../../src/internal/runSampler.ts","../../src/internal/runSamplerTexture.ts","../../src/internal/runUniform.ts","../../src/internal/renderObject/runUniforms.ts","../../src/internal/runIndexBuffer.ts","../../src/internal/runVertexAttribute.ts","../../src/internal/renderObject/runVertexArray.ts","../../src/internal/renderObject/runViewPort.ts","../../src/internal/renderObject/runRenderObject.ts","../../src/internal/runBlitFramebuffer.ts","../../src/internal/runOcclusionQuery.ts","../../src/internal/runRenderPassDescriptor.ts","../../src/internal/runRenderPass.ts","../../src/internal/runTransformFeedbackPipeline.ts","../../src/internal/runTransformFeedback.ts","../../src/internal/endTransformFeedback.ts","../../src/internal/runTransformFeedbackObject.ts","../../src/internal/runTransformFeedbackPass.ts","../../src/caches/getGLBlitFramebuffer.ts","../../src/internal/runCopyTextureToTexture.ts","../../src/internal/runCopyBufferToBuffer.ts","../../src/internal/runCommandEncoder.ts","../../src/internal/runSubmit.ts","../../src/utils/readPixels.ts","../../src/WebGL.ts"],"sourcesContent":["var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\nconst vertexFormatMap = {\n  uint8x2: { numComponents: 2, type: \"UNSIGNED_BYTE\", normalized: false, dataType: \"unsigned int\", byteSize: 2, wgslType: \"vec2<u32>\", typedArrayConstructor: Uint8Array },\n  uint8x4: { numComponents: 4, type: \"UNSIGNED_BYTE\", normalized: false, dataType: \"unsigned int\", byteSize: 4, wgslType: \"vec4<u32>\", typedArrayConstructor: Uint8Array },\n  sint8x2: { numComponents: 2, type: \"BYTE\", normalized: false, dataType: \"signed int\", byteSize: 2, wgslType: \"vec2<i32>\", typedArrayConstructor: Int8Array },\n  sint8x4: { numComponents: 4, type: \"BYTE\", normalized: false, dataType: \"signed int\", byteSize: 4, wgslType: \"vec4<i32>\", typedArrayConstructor: Int8Array },\n  unorm8x2: { numComponents: 2, type: \"UNSIGNED_BYTE\", normalized: true, dataType: \"unsigned normalized\", byteSize: 2, wgslType: \"vec2<f32>\", typedArrayConstructor: Uint8Array },\n  unorm8x4: { numComponents: 4, type: \"UNSIGNED_BYTE\", normalized: true, dataType: \"unsigned normalized\", byteSize: 4, wgslType: \"vec4<f32>\", typedArrayConstructor: Uint8Array },\n  snorm8x2: { numComponents: 2, type: \"BYTE\", normalized: true, dataType: \"signed normalized\", byteSize: 2, wgslType: \"vec2<f32>\", typedArrayConstructor: Int8Array },\n  snorm8x4: { numComponents: 4, type: \"BYTE\", normalized: true, dataType: \"signed normalized\", byteSize: 4, wgslType: \"vec4<f32>\", typedArrayConstructor: Int8Array },\n  uint16x2: { numComponents: 2, type: \"UNSIGNED_SHORT\", normalized: false, dataType: \"unsigned int\", byteSize: 4, wgslType: \"vec2<u32>\", typedArrayConstructor: Uint16Array },\n  uint16x4: { numComponents: 4, type: \"UNSIGNED_SHORT\", normalized: false, dataType: \"unsigned int\", byteSize: 8, wgslType: \"vec4<u32>\", typedArrayConstructor: Uint16Array },\n  sint16x2: { numComponents: 2, type: \"SHORT\", normalized: false, dataType: \"signed int\", byteSize: 4, wgslType: \"vec2<i32>\", typedArrayConstructor: Int16Array },\n  sint16x4: { numComponents: 4, type: \"SHORT\", normalized: false, dataType: \"signed int\", byteSize: 8, wgslType: \"vec4<i32>\", typedArrayConstructor: Int16Array },\n  unorm16x2: { numComponents: 2, type: \"UNSIGNED_SHORT\", normalized: true, dataType: \"unsigned normalized\", byteSize: 4, wgslType: \"vec2<f32>\", typedArrayConstructor: Uint16Array },\n  unorm16x4: { numComponents: 4, type: \"UNSIGNED_SHORT\", normalized: true, dataType: \"unsigned normalized\", byteSize: 8, wgslType: \"vec4<f32>\", typedArrayConstructor: Uint16Array },\n  snorm16x2: { numComponents: 2, type: \"SHORT\", normalized: true, dataType: \"signed normalized\", byteSize: 4, wgslType: \"vec2<f32>\", typedArrayConstructor: Int16Array },\n  snorm16x4: { numComponents: 4, type: \"SHORT\", normalized: true, dataType: \"signed normalized\", byteSize: 8, wgslType: \"vec4<f32>\", typedArrayConstructor: Int16Array },\n  float16x2: { numComponents: 2, type: \"HALF_FLOAT\", normalized: false, dataType: \"float\", byteSize: 4, wgslType: \"vec2<f16>\", typedArrayConstructor: Int16Array },\n  float16x4: { numComponents: 4, type: \"HALF_FLOAT\", normalized: false, dataType: \"float\", byteSize: 8, wgslType: \"vec4<f16>\", typedArrayConstructor: Int16Array },\n  float32: { numComponents: 1, type: \"FLOAT\", normalized: false, dataType: \"float\", byteSize: 4, wgslType: \"f32\", typedArrayConstructor: Float32Array },\n  float32x2: { numComponents: 2, type: \"FLOAT\", normalized: false, dataType: \"float\", byteSize: 8, wgslType: \"vec2<f32>\", typedArrayConstructor: Float32Array },\n  float32x3: { numComponents: 3, type: \"FLOAT\", normalized: false, dataType: \"float\", byteSize: 12, wgslType: \"vec3<f32>\", typedArrayConstructor: Float32Array },\n  float32x4: { numComponents: 4, type: \"FLOAT\", normalized: false, dataType: \"float\", byteSize: 16, wgslType: \"vec4<f32>\", typedArrayConstructor: Float32Array },\n  uint32: { numComponents: 1, type: \"UNSIGNED_INT\", normalized: false, dataType: \"unsigned int\", byteSize: 4, wgslType: \"u32\", typedArrayConstructor: Uint32Array },\n  uint32x2: { numComponents: 2, type: \"UNSIGNED_INT\", normalized: false, dataType: \"unsigned int\", byteSize: 8, wgslType: \"vec2<u32>\", typedArrayConstructor: Uint32Array },\n  uint32x3: { numComponents: 3, type: \"UNSIGNED_INT\", normalized: false, dataType: \"unsigned int\", byteSize: 12, wgslType: \"vec3<u32>\", typedArrayConstructor: Uint32Array },\n  uint32x4: { numComponents: 4, type: \"UNSIGNED_INT\", normalized: false, dataType: \"unsigned int\", byteSize: 16, wgslType: \"vec4<u32>\", typedArrayConstructor: Uint32Array },\n  sint32: { numComponents: 1, type: \"INT\", normalized: false, dataType: \"signed int\", byteSize: 4, wgslType: \"i32\", typedArrayConstructor: Int32Array },\n  sint32x2: { numComponents: 2, type: \"INT\", normalized: false, dataType: \"signed int\", byteSize: 8, wgslType: \"vec2<i32>\", typedArrayConstructor: Int32Array },\n  sint32x3: { numComponents: 3, type: \"INT\", normalized: false, dataType: \"signed int\", byteSize: 12, wgslType: \"vec3<i32>\", typedArrayConstructor: Int32Array },\n  sint32x4: { numComponents: 4, type: \"INT\", normalized: false, dataType: \"signed int\", byteSize: 16, wgslType: \"vec4<i32>\", typedArrayConstructor: Int32Array },\n  \"unorm10-10-10-2\": { numComponents: 4, type: \"UNSIGNED_INT_2_10_10_10_REV\", normalized: true, dataType: \"unsigned normalized\", byteSize: 4, wgslType: \"vec4<f32>\", typedArrayConstructor: Int32Array }\n};\nconst defaultBlendComponent = {\n  operation: \"add\",\n  srcFactor: \"src-alpha\",\n  dstFactor: \"one-minus-src-alpha\"\n};\nclass BlendState {\n  /**\n   * 当混合系数用到了混合常量值时设置混合常量值。\n   *\n   * @param blend\n   * @returns\n   */\n  static getBlendConstantColor(blendState) {\n    if (!blendState) return void 0;\n    const { color, alpha } = blendState;\n    if ((color == null ? void 0 : color.srcFactor) === \"constant\" || (color == null ? void 0 : color.srcFactor) === \"one-minus-constant\" || (color == null ? void 0 : color.dstFactor) === \"constant\" || (color == null ? void 0 : color.dstFactor) === \"one-minus-constant\" || (alpha == null ? void 0 : alpha.srcFactor) === \"constant\" || (alpha == null ? void 0 : alpha.srcFactor) === \"one-minus-constant\" || (alpha == null ? void 0 : alpha.dstFactor) === \"constant\" || (alpha == null ? void 0 : alpha.dstFactor) === \"one-minus-constant\") {\n      const constantColor = blendState.constantColor;\n      if (constantColor) {\n        return constantColor;\n      }\n      return constantColor ?? [0, 0, 0, 0];\n    }\n    return void 0;\n  }\n}\nclass Buffer2 {\n  /**\n   * 从TypedArray创建或获取缓冲区配置\n   * 自动处理缓冲区大小对齐（4字节对齐）\n   * @param arrayBuffer 源数据数组\n   * @returns 缓冲区配置对象\n   */\n  static getBuffer(arrayBuffer) {\n    let buffer = this.bufferMap.get(arrayBuffer);\n    if (buffer) return buffer;\n    buffer = {\n      size: Math.ceil(arrayBuffer.byteLength / 4) * 4,\n      data: arrayBuffer\n    };\n    this.bufferMap.set(arrayBuffer, buffer);\n    return buffer;\n  }\n}\n/** 缓冲区配置缓存映射表 */\n__publicField(Buffer2, \"bufferMap\", /* @__PURE__ */ new WeakMap());\nfunction getStencilReference(depthStencil) {\n  if (!depthStencil) return void 0;\n  const { stencilFront, stencilBack } = depthStencil;\n  let stencilReference;\n  if (stencilFront) {\n    const { failOp, depthFailOp, passOp } = stencilFront;\n    if (failOp === \"replace\" || depthFailOp === \"replace\" || passOp === \"replace\") {\n      stencilReference = (depthStencil == null ? void 0 : depthStencil.stencilReference) ?? 0;\n    }\n  }\n  if (stencilBack) {\n    const { failOp, depthFailOp, passOp } = stencilBack;\n    if (failOp === \"replace\" || depthFailOp === \"replace\" || passOp === \"replace\") {\n      stencilReference = (depthStencil == null ? void 0 : depthStencil.stencilReference) ?? 0;\n    }\n  }\n  return stencilReference;\n}\nclass VertexAttribute {\n  /**\n   * 获取顶点属性数据的顶点数量。\n   *\n   * @param attribute 顶点属性数据。\n   * @returns\n   */\n  static getVertexCount(attribute) {\n    const attributeSize = VertexAttribute.getVertexByteSize(attribute);\n    const offset = attribute.offset || 0;\n    const arrayStride = attribute.arrayStride || attributeSize;\n    const attributeCount = (attribute.data.byteLength - offset) / arrayStride;\n    return attributeCount;\n  }\n  /**\n   * 获取顶点属性数据的字节尺寸。\n   *\n   * @param attribute 顶点属性数据。\n   */\n  static getVertexByteSize(attribute) {\n    const attributeSize = vertexFormatMap[attribute.format].byteSize;\n    return attributeSize;\n  }\n}\nclass RenderObject {\n  /**\n   * 获取顶点数量。\n   *\n   * @returns 顶点数量。\n   */\n  static getNumVertex(geometry) {\n    const attributes = geometry.vertices;\n    const vertexList = Object.keys(attributes).map((v) => attributes[v]).filter((v) => v.data && v.stepMode !== \"instance\");\n    const count = vertexList.length > 0 ? VertexAttribute.getVertexCount(vertexList[0]) : 0;\n    if (vertexList.length > 0) {\n      console.assert(vertexList.every((v) => count === VertexAttribute.getVertexCount(v)));\n    }\n    return count;\n  }\n  /**\n   * 获取实例数量。\n   *\n   * @returns 实例数量。\n   */\n  static getInstanceCount(geometry) {\n    const attributes = geometry.vertices;\n    const vertexList = Object.keys(attributes).map((v) => attributes[v]).filter((v) => v.data && v.stepMode === \"instance\");\n    const count = vertexList.length > 0 ? VertexAttribute.getVertexCount(vertexList[0]) : 1;\n    if (vertexList.length > 0) {\n      console.assert(vertexList.every((v) => count === VertexAttribute.getVertexCount(v)));\n    }\n    return count;\n  }\n  static getDraw(geometry) {\n    if (geometry[\"_draw\"]) return geometry[\"_draw\"];\n    const instanceCount = RenderObject.getInstanceCount(geometry);\n    if (geometry.indices) {\n      return {\n        __type__: \"DrawIndexed\",\n        indexCount: geometry.indices.length,\n        firstIndex: 0,\n        instanceCount\n      };\n    }\n    return {\n      __type__: \"DrawVertex\",\n      vertexCount: RenderObject.getNumVertex(geometry),\n      instanceCount\n    };\n  }\n}\nconst defaultRenderPassColorAttachment = {\n  view: void 0,\n  clearValue: [0, 0, 0, 0],\n  loadOp: \"clear\"\n};\nconst defaultSampler = {\n  addressModeU: \"repeat\",\n  addressModeV: \"repeat\",\n  addressModeW: \"repeat\",\n  magFilter: \"nearest\",\n  minFilter: \"nearest\",\n  mipmapFilter: \"nearest\",\n  lodMinClamp: 0,\n  lodMaxClamp: 16,\n  compare: void 0,\n  maxAnisotropy: 1\n};\nclass Texture {\n  /**\n   * 获取纹理每个像素占用的字节数量。\n   *\n   * @param format 纹理格式。\n   */\n  static getTextureBytesPerPixel(format = \"rgba8unorm\") {\n    var _a;\n    const bytesPerPixel = (_a = formatMap[format]) == null ? void 0 : _a.bytesPerPixel;\n    console.assert(!!bytesPerPixel, `未处理格式 ${format} ，无法查询到该格式中每个像素占用的字节数量！`);\n    return bytesPerPixel;\n  }\n  /**\n       * 获取纹理数据构造函数。\n  \n       * @param format 纹理格式。\n       * @returns\n       */\n  static getTextureDataConstructor(format = \"rgba8unorm\") {\n    var _a;\n    const bytesPerPixel = (_a = formatMap[format]) == null ? void 0 : _a.dataConstructor;\n    console.assert(!!bytesPerPixel, `未处理格式 ${format} ，无法查询到该格式的纹理数据构造函数！`);\n    return bytesPerPixel;\n  }\n}\nconst formatMap = {\n  r8unorm: { bytesPerPixel: 1, dataConstructor: Uint8Array },\n  r8snorm: { bytesPerPixel: 1, dataConstructor: Int8Array },\n  r8uint: { bytesPerPixel: 1, dataConstructor: Uint8Array },\n  r8sint: { bytesPerPixel: 1, dataConstructor: Int8Array },\n  r16uint: { bytesPerPixel: 2, dataConstructor: Uint16Array },\n  r16sint: { bytesPerPixel: 2, dataConstructor: Int16Array },\n  r16float: { bytesPerPixel: 2, dataConstructor: Uint16Array },\n  rg8unorm: { bytesPerPixel: 2, dataConstructor: Uint8Array },\n  rg8snorm: { bytesPerPixel: 2, dataConstructor: Int8Array },\n  rg8uint: { bytesPerPixel: 2, dataConstructor: Uint8Array },\n  rg8sint: { bytesPerPixel: 2, dataConstructor: Int8Array },\n  r32uint: { bytesPerPixel: 4, dataConstructor: Uint32Array },\n  r32sint: { bytesPerPixel: 4, dataConstructor: Int32Array },\n  r32float: { bytesPerPixel: 4, dataConstructor: Float32Array },\n  rg16uint: { bytesPerPixel: 4, dataConstructor: Uint16Array },\n  rg16sint: { bytesPerPixel: 4, dataConstructor: Int16Array },\n  rg16float: { bytesPerPixel: 4, dataConstructor: Uint16Array },\n  rgba8unorm: { bytesPerPixel: 4, dataConstructor: Uint8Array },\n  \"rgba8unorm-srgb\": { bytesPerPixel: 4, dataConstructor: Uint8Array },\n  rgba8snorm: { bytesPerPixel: 4, dataConstructor: Int8Array },\n  rgba8uint: { bytesPerPixel: 4, dataConstructor: Uint8Array },\n  rgba8sint: { bytesPerPixel: 4, dataConstructor: Int8Array },\n  bgra8unorm: { bytesPerPixel: 4, dataConstructor: Uint8Array },\n  \"bgra8unorm-srgb\": { bytesPerPixel: 4, dataConstructor: Uint8Array },\n  rgb9e5ufloat: { bytesPerPixel: 4, dataConstructor: Uint32Array },\n  rgb10a2uint: { bytesPerPixel: 4, dataConstructor: Uint32Array },\n  rgb10a2unorm: { bytesPerPixel: 4, dataConstructor: Uint32Array },\n  rg11b10ufloat: { bytesPerPixel: 4, dataConstructor: Uint32Array },\n  rg32uint: { bytesPerPixel: 8, dataConstructor: Uint32Array },\n  rg32sint: { bytesPerPixel: 8, dataConstructor: Int32Array },\n  rg32float: { bytesPerPixel: 8, dataConstructor: Float32Array },\n  rgba16uint: { bytesPerPixel: 8, dataConstructor: Uint16Array },\n  rgba16sint: { bytesPerPixel: 8, dataConstructor: Int16Array },\n  rgba16float: { bytesPerPixel: 8, dataConstructor: Uint16Array },\n  rgba32uint: { bytesPerPixel: 16, dataConstructor: Uint32Array },\n  rgba32sint: { bytesPerPixel: 16, dataConstructor: Int32Array },\n  rgba32float: { bytesPerPixel: 16, dataConstructor: Float32Array },\n  stencil8: { bytesPerPixel: 1, dataConstructor: Uint8Array },\n  depth16unorm: { bytesPerPixel: 2, dataConstructor: Uint16Array },\n  depth24plus: { bytesPerPixel: 3, dataConstructor: Uint8Array },\n  \"depth24plus-stencil8\": { bytesPerPixel: 4 },\n  depth32float: { bytesPerPixel: 4 },\n  \"depth32float-stencil8\": { bytesPerPixel: 5 },\n  \"bc1-rgba-unorm\": void 0,\n  \"bc1-rgba-unorm-srgb\": void 0,\n  \"bc2-rgba-unorm\": void 0,\n  \"bc2-rgba-unorm-srgb\": void 0,\n  \"bc3-rgba-unorm\": void 0,\n  \"bc3-rgba-unorm-srgb\": void 0,\n  \"bc4-r-unorm\": void 0,\n  \"bc4-r-snorm\": void 0,\n  \"bc5-rg-unorm\": void 0,\n  \"bc5-rg-snorm\": void 0,\n  \"bc6h-rgb-ufloat\": void 0,\n  \"bc6h-rgb-float\": void 0,\n  \"bc7-rgba-unorm\": void 0,\n  \"bc7-rgba-unorm-srgb\": void 0,\n  \"etc2-rgb8unorm\": void 0,\n  \"etc2-rgb8unorm-srgb\": void 0,\n  \"etc2-rgb8a1unorm\": void 0,\n  \"etc2-rgb8a1unorm-srgb\": void 0,\n  \"etc2-rgba8unorm\": void 0,\n  \"etc2-rgba8unorm-srgb\": void 0,\n  \"eac-r11unorm\": void 0,\n  \"eac-r11snorm\": void 0,\n  \"eac-rg11unorm\": void 0,\n  \"eac-rg11snorm\": void 0,\n  \"astc-4x4-unorm\": void 0,\n  \"astc-4x4-unorm-srgb\": void 0,\n  \"astc-5x4-unorm\": void 0,\n  \"astc-5x4-unorm-srgb\": void 0,\n  \"astc-5x5-unorm\": void 0,\n  \"astc-5x5-unorm-srgb\": void 0,\n  \"astc-6x5-unorm\": void 0,\n  \"astc-6x5-unorm-srgb\": void 0,\n  \"astc-6x6-unorm\": void 0,\n  \"astc-6x6-unorm-srgb\": void 0,\n  \"astc-8x5-unorm\": void 0,\n  \"astc-8x5-unorm-srgb\": void 0,\n  \"astc-8x6-unorm\": void 0,\n  \"astc-8x6-unorm-srgb\": void 0,\n  \"astc-8x8-unorm\": void 0,\n  \"astc-8x8-unorm-srgb\": void 0,\n  \"astc-10x5-unorm\": void 0,\n  \"astc-10x5-unorm-srgb\": void 0,\n  \"astc-10x6-unorm\": void 0,\n  \"astc-10x6-unorm-srgb\": void 0,\n  \"astc-10x8-unorm\": void 0,\n  \"astc-10x8-unorm-srgb\": void 0,\n  \"astc-10x10-unorm\": void 0,\n  \"astc-10x10-unorm-srgb\": void 0,\n  \"astc-12x10-unorm\": void 0,\n  \"astc-12x10-unorm-srgb\": void 0,\n  \"astc-12x12-unorm\": void 0,\n  \"astc-12x12-unorm-srgb\": void 0\n};\nclass TextureImageSource {\n  /**\n   * 获取纹理的图片资源尺寸。\n   *\n   * @param texImageSource 纹理的图片资源。\n   * @returns\n   */\n  static getTexImageSourceSize(image) {\n    let width;\n    let height;\n    if (image instanceof VideoFrame) {\n      width = image.codedWidth;\n      height = image.codedHeight;\n    } else if (image instanceof HTMLVideoElement) {\n      width = image.videoWidth;\n      height = image.videoHeight;\n    } else {\n      width = image.width;\n      height = image.height;\n    }\n    return [width, height];\n  }\n}\nclass ChainMap {\n  constructor() {\n    /**\n     * 根字典。\n     */\n    __publicField(this, \"_map\", /* @__PURE__ */ new WeakMap());\n    __publicField(this, \"_size\", 0);\n  }\n  get size() {\n    return this._size;\n  }\n  /**\n   * 获取键对应的值。\n   *\n   * @param keys 键。\n   * @returns 值。\n   */\n  get(keys) {\n    const keysLength = keys.length;\n    let map = this._map;\n    let key;\n    for (let i = 0, n = keysLength - 1; i < n; i++) {\n      key = wrapKey(keys[i]);\n      map = map.get(key);\n      if (map === void 0) return void 0;\n    }\n    key = wrapKey(keys[keysLength - 1]);\n    return map.get(key);\n  }\n  /**\n   * 设置映射。\n   *\n   * @param keys 键。\n   * @param value 值。\n   *\n   * @returns 返回设置的值。\n   */\n  set(keys, value) {\n    const keysLength = keys.length;\n    let map = this._map;\n    let key;\n    for (let i = 0; i < keysLength - 1; i++) {\n      key = wrapKey(keys[i]);\n      if (!map.has(key)) {\n        map.set(key, /* @__PURE__ */ new WeakMap());\n      }\n      map = map.get(key);\n    }\n    key = wrapKey(keys[keysLength - 1]);\n    if (!map.has(key)) {\n      map.set(key, value);\n      this._size++;\n    }\n    return value;\n  }\n  /**\n   * 删除映射。\n   *\n   * @param keys 键。\n   * @returns 如果找到目标值且被删除返回 `true` ，否则返回 `false` 。\n   */\n  delete(keys) {\n    const keysLength = keys.length;\n    let map = this._map;\n    let key;\n    for (let i = 0; i < keysLength - 1; i++) {\n      key = wrapKey(keys[i]);\n      map = map.get(key);\n      if (map === void 0) return false;\n    }\n    key = wrapKey(keys[keysLength - 1]);\n    const result = map.delete(key);\n    if (result) this._size--;\n    return result;\n  }\n}\nconst keyMap = /* @__PURE__ */ new Map();\nlet idCounter = 0;\nfunction wrapKey(key) {\n  if (typeof key === \"object\" && key !== null) {\n    return key;\n  }\n  if (keyMap.has(key)) {\n    return keyMap.get(key);\n  }\n  const id = idCounter++;\n  const wrapper = {\n    __id: id,\n    __value: key\n  };\n  keyMap.set(key, wrapper);\n  return wrapper;\n}\nfunction unreadonly(value) {\n  return value;\n}\nconst renderState = {\n  isRunWebGPU: false,\n  isRunWebGL: false\n};\nconsole.log(\"@feng3d/render-api v0.1.0\");\nexport {\n  BlendState,\n  Buffer2 as Buffer,\n  ChainMap,\n  RenderObject,\n  Texture,\n  TextureImageSource,\n  VertexAttribute,\n  defaultBlendComponent,\n  defaultRenderPassColorAttachment,\n  defaultSampler,\n  getStencilReference,\n  renderState,\n  unreadonly,\n  vertexFormatMap\n};\n//# sourceMappingURL=index.js.map\n","import { CanvasContext } from '@feng3d/render-api';\n\ndeclare module '@feng3d/render-api'\n{\n    /**\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext\n     */\n    export interface CanvasContext\n    {\n        /**\n         * WebGL上下文类型\n         */\n        webGLcontextId?: 'webgl' | 'webgl2';\n\n        /**\n         * WebGL上下文属性。\n         */\n        webGLContextAttributes?: WebGLContextAttributes;\n    }\n}\n\n/**\n * 默认画布(WebGL)上下文信息。\n */\nexport const defaultWebGLContextAttributes: WebGLContextAttributes = {\n    depth: true,\n    stencil: true,\n    antialias: false,\n    premultipliedAlpha: false,\n    preserveDrawingBuffer: false,\n    powerPreference: 'default',\n    failIfMajorPerformanceCaveat: false,\n};\n","var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\nvar _a, _b;\nconst _Reactivity = class _Reactivity {\n  constructor() {\n    /**\n     * @private\n     */\n    __publicField(this, \"_value\");\n    /**\n     * 父反应节点集合。\n     *\n     * 记录了哪些节点依赖了当前节点。\n     * 当当前节点值发生变化时，会通知所有父节点。\n     *\n     * Map 的 key 是父节点，value 是父节点的版本号。\n     * 版本号用于判断依赖关系是否过期。\n     *\n     * @private\n     */\n    __publicField(this, \"_parents\", /* @__PURE__ */ new Map());\n  }\n  /**\n   * 获取当前节点值。\n   *\n   * 取值时将会建立与父节点的依赖关系。\n   * 当其他响应式节点访问此值时，会自动建立依赖关系。\n   */\n  get value() {\n    this.track();\n    return this._value;\n  }\n  /**\n   * 建立依赖关系。\n   *\n   * 当其他节点访问当前节点的值时，会调用此方法。\n   * 将当前节点与访问者（父节点）建立依赖关系。\n   *\n   * 如果当前没有活动的响应式节点，或者不应该跟踪依赖，则不会建立依赖关系。\n   */\n  track() {\n    if (!_Reactivity.activeReactivity || !_shouldTrack) return;\n    const parent = _Reactivity.activeReactivity;\n    if (parent) {\n      this._parents.set(parent, parent._version);\n    }\n  }\n  /**\n   * 触发更新。\n   *\n   * 当节点值发生变化时，会调用此方法。\n   * 通知所有依赖此节点的父节点进行更新。\n   *\n   * 更新过程：\n   * 1. 遍历所有父节点\n   * 2. 检查父节点的版本号是否匹配\n   * 3. 触发父节点的更新\n   * 4. 将当前节点添加到父节点的失效子节点集合中\n   */\n  trigger() {\n    this._parents.forEach((version, parent) => {\n      if (parent._version !== version) return;\n      parent.trigger();\n      parent._children.set(this, this._value);\n    });\n    this._parents.clear();\n  }\n};\n/**\n * 当前正在执行的反应式节点。\n *\n * 用于在依赖收集过程中标识当前正在执行的节点。\n * 当其他节点访问此节点的值时，会将其作为父节点。\n *\n * @internal\n */\n__publicField(_Reactivity, \"activeReactivity\");\nlet Reactivity = _Reactivity;\nfunction forceTrack(fn) {\n  const preShouldTrack = _shouldTrack;\n  _shouldTrack = true;\n  const result = fn();\n  _shouldTrack = preShouldTrack;\n  return result;\n}\nfunction noTrack(fn) {\n  const preShouldTrack = _shouldTrack;\n  _shouldTrack = false;\n  const result = fn();\n  _shouldTrack = preShouldTrack;\n  return result;\n}\nlet _shouldTrack = true;\nfunction batch(dep, isRunning) {\n  if (isRunning) {\n    if (_isRunedDeps.indexOf(dep) !== -1) {\n      return;\n    }\n    _isRunedDeps.push(dep);\n  } else {\n    if (_needEffectDeps.indexOf(dep) !== -1) {\n      return;\n    }\n    _needEffectDeps.push(dep);\n  }\n}\nfunction batchRun(fn) {\n  _batchDepth++;\n  const result = fn();\n  if (--_batchDepth > 0) {\n    return;\n  }\n  if (_isRunedDeps.length > 0) {\n    _isRunedDeps.forEach((dep) => {\n      __DEV__ && console.assert(dep._isDirty === false, \"dep.dirty === false\");\n      dep._children.forEach((version, node) => {\n        node._parents.set(dep, dep._version);\n      });\n      dep._children.clear();\n    });\n    _isRunedDeps.length = 0;\n  }\n  if (_needEffectDeps.length > 0) {\n    _needEffectDeps.forEach((dep) => {\n      const pre = Reactivity.activeReactivity;\n      Reactivity.activeReactivity = null;\n      dep.runIfDirty();\n      Reactivity.activeReactivity = pre;\n    });\n    _needEffectDeps.length = 0;\n  }\n  return result;\n}\nlet _batchDepth = 0;\nconst _needEffectDeps = [];\nconst _isRunedDeps = [];\nfunction computed(func) {\n  return new ComputedReactivity(func);\n}\nclass ComputedReactivity extends Reactivity {\n  /**\n   * 创建计算反应式节点。\n   *\n   * @param func 计算函数，可以访问其他响应式数据，并返回计算结果\n   */\n  constructor(func) {\n    super();\n    /**\n     * 标识这是一个 ref 对象。\n     *\n     * @internal\n     */\n    __publicField(this, \"__v_isRef\", true);\n    /**\n     * 计算函数。\n     *\n     * 用于计算属性值的函数，可以访问其他响应式数据。\n     * 当依赖发生变化时，会重新执行此函数。\n     */\n    __publicField(this, \"_func\");\n    /**\n     * 失效子节点集合。\n     *\n     * 记录所有依赖此计算属性的子节点。\n     * 当计算属性重新计算时，会通知这些子节点。\n     *\n     * @private\n     */\n    __publicField(this, \"_children\", /* @__PURE__ */ new Map());\n    /**\n     * 脏标记。\n     *\n     * 表示计算属性是否需要重新计算。\n     * 当依赖发生变化时，会设置此标记。\n     * 重新计算后会清除此标记。\n     *\n     * @private\n     */\n    __publicField(this, \"_isDirty\", true);\n    /**\n     * 版本号。\n     *\n     * 每次重新计算后自动递增。\n     * 用于判断子节点中的父节点引用是否过期。\n     * 当子节点发现父节点的版本号不匹配时，会重新建立依赖关系。\n     *\n     * @private\n     */\n    __publicField(this, \"_version\", -1);\n    this._func = func;\n  }\n  /**\n   * 获取计算属性的值。\n   *\n   * 取值时会：\n   * 1. 检查是否需要重新计算\n   * 2. 建立与父节点的依赖关系\n   * 3. 返回当前值\n   */\n  get value() {\n    this.runIfDirty();\n    this.track();\n    return this._value;\n  }\n  /**\n   * 触发更新。\n   *\n   * 当依赖发生变化时，会调用此方法。\n   * 如果当前正在执行计算，会将更新延迟到计算完成后。\n   * 否则，立即通知所有父节点进行更新。\n   */\n  trigger() {\n    if (Reactivity.activeReactivity === this) {\n      batch(this, Reactivity.activeReactivity === this);\n    }\n    super.trigger();\n  }\n  /**\n   * 执行计算。\n   *\n   * 执行计算函数，更新当前值。\n   * 在计算过程中会：\n   * 1. 强制启用依赖跟踪\n   * 2. 保存并设置当前活动节点\n   * 3. 执行计算函数\n   * 4. 恢复活动节点\n   */\n  run() {\n    forceTrack(() => {\n      const parentReactiveNode = Reactivity.activeReactivity;\n      Reactivity.activeReactivity = this;\n      this._version++;\n      this._value = this._func(this._value);\n      Reactivity.activeReactivity = parentReactiveNode;\n    });\n  }\n  /**\n   * 检查并执行计算。\n   *\n   * 检查当前节点是否需要重新计算：\n   * 1. 如果脏标记为 true，需要重新计算\n   * 2. 如果子节点发生变化，需要重新计算\n   *\n   * 重新计算后会清除脏标记。\n   */\n  runIfDirty() {\n    this._isDirty = this._isDirty || this.isChildrenChanged();\n    if (this._isDirty) {\n      this._isDirty = false;\n      this.run();\n    }\n  }\n  /**\n   * 检查子节点是否发生变化。\n   *\n   * 遍历所有子节点，检查它们的值是否发生变化。\n   * 如果发生变化，返回 true，否则返回 false。\n   *\n   * 在检查过程中会：\n   * 1. 临时禁用依赖跟踪\n   * 2. 检查每个子节点的值\n   * 3. 如果子节点没有变化，重新建立依赖关系\n   * 4. 清空子节点集合\n   *\n   * @returns 是否有子节点发生变化\n   */\n  isChildrenChanged() {\n    if (this._children.size === 0) return false;\n    let isChanged = false;\n    const preReactiveNode = Reactivity.activeReactivity;\n    Reactivity.activeReactivity = null;\n    this._children.forEach((value, node) => {\n      if (isChanged) return;\n      if (node.value !== value) {\n        isChanged = true;\n        return;\n      }\n    });\n    Reactivity.activeReactivity = preReactiveNode;\n    if (!isChanged) {\n      this._children.forEach((version, node) => {\n        node._parents.set(this, this._version);\n      });\n    }\n    this._children.clear();\n    return isChanged;\n  }\n}\nvar ReactiveFlags = /* @__PURE__ */ ((ReactiveFlags2) => {\n  ReactiveFlags2[\"IS_REACTIVE\"] = \"__v_isReactive\";\n  ReactiveFlags2[\"RAW\"] = \"__v_raw\";\n  ReactiveFlags2[\"IS_REF\"] = \"__v_isRef\";\n  return ReactiveFlags2;\n})(ReactiveFlags || {});\nvar TargetType = /* @__PURE__ */ ((TargetType2) => {\n  TargetType2[TargetType2[\"INVALID\"] = 0] = \"INVALID\";\n  TargetType2[TargetType2[\"COMMON\"] = 1] = \"COMMON\";\n  TargetType2[TargetType2[\"COLLECTION\"] = 2] = \"COLLECTION\";\n  return TargetType2;\n})(TargetType || {});\nvar TrackOpTypes = /* @__PURE__ */ ((TrackOpTypes2) => {\n  TrackOpTypes2[\"GET\"] = \"get\";\n  TrackOpTypes2[\"HAS\"] = \"has\";\n  TrackOpTypes2[\"ITERATE\"] = \"iterate\";\n  return TrackOpTypes2;\n})(TrackOpTypes || {});\nvar TriggerOpTypes = /* @__PURE__ */ ((TriggerOpTypes2) => {\n  TriggerOpTypes2[\"SET\"] = \"set\";\n  TriggerOpTypes2[\"ADD\"] = \"add\";\n  TriggerOpTypes2[\"DELETE\"] = \"delete\";\n  TriggerOpTypes2[\"CLEAR\"] = \"clear\";\n  return TriggerOpTypes2;\n})(TriggerOpTypes || {});\nconst ITERATE_KEY = Symbol(__DEV__ ? \"Object iterate\" : \"\");\nconst MAP_KEY_ITERATE_KEY = Symbol(__DEV__ ? \"Map keys iterate\" : \"\");\nconst ARRAY_ITERATE_KEY = Symbol(__DEV__ ? \"Array iterate\" : \"\");\nglobalThis.__DEV__ ?? (globalThis.__DEV__ = true);\nconst isObject = (val) => val !== null && typeof val === \"object\";\nconst isArray = Array.isArray;\nconst isSymbol = (val) => typeof val === \"symbol\";\nconst isString = (val) => typeof val === \"string\";\nconst isIntegerKey = (key) => isString(key) && key !== \"NaN\" && key[0] !== \"-\" && `${parseInt(key, 10)}` === key;\nconst isMap = (val) => toTypeString(val) === \"[object Map]\";\nconst hasOwn = (val, key) => Object.prototype.hasOwnProperty.call(val, key);\nconst hasChanged = (value, oldValue) => !Object.is(value, oldValue);\nfunction targetTypeMap(rawType) {\n  switch (rawType) {\n    case \"Object\":\n    case \"Array\":\n      return TargetType.COMMON;\n    case \"Map\":\n    case \"Set\":\n    case \"WeakMap\":\n    case \"WeakSet\":\n      return TargetType.COLLECTION;\n    default:\n      return TargetType.COMMON;\n  }\n}\nfunction getTargetType(value) {\n  if (!Object.isExtensible(value)) return TargetType.INVALID;\n  return targetTypeMap(toRawType(value));\n}\nconst toTypeString = (value) => Object.prototype.toString.call(value);\nconst toRawType = (value) => (\n  // 从类似 \"[object RawType]\" 的字符串中提取 \"RawType\"\n  toTypeString(value).slice(8, -1)\n);\nfunction toRaw(observed) {\n  const raw = observed && observed[ReactiveFlags.RAW];\n  return raw ? toRaw(raw) : observed;\n}\nfunction warn(msg, ...args) {\n  console.warn(`[警告] ${msg}`, ...args);\n}\n// @__NO_SIDE_EFFECTS__\nfunction makeMap(str) {\n  const map = /* @__PURE__ */ Object.create(null);\n  for (const key of str.split(\",\")) map[key] = 1;\n  return (val) => val in map;\n}\nlet activeEffectScope;\nclass EffectScope {\n  /**\n   * 构造函数\n   * @param detached 是否创建分离的作用域\n   */\n  constructor(detached = false) {\n    /**\n     * 作用域是否处于活动状态\n     * @internal\n     */\n    __publicField(this, \"_active\", true);\n    /**\n     * 跟踪 on 方法的调用次数，允许多次调用 on 方法\n     * @internal\n     */\n    __publicField(this, \"_on\", 0);\n    /**\n     * 存储当前作用域中的所有效果\n     * @internal\n     */\n    __publicField(this, \"effects\", []);\n    /**\n     * 存储清理函数\n     * @internal\n     */\n    __publicField(this, \"cleanups\", []);\n    /**\n     * 作用域是否被暂停\n     */\n    __publicField(this, \"_isPaused\", false);\n    /**\n     * 父作用域，仅由非分离的作用域分配\n     * @internal\n     */\n    __publicField(this, \"parent\");\n    /**\n     * 记录未分离的子作用域\n     * @internal\n     */\n    __publicField(this, \"scopes\");\n    /**\n     * 在父作用域的 scopes 数组中记录子作用域的索引，用于优化移除操作\n     * @internal\n     */\n    __publicField(this, \"index\");\n    /**\n     * 前一个作用域\n     */\n    __publicField(this, \"prevScope\");\n    this.detached = detached;\n    this.parent = activeEffectScope;\n    if (!detached && activeEffectScope) {\n      this.index = (activeEffectScope.scopes || (activeEffectScope.scopes = [])).push(\n        this\n      ) - 1;\n    }\n  }\n  /**\n   * 获取作用域是否处于活动状态\n   */\n  get active() {\n    return this._active;\n  }\n  /**\n   * 暂停作用域\n   *\n   * 暂停当前作用域及其所有子作用域和效果\n   */\n  pause() {\n    if (this._active) {\n      this._isPaused = true;\n      let i, l;\n      if (this.scopes) {\n        for (i = 0, l = this.scopes.length; i < l; i++) {\n          this.scopes[i].pause();\n        }\n      }\n      for (i = 0, l = this.effects.length; i < l; i++) {\n        this.effects[i].pause();\n      }\n    }\n  }\n  /**\n   * 恢复作用域\n   *\n   * 恢复当前作用域及其所有子作用域和效果\n   */\n  resume() {\n    if (this._active) {\n      if (this._isPaused) {\n        this._isPaused = false;\n        let i, l;\n        if (this.scopes) {\n          for (i = 0, l = this.scopes.length; i < l; i++) {\n            this.scopes[i].resume();\n          }\n        }\n        for (i = 0, l = this.effects.length; i < l; i++) {\n          this.effects[i].resume();\n        }\n      }\n    }\n  }\n  /**\n   * 在作用域中运行函数\n   * @param fn 要运行的函数\n   * @returns 函数的返回值\n   */\n  run(fn) {\n    if (this._active) {\n      const currentEffectScope = activeEffectScope;\n      try {\n        activeEffectScope = this;\n        return fn();\n      } finally {\n        activeEffectScope = currentEffectScope;\n      }\n    } else if (__DEV__) {\n      warn(`无法运行已停用的 effect 作用域。`);\n    }\n  }\n  /**\n   * 激活作用域\n   * 仅应在非分离的作用域上调用\n   * @internal\n   */\n  on() {\n    if (++this._on === 1) {\n      this.prevScope = activeEffectScope;\n      activeEffectScope = this;\n    }\n  }\n  /**\n   * 停用作用域\n   * 仅应在非分离的作用域上调用\n   * @internal\n   */\n  off() {\n    if (this._on > 0 && --this._on === 0) {\n      activeEffectScope = this.prevScope;\n      this.prevScope = void 0;\n    }\n  }\n  /**\n   * 停止作用域\n   *\n   * 停止当前作用域及其所有子作用域和效果，并执行清理函数\n   * @param fromParent 是否由父作用域调用\n   */\n  stop(fromParent) {\n    if (this._active) {\n      this._active = false;\n      let i, l;\n      for (i = 0, l = this.effects.length; i < l; i++) {\n        this.effects[i].stop();\n      }\n      this.effects.length = 0;\n      for (i = 0, l = this.cleanups.length; i < l; i++) {\n        this.cleanups[i]();\n      }\n      this.cleanups.length = 0;\n      if (this.scopes) {\n        for (i = 0, l = this.scopes.length; i < l; i++) {\n          this.scopes[i].stop(true);\n        }\n        this.scopes.length = 0;\n      }\n      if (!this.detached && this.parent && !fromParent) {\n        const last = this.parent.scopes.pop();\n        if (last && last !== this) {\n          this.parent.scopes[this.index] = last;\n          last.index = this.index;\n        }\n      }\n      this.parent = void 0;\n    }\n  }\n}\nfunction effectScope(detached) {\n  return new EffectScope(detached);\n}\nfunction getCurrentScope() {\n  return activeEffectScope;\n}\nfunction onScopeDispose(fn, failSilently = false) {\n  if (activeEffectScope) {\n    activeEffectScope.cleanups.push(fn);\n  } else if (__DEV__ && !failSilently) {\n    warn(\n      `onScopeDispose() 在没有活动的 effect 作用域时被调用，无法关联。`\n    );\n  }\n}\nfunction effect(fn) {\n  return new EffectReactivity(fn);\n}\nconst _EffectReactivity = class _EffectReactivity extends ComputedReactivity {\n  constructor(func) {\n    super(func);\n    /**\n     * 是否为启用, 默认为 true。\n     *\n     * 启用时，会立即执行函数。\n     */\n    __publicField(this, \"_isEnable\", true);\n    if (activeEffectScope && activeEffectScope.active) {\n      activeEffectScope.effects.push(this);\n    }\n    this.runIfDirty();\n  }\n  /**\n   * 暂停效果。\n   *\n   * 暂停后，当依赖发生变化时不会自动执行。\n   */\n  pause() {\n    this._isEnable = false;\n  }\n  /**\n   * 恢复效果。\n   *\n   * 恢复后，当依赖发生变化时会自动执行。\n   */\n  resume() {\n    if (this._isEnable) return;\n    this._isEnable = true;\n    if (_EffectReactivity.pausedQueueEffects.has(this)) {\n      _EffectReactivity.pausedQueueEffects.delete(this);\n      this.trigger();\n    }\n  }\n  /**\n   * 停止效果。\n   *\n   * 停止后，效果将不再响应依赖的变化。\n   */\n  stop() {\n    this._isEnable = false;\n    _EffectReactivity.pausedQueueEffects.delete(this);\n  }\n  /**\n   * 触发效果执行。\n   *\n   * 当依赖发生变化时，会调用此方法。\n   */\n  trigger() {\n    batchRun(() => {\n      super.trigger();\n      if (this._isEnable) {\n        batch(this, Reactivity.activeReactivity === this);\n      } else {\n        _EffectReactivity.pausedQueueEffects.add(this);\n      }\n    });\n  }\n  /**\n   * 执行当前节点。\n   *\n   * 当暂停时将会直接执行被包装的函数。\n   */\n  run() {\n    if (this._isEnable) {\n      super.run();\n    } else {\n      this._func(this._value);\n    }\n  }\n};\n__publicField(_EffectReactivity, \"pausedQueueEffects\", /* @__PURE__ */ new WeakSet());\nlet EffectReactivity = _EffectReactivity;\nfunction property(target, key) {\n  let depsMap = PropertyReactivity._targetMap.get(target);\n  if (!depsMap) {\n    depsMap = /* @__PURE__ */ new Map();\n    PropertyReactivity._targetMap.set(target, depsMap);\n  }\n  let dep = depsMap.get(key);\n  if (!dep) {\n    dep = new PropertyReactivity(target, key);\n    depsMap.set(key, dep);\n  }\n  return dep;\n}\nclass PropertyReactivity extends Reactivity {\n  constructor(target, key) {\n    super();\n    __publicField(this, \"_target\");\n    __publicField(this, \"_key\");\n    this._target = target;\n    this._key = key;\n    if (target instanceof Map || target instanceof WeakMap) {\n      this._value = target.get(key);\n    } else if (target instanceof Set || target instanceof WeakSet) {\n      this._value = target.has(key);\n    } else {\n      this._value = target[key];\n    }\n  }\n  /**\n   * 获取当前节点值。\n   *\n   * 取值时将会建立与父节点的依赖关系。\n   */\n  get value() {\n    this.track();\n    return this._value;\n  }\n  set value(v) {\n    if (this._key === \"length\") {\n      v = this._target[\"length\"];\n    } else if (isSymbol(this._key)) {\n      v = ~~this._value + 1;\n    }\n    if (v === this._value) return;\n    this.trigger();\n    this._value = v;\n  }\n  triggerIfChanged() {\n  }\n  /**\n   * 追踪属性的变化。\n   *\n   * 当属性被访问时，将会追踪属性的变化。\n   *\n   * @param target 目标对象。\n   * @param key  属性名。\n   * @returns\n   */\n  static track(target, type, key) {\n    if (!Reactivity.activeReactivity) return;\n    const dep = property(target, key);\n    dep.track();\n  }\n  /**\n   * 触发属性的变化。\n   *\n   * @param target 目标对象。\n   * @param type    操作类型。\n   * @param key 属性名。\n   * @param newValue 新值。\n   * @param oldValue 旧值。\n   * @returns\n   */\n  static trigger(target, type, key, newValue, oldValue) {\n    const depsMap = this._targetMap.get(target);\n    if (!depsMap) return;\n    const run = (dep) => {\n      if (dep) {\n        dep.value = newValue;\n      }\n    };\n    batchRun(() => {\n      if (type === TriggerOpTypes.CLEAR) {\n        depsMap.forEach(run);\n      } else {\n        const targetIsArray = isArray(target);\n        const isArrayIndex = targetIsArray && isIntegerKey(key);\n        if (targetIsArray && key === \"length\") {\n          const newLength = Number(newValue);\n          depsMap.forEach((dep, key2) => {\n            if (key2 === \"length\" || key2 === ARRAY_ITERATE_KEY || !isSymbol(key2) && key2 >= newLength) {\n              run(dep);\n            }\n          });\n        } else {\n          if (key !== void 0 || depsMap.has(void 0)) {\n            run(depsMap.get(key));\n          }\n          if (isArrayIndex) {\n            run(depsMap.get(ARRAY_ITERATE_KEY));\n          }\n          switch (type) {\n            case TriggerOpTypes.ADD:\n              if (!targetIsArray) {\n                run(depsMap.get(ITERATE_KEY));\n                if (isMap(target)) {\n                  run(depsMap.get(MAP_KEY_ITERATE_KEY));\n                }\n              } else if (isArrayIndex) {\n                run(depsMap.get(\"length\"));\n              }\n              break;\n            case TriggerOpTypes.DELETE:\n              if (!targetIsArray) {\n                run(depsMap.get(ITERATE_KEY));\n                if (isMap(target)) {\n                  run(depsMap.get(MAP_KEY_ITERATE_KEY));\n                }\n              }\n              break;\n            case TriggerOpTypes.SET:\n              if (isMap(target)) {\n                run(depsMap.get(ITERATE_KEY));\n              }\n              break;\n          }\n        }\n      }\n    });\n  }\n}\n/**\n * @private\n */\n__publicField(PropertyReactivity, \"_targetMap\", /* @__PURE__ */ new WeakMap());\nconst arrayInstrumentations = {\n  __proto__: null,\n  /**\n   * 返回一个迭代器，用于遍历数组的响应式值。\n   *\n   * 实现了以下功能：\n   * 1. 创建数组的迭代器\n   * 2. 自动将迭代的值转换为响应式\n   * 3. 自动追踪数组的访问\n   *\n   * @returns 数组的迭代器\n   */\n  [Symbol.iterator]() {\n    return iterator(this, Symbol.iterator, toReactive);\n  },\n  /**\n   * 连接数组并返回新数组。\n   *\n   * 实现了以下功能：\n   * 1. 处理响应式数组的连接\n   * 2. 自动将参数中的数组转换为响应式\n   * 3. 保持原始值的引用\n   *\n   * @param args 要连接的数组或值\n   * @returns 连接后的新数组\n   */\n  concat(...args) {\n    return reactiveReadArray(this).concat(\n      ...args.map((x) => isArray(x) ? reactiveReadArray(x) : x)\n    );\n  },\n  /**\n   * 返回一个迭代器，用于遍历数组的键值对。\n   *\n   * 实现了以下功能：\n   * 1. 创建数组的键值对迭代器\n   * 2. 自动将值转换为响应式\n   * 3. 自动追踪数组的访问\n   *\n   * @returns 数组的键值对迭代器\n   */\n  entries() {\n    return iterator(this, \"entries\", (value) => {\n      value[1] = toReactive(value[1]);\n      return value;\n    });\n  },\n  /**\n   * 测试数组中的所有元素是否都通过了指定函数的测试。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的测试\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 如果所有元素都通过测试则返回 true，否则返回 false\n   */\n  every(fn, thisArg) {\n    return apply(this, \"every\", fn, thisArg, void 0, arguments);\n  },\n  /**\n   * 创建一个新数组，包含通过指定函数测试的所有元素。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 自动将结果转换为响应式\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 包含通过测试的元素的新数组\n   */\n  filter(fn, thisArg) {\n    return apply(this, \"filter\", fn, thisArg, (v) => v.map(toReactive), arguments);\n  },\n  /**\n   * 返回数组中满足指定测试函数的第一个元素。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 自动将结果转换为响应式\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 第一个满足测试的元素，如果没有则返回 undefined\n   */\n  find(fn, thisArg) {\n    return apply(this, \"find\", fn, thisArg, toReactive, arguments);\n  },\n  /**\n   * 返回数组中满足指定测试函数的第一个元素的索引。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的查找\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 第一个满足测试的元素的索引，如果没有则返回 -1\n   */\n  findIndex(fn, thisArg) {\n    return apply(this, \"findIndex\", fn, thisArg, void 0, arguments);\n  },\n  /**\n   * 返回数组中满足指定测试函数的最后一个元素。\n   *\n   * 实现了以下功能：\n   * 1. 从后向前遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 自动将结果转换为响应式\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 最后一个满足测试的元素，如果没有则返回 undefined\n   */\n  findLast(fn, thisArg) {\n    return apply(this, \"findLast\", fn, thisArg, toReactive, arguments);\n  },\n  /**\n   * 返回数组中满足指定测试函数的最后一个元素的索引。\n   *\n   * 实现了以下功能：\n   * 1. 从后向前遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的查找\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 最后一个满足测试的元素的索引，如果没有则返回 -1\n   */\n  findLastIndex(fn, thisArg) {\n    return apply(this, \"findLastIndex\", fn, thisArg, void 0, arguments);\n  },\n  // flat, flatMap 可以从 ARRAY_ITERATE 中受益，但实现起来不太直接\n  /**\n   * 对数组中的每个元素执行指定函数。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行回调函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的遍历\n   *\n   * @param fn 回调函数\n   * @param thisArg 回调函数的 this 值\n   */\n  forEach(fn, thisArg) {\n    return apply(this, \"forEach\", fn, thisArg, void 0, arguments);\n  },\n  /**\n   * 判断数组是否包含指定元素。\n   *\n   * 实现了以下功能：\n   * 1. 处理响应式值的查找\n   * 2. 自动追踪数组的访问\n   * 3. 处理代理对象的查找\n   *\n   * @param args 要查找的元素\n   * @returns 如果数组包含该元素则返回 true，否则返回 false\n   */\n  includes(...args) {\n    return searchProxy(this, \"includes\", args);\n  },\n  /**\n   * 返回数组中指定元素第一次出现的索引。\n   *\n   * 实现了以下功能：\n   * 1. 处理响应式值的查找\n   * 2. 自动追踪数组的访问\n   * 3. 处理代理对象的查找\n   *\n   * @param args 要查找的元素\n   * @returns 元素第一次出现的索引，如果没有则返回 -1\n   */\n  indexOf(...args) {\n    return searchProxy(this, \"indexOf\", args);\n  },\n  /**\n   * 将数组的所有元素连接成一个字符串。\n   *\n   * 实现了以下功能：\n   * 1. 处理响应式数组的连接\n   * 2. 自动追踪数组的访问\n   * 3. 保持原始值的引用\n   *\n   * @param separator 分隔符\n   * @returns 连接后的字符串\n   */\n  join(separator) {\n    return reactiveReadArray(this).join(separator);\n  },\n  // keys() 迭代器只读取 length，不需要优化\n  /**\n   * 返回数组中指定元素最后一次出现的索引。\n   *\n   * 实现了以下功能：\n   * 1. 处理响应式值的查找\n   * 2. 自动追踪数组的访问\n   * 3. 处理代理对象的查找\n   *\n   * @param args 要查找的元素\n   * @returns 元素最后一次出现的索引，如果没有则返回 -1\n   */\n  lastIndexOf(...args) {\n    return searchProxy(this, \"lastIndexOf\", args);\n  },\n  /**\n   * 创建一个新数组，包含对原数组每个元素调用指定函数的结果。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行映射函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的映射\n   *\n   * @param fn 映射函数\n   * @param thisArg 映射函数的 this 值\n   * @returns 包含映射结果的新数组\n   */\n  map(fn, thisArg) {\n    return apply(this, \"map\", fn, thisArg, void 0, arguments);\n  },\n  /**\n   * 移除数组的最后一个元素并返回该元素。\n   *\n   * 实现了以下功能：\n   * 1. 移除最后一个元素\n   * 2. 避免跟踪长度变化\n   * 3. 处理响应式值的移除\n   *\n   * @returns 被移除的元素\n   */\n  pop() {\n    return noTracking(this, \"pop\");\n  },\n  /**\n   * 向数组末尾添加一个或多个元素。\n   *\n   * 实现了以下功能：\n   * 1. 添加新元素\n   * 2. 避免跟踪长度变化\n   * 3. 处理响应式值的添加\n   *\n   * @param args 要添加的元素\n   * @returns 数组的新长度\n   */\n  push(...args) {\n    return noTracking(this, \"push\", args);\n  },\n  /**\n   * 对数组中的每个元素执行累加器函数。\n   *\n   * 实现了以下功能：\n   * 1. 从左到右遍历数组元素\n   * 2. 对每个元素执行累加器函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的累加\n   *\n   * @param fn 累加器函数\n   * @param args 初始值（可选）\n   * @returns 累加的结果\n   */\n  reduce(fn, ...args) {\n    return reduce(this, \"reduce\", fn, args);\n  },\n  /**\n   * 从右到左对数组中的每个元素执行累加器函数。\n   *\n   * 实现了以下功能：\n   * 1. 从右到左遍历数组元素\n   * 2. 对每个元素执行累加器函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的累加\n   *\n   * @param fn 累加器函数\n   * @param args 初始值（可选）\n   * @returns 累加的结果\n   */\n  reduceRight(fn, ...args) {\n    return reduce(this, \"reduceRight\", fn, args);\n  },\n  /**\n   * 移除数组的第一个元素并返回该元素。\n   *\n   * 实现了以下功能：\n   * 1. 移除第一个元素\n   * 2. 避免跟踪长度变化\n   * 3. 处理响应式值的移除\n   *\n   * @returns 被移除的元素\n   */\n  shift() {\n    return noTracking(this, \"shift\");\n  },\n  // slice 可以使用 ARRAY_ITERATE，但似乎也需要范围追踪\n  /**\n   * 测试数组中的某些元素是否通过了指定函数的测试。\n   *\n   * 实现了以下功能：\n   * 1. 遍历数组元素\n   * 2. 对每个元素执行测试函数\n   * 3. 自动追踪数组的访问\n   * 4. 处理响应式值的测试\n   *\n   * @param fn 测试函数\n   * @param thisArg 测试函数的 this 值\n   * @returns 如果有元素通过测试则返回 true，否则返回 false\n   */\n  some(fn, thisArg) {\n    return apply(this, \"some\", fn, thisArg, void 0, arguments);\n  },\n  /**\n   * 通过删除或替换现有元素或添加新元素来修改数组。\n   *\n   * 实现了以下功能：\n   * 1. 修改数组内容\n   * 2. 避免跟踪长度变化\n   * 3. 处理响应式值的修改\n   *\n   * @param args 要删除的起始索引、要删除的元素数量和要添加的元素\n   * @returns 包含被删除元素的新数组\n   */\n  splice(...args) {\n    return noTracking(this, \"splice\", args);\n  },\n  /**\n   * 返回一个新数组，包含原数组的反转副本。\n   *\n   * 实现了以下功能：\n   * 1. 创建数组的反转副本\n   * 2. 自动将结果转换为响应式\n   * 3. 保持原始值的引用\n   *\n   * @returns 反转后的新数组\n   */\n  toReversed() {\n    return reactiveReadArray(this).toReversed();\n  },\n  /**\n   * 返回一个新数组，包含原数组的排序副本。\n   *\n   * 实现了以下功能：\n   * 1. 创建数组的排序副本\n   * 2. 自动将结果转换为响应式\n   * 3. 保持原始值的引用\n   *\n   * @param comparer 比较函数\n   * @returns 排序后的新数组\n   */\n  toSorted(comparer) {\n    return reactiveReadArray(this).toSorted(comparer);\n  },\n  /**\n   * 返回一个新数组，包含原数组的切片副本。\n   *\n   * 实现了以下功能：\n   * 1. 创建数组的切片副本\n   * 2. 自动将结果转换为响应式\n   * 3. 保持原始值的引用\n   *\n   * @param args 起始索引和结束索引\n   * @returns 切片后的新数组\n   */\n  toSpliced(...args) {\n    return reactiveReadArray(this).toSpliced(...args);\n  },\n  /**\n   * 向数组开头添加一个或多个元素。\n   *\n   * 实现了以下功能：\n   * 1. 添加新元素\n   * 2. 避免跟踪长度变化\n   * 3. 处理响应式值的添加\n   *\n   * @param args 要添加的元素\n   * @returns 数组的新长度\n   */\n  unshift(...args) {\n    return noTracking(this, \"unshift\", args);\n  },\n  /**\n   * 返回一个迭代器，用于遍历数组的值。\n   *\n   * 实现了以下功能：\n   * 1. 创建数组的值迭代器\n   * 2. 自动将迭代的值转换为响应式\n   * 3. 自动追踪数组的访问\n   *\n   * @returns 数组的值迭代器\n   */\n  values() {\n    return iterator(this, \"values\", toReactive);\n  }\n};\nfunction iterator(self, method, wrapValue) {\n  const arr = shallowReadArray(self);\n  const iter = arr[method]();\n  if (arr !== self) {\n    iter._next = iter.next;\n    iter.next = () => {\n      const result = iter._next();\n      if (result.value) {\n        result.value = wrapValue(result.value);\n      }\n      return result;\n    };\n  }\n  return iter;\n}\nfunction shallowReadArray(arr) {\n  PropertyReactivity.track(arr = toRaw(arr), TrackOpTypes.ITERATE, ARRAY_ITERATE_KEY);\n  return arr;\n}\nfunction reactiveReadArray(array) {\n  const raw = toRaw(array);\n  if (raw === array) return raw;\n  PropertyReactivity.track(raw, TrackOpTypes.ITERATE, ARRAY_ITERATE_KEY);\n  return raw.map(toReactive);\n}\nfunction apply(self, method, fn, thisArg, wrappedRetFn, args) {\n  const arr = shallowReadArray(self);\n  const needsWrap = arr !== self;\n  const methodFn = arr[method];\n  if (methodFn !== Array.prototype[method]) {\n    const result2 = methodFn.apply(self, args);\n    return needsWrap ? toReactive(result2) : result2;\n  }\n  let wrappedFn = fn;\n  if (arr !== self) {\n    if (needsWrap) {\n      wrappedFn = function(item, index) {\n        return fn.call(this, toReactive(item), index, self);\n      };\n    } else if (fn.length > 2) {\n      wrappedFn = function(item, index) {\n        return fn.call(this, item, index, self);\n      };\n    }\n  }\n  const result = methodFn.call(arr, wrappedFn, thisArg);\n  return needsWrap && wrappedRetFn ? wrappedRetFn(result) : result;\n}\nfunction reduce(self, method, fn, args) {\n  const arr = shallowReadArray(self);\n  let wrappedFn = fn;\n  if (arr !== self) {\n    wrappedFn = function(acc, item, index) {\n      return fn.call(this, acc, toReactive(item), index, self);\n    };\n  }\n  return arr[method](wrappedFn, ...args);\n}\nfunction searchProxy(self, method, args) {\n  const arr = toRaw(self);\n  PropertyReactivity.track(arr, TrackOpTypes.ITERATE, ARRAY_ITERATE_KEY);\n  const res = arr[method](...args);\n  if ((res === -1 || res === false) && isProxy(args[0])) {\n    args[0] = toRaw(args[0]);\n    return arr[method](...args);\n  }\n  return res;\n}\nfunction noTracking(self, method, args = []) {\n  const res = batchRun(\n    () => noTrack(\n      () => toRaw(self)[method].apply(self, args)\n    )\n  );\n  return res;\n}\nfunction ref(value) {\n  if (isRef(value)) {\n    return value;\n  }\n  return new RefReactivity(value);\n}\nfunction isRef(r) {\n  return r ? r[ReactiveFlags.IS_REF] === true : false;\n}\nclass RefReactivity extends (_b = Reactivity, _a = ReactiveFlags.IS_REF, _b) {\n  /**\n   * 创建引用反应式节点。\n   *\n   * @param value 要包装的值\n   */\n  constructor(value) {\n    super();\n    /**\n     * 标识这是一个 ref 对象。\n     *\n     * 用于 isRef 函数判断对象是否为引用。\n     */\n    __publicField(this, _a, true);\n    /**\n     * 原始值。\n     *\n     * 存储未经响应式处理的原始值。\n     * 用于比较值是否发生变化。\n     *\n     * @private\n     */\n    __publicField(this, \"_rawValue\");\n    this._rawValue = toRaw(value);\n    this._value = toReactive(value);\n  }\n  /**\n   * 获取引用的值。\n   *\n   * 取值时会：\n   * 1. 建立依赖关系\n   * 2. 返回当前值\n   */\n  get value() {\n    this.track();\n    return this._value;\n  }\n  /**\n   * 设置引用的值。\n   *\n   * 设置值时会：\n   * 1. 比较新旧值是否发生变化\n   * 2. 如果值发生变化，则：\n   *    - 触发更新通知\n   *    - 更新原始值\n   *    - 更新响应式值\n   *\n   * @param v 要设置的新值\n   */\n  set value(v) {\n    const oldValue = this._rawValue;\n    const newValue = toRaw(v);\n    if (!hasChanged(oldValue, newValue)) return;\n    batchRun(() => {\n      this.trigger();\n      this._rawValue = newValue;\n      this._value = toReactive(newValue);\n    });\n  }\n}\nclass BaseReactiveHandler {\n  /**\n   * 获取对象的属性值。\n   *\n   * 实现了以下功能：\n   * 1. 响应式对象标识检查\n   * 2. 原始对象获取\n   * 3. 数组方法拦截\n   * 4. 属性依赖追踪\n   * 5. 值的自动解包\n   * 6. 对象的自动响应式转换\n   *\n   * @param target 被代理的原始对象\n   * @param key 要获取的属性名\n   * @param receiver 代理对象本身\n   * @returns 获取到的属性值\n   */\n  get(target, key, receiver) {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true;\n    } else if (key === ReactiveFlags.RAW) {\n      if (receiver === reactiveMap.get(target) || Object.getPrototypeOf(target) === Object.getPrototypeOf(receiver)) {\n        return target;\n      }\n      return;\n    }\n    const targetIsArray = isArray(target);\n    let fn;\n    if (targetIsArray && (fn = arrayInstrumentations[key])) {\n      return fn;\n    }\n    if (key === \"hasOwnProperty\") {\n      return hasOwnProperty;\n    }\n    const res = Reflect.get(\n      target,\n      key,\n      isRef(target) ? target : receiver\n    );\n    if (isSymbol(key) ? builtInSymbols.has(key) : isNonTrackableKeys(key)) {\n      return res;\n    }\n    PropertyReactivity.track(target, TrackOpTypes.GET, key);\n    if (isRef(res)) {\n      return targetIsArray && isIntegerKey(key) ? res : res.value;\n    }\n    if (isObject(res)) {\n      return reactive(res);\n    }\n    return res;\n  }\n}\nclass MutableReactiveHandler extends BaseReactiveHandler {\n  /**\n   * 设置对象的属性值。\n   *\n   * 实现了以下功能：\n   * 1. 值的原始化处理\n   * 2. ref 值的特殊处理\n   * 3. 属性变更通知\n   * 4. 数组长度的特殊处理\n   *\n   * @param target 被代理的原始对象\n   * @param key 要设置的属性名\n   * @param value 要设置的新值\n   * @param receiver 代理对象本身\n   * @returns 设置是否成功\n   */\n  set(target, key, value, receiver) {\n    let oldValue = target[key];\n    oldValue = toRaw(oldValue);\n    value = toRaw(value);\n    if (!isArray(target) && isRef(oldValue) && !isRef(value)) {\n      oldValue.value = value;\n      return true;\n    }\n    const hadKey = isArray(target) && isIntegerKey(key) ? Number(key) < target.length : hasOwn(target, key);\n    const result = Reflect.set(\n      target,\n      key,\n      value,\n      isRef(target) ? target : receiver\n    );\n    __DEV__ && console.assert(target === toRaw(receiver));\n    if (target === toRaw(receiver)) {\n      if (!hadKey) {\n        PropertyReactivity.trigger(target, TriggerOpTypes.ADD, key, value);\n      } else if (hasChanged(value, oldValue)) {\n        PropertyReactivity.trigger(target, TriggerOpTypes.SET, key, value, oldValue);\n      }\n    }\n    return result;\n  }\n  /**\n   * 删除对象的属性。\n   *\n   * 实现了以下功能：\n   * 1. 属性删除操作\n   * 2. 删除后的变更通知\n   *\n   * @param target 被代理的原始对象\n   * @param key 要删除的属性名\n   * @returns 删除是否成功\n   */\n  deleteProperty(target, key) {\n    const hadKey = hasOwn(target, key);\n    const oldValue = target[key];\n    const result = Reflect.deleteProperty(target, key);\n    if (result && hadKey) {\n      PropertyReactivity.trigger(target, TriggerOpTypes.DELETE, key, void 0, oldValue);\n    }\n    return result;\n  }\n  /**\n   * 检查对象是否包含某个属性。\n   *\n   * 实现了以下功能：\n   * 1. 属性存在性检查\n   * 2. 属性访问依赖追踪\n   *\n   * @param target 被代理的原始对象\n   * @param key 要检查的属性名\n   * @returns 属性是否存在\n   */\n  has(target, key) {\n    const result = Reflect.has(target, key);\n    if (!isSymbol(key) || !builtInSymbols.has(key)) {\n      PropertyReactivity.track(target, TrackOpTypes.HAS, key);\n    }\n    return result;\n  }\n  /**\n   * 获取对象的所有属性名。\n   *\n   * 实现了以下功能：\n   * 1. 属性遍历\n   * 2. 遍历操作的依赖追踪\n   *\n   * @param target 被代理的原始对象\n   * @returns 对象的所有属性名数组\n   */\n  ownKeys(target) {\n    PropertyReactivity.track(\n      target,\n      TrackOpTypes.ITERATE,\n      isArray(target) ? \"length\" : ITERATE_KEY\n    );\n    return Reflect.ownKeys(target);\n  }\n}\nconst mutableHandlers = new MutableReactiveHandler();\nfunction hasOwnProperty(key) {\n  if (!isSymbol(key)) key = String(key);\n  const obj = toRaw(this);\n  PropertyReactivity.track(obj, TrackOpTypes.HAS, key);\n  return obj.hasOwnProperty(key);\n}\nconst builtInSymbols = new Set(\n  /* @__PURE__ */ Object.getOwnPropertyNames(Symbol).filter((key) => key !== \"arguments\" && key !== \"caller\").map((key) => Symbol[key]).filter(isSymbol)\n);\nconst isNonTrackableKeys = /* @__PURE__ */ makeMap(`__proto__,__v_isRef,__isVue`);\nconst mutableCollectionHandlers = {\n  get: createInstrumentationGetter()\n};\nfunction createInstrumentationGetter() {\n  const instrumentations = createInstrumentations();\n  return (target, key, receiver) => {\n    if (key === ReactiveFlags.IS_REACTIVE) {\n      return true;\n    } else if (key === ReactiveFlags.RAW) {\n      return target;\n    }\n    return Reflect.get(\n      hasOwn(instrumentations, key) && key in target ? instrumentations : target,\n      key,\n      receiver\n    );\n  };\n}\nfunction createInstrumentations() {\n  const instrumentations = {\n    /**\n     * 获取 Map 中的值。\n     *\n     * 实现了以下功能：\n     * 1. 支持原始键和响应式键的查找\n     * 2. 自动追踪键的访问\n     * 3. 自动将返回值转换为响应式\n     *\n     * @param key 要查找的键\n     * @returns 找到的值，如果不存在则返回 undefined\n     */\n    get(key) {\n      const target = this[ReactiveFlags.RAW];\n      const rawTarget = toRaw(target);\n      const rawKey = toRaw(key);\n      if (hasChanged(key, rawKey)) {\n        PropertyReactivity.track(rawTarget, TrackOpTypes.GET, key);\n      }\n      PropertyReactivity.track(rawTarget, TrackOpTypes.GET, rawKey);\n      const { has } = getProto(rawTarget);\n      const wrap = toReactive;\n      if (has.call(rawTarget, key)) {\n        return wrap(target.get(key));\n      } else if (has.call(rawTarget, rawKey)) {\n        return wrap(target.get(rawKey));\n      } else if (target !== rawTarget) {\n        target.get(key);\n      }\n    },\n    /**\n     * 获取集合的大小。\n     *\n     * 实现了以下功能：\n     * 1. 追踪集合大小的访问\n     * 2. 返回集合的实际大小\n     */\n    get size() {\n      const target = this[ReactiveFlags.RAW];\n      PropertyReactivity.track(toRaw(target), TrackOpTypes.ITERATE, ITERATE_KEY);\n      return Reflect.get(target, \"size\", target);\n    },\n    /**\n     * 检查集合是否包含某个值。\n     *\n     * 实现了以下功能：\n     * 1. 支持原始键和响应式键的检查\n     * 2. 自动追踪键的检查\n     *\n     * @param key 要检查的键\n     * @returns 如果集合包含该键则返回 true，否则返回 false\n     */\n    has(key) {\n      const target = this[ReactiveFlags.RAW];\n      const rawTarget = toRaw(target);\n      const rawKey = toRaw(key);\n      if (hasChanged(key, rawKey)) {\n        PropertyReactivity.track(rawTarget, TrackOpTypes.HAS, key);\n      }\n      PropertyReactivity.track(rawTarget, TrackOpTypes.HAS, rawKey);\n      return key === rawKey ? target.has(key) : target.has(key) || target.has(rawKey);\n    },\n    /**\n     * 遍历集合中的所有元素。\n     *\n     * 实现了以下功能：\n     * 1. 追踪集合的遍历操作\n     * 2. 自动将遍历的值转换为响应式\n     * 3. 保持回调函数的 this 上下文\n     *\n     * @param callback 遍历回调函数\n     * @param thisArg 回调函数的 this 值\n     */\n    forEach(callback, thisArg) {\n      const observed = this;\n      const target = observed[ReactiveFlags.RAW];\n      const rawTarget = toRaw(target);\n      const wrap = toReactive;\n      PropertyReactivity.track(rawTarget, TrackOpTypes.ITERATE, ITERATE_KEY);\n      return target.forEach(\n        (value, key) => (\n          // 重要：确保回调函数\n          // 1. 使用响应式 map 作为 this 和第三个参数\n          // 2. 接收到的值应该是相应的响应式/只读版本\n          callback.call(thisArg, wrap(value), wrap(key), observed)\n        )\n      );\n    },\n    /**\n     * 向 Set 中添加值。\n     *\n     * 实现了以下功能：\n     * 1. 自动将值转换为原始值\n     * 2. 避免重复添加\n     * 3. 触发添加操作的通知\n     *\n     * @param value 要添加的值\n     * @returns 集合本身，支持链式调用\n     */\n    add(value) {\n      value = toRaw(value);\n      const target = toRaw(this);\n      const proto = getProto(target);\n      const hadKey = proto.has.call(target, value);\n      if (!hadKey) {\n        target.add(value);\n        PropertyReactivity.trigger(target, TriggerOpTypes.ADD, value, value);\n      }\n      return this;\n    },\n    /**\n     * 设置 Map 中的值。\n     *\n     * 实现了以下功能：\n     * 1. 自动将值转换为原始值\n     * 2. 支持原始键和响应式键的设置\n     * 3. 触发添加或修改操作的通知\n     *\n     * @param key 要设置的键\n     * @param value 要设置的值\n     * @returns 集合本身，支持链式调用\n     */\n    set(key, value) {\n      value = toRaw(value);\n      const target = toRaw(this);\n      const { has, get } = getProto(target);\n      let hadKey = has.call(target, key);\n      if (!hadKey) {\n        key = toRaw(key);\n        hadKey = has.call(target, key);\n      } else if (__DEV__) {\n        checkIdentityKeys(target, has, key);\n      }\n      const oldValue = get.call(target, key);\n      target.set(key, value);\n      if (!hadKey) {\n        PropertyReactivity.trigger(target, TriggerOpTypes.ADD, key, value);\n      } else if (hasChanged(value, oldValue)) {\n        PropertyReactivity.trigger(target, TriggerOpTypes.SET, key, value, oldValue);\n      }\n      return this;\n    },\n    /**\n     * 从集合中删除值。\n     *\n     * 实现了以下功能：\n     * 1. 支持原始键和响应式键的删除\n     * 2. 触发删除操作的通知\n     *\n     * @param key 要删除的键\n     * @returns 如果删除成功则返回 true，否则返回 false\n     */\n    delete(key) {\n      const target = toRaw(this);\n      const { has, get } = getProto(target);\n      let hadKey = has.call(target, key);\n      if (!hadKey) {\n        key = toRaw(key);\n        hadKey = has.call(target, key);\n      } else if (__DEV__) {\n        checkIdentityKeys(target, has, key);\n      }\n      const oldValue = get ? get.call(target, key) : void 0;\n      const result = target.delete(key);\n      if (hadKey) {\n        PropertyReactivity.trigger(target, TriggerOpTypes.DELETE, key, void 0, oldValue);\n      }\n      return result;\n    },\n    /**\n     * 清空集合。\n     *\n     * 实现了以下功能：\n     * 1. 清空集合中的所有元素\n     * 2. 触发清空操作的通知\n     * 3. 在开发模式下保存旧值用于调试\n     *\n     * @returns 如果清空成功则返回 true，否则返回 false\n     */\n    clear() {\n      const target = toRaw(this);\n      const hadItems = target.size !== 0;\n      const oldTarget = __DEV__ ? isMap(target) ? new Map(target) : new Set(target) : void 0;\n      const result = target.clear();\n      if (hadItems) {\n        PropertyReactivity.trigger(\n          target,\n          TriggerOpTypes.CLEAR,\n          void 0,\n          void 0,\n          oldTarget\n        );\n      }\n      return result;\n    }\n  };\n  const iteratorMethods = [\n    \"keys\",\n    \"values\",\n    \"entries\",\n    Symbol.iterator\n  ];\n  iteratorMethods.forEach((method) => {\n    instrumentations[method] = createIterableMethod(method);\n  });\n  return instrumentations;\n}\nfunction createIterableMethod(method) {\n  return function(...args) {\n    const target = this[ReactiveFlags.RAW];\n    const rawTarget = toRaw(target);\n    const targetIsMap = isMap(rawTarget);\n    const isPair = method === \"entries\" || method === Symbol.iterator && targetIsMap;\n    const isKeyOnly = method === \"keys\" && targetIsMap;\n    const innerIterator = target[method](...args);\n    const wrap = toReactive;\n    PropertyReactivity.track(\n      rawTarget,\n      TrackOpTypes.ITERATE,\n      isKeyOnly ? MAP_KEY_ITERATE_KEY : ITERATE_KEY\n    );\n    return {\n      // 迭代器协议\n      next() {\n        const { value, done } = innerIterator.next();\n        return done ? { value, done } : {\n          value: isPair ? [wrap(value[0]), wrap(value[1])] : wrap(value),\n          done\n        };\n      },\n      // 可迭代协议\n      [Symbol.iterator]() {\n        return this;\n      }\n    };\n  };\n}\nfunction checkIdentityKeys(target, has, key) {\n  const rawKey = toRaw(key);\n  if (rawKey !== key && has.call(target, rawKey)) {\n    const type = toRawType(target);\n    warn(\n      `响应式 ${type} 同时包含同一对象的原始版本和响应式版本${type === `Map` ? `作为键` : ``}，这可能导致不一致。建议仅使用响应式版本。`\n    );\n  }\n}\nconst getProto = (v) => Reflect.getPrototypeOf(v);\nfunction reactive(target) {\n  if (!isObject(target)) {\n    return target;\n  }\n  if (target[ReactiveFlags.RAW]) {\n    return target;\n  }\n  const targetType = getTargetType(target);\n  if (targetType === TargetType.INVALID) {\n    return target;\n  }\n  const existingProxy = reactiveMap.get(target);\n  if (existingProxy) {\n    return existingProxy;\n  }\n  const proxy = new Proxy(\n    target,\n    targetType === TargetType.COLLECTION ? mutableCollectionHandlers : mutableHandlers\n  );\n  reactiveMap.set(target, proxy);\n  return proxy;\n}\nconst reactiveMap = /* @__PURE__ */ new WeakMap();\nfunction isReactive(value) {\n  return !!(value && value[ReactiveFlags.IS_REACTIVE]);\n}\nconst toReactive = (value) => {\n  if (isObject(value)) {\n    return reactive(value);\n  }\n  return value;\n};\nfunction isProxy(value) {\n  return value ? !!value[ReactiveFlags.RAW] : false;\n}\nclass ReactiveObject {\n  constructor() {\n    /**\n     * 副作用作用域\n     *\n     * 用于管理所有副作用的生命周期：\n     * - 收集所有通过 effect() 方法创建的副作用\n     * - 在类销毁时自动停止所有副作用\n     * - 防止副作用在类销毁后继续执行，避免内存泄漏\n     *\n     * 私有属性，外部无法直接访问，只能通过 effect() 方法使用\n     */\n    __publicField(this, \"_effectScope\", new EffectScope());\n    /**\n     * 销毁时需要执行的函数\n     */\n    __publicField(this, \"_destroyCallbacks\", []);\n  }\n  /**\n   * 创建并运行副作用\n   *\n   * 功能：\n   * 1. 将传入的函数包装为副作用\n   * 2. 自动收集副作用中访问的响应式属性作为依赖\n   * 3. 当依赖变化时自动重新执行副作用\n   * 4. 在类销毁时自动停止副作用\n   *\n   * 使用场景：\n   * - 监听属性变化并执行相应操作\n   * - 自动更新UI或重新计算派生状态\n   * - 执行清理或初始化逻辑\n   *\n   * @param fn 副作用函数，会在依赖变化时自动执行\n   *\n   * 使用示例：\n   * ```typescript\n   * this.effect(() => {\n   *   // 访问响应式属性，建立依赖关系\n   *   const value = reactive(this).someProperty;\n   *\n   *   // 执行相应的逻辑\n   *   this.updateUI(value);\n   * });\n   * ```\n   */\n  effect(fn) {\n    let eff;\n    this._effectScope.run(() => {\n      eff = effect(fn);\n    });\n    return eff;\n  }\n  /**\n   * 销毁时执行的函数\n   * @param callback 销毁时执行的函数\n   */\n  destroyCall(callback) {\n    this._destroyCallbacks.push(callback);\n  }\n  /**\n   * 销毁响应式类实例\n   *\n   * 执行清理操作：\n   * 1. 执行所有注册的清理函数\n   * 2. 停止所有副作用作用域，防止副作用继续执行\n   * 3. 清理引用，帮助垃圾回收，防止内存泄漏\n   *\n   * 重要：\n   * - 子类重写此方法时必须调用 super.destroy()\n   * - 确保在类实例不再使用时调用此方法\n   * - 调用后实例将无法再使用 effect() 方法\n   *\n   * 使用示例：\n   * ```typescript\n   * class MyClass extends ReactiveObject {\n   *   destroy() {\n   *     // 执行子类特定的清理逻辑\n   *     this.cleanup();\n   *\n   *     // 必须调用父类的destroy方法\n   *     super.destroy();\n   *   }\n   * }\n   * ```\n   */\n  destroy() {\n    var _a2, _b2;\n    (_a2 = this._destroyCallbacks) == null ? void 0 : _a2.forEach((item) => item());\n    this._destroyCallbacks = null;\n    (_b2 = this._effectScope) == null ? void 0 : _b2.stop();\n    this._effectScope = null;\n  }\n}\nconsole.log(\"@feng3d/reactivity v1.0.12\");\nexport {\n  EffectScope,\n  ReactiveObject,\n  batchRun,\n  computed,\n  effect,\n  effectScope,\n  forceTrack,\n  getCurrentScope,\n  isProxy,\n  isReactive,\n  isRef,\n  noTrack,\n  onScopeDispose,\n  reactive,\n  ref,\n  toRaw\n};\n//# sourceMappingURL=index.js.map\n","import { effect, Effect, reactive } from '@feng3d/reactivity';\nimport { Buffer, renderState, WriteBuffer } from '@feng3d/render-api';\n\ndeclare global\n{\n    interface WebGLBuffer\n    {\n        /**\n         * 销毁。\n         */\n        destroy: () => void;\n    }\n}\n\nexport function getGLBuffer(gl: WebGLRenderingContext, buffer: Buffer, target: BufferTarget, usage: BufferUsage = 'STATIC_DRAW')\n{\n    let webGLBuffer = gl._bufferMap.get(buffer);\n\n    if (webGLBuffer) return webGLBuffer;\n\n    webGLBuffer = gl.createBuffer();\n    gl._bufferMap.set(buffer, webGLBuffer);\n\n    const size = buffer.size;\n\n    // 上传数据到WebGL\n    gl.bindBuffer(gl[target], webGLBuffer);\n    gl.bufferData(gl[target], size, gl[usage]);\n\n    const doWriteBuffer = (writeBuffer: WriteBuffer) =>\n    {\n        const bufferOffset = writeBuffer.bufferOffset ?? 0;\n        let data = writeBuffer.data;\n\n        if (writeBuffer.size)\n        {\n            data = new Uint8Array(data.buffer, data.byteOffset, writeBuffer.size * data.BYTES_PER_ELEMENT);\n        }\n        gl.bufferSubData(gl[target], bufferOffset, data);\n    };\n\n    const r_buffer = reactive(buffer);\n\n    const effects: Effect[] = [];\n\n    // 监听 data 变化\n    effects.push(effect(() =>\n    {\n        r_buffer.data;\n\n        if (!buffer.data) return;\n\n        gl.bindBuffer(gl[target], webGLBuffer);\n        doWriteBuffer({ data: new Uint8Array(buffer.data) });\n    }));\n\n    // 监听 writeBuffers 变化\n    effects.push(effect(() =>\n    {\n        // 触发响应式依赖，监听 writeBuffers 数组变化\n        r_buffer.writeBuffers?.forEach(() =>\n        { });\n\n        const writeBuffers = buffer.writeBuffers;\n\n        if (!writeBuffers) return;\n\n        gl.bindBuffer(gl[target], webGLBuffer);\n        writeBuffers.forEach(doWriteBuffer);\n\n        if (!renderState.isRunWebGPU)\n        {\n            reactive(buffer).writeBuffers = null;\n        }\n        else\n        {\n            setTimeout(() =>\n            {\n                reactive(buffer).writeBuffers = null;\n            }, 0);\n        }\n    }));\n\n    //\n    webGLBuffer.destroy = () =>\n    {\n        effects.forEach((eff) => eff.stop());\n    };\n\n    return webGLBuffer;\n}\n\nexport function deleteBuffer(gl: WebGLRenderingContext, buffer: Buffer)\n{\n    const webGLBuffer = gl._bufferMap.get(buffer);\n\n    if (webGLBuffer)\n    {\n        gl._bufferMap.delete(buffer);\n        webGLBuffer.destroy();\n        delete webGLBuffer.destroy;\n        //\n        gl.deleteBuffer(webGLBuffer);\n    }\n}\n\n/**\n * WebGL缓冲区使用模式。\n *\n * A GLenum specifying the intended usage pattern of the data store for optimization purposes. Possible values:\n *\n * * gl.STATIC_DRAW: The contents are intended to be specified once by the application, and used many times as the source for WebGL drawing and image specification commands.\n * * gl.DYNAMIC_DRAW: The contents are intended to be respecified repeatedly by the application, and used many times as the source for WebGL drawing and image specification commands.\n * * gl.STREAM_DRAW: The contents are intended to be specified once by the application, and used at most a few times as the source for WebGL drawing and image specification commands.\n *\n * When using a WebGL 2 context, the following values are available additionally:\n *\n * * gl.STATIC_READ     The contents are intended to be specified once by reading data from WebGL, and queried many times by the application.\n * * gl.DYNAMIC_READ    The contents are intended to be respecified repeatedly by reading data from WebGL, and queried many times by the application.\n * * gl.STREAM_READ     The contents are intended to be specified once by reading data from WebGL, and queried at most a few times by the application\n * * gl.STATIC_COPY     The contents are intended to be specified once by reading data from WebGL, and used many times as the source for WebGL drawing and image specification commands.\n * * gl.DYNAMIC_COPY    The contents are intended to be respecified repeatedly by reading data from WebGL, and used many times as the source for WebGL drawing and image specification commands.\n * * gl.STREAM_COPY     The contents are intended to be specified once by reading data from WebGL, and used at most a few times as the source for WebGL drawing and image specification commands.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bufferData\n */\ntype BufferUsage = 'STATIC_DRAW' | 'DYNAMIC_DRAW' | 'STREAM_DRAW' // WebGL1\n    | 'STATIC_READ' | 'DYNAMIC_READ' | 'STREAM_READ' | 'STATIC_COPY' | 'DYNAMIC_COPY' | 'STREAM_COPY' // WebGL2\n    ;\n\n/**\n * WebGL缓冲区目标。\n *\n * A GLenum specifying the binding point (target). Possible values:\n *\n * * gl.ARRAY_BUFFER: Buffer containing vertex attributes, such as vertex coordinates, texture coordinate data, or vertex color data.\n * * gl.ELEMENT_ARRAY_BUFFER: Buffer used for element indices.\n *\n * When using a WebGL 2 context, the following values are available additionally:\n * * gl.COPY_READ_BUFFER: Buffer for copying from one buffer object to another.\n * * gl.COPY_WRITE_BUFFER: Buffer for copying from one buffer object to another.\n * * gl.TRANSFORM_FEEDBACK_BUFFER: Buffer for transform feedback operations.\n * * gl.UNIFORM_BUFFER: Buffer used for storing uniform blocks.\n * * gl.PIXEL_PACK_BUFFER: Buffer used for pixel transfer operations.\n * * gl.PIXEL_UNPACK_BUFFER: Buffer used for pixel transfer operations.\n *\n */\ntype BufferTarget = 'ARRAY_BUFFER' | 'ELEMENT_ARRAY_BUFFER' // WebGL1\n    | 'COPY_READ_BUFFER' | 'COPY_WRITE_BUFFER' | 'TRANSFORM_FEEDBACK_BUFFER'// WebGL2\n    | 'UNIFORM_BUFFER' | 'PIXEL_PACK_BUFFER' | 'PIXEL_UNPACK_BUFFER'; // WebGL2\n","/**\n * WEBGL支持功能\n *\n * @see https://webglreport.com\n * @see http://html5test.com\n */\nexport class Capabilities\n{\n    /**\n     * 纹理各向异性过滤最大值\n     */\n    get maxAnisotropy()\n    {\n        if (this._maxAnisotropy) return this._maxAnisotropy;\n        this._maxAnisotropy = this._gl.getExtension('EXT_texture_filter_anisotropic') ? this._gl.getParameter(this._gl.getExtension('EXT_texture_filter_anisotropic').MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 0;\n\n        return this._maxAnisotropy;\n    }\n\n    private _maxAnisotropy: number;\n\n    /**\n     * 支持最大纹理数量\n     */\n    get maxTextures()\n    {\n        if (this._maxTextures) return this._maxTextures;\n        this._maxTextures = this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);\n\n        return this._maxTextures;\n    }\n\n    private _maxTextures: number;\n\n    /**\n     * 支持最大顶点纹理数量\n     */\n    get maxVertexTextures()\n    {\n        if (this._maxVertexTextures) return this._maxVertexTextures;\n        this._maxVertexTextures = this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\n\n        return this._maxVertexTextures;\n    }\n\n    private _maxVertexTextures: number;\n\n    /**\n     * 支持最大纹理尺寸\n     */\n    get maxTextureSize()\n    {\n        if (this._maxTextureSize) return this._maxTextureSize;\n        this._maxTextureSize = this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE);\n\n        return this._maxTextureSize;\n    }\n\n    private _maxTextureSize: number;\n\n    /**\n     * 支持最大立方体贴图尺寸\n     */\n    get maxCubemapSize()\n    {\n        if (this._maxCubemapSize) return this._maxCubemapSize;\n        this._maxCubemapSize = this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE);\n\n        return this._maxCubemapSize;\n    }\n\n    private _maxCubemapSize: number;\n\n    /**\n     * 支持属性数量\n     */\n    get maxAttributes()\n    {\n        if (this._maxAttributes) return this._maxAttributes;\n        this._maxAttributes = this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS);\n\n        return this._maxAttributes;\n    }\n\n    private _maxAttributes: number;\n\n    /**\n     * 顶点着色器支持最大 Uniform 数量\n     */\n    get maxVertexUniforms()\n    {\n        if (this._maxVertexUniforms) return this._maxVertexUniforms;\n        this._maxVertexUniforms = this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS);\n\n        return this._maxVertexUniforms;\n    }\n\n    private _maxVertexUniforms: number;\n\n    /**\n     * 支持最大shader之间传递的变量数\n     */\n    get maxVaryings()\n    {\n        if (this._maxVaryings) return this._maxVaryings;\n        this._maxVaryings = this._gl.getParameter(this._gl.MAX_VARYING_VECTORS);\n\n        return this._maxVaryings;\n    }\n\n    private _maxVaryings: number;\n\n    /**\n     * 片段着色器支持最大 Uniform 数量\n     */\n    get maxFragmentUniforms()\n    {\n        if (this._maxFragmentUniforms) return this._maxFragmentUniforms;\n        this._maxFragmentUniforms = this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS);\n\n        return this._maxFragmentUniforms;\n    }\n\n    private _maxFragmentUniforms: number;\n\n    /**\n     * 是否支持顶点纹理\n     */\n    get vertexTextures()\n    {\n        if (this._vertexTextures) return this._vertexTextures;\n        this._vertexTextures = this.maxVertexTextures > 0;\n\n        return this._vertexTextures;\n    }\n\n    private _vertexTextures: boolean;\n\n    /**\n     * 是否支持浮点类型片段着色器纹理\n     */\n    get floatFragmentTextures()\n    {\n        if (this._floatFragmentTextures) return this._floatFragmentTextures;\n        this._floatFragmentTextures = this._gl instanceof WebGL2RenderingContext || !!this._gl.getExtension('OES_texture_float');\n\n        return this._floatFragmentTextures;\n    }\n\n    private _floatFragmentTextures: boolean;\n\n    /**\n     * 是否支持浮点类型顶点着色器纹理\n     */\n    get floatVertexTextures()\n    {\n        if (this._floatVertexTextures) return this._floatVertexTextures;\n        this._floatVertexTextures = this.vertexTextures && this.floatFragmentTextures;\n\n        return this._floatVertexTextures;\n    }\n\n    private _floatVertexTextures: boolean;\n\n    /**\n     * Shader中支持浮点类型的最高精度\n     */\n    get maxPrecision()\n    {\n        if (this._maxPrecision) return this._maxPrecision;\n        this._maxPrecision = _getMaxPrecision(this._gl, this._precision);\n\n        return this._maxPrecision;\n    }\n\n    private _maxPrecision: 'highp' | 'mediump' | 'lowp';\n\n    /**\n     *\n     */\n    get maxSamples()\n    {\n        if (this._maxSamples) return this._maxSamples;\n        this._maxSamples = this._gl instanceof WebGL2RenderingContext ? this._gl.getParameter(this._gl.MAX_SAMPLES) : 0;\n\n        return this._maxSamples;\n    }\n\n    private _maxSamples: number;\n\n    /**\n     * 支持模板的位数\n     */\n    get stencilBits()\n    {\n        if (this._stencilBits) return this._stencilBits;\n        this._stencilBits = this._gl.getParameter(this._gl.STENCIL_BITS);\n\n        return this._stencilBits;\n    }\n\n    private _stencilBits: number;\n\n    /**\n     * 是否支持VAO。\n     */\n    get vaoAvailable()\n    {\n        if (this._vaoAvailable) return this._vaoAvailable;\n        this._vaoAvailable = this._gl instanceof WebGL2RenderingContext || !!this._gl.getExtension('OES_vertex_array_object');\n\n        return this._vaoAvailable;\n    }\n\n    private _vaoAvailable: boolean;\n\n    constructor(private _gl: WebGLRenderingContext | WebGL2RenderingContext, private _precision: 'highp' | 'mediump' | 'lowp' = 'highp')\n    {\n    }\n}\n\nfunction _getMaxPrecision(gl: WebGLRenderingContext | WebGL2RenderingContext, precision: 'highp' | 'mediump' | 'lowp' = 'highp')\n{\n    if (precision === 'highp')\n    {\n        if (gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.HIGH_FLOAT).precision > 0\n            && gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT).precision > 0)\n        {\n            return 'highp';\n        }\n        precision = 'mediump';\n    }\n    if (precision === 'mediump')\n    {\n        if (gl.getShaderPrecisionFormat(gl.VERTEX_SHADER, gl.MEDIUM_FLOAT).precision > 0\n            && gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT).precision > 0)\n        {\n            return 'mediump';\n        }\n    }\n\n    return 'lowp';\n}","import { Buffer, CanvasContext, ChainMap, IndicesDataTypes, RenderPassDescriptor, RenderPipeline, Sampler, Texture, VertexAttributes } from '@feng3d/render-api';\nimport { defaultWebGLContextAttributes } from '../data/polyfills/CanvasContext';\nimport { Renderbuffer } from '../data/Renderbuffer';\nimport { TransformFeedback } from '@feng3d/render-api';\nimport { Capabilities } from './Capabilities';\n\ndeclare global\n{\n    interface WebGLRenderingContext\n    {\n        _capabilities: Capabilities;\n        //\n        _bufferMap: WeakMap<Buffer, WebGLBuffer>\n        _textures: WeakMap<Texture, WebGLTexture>\n        _renderbuffers: WeakMap<Renderbuffer, WebGLRenderbuffer>;\n        _framebuffers: WeakMap<RenderPassDescriptor, WebGLFramebuffer>;\n        _vertexArrays: ChainMap<[RenderPipeline, VertexAttributes, IndicesDataTypes], WebGLVertexArrayObject>;\n        _samplers: WeakMap<Sampler, WebGLSampler>;\n        _transforms: WeakMap<TransformFeedback, WebGLTransformFeedback>;\n        _programs: { [key: string]: WebGLProgram }\n        _shaders: { [key: string]: WebGLShader }\n    }\n}\n\n/**\n * 获取WebGL上下文。\n *\n * @param canvasContext\n * @returns\n */\nexport function getGLCanvasContext(canvasContext: CanvasContext)\n{\n    let gl: WebGLRenderingContext = canvasContext['_gl'];\n\n    if (gl) return gl;\n\n    const canvas = typeof canvasContext.canvasId === 'string' ? document.getElementById(canvasContext.canvasId) as HTMLCanvasElement : canvasContext.canvasId;\n\n    gl = canvasContext['_gl'] = getWebGLContext(canvas, canvasContext);\n\n    canvasContext.webGLContextAttributes;\n    //\n    gl._capabilities = new Capabilities(gl);\n\n    gl._bufferMap = new WeakMap();\n    gl._textures = new WeakMap();\n    gl._renderbuffers = new WeakMap();\n    gl._framebuffers = new WeakMap();\n    gl._vertexArrays = new ChainMap();\n    gl._samplers = new WeakMap();\n    gl._transforms = new WeakMap();\n    gl._programs = {};\n    gl._shaders = {};\n\n    //\n    canvas.addEventListener('webglcontextlost', _onContextLost, false);\n    canvas.addEventListener('webglcontextrestored', _onContextRestore, false);\n    canvas.addEventListener('webglcontextcreationerror', _onContextCreationError, false);\n\n    return gl;\n}\n\nfunction _onContextLost(event: Event)\n{\n    event.preventDefault();\n\n    console.warn('WebGLRenderer: Context Lost.');\n}\n\nfunction _onContextRestore()\n{\n    console.warn('WebGLRenderer: Context Restored.');\n}\n\nfunction _onContextCreationError(event: WebGLContextEvent)\n{\n    console.error('WebGLRenderer: A WebGL context could not be created. Reason: ', event.statusMessage);\n}\n\nfunction getWebGLContext(canvas: HTMLCanvasElement | OffscreenCanvas, canvasContext: CanvasContext): WebGLRenderingContext\n{\n    const contextAttributes = Object.assign({}, defaultWebGLContextAttributes, canvasContext.webGLContextAttributes);\n\n    // 使用用户提供参数获取WebGL上下文\n    let gl = canvas.getContext(canvasContext.webGLcontextId || 'webgl2', contextAttributes);\n\n    gl || console.warn(`无法使用用户提供参数获取指定WebGL上下文`, contextAttributes);\n\n    gl = canvas.getContext('webgl2', contextAttributes)\n        || canvas.getContext('webgl2')\n        || canvas.getContext('webgl', contextAttributes)\n        || canvas.getContext('webgl');\n\n    gl || console.error(`无法获取WebGL上下文。`);\n\n    return gl as any;\n}\n","import { Renderbuffer } from '../data/Renderbuffer';\n\nexport function getGLRenderbuffer(gl: WebGLRenderingContext, renderbuffer: Renderbuffer, sampleCount?: 4)\n{\n    let webGLRenderbuffer = gl._renderbuffers.get(renderbuffer);\n\n    if (webGLRenderbuffer) return webGLRenderbuffer;\n\n    webGLRenderbuffer = gl.createRenderbuffer();\n    gl._renderbuffers.set(renderbuffer, webGLRenderbuffer);\n\n    const { internalformat, width, height } = renderbuffer;\n\n    gl.bindRenderbuffer(gl.RENDERBUFFER, webGLRenderbuffer);\n    if (sampleCount === 4 && gl instanceof WebGL2RenderingContext)\n    {\n        gl.renderbufferStorageMultisample(gl.RENDERBUFFER, sampleCount, gl[internalformat], width, height);\n    }\n    else\n    {\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl[internalformat], width, height);\n    }\n\n    return webGLRenderbuffer;\n}\n\nexport function deleteRenderbuffer(gl: WebGLRenderingContext, renderbuffer: Renderbuffer)\n{\n    const webGLRenderbuffer = gl._renderbuffers.get(renderbuffer);\n\n    gl._renderbuffers.delete(renderbuffer);\n    //\n    gl.deleteRenderbuffer(webGLRenderbuffer);\n}","import { TextureFormat } from '@feng3d/render-api';\n\nexport function getGLTextureFormats(format: TextureFormat = 'rgba8unorm')\n{\n    const glTextureFormat: GLTextureFormats = formatMap[format];\n\n    console.assert(!!glTextureFormat, `未处理格式 ${format}；或者WebGL不支持纹理， 该格式只在WebGPU中支持！`);\n\n    return glTextureFormat;\n}\n\nexport interface GLTextureFormats\n{\n    /**\n     * 内部纹理格式。\n     *\n     * 默认 \"RGBA\"。\n     */\n    readonly internalformat?: GLTextureInternalFormat,\n\n    /**\n     * 纹理格式。\n     *\n     * 默认 \"RGBA\"。\n     */\n    readonly format?: GLTextureFormat;\n\n    /**\n     * 数据类型。\n     *\n     * 默认 \"UNSIGNED_BYTE\"。\n     */\n    readonly type?: GLTextureDataType;\n}\n\nconst formatMap: { [key: string]: GLTextureFormats } = {\n    r8unorm: { internalformat: 'R8', format: 'RED', type: 'UNSIGNED_BYTE' },\n    r8snorm: undefined,\n    r8uint: { internalformat: 'R8', format: 'RED', type: 'UNSIGNED_BYTE' },\n    r8sint: undefined,\n    r16uint: undefined,\n    r16sint: undefined,\n    r16float: { internalformat: 'R16F', format: 'RED', type: 'HALF_FLOAT' },\n    rg8unorm: { internalformat: 'RG8', format: 'RG', type: 'UNSIGNED_BYTE' },\n    rg8snorm: undefined,\n    rg8uint: { internalformat: 'RG8UI', format: 'RG_INTEGER', type: 'UNSIGNED_BYTE' },\n    rg8sint: undefined,\n    r32uint: undefined,\n    r32sint: undefined,\n    r32float: { internalformat: 'R32F', format: 'RED', type: 'FLOAT' },\n    rg16uint: undefined,\n    rg16sint: undefined,\n    rg16float: { internalformat: 'RG16F', format: 'RG', type: 'HALF_FLOAT' },\n    rgba8unorm: { internalformat: 'RGBA8', format: 'RGBA', type: 'UNSIGNED_BYTE' },\n    'rgba8unorm-srgb': { internalformat: 'SRGB8_ALPHA8', format: 'RGBA', type: 'UNSIGNED_BYTE' },\n    rgba8snorm: undefined,\n    rgba8uint: { internalformat: 'RGBA8UI', format: 'RGBA_INTEGER', type: 'UNSIGNED_BYTE' },\n    rgba8sint: undefined,\n    bgra8unorm: { internalformat: 'RGBA8', format: 'RGBA', type: 'UNSIGNED_BYTE' }, // WebGL不支持bgra8unorm，但WebGPU支持。navigator.gpu.getPreferredCanvasFormat() 返回的是 bgra8unorm, 暂时使用RGBA8代替，解决一部分问题。（参考 示例 https://github.com/feng3d-labs/tsl/tree/master/examples/src/fractalCube/index.ts）\n    'bgra8unorm-srgb': undefined,\n    rgb9e5ufloat: { internalformat: 'RGB9_E5', format: 'RGB', type: 'HALF_FLOAT' },\n    rgb10a2uint: undefined,\n    rgb10a2unorm: { internalformat: 'RGB10_A2', format: 'RGBA', type: 'UNSIGNED_INT_2_10_10_10_REV' },\n    rg11b10ufloat: { internalformat: 'R11F_G11F_B10F', format: 'RGB', type: 'UNSIGNED_INT_10F_11F_11F_REV' },\n    rg32uint: undefined,\n    rg32sint: undefined,\n    rg32float: { internalformat: 'RG32F', format: 'RG', type: 'FLOAT' },\n    rgba16uint: undefined,\n    rgba16sint: undefined,\n    rgba16float: { internalformat: 'RGBA16F', format: 'RGBA', type: 'HALF_FLOAT' },\n    rgba32uint: undefined,\n    rgba32sint: undefined,\n    rgba32float: { internalformat: 'RGBA32F', format: 'RGBA', type: 'FLOAT' },\n    stencil8: undefined,\n    depth16unorm: { internalformat: 'DEPTH_COMPONENT16', format: 'DEPTH_COMPONENT', type: 'UNSIGNED_SHORT' },\n    depth24plus: undefined,\n    'depth24plus-stencil8': undefined,\n    depth32float: undefined,\n    'depth32float-stencil8': undefined,\n    'bc1-rgba-unorm': undefined,\n    'bc1-rgba-unorm-srgb': undefined,\n    'bc2-rgba-unorm': undefined,\n    'bc2-rgba-unorm-srgb': undefined,\n    'bc3-rgba-unorm': undefined,\n    'bc3-rgba-unorm-srgb': undefined,\n    'bc4-r-unorm': undefined,\n    'bc4-r-snorm': undefined,\n    'bc5-rg-unorm': undefined,\n    'bc5-rg-snorm': undefined,\n    'bc6h-rgb-ufloat': undefined,\n    'bc6h-rgb-float': undefined,\n    'bc7-rgba-unorm': undefined,\n    'bc7-rgba-unorm-srgb': undefined,\n    'etc2-rgb8unorm': undefined,\n    'etc2-rgb8unorm-srgb': undefined,\n    'etc2-rgb8a1unorm': undefined,\n    'etc2-rgb8a1unorm-srgb': undefined,\n    'etc2-rgba8unorm': undefined,\n    'etc2-rgba8unorm-srgb': undefined,\n    'eac-r11unorm': undefined,\n    'eac-r11snorm': undefined,\n    'eac-rg11unorm': undefined,\n    'eac-rg11snorm': undefined,\n    'astc-4x4-unorm': undefined,\n    'astc-4x4-unorm-srgb': undefined,\n    'astc-5x4-unorm': undefined,\n    'astc-5x4-unorm-srgb': undefined,\n    'astc-5x5-unorm': undefined,\n    'astc-5x5-unorm-srgb': undefined,\n    'astc-6x5-unorm': undefined,\n    'astc-6x5-unorm-srgb': undefined,\n    'astc-6x6-unorm': undefined,\n    'astc-6x6-unorm-srgb': undefined,\n    'astc-8x5-unorm': undefined,\n    'astc-8x5-unorm-srgb': undefined,\n    'astc-8x6-unorm': undefined,\n    'astc-8x6-unorm-srgb': undefined,\n    'astc-8x8-unorm': undefined,\n    'astc-8x8-unorm-srgb': undefined,\n    'astc-10x5-unorm': undefined,\n    'astc-10x5-unorm-srgb': undefined,\n    'astc-10x6-unorm': undefined,\n    'astc-10x6-unorm-srgb': undefined,\n    'astc-10x8-unorm': undefined,\n    'astc-10x8-unorm-srgb': undefined,\n    'astc-10x10-unorm': undefined,\n    'astc-10x10-unorm-srgb': undefined,\n    'astc-12x10-unorm': undefined,\n    'astc-12x10-unorm-srgb': undefined,\n    'astc-12x12-unorm': undefined,\n    'astc-12x12-unorm-srgb': undefined,\n};\n\n/**\n * internalformat\tformat\ttype\n *\n * @see https://registry.khronos.org/webgl/specs/latest/2.0/#TEXTURE_TYPES_FORMATS_FROM_DOM_ELEMENTS_TABLE\n */\ntype GLTextureTypes =\n    | { internalformat: 'RGB', format: 'RGB', type: 'UNSIGNED_BYTE' | 'UNSIGNED_SHORT_5_6_5' }\n    | { internalformat: 'RGBA', format: 'RGBA', type: 'UNSIGNED_BYTE' | 'UNSIGNED_SHORT_4_4_4_4' | 'UNSIGNED_SHORT_5_5_5_1' }\n    | { internalformat: 'LUMINANCE_ALPHA', format: 'LUMINANCE_ALPHA', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'LUMINANCE', format: 'LUMINANCE', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'ALPHA', format: 'ALPHA', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'R8', format: 'RED', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'R16F', format: 'RED', type: 'HALF_FLOAT' | ' FLOAT' }\n    | { internalformat: 'R32F', format: 'RED', type: 'FLOAT' }\n    | { internalformat: 'R8UI', format: 'RED_INTEGER', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'RG8', format: 'RG', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'RG16F', format: 'RG', type: 'HALF_FLOAT' | 'FLOAT' }\n    | { internalformat: 'RG32F', format: 'RG', type: 'FLOAT' }\n    | { internalformat: 'RG8UI', format: 'RG_INTEGER', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'RGB8', format: 'RGB', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'SRGB8', format: 'RGB', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'RGB565', format: 'RGB', type: 'UNSIGNED_BYTE' | 'UNSIGNED_SHORT_5_6_5' }\n    | { internalformat: 'R11F_G11F_B10F', format: 'RGB', type: 'UNSIGNED_INT_10F_11F_11F_REV' | 'HALF_FLOAT' | 'FLOAT' }\n    | { internalformat: 'RGB9_E5', format: 'RGB', type: 'HALF_FLOAT' | 'FLOAT' }\n    | { internalformat: 'RGB16F', format: 'RGB', type: 'HALF_FLOAT' | 'FLOAT' }\n    | { internalformat: 'RGB32F', format: 'RGB', type: 'FLOAT' }\n    | { internalformat: 'RGB8UI', format: 'RGB_INTEGER', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'RGBA8', format: 'RGBA', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'SRGB8_ALPHA8', format: 'RGBA', type: 'UNSIGNED_BYTE' }\n    | { internalformat: 'RGB5_A1', format: 'RGBA', type: 'UNSIGNED_BYTE' | 'UNSIGNED_SHORT_5_5_5_1' }\n    | { internalformat: 'RGB10_A2', format: 'RGBA', type: 'UNSIGNED_INT_2_10_10_10_REV' }\n    | { internalformat: 'RGBA4', format: 'RGBA', type: 'UNSIGNED_BYTE' | 'UNSIGNED_SHORT_4_4_4_4' }\n    | { internalformat: 'RGBA16F', format: 'RGBA', type: 'HALF_FLOAT' | 'FLOAT' }\n    | { internalformat: 'RGBA32F', format: 'RGBA', type: 'FLOAT' }\n    | { internalformat: 'RGBA8UI', format: 'RGBA_INTEGER', type: 'UNSIGNED_BYTE' }\n    // 深度纹理\n    | { internalformat: 'DEPTH_COMPONENT16', format: 'DEPTH_COMPONENT', type: 'UNSIGNED_SHORT', }\n    ;\n\nexport type GLTextureInternalFormat = GLTextureTypes['internalformat'];\nexport type GLTextureFormat = GLTextureTypes['format'];\nexport type GLTextureDataType = GLTextureTypes['type'];\n","import { RenderPassColorAttachment, RenderPassDescriptor, Texture, TextureFormat, TextureView } from '@feng3d/render-api';\nimport { BlitFramebuffer } from '../data/BlitFramebuffer';\nimport { RenderbufferInternalformat, Renderbuffer } from '../data/Renderbuffer';\nimport { getGLTextureFormats } from './getGLTextureFormats';\n\n/**\n *\n * 当需要渲染到纹理并且开启多重采样时，就必须使用支持多重采样的渲染缓冲区来进行接受中间结果再拷贝到模板纹理上。\n *\n * 当`passDescriptor.multisample`值存在时，引擎将会自动创建支持`multisample`的`IGLRenderbuffer`用于接收颜色附件的结果。在渲染通道执行结束后在由`IGLRenderbuffer`拷贝到对应纹理上。\n *\n * @param sourcePassDescriptor 需要渲染到纹理并且开启多重采样的渲染通道描述。\n */\nexport function getGLRenderPassDescriptorWithMultisample(sourcePassDescriptor: RenderPassDescriptor): GLRenderPassDescriptorWithMultisample\n{\n    if (sourcePassDescriptor[_IGLRenderPassDescriptorWithMultisample]) return sourcePassDescriptor[_IGLRenderPassDescriptorWithMultisample];\n\n    const texture = (sourcePassDescriptor.colorAttachments[0].view as TextureView).texture;\n\n    const textureSize = (texture as Texture).descriptor.size;\n\n    const renderbuffers: Renderbuffer[] = [];\n\n    // 创建支持 多重采样的 渲染通道\n    const passDescriptor: RenderPassDescriptor = {\n        colorAttachments: sourcePassDescriptor.colorAttachments.map((v) =>\n        {\n            const texture = v.view.texture;\n\n            const renderbuffer: Renderbuffer = {\n                internalformat: getGLRenderbufferInternalformat((texture as Texture).descriptor.format),\n                width: textureSize[0],\n                height: textureSize[1],\n            };\n\n            renderbuffers.push(renderbuffer);\n\n            const colorAttachment: RenderPassColorAttachment = {\n                ...v,\n                view: renderbuffer as any,\n            };\n\n            return colorAttachment;\n        }),\n        depthStencilAttachment: sourcePassDescriptor.depthStencilAttachment,\n        sampleCount: sourcePassDescriptor.sampleCount,\n    };\n\n    // 拷贝 渲染缓冲区到 IGLTexture\n    const blitFramebuffer: BlitFramebuffer = {\n        __type__: 'BlitFramebuffer',\n        read: passDescriptor,\n        draw: sourcePassDescriptor,\n        blitFramebuffers: [[0, 0, textureSize[0], textureSize[1],\n            0, 0, textureSize[0], textureSize[1],\n            'COLOR_BUFFER_BIT', 'NEAREST']],\n    };\n\n    sourcePassDescriptor[_IGLRenderPassDescriptorWithMultisample] = { passDescriptor, blitFramebuffer, renderbuffers } as GLRenderPassDescriptorWithMultisample;\n\n    return sourcePassDescriptor[_IGLRenderPassDescriptorWithMultisample];\n}\n\nfunction getGLRenderbufferInternalformat(format?: TextureFormat)\n{\n    const { internalformat } = getGLTextureFormats(format);\n\n    return internalformat as RenderbufferInternalformat;\n}\n\nexport const _IGLRenderPassDescriptorWithMultisample = '_IGLRenderPassDescriptorWithMultisample';\n\n/**\n * 由`passDescriptor.multisample`值存在的IGLRenderPassDescriptor生成。\n */\nexport interface GLRenderPassDescriptorWithMultisample\n{\n    /**\n     * 渲染到渲染缓冲区上。\n     */\n    passDescriptor: RenderPassDescriptor;\n    /**\n     * 拷贝渲染缓冲区到目标纹理中。\n     */\n    blitFramebuffer: BlitFramebuffer;\n    /**\n     * 需要销毁的临时渲染缓冲区。\n     */\n    renderbuffers: Renderbuffer[];\n}","class Watcher {\n  constructor() {\n    this._binds = [];\n  }\n  /**\n   * 创建一个 WatchSession 对象，用于监听对象属性的变化。\n   * WatchSession 提供了多种监听方法，并且可以通过 `off` 方法一次性取消所有监听。\n   *\n   * @returns {WatchSession} 返回一个包含监听方法和取消监听方法的 WatchSession 对象。\n   */\n  on() {\n    const offFuncs = [];\n    const watchInfo = {\n      watch: (object, property, handler, thisObject, onlyChanged = true, topObject, fullProperty) => {\n        this.watch(object, property, handler, thisObject, onlyChanged, topObject, fullProperty);\n        offFuncs.push(() => this.unwatch(object, property, handler, thisObject));\n        return watchInfo;\n      },\n      watchs: (object, propertys, handler, thisObject, onlyChanged) => {\n        this.watchs(object, propertys, handler, thisObject, onlyChanged);\n        offFuncs.push(() => this.unwatchs(object, propertys, handler, thisObject));\n        return watchInfo;\n      },\n      bind: (object0, property0, object1, property1) => {\n        this.bind(object0, property0, object1, property1);\n        offFuncs.push(() => this.unbind(object0, property0, object1, property1));\n        return watchInfo;\n      },\n      watchchain: (object, property, handler, thisObject, onlyChanged = true, topObject, fullProperty) => {\n        this.watchchain(object, property, handler, thisObject, onlyChanged, topObject, fullProperty);\n        offFuncs.push(() => this.unwatchchain(object, property, handler, thisObject));\n        return watchInfo;\n      },\n      watchobject: (object, property, handler, thisObject, onlyChanged = true) => {\n        this.watchobject(object, property, handler, thisObject, onlyChanged);\n        offFuncs.push(() => this.unwatchobject(object, property, handler, thisObject));\n        return watchInfo;\n      },\n      off: () => {\n        offFuncs.forEach((func) => func());\n        offFuncs.length = 0;\n      }\n    };\n    return watchInfo;\n  }\n  /**\n   * 监听对象属性的变化\n   *\n   * 注意：使用watch后获取该属性值的性能将会是原来的1/60，避免在运算密集处使用该函数。\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性\n   * @param handler 变化回调函数 (newValue: V, oldValue: V, object: T, property: string) => void\n   * @param thisObject 变化回调函数 this值\n   * @param onlyChanged 值为 true 时表示只在变化时才触发回调函数，否则只要被赋值就触发回调函数。默认为 true 。\n   */\n  watch(object, property, handler, thisObject, onlyChanged = true, topObject, fullProperty) {\n    topObject = topObject || object;\n    fullProperty = fullProperty || property;\n    if (!Object.getOwnPropertyDescriptor(object, __watchs__)) {\n      Object.defineProperty(object, __watchs__, {\n        value: {},\n        enumerable: false,\n        configurable: true,\n        writable: false\n      });\n    }\n    const _property = property;\n    const watchs = object[__watchs__];\n    if (!watchs[_property]) {\n      const oldPropertyDescriptor = Object.getOwnPropertyDescriptor(object, _property);\n      watchs[_property] = { value: object[_property], oldPropertyDescriptor, handlers: [] };\n      let data = getPropertyDescriptor(object, _property);\n      if (data && data.set && data.get) {\n        data = { enumerable: data.enumerable, configurable: true, get: data.get, set: data.set };\n        const orgSet = data.set;\n        data.set = function(value) {\n          const oldValue = this[_property];\n          orgSet && orgSet.call(this, value);\n          notifyListener(value, oldValue, this, _property, topObject, fullProperty);\n        };\n      } else if (!data || !data.get && !data.set) {\n        data = { enumerable: true, configurable: true };\n        data.get = function() {\n          return this[__watchs__][_property].value;\n        };\n        data.set = function(value) {\n          const oldValue = this[__watchs__][_property].value;\n          this[__watchs__][_property].value = value;\n          notifyListener(value, oldValue, this, _property, topObject, fullProperty);\n        };\n      } else {\n        console.warn(`无法修改监听属性的描述，监听失败！`, object, _property, handler, thisObject);\n        return;\n      }\n      Object.defineProperty(object, _property, data);\n    }\n    const propertywatchs = watchs[_property];\n    const has = propertywatchs.handlers.reduce((v, item) => v || item.handler === handler && item.thisObject === thisObject, false);\n    if (!has) {\n      propertywatchs.handlers.push({ handler, thisObject, onlyChanged });\n    } else {\n      console.warn(`重复监听， 监听失败！`, object, _property, handler, thisObject);\n    }\n  }\n  /**\n   * 取消监听对象属性的变化\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性\n   * @param handler 变化回调函数 (newValue: V, oldValue: V, object: T, property: string) => void\n   * @param thisObject 变化回调函数 this值\n   */\n  unwatch(object, property, handler, thisObject) {\n    const watchs = object[__watchs__];\n    if (!watchs)\n      return;\n    const _property = property;\n    if (watchs[_property]) {\n      const handlers = watchs[_property].handlers;\n      if (handler === void 0) {\n        handlers.length = 0;\n      }\n      for (let i = handlers.length - 1; i >= 0; i--) {\n        if (handlers[i].handler === handler && (handlers[i].thisObject === thisObject || thisObject === void 0)) {\n          handlers.splice(i, 1);\n        }\n      }\n      if (handlers.length === 0) {\n        const value = object[_property];\n        delete object[_property];\n        if (watchs[_property].oldPropertyDescriptor) {\n          Object.defineProperty(object, _property, watchs[_property].oldPropertyDescriptor);\n        }\n        object[_property] = value;\n        delete watchs[_property];\n      }\n      if (Object.keys(watchs).length === 0) {\n        delete object[__watchs__];\n      }\n    }\n  }\n  /**\n   * 监听对象属性的变化\n   *\n   * 注意：使用watch后获取该属性值的性能将会是原来的1/60，避免在运算密集处使用该函数。\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性\n   * @param handler 变化回调函数 (newValue: V, oldValue: V, object: T, property: string) => void\n   * @param thisObject 变化回调函数 this值\n   * @param onlyChanged 值为 true 时表示只在变化时才触发回调函数，否则只要被赋值就触发回调函数。默认为 true 。\n   */\n  watchs(object, propertys, handler, thisObject, onlyChanged = true) {\n    propertys.forEach((v) => {\n      this.watch(object, v, handler, thisObject, onlyChanged);\n    });\n  }\n  /**\n   * 取消监听对象属性的变化\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性\n   * @param handler 变化回调函数 (newValue: V, oldValue: V, object: T, property: string) => void\n   * @param thisObject 变化回调函数 this值\n   */\n  unwatchs(object, propertys, handler, thisObject) {\n    propertys.forEach((v) => {\n      this.unwatch(object, v, handler, thisObject);\n    });\n  }\n  /**\n   * 绑定两个对象的指定属性，保存两个属性值同步。\n   *\n   * @param object0 第一个对象。\n   * @param property0 第一个对象的属性名称。\n   * @param object1 第二个对象。\n   * @param property1 第二个对象的属性名称。\n   */\n  bind(object0, property0, object1, property1) {\n    const fun0 = () => {\n      object1[property1] = object0[property0];\n    };\n    const fun1 = () => {\n      object0[property0] = object1[property1];\n    };\n    this.watch(object0, property0, fun0);\n    this.watch(object1, property1, fun1);\n    this._binds.push([object0, property0, fun0, object1, property1, fun1]);\n  }\n  /**\n   * 解除两个对象的指定属性的绑定。\n   *\n   * @param object0 第一个对象。\n   * @param property0 第一个对象的属性名称。\n   * @param object1 第二个对象。\n   * @param property1 第二个对象的属性名称。\n   */\n  unbind(object0, property0, object1, property1) {\n    const binds = this._binds;\n    for (let i = binds.length - 1; i >= 0; i--) {\n      const v = binds[i];\n      if (v[1] === property0 && v[4] === property1 || v[1] === property1 && v[4] === property0) {\n        if (v[0] === object0 && v[3] === object1 || v[0] === object1 && v[3] === object0) {\n          this.unwatch(v[0], v[1], v[2]);\n          this.unwatch(v[3], v[4], v[5]);\n          binds.splice(i, 1);\n          break;\n        }\n      }\n    }\n  }\n  /**\n   * 监听对象属性链值变化\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性 例如：\"a.b\"\n   * @param handler 变化回调函数 (newValue: any, oldValue: any, object: any, property: string) => void\n   * @param thisObject 变化回调函数 this值\n   * @param onlyChanged 值为 true 时表示只在变化时才触发回调函数，否则只要被赋值就触发回调函数。默认为 true 。\n   */\n  watchchain(object, property, handler, thisObject, onlyChanged = true, topObject, fullProperty) {\n    topObject = topObject || object;\n    fullProperty = fullProperty || property;\n    const notIndex = property.indexOf(\".\");\n    if (notIndex === -1) {\n      this.watch(object, property, handler, thisObject, onlyChanged, topObject, fullProperty);\n      return;\n    }\n    if (!Object.getOwnPropertyDescriptor(object, __watchchains__)) {\n      Object.defineProperty(object, __watchchains__, { value: {}, enumerable: false, writable: false, configurable: true });\n    }\n    const watchchains = object[__watchchains__];\n    if (!watchchains[property]) {\n      watchchains[property] = [];\n    }\n    const propertywatchs = watchchains[property];\n    const has = propertywatchs.reduce((v, item) => v || item.handler === handler && item.thisObject === thisObject, false);\n    if (!has) {\n      const currentp = property.substr(0, notIndex);\n      const nextp = property.substr(notIndex + 1);\n      if (object[currentp]) {\n        this.watchchain(object[currentp], nextp, handler, thisObject, onlyChanged, topObject, fullProperty);\n      }\n      const watchchainFun = (newValue, oldValue) => {\n        if (oldValue)\n          this.unwatchchain(oldValue, nextp, handler, thisObject);\n        if (newValue)\n          this.watchchain(newValue, nextp, handler, thisObject, onlyChanged, topObject, fullProperty);\n        const ov = getObjectPropertyValue(oldValue, nextp);\n        const nv = getObjectPropertyValue(newValue, nextp);\n        if (!onlyChanged || ov !== nv) {\n          handler.call(thisObject, nv, ov, topObject, fullProperty);\n        }\n      };\n      this.watch(object, currentp, watchchainFun, void 0, onlyChanged);\n      propertywatchs.push({ handler, thisObject, watchchainFun });\n    }\n  }\n  /**\n   * 取消监听对象属性链值变化\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性 例如：\"a.b\"\n   * @param handler 变化回调函数 (object: T, property: string, oldValue: V) => void\n   * @param thisObject 变化回调函数 this值\n   */\n  unwatchchain(object, property, handler, thisObject) {\n    const notIndex = property.indexOf(\".\");\n    if (notIndex === -1) {\n      this.unwatch(object, property, handler, thisObject);\n      return;\n    }\n    const currentp = property.substr(0, notIndex);\n    const nextp = property.substr(notIndex + 1);\n    const watchchains = object[__watchchains__];\n    if (!watchchains || !watchchains[property])\n      return;\n    const propertywatchs = watchchains[property];\n    for (let i = propertywatchs.length - 1; i >= 0; i--) {\n      const element = propertywatchs[i];\n      if (objectIsEmpty(handler) || handler === element.handler && thisObject === element.thisObject) {\n        if (object[currentp]) {\n          this.unwatchchain(object[currentp], nextp, element.handler, element.thisObject);\n        }\n        this.unwatch(object, currentp, element.watchchainFun);\n        propertywatchs.splice(i, 1);\n      }\n    }\n    if (propertywatchs.length === 0)\n      delete watchchains[property];\n    if (Object.keys(watchchains).length === 0) {\n      delete object[__watchchains__];\n    }\n  }\n  /**\n   * 监听对象属性链值变化\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性 例如：{a:{b:null,d:null}} 表示监听 object.a.b 与 object.a.d 值得变化，如果property===object时表示监听对象中所有叶子属性变化。\n   * @param handler 变化回调函数 (newValue: any, oldValue: any, host: any, property: string) => void\n   * @param thisObject 变化回调函数 this值\n   * @param onlyChanged 值为 true 时表示只在变化时才触发回调函数，否则只要被赋值就触发回调函数。默认为 true 。\n   */\n  watchobject(object, property, handler, thisObject, onlyChanged = true) {\n    const chains = getObjectPropertyChains(property);\n    chains.forEach((v) => {\n      this.watchchain(object, v, handler, thisObject, onlyChanged);\n    });\n  }\n  /**\n   * 取消监听对象属性链值变化\n   *\n   * @param object 被监听对象\n   * @param property 被监听属性 例如：{a:{b:null,d:null}} 表示监听 object.a.b 与 object.a.d 值得变化，如果property===object时表示监听对象中所有叶子属性变化。\n   * @param handler 变化回调函数 newValue: any, oldValue: any, host: any, property: string => void\n   * @param thisObject 变化回调函数 this值\n   */\n  unwatchobject(object, property, handler, thisObject) {\n    const chains = getObjectPropertyChains(property);\n    chains.forEach((v) => {\n      this.unwatchchain(object, v, handler, thisObject);\n    });\n  }\n}\nconst watcher = new Watcher();\nconst __watchs__ = \"__watchs__\";\nconst __watchchains__ = \"__watchchains__\";\nfunction notifyListener(newValue, oldValue, host, property, topObject, fullProperty) {\n  topObject = topObject || host;\n  fullProperty = fullProperty || property;\n  const watchs = host[__watchs__];\n  const handlers = watchs[property].handlers.concat();\n  handlers.forEach((element) => {\n    if (!element.onlyChanged || newValue !== oldValue) {\n      element.handler.call(element.thisObject, newValue, oldValue, topObject, fullProperty);\n    }\n  });\n}\nfunction getPropertyDescriptor(object, property) {\n  const data = Object.getOwnPropertyDescriptor(object, property);\n  if (data) {\n    return data;\n  }\n  const prototype = Object.getPrototypeOf(object);\n  if (prototype) {\n    return getPropertyDescriptor(prototype, property);\n  }\n  return void 0;\n}\nfunction objectIsEmpty(obj) {\n  if (obj === void 0 || obj === null) {\n    return true;\n  }\n  return false;\n}\nfunction getObjectPropertyValue(object, property) {\n  if (typeof property === \"string\")\n    property = property.split(\".\");\n  let value = object;\n  for (let i = 0; i < property.length; i++) {\n    if (objectIsEmpty(value))\n      return void 0;\n    value = value[property[i]];\n  }\n  return value;\n}\nfunction getObjectPropertyChains(object) {\n  const result = [];\n  const propertys = Object.keys(object);\n  const hosts = new Array(propertys.length).fill(object);\n  const parentPropertyIndices = new Array(propertys.length).fill(-1);\n  let index = 0;\n  while (index < propertys.length) {\n    const host = hosts[index];\n    const cp = propertys[index];\n    const cv = host[cp];\n    let vks;\n    if (objectIsEmpty(cv) || isBaseType(cv) || (vks = Object.keys(cv)).length === 0) {\n      const ps = [cp];\n      let ci = index;\n      while ((ci = parentPropertyIndices[ci]) !== -1) {\n        ps.push(propertys[ci]);\n      }\n      ps.reverse();\n      result.push(ps.join(\".\"));\n    } else {\n      vks.forEach((k) => {\n        propertys.push(k);\n        hosts.push(cv);\n        parentPropertyIndices.push(index);\n      });\n    }\n    index++;\n  }\n  return result;\n}\nfunction isBaseType(object) {\n  if (object === void 0 || object === null || typeof object === \"boolean\" || typeof object === \"string\" || typeof object === \"number\") {\n    return true;\n  }\n  return false;\n}\nexport {\n  Watcher,\n  watcher\n};\n//# sourceMappingURL=index.js.map\n","import { TextureDimension } from '@feng3d/render-api';\n\n/**\n * 纹理绑定点。\n *\n * * gl.TEXTURE_2D: A two-dimensional texture.\n * * gl.TEXTURE_CUBE_MAP: A cube-mapped texture.\n *\n * When using a WebGL 2 context, the following values are available additionally:\n *\n * * gl.TEXTURE_3D: A three-dimensional texture.\n * * gl.TEXTURE_2D_ARRAY: A two-dimensional array texture.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/bindTexture\n */\nexport type GLTextureTarget = 'TEXTURE_2D' | 'TEXTURE_CUBE_MAP' | 'TEXTURE_3D' | 'TEXTURE_2D_ARRAY';\n\nexport function getGLTextureTarget(dimension: TextureDimension = '2d')\n{\n    const target: GLTextureTarget = dimensionMap[dimension];\n\n    console.assert(!!target, `WebGL 不支持纹理维度 ${dimension} , 该维度只在WebGPU中支持！`);\n\n    return target;\n}\n\nconst dimensionMap: { [key: string]: GLTextureTarget } = {\n    '1d': undefined,\n    '2d': 'TEXTURE_2D',\n    '2d-array': 'TEXTURE_2D_ARRAY',\n    cube: 'TEXTURE_CUBE_MAP',\n    'cube-array': undefined,\n    '3d': 'TEXTURE_3D',\n};","import { Texture, TextureDataSource, TextureImageSource, TextureSize } from '@feng3d/render-api';\nimport { watcher } from '@feng3d/watcher';\nimport { getGLTextureFormats } from './getGLTextureFormats';\nimport { getGLTextureTarget } from './getGLTextureTarget';\n\ndeclare global\n{\n    interface WebGLTexture\n    {\n        /**\n         * 销毁WebGL纹理。\n         */\n        destroy: () => void;\n    }\n}\n\nexport const defaultTexturePixelStore: GLTexturePixelStore = {\n    packAlignment: 4,\n    unpackAlignment: 4,\n    unpackFlipY: false,\n    unpackPremulAlpha: false,\n    unpackColorSpaceConversion: 'BROWSER_DEFAULT_WEBGL',\n    packRowLength: 0,\n    packSkipPixels: 0,\n    packSkipRows: 0,\n    unpackRowLength: 0,\n    unpackImageHeight: 0,\n    unpackSkipPixels: 0,\n    unpackSkipRows: 0,\n    unpackSkipImages: 0,\n};\n\nexport function getGLTexture(gl: WebGLRenderingContext, texture: Texture)\n{\n    let webGLTexture = gl._textures.get(texture);\n\n    if (webGLTexture) return webGLTexture;\n\n    // 创建纹理\n    const createTexture = () =>\n    {\n        const descriptor = texture.descriptor;\n\n        const target = getGLTextureTarget(descriptor.dimension);\n        const { internalformat, format, type } = getGLTextureFormats(descriptor.format);\n\n        webGLTexture = gl.createTexture(); // Create a texture object\n        gl._textures.set(texture, webGLTexture);\n\n        gl.bindTexture(gl[target], webGLTexture);\n\n        //\n        const { sources } = texture;\n        const generateMipmap = descriptor.generateMipmap;\n\n        // 设置纹理尺寸\n        const [width, height, depth] = descriptor.size;\n        const mipLevelCount = descriptor.mipLevelCount || 1;\n\n        if (sources)\n        {\n            sources.forEach((v) =>\n            {\n                const { textureOrigin, size } = v;\n                //\n                const mipLevel = v.mipLevel ?? 0;\n                const width = size?.[0];\n                const height = size?.[1];\n                const depthOrArrayLayers = size?.[2];\n                const xoffset = textureOrigin?.[0];\n                const yoffset = textureOrigin?.[1];\n                const zoffset = textureOrigin?.[2];\n\n                if (gl instanceof WebGL2RenderingContext)\n                {\n                    const imageSource = v as TextureImageSource;\n\n                    if (imageSource.image)\n                    {\n                        const { image, imageOrigin, flipY, premultipliedAlpha } = imageSource;\n\n                        //\n                        const pixelStore: GLTexturePixelStore = {};\n\n                        pixelStore.unpackSkipPixels = imageOrigin?.[0] || 0;\n                        pixelStore.unpackSkipRows = imageOrigin?.[1] || 0;\n                        pixelStore.unpackFlipY = flipY || false;\n                        pixelStore.unpackPremulAlpha = premultipliedAlpha || false;\n\n                        setTexturePixelStore(gl, pixelStore);\n\n                        if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                        {\n                            const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(zoffset) : target;\n\n                            if (width && height)\n                            {\n                                gl.texImage2D(gl[bindTarget], mipLevel, gl[internalformat], width, height, 0, gl[format], gl[type], image);\n                            }\n                            else\n                            {\n                                gl.texImage2D(gl[bindTarget], mipLevel, gl[internalformat], gl[format], gl[type], image);\n                            }\n                        }\n                        else if (target === 'TEXTURE_3D' || target === 'TEXTURE_2D_ARRAY')\n                        {\n                            gl.texImage3D(gl[target], mipLevel, gl[internalformat], width, height, depth, 0, gl[format], gl[type], image);\n                        }\n                        else\n                        {\n                            console.error(`未处理 ${target} 纹理初始化存储！`);\n                        }\n                    }\n                    else\n                    {\n                        const bufferSource = v as TextureDataSource;\n                        const { data, dataLayout, dataImageOrigin } = bufferSource;\n\n                        //\n                        const offset = dataLayout?.offset || 0;\n\n                        //\n                        const pixelStore: GLTexturePixelStore = {};\n\n                        pixelStore.unpackSkipPixels = dataImageOrigin?.[0] || 0;\n                        pixelStore.unpackSkipRows = dataImageOrigin?.[1] || 0;\n                        pixelStore.unpackSkipImages = dataImageOrigin?.[2] || 0;\n                        pixelStore.unpackRowLength = dataLayout?.width;\n                        pixelStore.unpackImageHeight = dataLayout?.height;\n\n                        setTexturePixelStore(gl, pixelStore);\n\n                        if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                        {\n                            const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(zoffset) : target;\n\n                            gl.texImage2D(gl[bindTarget], mipLevel, gl[internalformat], width, height, 0, gl[format], gl[type], data, offset);\n                        }\n                        else if (target === 'TEXTURE_3D' || target === 'TEXTURE_2D_ARRAY')\n                        {\n                            gl.texImage3D(gl[target], mipLevel, gl[internalformat], width, height, depth, 0, gl[format], gl[type], data, offset);\n                        }\n                        else\n                        {\n                            console.error(`未处理 ${target} 纹理初始化存储！`);\n                        }\n                    }\n                }\n                else\n                {\n                    const imageSource = v as TextureImageSource;\n\n                    if (imageSource.image)\n                    {\n                        const { image, imageOrigin, flipY, premultipliedAlpha } = imageSource;\n\n                        //\n                        const pixelStore: GLTexturePixelStore = {};\n\n                        pixelStore.unpackSkipPixels = imageOrigin?.[0] || 0;\n                        pixelStore.unpackSkipRows = imageOrigin?.[1] || 0;\n                        pixelStore.unpackFlipY = flipY || false;\n                        pixelStore.unpackPremulAlpha = premultipliedAlpha || false;\n\n                        setTexturePixelStore(gl, pixelStore);\n\n                        if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                        {\n                            const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(zoffset) : target;\n\n                            gl.texImage2D(gl[bindTarget], mipLevel, gl[format], gl[format], gl[type], image);\n                        }\n                        else\n                        {\n                            console.error(`未处理 ${target} 纹理初始化存储！`);\n                        }\n                    }\n                    else\n                    {\n                        const bufferSource = v as TextureDataSource;\n                        const { data, dataLayout, dataImageOrigin } = bufferSource;\n\n                        //\n                        const offset = dataLayout?.offset || 0;\n\n                        //\n                        const pixelStore: GLTexturePixelStore = {};\n\n                        pixelStore.unpackSkipPixels = dataImageOrigin?.[0] || 0;\n                        pixelStore.unpackSkipRows = dataImageOrigin?.[1] || 0;\n                        pixelStore.unpackSkipImages = dataImageOrigin?.[2] || 0;\n                        pixelStore.unpackRowLength = dataLayout?.width;\n                        pixelStore.unpackImageHeight = dataLayout?.height;\n\n                        setTexturePixelStore(gl, pixelStore);\n\n                        if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                        {\n                            const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(zoffset) : target;\n\n                            console.assert(offset === 0, `WebGL1中ITextureDataLayout.offset必须为0`);\n                            gl.texImage2D(gl[bindTarget], mipLevel, gl[format], width, height, 0, gl[format], gl[type], data);\n                        }\n                        else\n                        {\n                            console.error(`未处理 ${target} 纹理初始化存储！`);\n                        }\n                    }\n                }\n            });\n\n            //\n            if (generateMipmap)\n            {\n                gl.generateMipmap(gl[target]);\n            }\n        }\n        else\n        {\n            if (gl instanceof WebGL2RenderingContext)\n            {\n                if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                {\n                    gl.texStorage2D(gl[target], mipLevelCount, gl[internalformat], width, height);\n                }\n                else if (target === 'TEXTURE_3D' || target === 'TEXTURE_2D_ARRAY')\n                {\n                    gl.texStorage3D(gl[target], mipLevelCount, gl[internalformat], width, height, depth);\n                }\n                else\n                {\n                    console.error(`未处理 ${target} 纹理初始化存储！`);\n                }\n            }\n            else\n            {\n                if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                {\n                    for (let i = 0; i < mipLevelCount; i++)\n                    {\n                        gl.texImage2D(gl[target], i, gl[format], width, height, 0, gl[format], gl[type], null);\n                    }\n                }\n                else\n                {\n                    console.error(`未处理 ${target} 纹理初始化存储！`);\n                }\n            }\n        }\n    };\n\n    createTexture();\n\n    const updateSources = () =>\n    {\n        webGLTexture.destroy();\n    };\n\n    watcher.watch(texture, 'sources', updateSources);\n\n    // 更新纹理\n    const updateTexture = () =>\n    {\n        const { writeTextures } = texture;\n\n        if (!writeTextures || writeTextures.length === 0) return;\n\n        const descriptor = texture.descriptor;\n\n        const target = getGLTextureTarget(descriptor.dimension);\n        const { format, type } = getGLTextureFormats(descriptor.format);\n\n        gl.bindTexture(gl[target], webGLTexture);\n\n        writeTextures.forEach((v) =>\n        {\n            const { mipLevel, textureOrigin, size } = v;\n            //\n            const width = size?.[0];\n            const height = size?.[1];\n            const depthOrArrayLayers = size?.[2];\n            const xoffset = textureOrigin?.[0];\n            const yoffset = textureOrigin?.[1];\n            const zoffset = textureOrigin?.[2];\n\n            // 处理图片资源\n            const imageSource = v as TextureImageSource;\n\n            if (imageSource.image)\n            {\n                const { image, imageOrigin, flipY, premultipliedAlpha } = imageSource;\n\n                //\n                const pixelStore: GLTexturePixelStore = {};\n\n                pixelStore.unpackSkipPixels = imageOrigin?.[0] || 0;\n                pixelStore.unpackSkipRows = imageOrigin?.[1] || 0;\n                pixelStore.unpackFlipY = flipY || false;\n                pixelStore.unpackPremulAlpha = premultipliedAlpha || false;\n\n                setTexturePixelStore(gl, pixelStore);\n\n                if (gl instanceof WebGL2RenderingContext)\n                {\n                    if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                    {\n                        const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(depthOrArrayLayers) : target;\n\n                        if (width && height)\n                        {\n                            gl.texSubImage2D(gl[bindTarget], mipLevel, xoffset, yoffset, width, height, gl[format], gl[type], image);\n                        }\n                        else\n                        {\n                            gl.texSubImage2D(gl[bindTarget], mipLevel, xoffset, yoffset, gl[format], gl[type], image);\n                        }\n                    }\n                    else if (target === 'TEXTURE_3D' || target === 'TEXTURE_2D_ARRAY')\n                    {\n                        gl.texSubImage3D(gl[target], mipLevel, xoffset, yoffset, zoffset, width, height, depthOrArrayLayers, gl[format], gl[type], image);\n                    }\n                    else\n                    {\n                        console.error(`未处理 WebGL1 中 ${target} 纹理类型的图片资源上传！`);\n                    }\n                }\n                // 处理 WebGL1\n                else\n                {\n\n                    if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                    {\n                        const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(depthOrArrayLayers) : target;\n\n                        gl.texSubImage2D(gl[bindTarget], mipLevel, xoffset, yoffset, gl[format], gl[type], image);\n                    }\n                    else\n                    {\n                        console.error(`WebGL1 中 不支持 ${target} 纹理类型！`);\n                    }\n                }\n\n                return;\n            }\n\n            // 处理数据资源\n            const bufferSource = v as TextureDataSource;\n            const { data, dataLayout, dataImageOrigin } = bufferSource;\n\n            //\n            const offset = dataLayout?.offset || 0;\n\n            //\n            const pixelStore: GLTexturePixelStore = {};\n\n            pixelStore.unpackSkipPixels = dataImageOrigin?.[0] || 0;\n            pixelStore.unpackSkipRows = dataImageOrigin?.[1] || 0;\n            pixelStore.unpackSkipImages = dataImageOrigin?.[2] || 0;\n            pixelStore.unpackRowLength = dataLayout?.width;\n            pixelStore.unpackImageHeight = dataLayout?.height;\n\n            setTexturePixelStore(gl, pixelStore);\n\n            if (gl instanceof WebGL2RenderingContext)\n            {\n\n                if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                {\n                    const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(depthOrArrayLayers) : target;\n\n                    gl.texSubImage2D(gl[bindTarget], mipLevel, xoffset, yoffset, width, height, gl[format], gl[type], data, offset);\n                }\n                else if (target === 'TEXTURE_3D' || target === 'TEXTURE_2D_ARRAY')\n                {\n                    gl.texSubImage3D(gl[target], mipLevel, xoffset, yoffset, zoffset, width, height, depthOrArrayLayers, gl[format], gl[type], data, offset);\n                }\n                else\n                {\n                    console.error(`未处理 WebGL1 中 ${target} 纹理类型的像素资源上传。`);\n                }\n            }\n            // 处理 WebGL1\n            else\n            {\n\n                if (target === 'TEXTURE_2D' || target === 'TEXTURE_CUBE_MAP')\n                {\n                    const bindTarget = target === 'TEXTURE_CUBE_MAP' ? getTextureCubeMapTarget(depthOrArrayLayers) : target;\n\n                    gl.texSubImage2D(gl[bindTarget], mipLevel, xoffset, yoffset, width, height, gl[format], gl[type], data);\n\n                    console.assert(!offset, `WebGL1 不支持 IGLTextureDataSource.dataLayout.offset ！`);\n                }\n                else\n                {\n                    console.error(`WebGL1 中 不支持 ${target} 纹理类型！`);\n                }\n            }\n        });\n    };\n\n    updateTexture();\n\n    const descriptor = texture.descriptor;\n\n    watcher.watchs(descriptor, ['generateMipmap'], updateTexture);\n    watcher.watch(texture, 'writeTextures', updateTexture);\n\n    // 监听纹理尺寸发生变化\n    const resize = (newValue: TextureSize, oldValue: TextureSize) =>\n    {\n        if (!!newValue && !!oldValue)\n        {\n            if (newValue[0] === oldValue[0]\n                && newValue[1] === oldValue[1]\n                && (newValue[2] || 1) === (oldValue[2] || 1)\n            )\n            {\n                return;\n            }\n        }\n\n        webGLTexture.destroy();\n    };\n\n    watcher.watch(descriptor, 'size', resize);\n\n    webGLTexture.destroy = () =>\n    {\n        //\n        gl.deleteTexture(webGLTexture);\n        gl._textures.delete(texture);\n        //\n        watcher.unwatchs(descriptor, ['generateMipmap'], updateTexture);\n        watcher.unwatch(texture, 'sources', updateSources);\n        watcher.unwatch(texture, 'writeTextures', updateTexture);\n        watcher.unwatch(descriptor, 'size', resize);\n        //\n        delete webGLTexture.destroy;\n    };\n\n    return webGLTexture;\n}\n\nexport function deleteTexture(gl: WebGLRenderingContext, texture: Texture)\n{\n    const webGLTexture = gl._textures.get(texture);\n\n    if (!webGLTexture) return;\n\n    webGLTexture.destroy();\n}\n\n/**\n * 设置像素解包打包时参数。\n *\n * @param gl\n * @param pixelStore 像素解包打包时参数。\n */\nfunction setTexturePixelStore(gl: WebGLRenderingContext, pixelStore: GLTexturePixelStore)\n{\n    const {\n        packAlignment,\n        unpackAlignment,\n        unpackFlipY,\n        unpackPremulAlpha,\n        unpackColorSpaceConversion,\n        packRowLength,\n        packSkipPixels,\n        packSkipRows,\n        unpackRowLength,\n        unpackImageHeight,\n        unpackSkipPixels,\n        unpackSkipRows,\n        unpackSkipImages,\n    } = { ...defaultTexturePixelStore, ...pixelStore };\n\n    //\n    gl.pixelStorei(gl.PACK_ALIGNMENT, packAlignment);\n    gl.pixelStorei(gl.UNPACK_ALIGNMENT, unpackAlignment);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, unpackFlipY);\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, unpackPremulAlpha);\n    gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, gl[unpackColorSpaceConversion]);\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        gl.pixelStorei(gl.PACK_ROW_LENGTH, packRowLength);\n        gl.pixelStorei(gl.PACK_SKIP_PIXELS, packSkipPixels);\n        gl.pixelStorei(gl.PACK_SKIP_ROWS, packSkipRows);\n        gl.pixelStorei(gl.UNPACK_ROW_LENGTH, unpackRowLength);\n        gl.pixelStorei(gl.UNPACK_IMAGE_HEIGHT, unpackImageHeight);\n        gl.pixelStorei(gl.UNPACK_SKIP_PIXELS, unpackSkipPixels);\n        gl.pixelStorei(gl.UNPACK_SKIP_ROWS, unpackSkipRows);\n        gl.pixelStorei(gl.UNPACK_SKIP_IMAGES, unpackSkipImages);\n    }\n}\n\n/**\n * 像素解包打包时参数。\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/pixelStorei\n */\ninterface GLTexturePixelStore\n{\n    /**\n     * Packing of pixel data into memory\n     *\n     * gl.PACK_ALIGNMENT\n     *\n     * 默认值为 4 。\n     */\n    packAlignment?: 1 | 2 | 4 | 8;\n\n    /**\n     * Unpacking of pixel data from memory.\n     *\n     * gl.UNPACK_ALIGNMENT\n     *\n     * 默认值为 4 。\n     */\n    unpackAlignment?: 1 | 2 | 4 | 8;\n\n    /**\n     * 解包图像数据时进行Y轴反转。\n     *\n     * Flips the source data along its vertical axis if true.\n     *\n     * gl.UNPACK_FLIP_Y_WEBGL\n     *\n     * 默认为 false。\n     */\n    unpackFlipY?: boolean;\n\n    /**\n     * 将图像RGB颜色值得每一个分量乘以A。\n     *\n     * Multiplies the alpha channel into the other color channels\n     *\n     * gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL\n     *\n     * 默认为 false。\n     */\n    unpackPremulAlpha?: boolean;\n\n    /**\n     * Default color space conversion or no color space conversion.\n     *\n     * gl.UNPACK_COLORSPACE_CONVERSION_WEBGL\n     *\n     * 默认为 \"BROWSER_DEFAULT_WEBGL\" 。\n     */\n    unpackColorSpaceConversion?: 'BROWSER_DEFAULT_WEBGL' | 'NONE';\n\n    /**\n     * Number of pixels in a row.\n     *\n     * gl.PACK_ROW_LENGTH\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    packRowLength?: number;\n\n    /**\n     * Number of pixel locations skipped before the first pixel is written into memory.\n     *\n     * gl.PACK_SKIP_PIXELS\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    packSkipPixels?: number;\n\n    /**\n     * Number of rows of pixel locations skipped before the first pixel is written into memory\n     *\n     * gl.PACK_SKIP_ROWS\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    packSkipRows?: number;\n\n    /**\n     * Number of pixels in a row.\n     *\n     * gl.UNPACK_ROW_LENGTH\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    unpackRowLength?: number;\n\n    /**\n     * Image height used for reading pixel data from memory\n     *\n     * gl.UNPACK_IMAGE_HEIGHT\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    unpackImageHeight?: number;\n\n    /**\n     *\n     * Number of pixel images skipped before the first pixel is read from memory\n     *\n     * gl.UNPACK_SKIP_PIXELS\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    unpackSkipPixels?: number;\n\n    /**\n     *\n     * Number of rows of pixel locations skipped before the first pixel is read from memory\n     *\n     * gl.UNPACK_SKIP_ROWS\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    unpackSkipRows?: number;\n\n    /**\n     *\n     * Number of pixel images skipped before the first pixel is read from memory\n     *\n     * gl.UNPACK_SKIP_IMAGES\n     *\n     * 默认值为 0 。\n     *\n     * 仅 WebGL2。\n     */\n    unpackSkipImages?: number;\n}\n\nfunction getTextureCubeMapTarget(depthOrArrayLayers: number)\n{\n    const textureCubeMapTarget: GLTextureCubeMapTarget = textureCubeMapTargetMap[depthOrArrayLayers];\n\n    console.assert(!!textureCubeMapTarget, `CubeMap的depthOrArrayLayers值应在[0-5]之间！`);\n\n    return textureCubeMapTarget;\n}\n\nconst textureCubeMapTargetMap: GLTextureCubeMapTarget[] = [\n    'TEXTURE_CUBE_MAP_POSITIVE_X',\n    'TEXTURE_CUBE_MAP_NEGATIVE_X',\n    'TEXTURE_CUBE_MAP_POSITIVE_Y',\n    'TEXTURE_CUBE_MAP_NEGATIVE_Y',\n    'TEXTURE_CUBE_MAP_POSITIVE_Z',\n    'TEXTURE_CUBE_MAP_NEGATIVE_Z',\n];\n\n/**\n * A GLenum specifying the texture target.\n *\n * gl.TEXTURE_CUBE_MAP_POSITIVE_X: Positive X face for a cube-mapped texture.\n * gl.TEXTURE_CUBE_MAP_NEGATIVE_X: Negative X face for a cube-mapped texture.\n * gl.TEXTURE_CUBE_MAP_POSITIVE_Y: Positive Y face for a cube-mapped texture.\n * gl.TEXTURE_CUBE_MAP_NEGATIVE_Y: Negative Y face for a cube-mapped texture.\n * gl.TEXTURE_CUBE_MAP_POSITIVE_Z: Positive Z face for a cube-mapped texture.\n * gl.TEXTURE_CUBE_MAP_NEGATIVE_Z: Negative Z face for a cube-mapped texture.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D\n */\ntype GLTextureCubeMapTarget =\n    | 'TEXTURE_CUBE_MAP_POSITIVE_X'\n    | 'TEXTURE_CUBE_MAP_NEGATIVE_X'\n    | 'TEXTURE_CUBE_MAP_POSITIVE_Y'\n    | 'TEXTURE_CUBE_MAP_NEGATIVE_Y'\n    | 'TEXTURE_CUBE_MAP_POSITIVE_Z'\n    | 'TEXTURE_CUBE_MAP_NEGATIVE_Z';","import { CanvasTexture, RenderPassDescriptor, Texture, TextureView } from '@feng3d/render-api';\nimport { Renderbuffer } from '../data/Renderbuffer';\nimport { deleteRenderbuffer, getGLRenderbuffer } from './getGLRenderbuffer';\nimport { _IGLRenderPassDescriptorWithMultisample, GLRenderPassDescriptorWithMultisample } from './getGLRenderPassDescriptorWithMultisample';\nimport { getGLTexture } from './getGLTexture';\nimport { getGLTextureTarget } from './getGLTextureTarget';\n\n/**\n * 获取帧缓冲区\n */\nexport function getGLFramebuffer(gl: WebGLRenderingContext, passDescriptor: RenderPassDescriptor)\n{\n    const view = passDescriptor?.colorAttachments?.[0]?.view || passDescriptor?.depthStencilAttachment?.view;\n\n    if (!view) return null;\n\n    // 检查是否是 CanvasTexture，如果是，返回 null（使用默认 framebuffer）\n    if ('texture' in view)\n    {\n        const texture = view.texture;\n\n        if ('context' in texture)\n        {\n            // CanvasTexture: 使用默认 framebuffer（画布）\n            return null;\n        }\n    }\n\n    let webGLFramebuffer = gl._framebuffers.get(passDescriptor);\n\n    if (webGLFramebuffer) return webGLFramebuffer;\n\n    const sampleCount = passDescriptor.sampleCount;\n\n    webGLFramebuffer = gl.createFramebuffer();\n    gl.bindFramebuffer(gl.FRAMEBUFFER, webGLFramebuffer);\n    gl._framebuffers.set(passDescriptor, webGLFramebuffer);\n\n    // 处理颜色附件\n    const drawBuffers: number[] = [];\n\n    passDescriptor.colorAttachments?.forEach((item, i) =>\n    {\n        const view = item.view as (TextureView | Renderbuffer);\n        const attachment = gl[`COLOR_ATTACHMENT${i}`];\n\n        drawBuffers.push(attachment);\n        if ('texture' in view)\n        {\n            const texture = view.texture;\n            const baseMipLevel = view.baseMipLevel || 0;\n            const baseArrayLayer = view.baseArrayLayer || 0;\n\n            // 检查是否是 CanvasTexture\n            if ('context' in texture)\n            {\n                // CanvasTexture: 不需要附加到 framebuffer，因为使用的是默认 framebuffer\n                // 跳过处理，不添加到 drawBuffers\n                drawBuffers.pop(); // 移除刚才添加的 attachment\n\n                return; // 跳过当前迭代\n            }\n\n            const webGLTexture = getGLTexture(gl, texture as Texture);\n            const textureTarget = getGLTextureTarget((texture as Texture).descriptor.dimension);\n\n            if (textureTarget === 'TEXTURE_2D')\n            {\n                gl.framebufferTexture2D(gl.FRAMEBUFFER, attachment, gl[textureTarget], webGLTexture, baseMipLevel);\n            }\n            else if (textureTarget === 'TEXTURE_2D_ARRAY')\n            {\n                if (gl instanceof WebGL2RenderingContext)\n                {\n                    gl.framebufferTextureLayer(gl.DRAW_FRAMEBUFFER, attachment, webGLTexture, baseMipLevel, baseArrayLayer);\n                }\n            }\n            else\n            {\n                console.error(`未处理 ${textureTarget} 的颜色附件纹理设置！`);\n            }\n        }\n        else\n        {\n            const renderbuffer = getGLRenderbuffer(gl, view, sampleCount);\n\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, attachment, gl.RENDERBUFFER, renderbuffer);\n        }\n    });\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        gl.drawBuffers(drawBuffers);\n    }\n    else\n    {\n        console.error(`WebGL1 不支持 drawBuffers 。`);\n    }\n\n    // 处理深度模板附件\n    const depthStencilAttachment = passDescriptor.depthStencilAttachment;\n\n    if (depthStencilAttachment)\n    {\n        // 如果有 view，使用纹理作为深度附件\n        if (depthStencilAttachment.view)\n        {\n            const view = depthStencilAttachment.view;\n\n            const texture = view.texture;\n            const baseMipLevel = view.baseMipLevel || 0;\n            const baseArrayLayer = view.baseArrayLayer || 0;\n\n            // 检查是否是 CanvasTexture\n            if ('context' in texture)\n            {\n                // CanvasTexture: 不需要附加到 framebuffer，因为使用的是默认 framebuffer\n                // 跳过处理\n            }\n            else\n            {\n                const webGLTexture = getGLTexture(gl, texture as Texture);\n                const textureTarget = getGLTextureTarget((texture as Texture).descriptor.dimension);\n\n                if (textureTarget === 'TEXTURE_2D')\n                {\n                    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl[textureTarget], webGLTexture, baseMipLevel);\n                }\n                else if (textureTarget === 'TEXTURE_2D_ARRAY')\n                {\n                    if (gl instanceof WebGL2RenderingContext)\n                    {\n                        gl.framebufferTextureLayer(gl.DRAW_FRAMEBUFFER, gl.DEPTH_ATTACHMENT, webGLTexture, baseMipLevel, baseArrayLayer);\n                    }\n                }\n                else\n                {\n                    console.error(`未处理 ${textureTarget} 的深度模板附件纹理设置！`);\n                }\n            }\n        }\n        // 如果没有 view，但配置了 depthStencilAttachment，自动创建深度 renderbuffer\n        else if (webGLFramebuffer)\n        {\n            // 获取附件尺寸\n            const colorAttachment = passDescriptor.colorAttachments?.[0];\n            let width = gl.drawingBufferWidth;\n            let height = gl.drawingBufferHeight;\n\n            if (colorAttachment?.view)\n            {\n                const view = colorAttachment.view;\n\n                if ('texture' in view)\n                {\n                    const texture = view.texture;\n\n                    if ('descriptor' in texture)\n                    {\n                        width = texture.descriptor.size[0];\n                        height = texture.descriptor.size[1];\n                    }\n                }\n            }\n\n            // 创建深度 renderbuffer\n            const depthRenderbuffer = gl.createRenderbuffer();\n\n            gl.bindRenderbuffer(gl.RENDERBUFFER, depthRenderbuffer);\n            if (gl instanceof WebGL2RenderingContext)\n            {\n                gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH24_STENCIL8, width, height);\n                gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, depthRenderbuffer);\n            }\n            else\n            {\n                gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\n                gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, depthRenderbuffer);\n            }\n\n            // 将 renderbuffer 存储到 framebuffer 的缓存中，以便后续清理\n            // 使用 Map 存储 framebuffer 到 renderbuffer 的映射\n            const glAny = gl as any;\n\n            if (!glAny._framebufferDepthRenderbuffers)\n            {\n                glAny._framebufferDepthRenderbuffers = new Map();\n            }\n            glAny._framebufferDepthRenderbuffers.set(webGLFramebuffer, depthRenderbuffer);\n        }\n    }\n\n    return webGLFramebuffer;\n}\n\n/**\n *\n * @param gl\n * @param passDescriptor\n * @param handleMultisample 处理存在多重采样的渲染通道描述。\n * @returns\n */\nexport function deleteFramebuffer(gl: WebGLRenderingContext, passDescriptor: RenderPassDescriptor, handleMultisample = true)\n{\n    if (handleMultisample && passDescriptor?.[_IGLRenderPassDescriptorWithMultisample])\n    {\n        deleteRenderPassDescriptorWithMultisample(gl, passDescriptor[_IGLRenderPassDescriptorWithMultisample]);\n\n        return;\n    }\n\n    const webGLFramebuffer = gl._framebuffers.get(passDescriptor);\n\n    gl._framebuffers.delete(passDescriptor);\n\n    // 删除关联的深度 renderbuffer（如果存在）\n    const glAny = gl as any;\n\n    if (glAny._framebufferDepthRenderbuffers && webGLFramebuffer)\n    {\n        const depthRenderbuffer = glAny._framebufferDepthRenderbuffers.get(webGLFramebuffer);\n\n        if (depthRenderbuffer)\n        {\n            gl.deleteRenderbuffer(depthRenderbuffer);\n            glAny._framebufferDepthRenderbuffers.delete(webGLFramebuffer);\n        }\n    }\n\n    //\n    gl.deleteFramebuffer(webGLFramebuffer);\n}\n\nfunction deleteRenderPassDescriptorWithMultisample(gl: WebGLRenderingContext, renderPassDescriptorWithMultisample: GLRenderPassDescriptorWithMultisample)\n{\n    deleteFramebuffer(gl, renderPassDescriptorWithMultisample.blitFramebuffer.read, false);\n    deleteFramebuffer(gl, renderPassDescriptorWithMultisample.blitFramebuffer.draw, false);\n\n    renderPassDescriptorWithMultisample.renderbuffers.forEach((v) =>\n    {\n        deleteRenderbuffer(gl, v);\n    });\n}","/**\n * WebGL中Uniform类型\n */\nexport type GLUniformType = keyof typeof webGLUniformTypeValue;\n\n/**\n * WebGL中Uniform纹理类型\n */\nexport type GLUniformTextureType = keyof typeof webGLUniformTextureTypeValue;\n\n/**\n * WebGL中Uniform缓冲区类型\n */\nexport type GLUniformBufferType = keyof typeof webGLUniformBufferTypeValue;\n\n/**\n * 获取Unifrom类型名称\n *\n * @param value WebGL中Unifrom类型对应的值。\n * @returns Unifrom类型名称\n */\nexport function getWebGLUniformType(value: number): GLUniformType\n{\n    const result = webGLUniformValueType[value];\n\n    console.assert(!!result);\n\n    return result;\n}\n\n/**\n * 判断是否为纹理Unifrom类型。\n *\n * @param type Unifrom类型名称\n * @returns 是否为纹理Unifrom类型。\n */\nexport function isWebGLUniformTextureType(type: GLUniformType): boolean\n{\n    return webGLUniformTextureTypeValue[type] !== undefined;\n}\n\n/**\n * WebGL1 缓冲区数据类型。\n */\nconst webGL1UniformBufferTypeValue = { FLOAT: 5126, FLOAT_VEC2: 35664, FLOAT_VEC3: 35665, FLOAT_VEC4: 35666, INT: 5124, INT_VEC2: 35667, INT_VEC3: 35668, INT_VEC4: 35669, BOOL: 35670, BOOL_VEC2: 35671, BOOL_VEC3: 35672, BOOL_VEC4: 35673, FLOAT_MAT2: 35674, FLOAT_MAT3: 35675, FLOAT_MAT4: 35676 };\n/**\n * WebGL1 纹理数据类型。\n */\nconst webGL1UniformTextureTypeValue = { SAMPLER_2D: 35678, SAMPLER_CUBE: 35680 };\n\n/**\n * 仅 WebGL2 缓冲区数据类型。\n */\nconst webGL2OnlyUniformBufferTypeValue = { UNSIGNED_INT: 5125, UNSIGNED_INT_VEC2: 36294, UNSIGNED_INT_VEC3: 36295, UNSIGNED_INT_VEC4: 36296, FLOAT_MAT2x3: 35685, FLOAT_MAT2x4: 35686, FLOAT_MAT3x2: 35687, FLOAT_MAT3x4: 35688, FLOAT_MAT4x2: 35689, FLOAT_MAT4x3: 35690 };\n/**\n * 仅 WebGL2 纹理数据类型。\n */\nconst webGL2OnlyUniformTextureTypeValue = { SAMPLER_3D: 35679, SAMPLER_2D_SHADOW: 35682, SAMPLER_2D_ARRAY: 36289, SAMPLER_2D_ARRAY_SHADOW: 36292, SAMPLER_CUBE_SHADOW: 36293, INT_SAMPLER_2D: 36298, INT_SAMPLER_3D: 36299, INT_SAMPLER_CUBE: 36300, INT_SAMPLER_2D_ARRAY: 36303, UNSIGNED_INT_SAMPLER_2D: 36306, UNSIGNED_INT_SAMPLER_3D: 36307, UNSIGNED_INT_SAMPLER_CUBE: 36308, UNSIGNED_INT_SAMPLER_2D_ARRAY: 36311 };\n\n/**\n * WebGL Uniform 类型与值的映射。\n */\nconst webGLUniformTypeValue = { ...webGL1UniformBufferTypeValue, ...webGL1UniformTextureTypeValue, ...webGL2OnlyUniformBufferTypeValue, ...webGL2OnlyUniformTextureTypeValue };\n\n/**\n * WebGL Uniform 纹理类型与值的映射。\n */\nconst webGLUniformTextureTypeValue = { ...webGL1UniformTextureTypeValue, ...webGL2OnlyUniformTextureTypeValue };\n\n/**\n * WebGL Uniform 缓冲区数据与值的映射。\n */\nconst webGLUniformBufferTypeValue = { ...webGL1UniformBufferTypeValue, ...webGL2OnlyUniformBufferTypeValue };\n\n/**\n * WebGL Uniform 值与类型的映射。\n */\nconst webGLUniformValueType = Object.keys(webGLUniformTypeValue).reduce((pv, cv) =>\n{\n    pv[webGLUniformTypeValue[cv]] = cv;\n\n    return pv;\n}, {});\n","import { BufferBindingInfo, GLVertexAttributeTypes, RenderPipeline } from '@feng3d/render-api';\nimport { getWebGLUniformType, GLUniformBufferType, GLUniformType, isWebGLUniformTextureType } from '../const/GLUniformType';\nimport { TransformFeedbackPipeline, TransformFeedbackVaryings } from '@feng3d/render-api';\n\ndeclare global\n{\n    export interface WebGLProgram\n    {\n        vertex: string;\n        fragment: string;\n        /**\n         * 属性信息列表\n         */\n        attributes: GLAttributeInfo[];\n        /**\n         * uniform信息列表\n         */\n        uniforms: GLUniformInfo[];\n\n        /**\n         * 统一变量块信息列表。\n         *\n         * 仅 WebGL2 中存在。\n         */\n        uniformBlocks: UniformBlockInfo[];\n    }\n}\n\nexport interface GLAttributeInfo\n{\n    /**\n     * 名称。\n     */\n    name: string;\n\n    /**\n     * 顶点尺寸。\n     */\n    size: number;\n\n    /**\n     * 属性缓冲数据类型\n     */\n    type?: GLVertexAttributeTypes;\n\n    /**\n     * 属性地址\n     */\n    location: number;\n}\n\n/**\n * 激活渲染程序\n */\nexport function getGLProgram(gl: WebGLRenderingContext, material: RenderPipeline | TransformFeedbackPipeline)\n{\n    const shaderKey = getKey(material);\n    let result = gl._programs[shaderKey];\n\n    if (result) return result;\n\n    const vertex = material.vertex.glsl || material.vertex.code;\n    let fragment = undefined;\n    const fragmentState = (material as RenderPipeline).fragment;\n\n    if (fragmentState)\n    {\n        fragment = fragmentState.glsl || fragmentState.code;\n    }\n\n    fragment = fragment || `#version 300 es\n        precision highp float;\n        precision highp int;\n\n        void main()\n        {\n        }\n    `;\n    const transformFeedbackVaryings = (material as TransformFeedbackPipeline).transformFeedbackVaryings;\n\n    result = getWebGLProgram(gl, vertex, fragment, transformFeedbackVaryings);\n    gl._programs[shaderKey] = result;\n\n    return result;\n}\n\nexport function deleteProgram(gl: WebGLRenderingContext, material: RenderPipeline)\n{\n    const shaderKey = getKey(material);\n    const result = gl._programs[shaderKey];\n\n    if (result)\n    {\n        delete gl._programs[shaderKey];\n        gl.deleteProgram(result);\n    }\n}\n\nfunction getKey(material: RenderPipeline | TransformFeedbackPipeline)\n{\n    const vertex = material.vertex.glsl || material.vertex.code;\n    let fragment = undefined;\n    const fragmentState = (material as RenderPipeline).fragment;\n\n    if (fragmentState)\n    {\n        fragment = fragmentState.glsl || fragmentState.code;\n    }\n    const transformFeedbackVaryings = (material as TransformFeedbackPipeline).transformFeedbackVaryings;\n\n    return `---vertexShader---\\n${vertex}\\n---fragment---\\n${fragment}\\n---feedback---${transformFeedbackVaryings?.varyings.toString()} ${transformFeedbackVaryings?.bufferMode}`;\n}\n\nfunction getWebGLProgram(gl: WebGLRenderingContext, vshader: string, fshader: string, transformFeedbackVaryings: TransformFeedbackVaryings)\n{\n    // 编译顶点着色器\n    const vertexShader = getWebGLShader(gl, 'VERTEX_SHADER', vshader);\n\n    // 编译片段着色器\n    const fragmentShader = getWebGLShader(gl, 'FRAGMENT_SHADER', fshader);\n\n    // 创建着色器程序\n    const program = createLinkProgram(gl, vertexShader, fragmentShader, transformFeedbackVaryings);\n\n    // 获取属性信息\n    const numAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n    const attributes: GLAttributeInfo[] = [];\n\n    for (let i = 0; i < numAttributes; i++)\n    {\n        const activeInfo = gl.getActiveAttrib(program, i);\n        const { name, size, type } = activeInfo;\n        const location = gl.getAttribLocation(program, name);\n        const typeString = getGLAttributeType(type as any);\n\n        attributes.push({ name, size, type: typeString, location });\n    }\n    // 获取uniform信息\n    const numUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n    const uniforms: GLUniformInfo[] = [];\n    let textureID = 0;\n\n    for (let i = 0; i < numUniforms; i++)\n    {\n        const activeInfo = gl.getActiveUniform(program, i);\n        const { name, size, type } = activeInfo;\n        const typeString = getWebGLUniformType(type);\n        const isTexture = isWebGLUniformTextureType(typeString);\n\n        const reg = /(\\w+)/g;\n\n        const names = [name];\n\n        if (size > 1)\n        {\n            console.assert(name.substring(name.length - 3) === '[0]');\n            const baseName = name.substring(0, name.length - 3);\n\n            for (let j = 1; j < size; j++)\n            {\n                names[j] = `${baseName}[${j}]`;\n            }\n        }\n\n        const items: UniformItemInfo[] = [];\n\n        for (let j = 0; j < names.length; j++)\n        {\n            const name = names[j];\n            let result: RegExpExecArray = reg.exec(name);\n            const paths: string[] = [];\n\n            while (result)\n            {\n                paths.push(result[1]);\n                result = reg.exec(name);\n            }\n            const location = gl.getUniformLocation(program, name);\n\n            if (isTexture)\n            {\n                items.push({ location, paths, textureID });\n                textureID++;\n            }\n            else\n            {\n                items.push({ location, paths, textureID: -1 });\n            }\n        }\n        uniforms[i] = { name, type: typeString, isTexture, items };\n    }\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        const numUniformBlocks = gl.getProgramParameter(program, gl.ACTIVE_UNIFORM_BLOCKS);\n        const uniformBlockActiveInfos = new Array(numUniformBlocks).fill(0).map((v, i) =>\n        {\n            //\n            gl.uniformBlockBinding(program, i, i);\n            // 获取包含的统一变量列表。\n            const uniformIndices: Uint32Array = gl.getActiveUniformBlockParameter(program, i, gl.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES);\n            const uniformList: GLUniformInfo[] = [];\n\n            for (let i = 0; i < uniformIndices.length; i++)\n            {\n                const unifrom = uniforms[uniformIndices[i]];\n\n                unifrom.inBlock = true;\n                uniformList.push(unifrom);\n            }\n            const name = gl.getActiveUniformBlockName(program, i);\n            //\n            const info: UniformBlockInfo = {\n                name,\n                index: i,\n                dataSize: gl.getActiveUniformBlockParameter(program, i, gl.UNIFORM_BLOCK_DATA_SIZE),\n                uniforms: uniformList,\n                bufferBindingInfo: undefined,\n            };\n\n            //\n            info.bufferBindingInfo = getBufferBindingInfo(info);\n\n            return info;\n        });\n\n        program.uniformBlocks = uniformBlockActiveInfos;\n    }\n\n    //\n    program.vertex = vshader;\n    program.fragment = fshader;\n    program.attributes = attributes;\n    program.uniforms = uniforms;\n\n    return program;\n}\n\n/**\n * 统一变量块信息。\n */\nexport interface UniformBlockInfo\n{\n    /**\n     * 名称。\n     */\n    name: string;\n\n    /**\n     * 绑定位置。\n     */\n    index: number;\n\n    /**\n     * 数据尺寸。\n     */\n    dataSize: number;\n\n    /**\n     * 包含的统一变量列表。\n     */\n    uniforms: GLUniformInfo[];\n\n    /**\n     * 缓冲区绑定信息。\n     */\n    bufferBindingInfo: BufferBindingInfo;\n}\n\n/**\n * 编译着色器代码\n *\n * @param type 着色器类型\n * @param code 着色器代码\n * @return 编译后的着色器对象\n */\nfunction getWebGLShader(gl: WebGLRenderingContext, type: ShaderType, code: string)\n{\n    let shader = gl._shaders[code];\n\n    if (shader) return shader;\n\n    shader = gl.createShader(gl[type]);\n    gl._shaders[code] = shader;\n\n    gl.shaderSource(shader, code);\n    gl.compileShader(shader);\n\n    // 检查编译结果\n    const compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n    if (!compiled)\n    {\n        const error = gl.getShaderInfoLog(shader);\n\n        gl.deleteShader(shader);\n        throw `Failed to compile shader: ${error}`;\n    }\n\n    return shader;\n}\n\nfunction createLinkProgram(gl: WebGLRenderingContext, vertexShader: WebGLShader, fragmentShader: WebGLShader, transformFeedbackVaryings: TransformFeedbackVaryings)\n{\n    // 创建程序对象\n    const program = gl.createProgram();\n\n    // 添加着色器\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n\n    if (transformFeedbackVaryings)\n    {\n        if (gl instanceof WebGL2RenderingContext)\n        {\n            gl.transformFeedbackVaryings(program, transformFeedbackVaryings.varyings, gl[transformFeedbackVaryings.bufferMode]);\n        }\n        else\n        {\n            console.error(`WebGL1 不支持 transformFeedbackVaryings 功能！`);\n        }\n    }\n\n    // 链接程序\n    gl.linkProgram(program);\n\n    // 检查结果\n    const linked = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n    if (!linked)\n    {\n        const error = gl.getProgramInfoLog(program);\n\n        gl.deleteProgram(program);\n        gl.deleteShader(fragmentShader);\n        gl.deleteShader(vertexShader);\n        throw `Failed to link program: ${error}`;\n    }\n\n    return program;\n}\n\n/**\n * Shader type.\n *\n * Either a gl.FRAGMENT_SHADER or a gl.VERTEX_SHADER.\n */\nexport type ShaderType = 'FRAGMENT_SHADER' | 'VERTEX_SHADER';\n\nfunction getBufferBindingInfo(uniformBlock: UniformBlockInfo): BufferBindingInfo\n{\n    const size = uniformBlock.dataSize;\n    //\n    let currentSize = 0;\n    let structName: string;\n\n    const items: { paths: string[], offset: number, size: number, Cls: Float32ArrayConstructor | Int32ArrayConstructor | Uint32ArrayConstructor }[] = [];\n\n    uniformBlock.uniforms.forEach((uniformInfo) =>\n    {\n        const uniformBufferType = uniformInfo.type as GLUniformBufferType;\n        const alignSize = uniformBufferTypeAlignSizeMap[uniformBufferType];\n\n        console.assert(!!alignSize, `没有找到 ${uniformBufferType} 统一缓冲类型对应的对齐与尺寸。`);\n\n        //\n        const currentstructName = uniformInfo.name.substring(0, uniformInfo.name.lastIndexOf('.'));\n\n        if (structName !== currentstructName)\n        {\n            currentSize = roundUp(16, currentSize); // 结构体之间对齐\n            structName = currentstructName;\n        }\n\n        //\n        uniformInfo.items.forEach((itemInfo) =>\n        {\n            currentSize = roundUp(alignSize.align, currentSize); // 结构体成员对齐\n            const itemInfoOffset = currentSize;\n            const itemInfoSize = alignSize.size;\n\n            //\n            currentSize += alignSize.size;\n            const Cls = alignSize.clsType;\n            //\n            const paths = itemInfo.paths.slice(1);\n\n            //\n            items.push({ paths, offset: itemInfoOffset, size: itemInfoSize, Cls });\n        });\n    });\n    currentSize = roundUp(16, currentSize); // 整个统一块数据对齐\n\n    console.assert(size === currentSize, `uniformBlock映射尺寸出现错误( ${size}  ${currentSize} )！`);\n\n    const bufferBindingInfo: BufferBindingInfo = {\n        size: uniformBlock.dataSize,\n        items,\n    };\n\n    return bufferBindingInfo;\n}\n\nfunction roundUp(k: number, n: number): number\n{\n    return Math.ceil(n / k) * k;\n}\n\n/**\n *\n * @see https://github.com/brendan-duncan/wgsl_reflect/blob/main/src/wgsl_reflect.ts#L1206\n * @see https://www.orillusion.com/zh/wgsl.html#memory-layouts\n */\nconst uniformBufferTypeAlignSizeMap: {\n    [key: string]: {\n        align: number,\n        size: number,\n        clsType: Float32ArrayConstructor | Int32ArrayConstructor | Uint32ArrayConstructor,\n    }\n} = {\n    FLOAT: { align: 4, size: 4, clsType: Float32Array },\n    FLOAT_VEC2: { align: 8, size: 8, clsType: Float32Array },\n    FLOAT_VEC3: { align: 16, size: 12, clsType: Float32Array },\n    FLOAT_VEC4: { align: 16, size: 16, clsType: Float32Array },\n    INT: { align: 4, size: 4, clsType: Int32Array },\n    INT_VEC2: { align: 8, size: 8, clsType: Int32Array },\n    INT_VEC3: { align: 16, size: 12, clsType: Int32Array },\n    INT_VEC4: { align: 16, size: 16, clsType: Int32Array },\n    BOOL: { align: 4, size: 4, clsType: Int32Array },\n    BOOL_VEC2: { align: 8, size: 8, clsType: Int32Array },\n    BOOL_VEC3: { align: 16, size: 12, clsType: Int32Array },\n    BOOL_VEC4: { align: 16, size: 16, clsType: Int32Array },\n    FLOAT_MAT2: { align: 8, size: 16, clsType: Float32Array },\n    FLOAT_MAT3: { align: 16, size: 48, clsType: Float32Array },\n    FLOAT_MAT4: { align: 16, size: 64, clsType: Float32Array },\n    UNSIGNED_INT: { align: 4, size: 4, clsType: Uint32Array },\n    UNSIGNED_INT_VEC2: { align: 8, size: 8, clsType: Uint32Array },\n    UNSIGNED_INT_VEC3: { align: 16, size: 12, clsType: Uint32Array },\n    UNSIGNED_INT_VEC4: { align: 16, size: 16, clsType: Uint32Array },\n    FLOAT_MAT2x3: { align: 16, size: 32, clsType: Float32Array },\n    FLOAT_MAT2x4: { align: 16, size: 32, clsType: Float32Array },\n    FLOAT_MAT3x2: { align: 8, size: 24, clsType: Float32Array },\n    FLOAT_MAT3x4: { align: 16, size: 48, clsType: Float32Array },\n    FLOAT_MAT4x2: { align: 8, size: 32, clsType: Float32Array },\n    FLOAT_MAT4x3: { align: 16, size: 64, clsType: Float32Array },\n};\n\n/**\n * WebGL统一变量\n */\nexport interface GLUniformInfo\n{\n    /**\n     * 名称。\n     */\n    name: string;\n\n    type: GLUniformType;\n\n    /**\n     * 是否纹理。\n     */\n    isTexture: boolean;\n\n    /**\n     * 子项信息列表。\n     */\n    items: UniformItemInfo[]\n\n    /**\n     * 是否在Block中。\n     */\n    inBlock?: boolean;\n}\n\n/**\n * WebGL统一变量\n */\nexport interface UniformItemInfo\n{\n    /**\n     * uniform地址\n     */\n    location: WebGLUniformLocation;\n\n    /**\n     * texture索引\n     */\n    textureID: number;\n\n    /**\n     * Uniform数组索引，当Uniform数据为数组数据时生效\n     */\n    paths: string[];\n}\n\n/**\n * WebGL 属性类型。\n */\nexport type GLAttributeType = keyof typeof webglAttributeTypeValue;\n\n/**\n * 获取顶点数据类型名称。\n *\n * @param gl\n * @param value\n */\nexport function getGLAttributeType(value: keyof typeof webglAttributeValueType): GLAttributeType\n{\n    return webglAttributeValueType[value];\n}\n\nconst webglAttributeTypeValue = Object.freeze({ FLOAT: 5126, BYTE: 5120, SHORT: 5122, UNSIGNED_BYTE: 5121, UNSIGNED_SHORT: 5123, HALF_FLOAT: 5131, INT: 5124, UNSIGNED_INT: 5125 });\nconst webglAttributeValueType = Object.freeze({ 5120: 'BYTE', 5121: 'UNSIGNED_BYTE', 5122: 'SHORT', 5123: 'UNSIGNED_SHORT', 5124: 'INT', 5125: 'UNSIGNED_INT', 5126: 'FLOAT', 5131: 'HALF_FLOAT' });\n","import { CompareFunction } from '@feng3d/render-api';\n\nexport function getGLCompareFunction(depthCompare: CompareFunction)\n{\n    const glDepthCompare: GLCompareFunction = depthCompareMap[depthCompare];\n\n    console.assert(!!glDepthCompare, `接收到错误值，请从 ${Object.keys(depthCompareMap).toString()} 中取值！`);\n\n    return glDepthCompare;\n}\n\nconst depthCompareMap: { [key: string]: GLCompareFunction } = {\n    never: 'NEVER',\n    less: 'LESS',\n    equal: 'EQUAL',\n    'less-equal': 'LEQUAL',\n    greater: 'GREATER',\n    'not-equal': 'NOTEQUAL',\n    'greater-equal': 'GEQUAL',\n    always: 'ALWAYS',\n};\n\n/**\n * 指定深度比较函数的枚举，该函数设置绘制像素的条件，默认 LESS，如果传入值小于深度缓冲区值则通过。\n *\n * A GLenum specifying the depth comparison function, which sets the conditions under which the pixel will be drawn. The default value is gl.LESS.\n *\n * * `NEVER` 总是不通过。\n * * `LESS` 如果传入值小于深度缓冲区值则通过。\n * * `EQUAL` 如果传入值等于深度缓冲区值则通过。\n * * `LEQUAL` 如果传入值小于或等于深度缓冲区值则通过。\n * * `GREATER` 如果传入值大于深度缓冲区值则通过。\n * * `NOTEQUAL` 如果传入值不等于深度缓冲区值则通过。\n * * `GEQUAL` 如果传入值大于或等于深度缓冲区值则通过。\n * * `ALWAYS` 总是通过。\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/depthFunc\n */\nexport type GLCompareFunction = 'NEVER' | 'LESS' | 'EQUAL' | 'LEQUAL' | 'GREATER' | 'NOTEQUAL' | 'GEQUAL' | 'ALWAYS';\n","import { IAddressMode, IFilterMode, Sampler } from '@feng3d/render-api';\nimport { getGLCompareFunction } from '../runs/getGLCompareFunction';\n\nexport type GLSamplerCompareMode = 'NONE' | 'COMPARE_REF_TO_TEXTURE';\n\nexport function getGLSampler(gl: WebGLRenderingContext, sampler?: Sampler)\n{\n    let webGLSampler = gl._samplers.get(sampler);\n\n    if (webGLSampler) return webGLSampler;\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        webGLSampler = gl.createSampler();\n        gl._samplers.set(sampler, webGLSampler);\n\n        const minFilter: GLTextureMinFilter = getIGLTextureMinFilter(sampler.minFilter, sampler.mipmapFilter);\n        const magFilter: GLTextureMagFilter = getIGLTextureMagFilter(sampler.magFilter);\n        const wrapS: GLTextureWrap = getIGLTextureWrap(sampler.addressModeU);\n        const wrapT: GLTextureWrap = getIGLTextureWrap(sampler.addressModeV);\n        const wrapR: GLTextureWrap = getIGLTextureWrap(sampler.addressModeW);\n        const lodMinClamp = sampler.lodMinClamp || 0;\n        const lodMaxClamp = sampler.lodMaxClamp || 16;\n        const compareMode: GLSamplerCompareMode = sampler.compare ? 'COMPARE_REF_TO_TEXTURE' : 'NONE';\n        const compare = getGLCompareFunction(sampler.compare ?? 'less-equal');\n\n        //\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_MIN_FILTER, gl[minFilter]);\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_MAG_FILTER, gl[magFilter]);\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_WRAP_S, gl[wrapS]);\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_WRAP_T, gl[wrapT]);\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_WRAP_R, gl[wrapR]);\n        gl.samplerParameterf(webGLSampler, gl.TEXTURE_MIN_LOD, lodMinClamp);\n        gl.samplerParameterf(webGLSampler, gl.TEXTURE_MAX_LOD, lodMaxClamp);\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_COMPARE_MODE, gl[compareMode]);\n        gl.samplerParameteri(webGLSampler, gl.TEXTURE_COMPARE_FUNC, gl[compare]);\n    }\n\n    return webGLSampler;\n}\n\nexport function deleteSampler(gl: WebGLRenderingContext, sampler?: Sampler)\n{\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        const webGLSampler = gl._samplers.get(sampler);\n\n        gl._samplers.delete(sampler);\n        gl.deleteSampler(webGLSampler);\n    }\n}\n\n/**\n * 纹理坐标s包装函数枚举\n * Wrapping function for texture coordinate s\n *\n * * `REPEAT`\n * * `CLAMP_TO_EDGE`\n * * `MIRRORED_REPEAT`\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n */\nexport type GLTextureWrap = 'REPEAT' | 'CLAMP_TO_EDGE' | 'MIRRORED_REPEAT';\n\nexport function getIGLTextureWrap(addressMode: IAddressMode = 'repeat')\n{\n    const textureWrap: GLTextureWrap = addressModeMap[addressMode];\n\n    console.assert(!!textureWrap, `接收到错误值，请从 ${Object.keys(addressModeMap).toString()} 中取值！`);\n\n    return textureWrap;\n}\n\nconst addressModeMap: { [key: string]: GLTextureWrap } = {\n    'clamp-to-edge': 'CLAMP_TO_EDGE',\n    repeat: 'REPEAT',\n    'mirror-repeat': 'MIRRORED_REPEAT',\n};\n\n/**\n * 纹理缩小过滤器\n * Texture minification filter\n *\n * * `LINEAR`\n * * `NEAREST`\n * * `NEAREST_MIPMAP_NEAREST`\n * * `LINEAR_MIPMAP_NEAREST`\n * * `NEAREST_MIPMAP_LINEAR`\n * * `LINEAR_MIPMAP_LINEAR`\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n */\nexport type GLTextureMinFilter = 'LINEAR' | 'NEAREST' | 'NEAREST_MIPMAP_NEAREST' | 'LINEAR_MIPMAP_NEAREST' | 'NEAREST_MIPMAP_LINEAR' | 'LINEAR_MIPMAP_LINEAR';\n\nexport function getIGLTextureMinFilter(minFilter: IFilterMode = 'nearest', mipmapFilter?: IFilterMode): GLTextureMinFilter\n{\n    let glMinFilter: GLTextureMinFilter;\n\n    if (minFilter === 'linear')\n    {\n        if (mipmapFilter === 'linear')\n        {\n            glMinFilter = 'LINEAR_MIPMAP_LINEAR';\n        }\n        else if (mipmapFilter === 'nearest')\n        {\n            glMinFilter = 'LINEAR_MIPMAP_NEAREST';\n        }\n        else\n        {\n            glMinFilter = 'LINEAR';\n        }\n    }\n    else\n    {\n        if (mipmapFilter === 'linear')\n        {\n            glMinFilter = 'NEAREST_MIPMAP_LINEAR';\n        }\n        else if (mipmapFilter === 'nearest')\n        {\n            glMinFilter = 'NEAREST_MIPMAP_NEAREST';\n        }\n        else\n        {\n            glMinFilter = 'NEAREST';\n        }\n    }\n\n    return glMinFilter;\n}\n/**\n * 纹理放大滤波器\n * Texture magnification filter\n *\n * * `LINEAR`\n * * `NEAREST`\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texParameter\n */\nexport type GLTextureMagFilter = 'LINEAR' | 'NEAREST';\n\nexport function getIGLTextureMagFilter(magFilter: IFilterMode = 'nearest')\n{\n    const glMagFilter: GLTextureMagFilter = magFilterMap[magFilter];\n\n    console.assert(!!glMagFilter, `接收到错误值，请从 ${Object.keys(magFilterMap).toString()} 中取值！`);\n\n    return glMagFilter;\n}\n\nconst magFilterMap: { [key: string]: GLTextureMagFilter } = {\n    nearest: 'NEAREST',\n    linear: 'LINEAR',\n};","import { Buffer } from '@feng3d/render-api';\nimport { TransformFeedback } from '@feng3d/render-api';\nimport { getGLBuffer } from './getGLBuffer';\n\nexport function getGLTransformFeedback(gl: WebGLRenderingContext, transformFeedback: TransformFeedback)\n{\n    let webGLTransformFeedback = gl._transforms.get(transformFeedback);\n\n    if (webGLTransformFeedback) return webGLTransformFeedback;\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        webGLTransformFeedback = gl.createTransformFeedback();\n        gl._transforms.set(transformFeedback, webGLTransformFeedback);\n\n        gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, webGLTransformFeedback);\n        transformFeedback.bindBuffers.forEach((v) =>\n        {\n            const { index, data } = v;\n            const buffer = Buffer.getBuffer(data.buffer);\n\n            const webGLBuffer = getGLBuffer(gl, buffer, 'TRANSFORM_FEEDBACK_BUFFER', 'STREAM_COPY');\n\n            gl.bindBufferBase(gl.TRANSFORM_FEEDBACK_BUFFER, index, webGLBuffer);\n        });\n\n        // 移除可能绑定在GL上的回写数据缓冲区\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    }\n\n    return webGLTransformFeedback;\n}\n\nexport function deleteTransformFeedback(gl: WebGLRenderingContext, transformFeedback: TransformFeedback)\n{\n    const webGLTransformFeedback = gl._transforms.get(transformFeedback);\n\n    if (!webGLTransformFeedback) return;\n\n    gl._transforms.delete(transformFeedback);\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        gl.deleteTransformFeedback(webGLTransformFeedback);\n    }\n}\n","/**\n * 用于标记 GL 提交次数。更改时触发回调。\n */\nexport const _GL_Submit_Times = '_GL_Submit_Times';","import { RenderPassObject, OcclusionQuery, RenderPass } from '@feng3d/render-api';\n\nimport '../data/polyfills/OcclusionQuery';\n\nexport function getGLRenderOcclusionQuery(gl: WebGLRenderingContext, renderObjects?: readonly RenderPassObject[])\n{\n    if (!renderObjects) return defautRenderOcclusionQuery;\n    if (!(gl instanceof WebGL2RenderingContext)) return defautRenderOcclusionQuery;\n    let renderOcclusionQuery: GLRenderOcclusionQuery = renderObjects['_GLRenderOcclusionQuery'];\n\n    if (renderOcclusionQuery) return renderOcclusionQuery;\n\n    const occlusionQueryObjects: OcclusionQuery[] = renderObjects.filter((cv) => cv.__type__ === 'OcclusionQuery') as any;\n\n    if (occlusionQueryObjects.length === 0)\n    {\n        renderObjects['_GLRenderOcclusionQuery'] = defautRenderOcclusionQuery;\n\n        return defautRenderOcclusionQuery;\n    }\n\n    /**\n     * 初始化。\n     */\n    const init = () =>\n    {\n        occlusionQueryObjects.forEach((v, i) =>\n        {\n            v._step = getGLOcclusionQueryStep(gl, v);\n        });\n    };\n\n    /**\n     * 查询结果。\n     */\n    const resolve = (renderPass: RenderPass) =>\n    {\n        const results = occlusionQueryObjects.map((v) => v._step.resolve());\n\n        Promise.all(results).then((v) =>\n        {\n            renderPass.onOcclusionQuery?.(occlusionQueryObjects, v);\n        });\n    };\n\n    renderObjects['_GLRenderOcclusionQuery'] = renderOcclusionQuery = { init, resolve };\n\n    return renderOcclusionQuery;\n}\n\ninterface GLRenderOcclusionQuery\n{\n    init: () => void\n    resolve: (renderPass: RenderPass) => void\n}\n\nconst defautRenderOcclusionQuery = { init: () =>\n{ }, resolve: () =>\n{ } };\n\nexport function getGLOcclusionQueryStep(gl: WebGL2RenderingContext, occlusionQuery: OcclusionQuery)\n{\n    const query: { result?: number } = {};\n    let webGLQuery: WebGLQuery;\n\n    // 开始查询\n    const begin = () =>\n    {\n        webGLQuery = gl.createQuery();\n\n        gl.beginQuery(gl.ANY_SAMPLES_PASSED, webGLQuery);\n    };\n\n    const end = () =>\n    {\n        // 结束查询\n        gl.endQuery(gl.ANY_SAMPLES_PASSED);\n    };\n\n    /**\n     * 获取查询结果。\n     */\n    const resolve = async () =>\n    {\n        if (query.result !== undefined) return query.result;\n\n        if (gl instanceof WebGL2RenderingContext)\n        {\n            const result: number = await new Promise((resolve, reject) =>\n            {\n                (function tick()\n                {\n                    if (!gl.getQueryParameter(webGLQuery, gl.QUERY_RESULT_AVAILABLE))\n                    {\n                        // A query's result is never available in the same frame\n                        // the query was issued.  Try in the next frame.\n                        requestAnimationFrame(tick);\n\n                        return;\n                    }\n\n                    const result = query.result = gl.getQueryParameter(webGLQuery, gl.QUERY_RESULT) as number;\n\n                    occlusionQuery.onQuery(result);\n\n                    resolve(result);\n\n                    gl.deleteQuery(webGLQuery);\n                })();\n            });\n\n            return result;\n        }\n\n        return undefined;\n    };\n\n    return { begin, end, resolve } as GLOcclusionQueryStep;\n}\n\n/**\n * 不被遮挡查询步骤。\n */\nexport interface GLOcclusionQueryStep\n{\n    /**\n     * 开始查询\n     */\n    begin: () => void;\n\n    /**\n     * 结束查询\n     */\n    end: () => void;\n\n    /**\n     * 获取查询结果，将获取被赋值新结果的遮挡查询对象。\n     */\n    resolve: () => Promise<number>\n}","import { PrimitiveTopology } from '@feng3d/render-api';\n\nexport function getGLDrawMode(topology: PrimitiveTopology): GLDrawMode\n{\n    let drawMode = drawModeMap[topology];\n\n    console.assert(!!drawMode, `WebGL 不支持参数 IPrimitiveTopology ${topology} !`);\n\n    drawMode = drawMode || topology as any;\n\n    return drawMode;\n}\n\nconst drawModeMap: { [key: string]: GLDrawMode } = {\n    'point-list': 'POINTS',\n    'line-list': 'LINES',\n    'line-strip': 'LINE_STRIP',\n    'triangle-list': 'TRIANGLES',\n    'triangle-strip': 'TRIANGLE_STRIP',\n    LINE_LOOP: 'LINE_LOOP',\n    TRIANGLE_FAN: 'TRIANGLE_FAN',\n};\n\n/**\n * 渲染模式，默认 TRIANGLES，每三个顶点绘制一个三角形。\n *\n * * POINTS 绘制单个点。\n * * LINE_LOOP 绘制循环连线。\n * * LINE_STRIP 绘制连线\n * * LINES 每两个顶点绘制一条线段。\n * * TRIANGLES 每三个顶点绘制一个三角形。\n * * TRIANGLE_STRIP 绘制三角形条带。\n * * TRIANGLE_FAN  绘制三角扇形。\n *\n * A GLenum specifying the type primitive to render. Possible values are:\n *\n * * gl.POINTS: Draws a single dot.\n * * gl.LINE_STRIP: Draws a straight line to the next vertex.\n * * gl.LINE_LOOP: Draws a straight line to the next vertex, and connects the last vertex back to the first.\n * * gl.LINES: Draws a line between a pair of vertices.\n * * gl.TRIANGLE_STRIP\n * * gl.TRIANGLE_FAN\n * * gl.TRIANGLES: Draws a triangle for a group of three vertices.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/drawElements\n */\nexport type GLDrawMode = 'POINTS' | 'LINE_STRIP' | 'LINE_LOOP' | 'LINES' | 'TRIANGLE_STRIP' | 'TRIANGLE_FAN' | 'TRIANGLES';\n","import { DrawIndexed, IndicesDataTypes } from '@feng3d/render-api';\nimport { GLDrawMode } from '../../caches/getGLDrawMode';\n\nexport function runDrawIndexed(gl: WebGLRenderingContext, drawMode: GLDrawMode, indices: IndicesDataTypes, drawIndexed: DrawIndexed)\n{\n    const type = indices.BYTES_PER_ELEMENT === 2 ? gl.UNSIGNED_SHORT : gl.UNSIGNED_INT;\n    //\n    const indexCount = drawIndexed.indexCount;\n    const firstIndex = drawIndexed.firstIndex || 0;\n    const instanceCount = drawIndexed.instanceCount || 1;\n    //\n    const offset = firstIndex * indices.BYTES_PER_ELEMENT + indices.byteOffset;\n\n    //\n    if (instanceCount > 1)\n    {\n        if (gl instanceof WebGL2RenderingContext)\n        {\n            gl.drawElementsInstanced(gl[drawMode], indexCount, type, offset, instanceCount);\n        }\n        else\n        {\n            const extension = gl.getExtension('ANGLE_instanced_arrays');\n\n            extension.drawElementsInstancedANGLE(gl[drawMode], indexCount, type, offset, instanceCount);\n        }\n    }\n    else\n    {\n        gl.drawElements(gl[drawMode], indexCount, type, offset);\n    }\n}\n","import { DrawVertex } from '@feng3d/render-api';\nimport { GLDrawMode } from '../../caches/getGLDrawMode';\n\nexport function runDrawVertex(gl: WebGLRenderingContext, drawMode: GLDrawMode, drawArrays: DrawVertex)\n{\n    //\n    const vertexCount = drawArrays.vertexCount;\n    const firstVertex = drawArrays.firstVertex || 0;\n    const instanceCount = drawArrays.instanceCount || 1;\n\n    if (instanceCount > 1)\n    {\n        if (gl instanceof WebGL2RenderingContext)\n        {\n            gl.drawArraysInstanced(gl[drawMode], firstVertex, vertexCount, instanceCount);\n        }\n        else\n        {\n            const extension = gl.getExtension('ANGLE_instanced_arrays');\n\n            extension.drawArraysInstancedANGLE(gl[drawMode], firstVertex, vertexCount, instanceCount);\n        }\n    }\n    else\n    {\n        gl.drawArrays(gl[drawMode], firstVertex, vertexCount);\n    }\n}\n\n","import { CullFace, FrontFace, PrimitiveState } from '@feng3d/render-api';\n\nconst cullFaceMap = Object.freeze({\n    FRONT_AND_BACK: 'FRONT_AND_BACK',\n    none: 'BACK', // 不会开启剔除面功能，什么值无所谓。\n    front: 'FRONT',\n    back: 'BACK',\n});\n\nconst frontFaceMap = Object.freeze({ ccw: 'CCW', cw: 'CW' });\n\nexport function runPrimitiveState(gl: WebGLRenderingContext, primitive?: PrimitiveState)\n{\n    const cullFace: CullFace = primitive?.cullFace || 'none';\n    const frontFace: FrontFace = primitive?.frontFace || 'ccw';\n\n    if (cullFace !== 'none')\n    {\n        const glCullMode = cullFaceMap[cullFace];\n\n        console.assert(!!glCullMode, `接收到错误值，请从 ${Object.keys(cullFaceMap).toString()} 中取值！`);\n\n        const glFrontFace = frontFaceMap[frontFace];\n\n        console.assert(!!glFrontFace, `接收到错误 IFrontFace 值，请从 ${Object.keys(frontFaceMap).toString()} 中取值！`);\n\n        //\n        gl.enable(gl.CULL_FACE);\n        gl.cullFace(gl[glCullMode]);\n        gl.frontFace(gl[glFrontFace]);\n    }\n    else\n    {\n        gl.disable(gl.CULL_FACE);\n    }\n}\n\n","import { DepthStencilState } from '@feng3d/render-api';\nimport { getGLCompareFunction } from '../runs/getGLCompareFunction';\n\nexport function runDepthState(gl: WebGLRenderingContext, depthStencil?: DepthStencilState, hasDepthAttachment = true)\n{\n    // 如果没有深度附件，必须关闭深度检测\n    if (!hasDepthAttachment)\n    {\n        gl.disable(gl.DEPTH_TEST);\n\n        return;\n    }\n\n    if (depthStencil && (depthStencil.depthWriteEnabled || depthStencil.depthCompare !== 'always'))\n    {\n        const depthCompare = getGLCompareFunction(depthStencil.depthCompare ?? 'less');\n        const depthWriteEnabled = depthStencil.depthWriteEnabled ?? true;\n\n        //\n        gl.enable(gl.DEPTH_TEST);\n        //\n        gl.depthFunc(gl[depthCompare]);\n        gl.depthMask(depthWriteEnabled);\n\n        //\n        if (depthStencil.depthBias || depthStencil.depthBiasSlopeScale)\n        {\n            const factor = depthStencil.depthBiasSlopeScale ?? 0;\n            const units = depthStencil.depthBias ?? 0;\n\n            //\n            gl.enable(gl.POLYGON_OFFSET_FILL);\n            gl.polygonOffset(factor, units);\n        }\n        else\n        {\n            gl.disable(gl.POLYGON_OFFSET_FILL);\n        }\n    }\n    else\n    {\n        gl.disable(gl.DEPTH_TEST);\n    }\n}\n\n","import { BlendComponent, BlendFactor, BlendOperation, BlendState, ColorTargetState, defaultBlendComponent } from '@feng3d/render-api';\n\nexport function runColorTargetStates(gl: WebGLRenderingContext, targets?: readonly ColorTargetState[])\n{\n    //\n    const colorMask = targets?.[0]?.writeMask || [true, true, true, true];\n\n    gl.colorMask(colorMask[0], colorMask[1], colorMask[2], colorMask[3]);\n\n    //\n    const blend = targets?.[0]?.blend;\n\n    if (blend)\n    {\n        const color: BlendComponent = blend.color;\n        const alpha: BlendComponent = blend.alpha;\n\n        const colorOperation: GLBlendEquation = getGLBlendEquation(color?.operation ?? defaultBlendComponent.operation);\n        const colorSrcFactor: GLBlendFactor = getGLBlendFactor(color?.srcFactor ?? defaultBlendComponent.srcFactor, color?.operation);\n        const colorDstFactor: GLBlendFactor = getGLBlendFactor(color?.dstFactor ?? defaultBlendComponent.dstFactor, color?.operation);\n        //\n        const alphaOperation: GLBlendEquation = getGLBlendEquation(alpha?.operation) || colorOperation;\n        const alphaSrcFactor: GLBlendFactor = getGLBlendFactor(alpha?.srcFactor, color?.operation) || colorSrcFactor;\n        const alphaDstFactor: GLBlendFactor = getGLBlendFactor(alpha?.dstFactor, color?.operation) || colorDstFactor;\n\n        // 当混合系数用到了混合常量值时设置混合常量值。\n        const constantColor = BlendState.getBlendConstantColor(blend);\n\n        if (constantColor)\n        {\n            const constantColor = blend.constantColor ?? [0, 0, 0, 0];\n\n            gl.blendColor(constantColor[0], constantColor[1], constantColor[2], constantColor[3]);\n        }\n\n        //\n        gl.enable(gl.BLEND);\n        gl.blendEquationSeparate(gl[colorOperation], gl[alphaOperation]);\n        gl.blendFuncSeparate(gl[colorSrcFactor], gl[colorDstFactor], gl[alphaSrcFactor], gl[alphaDstFactor]);\n    }\n    else\n    {\n        gl.disable(gl.BLEND);\n    }\n}\n\nfunction getGLBlendEquation(operation?: BlendOperation)\n{\n    if (!operation) return undefined;\n\n    const glBlendEquation: GLBlendEquation = operationMap[operation];\n\n    console.assert(!!glBlendEquation, `接收到错误值，请从 ${Object.keys(operationMap).toString()} 中取值！`);\n\n    return glBlendEquation;\n}\n\nconst operationMap: { [key: string]: GLBlendEquation } = {\n    add: 'FUNC_ADD',\n    subtract: 'FUNC_SUBTRACT',\n    'reverse-subtract': 'FUNC_REVERSE_SUBTRACT',\n    min: 'MIN',\n    max: 'MAX',\n};\n\nfunction getGLBlendFactor(blendFactor: BlendFactor, operation: BlendOperation)\n{\n    if (!blendFactor) return undefined;\n\n    if (operation === 'max' || operation === 'min') blendFactor = 'one';\n\n    const glBlendFactor: GLBlendFactor = blendFactorMap[blendFactor];\n\n    console.assert(!!glBlendFactor, `接收到错误值，请从 ${Object.keys(blendFactorMap).toString()} 中取值！`);\n\n    return glBlendFactor;\n}\n\nconst blendFactorMap: { [key: string]: GLBlendFactor } = {\n    zero: 'ZERO',\n    one: 'ONE',\n    src: 'SRC_COLOR',\n    'one-minus-src': 'ONE_MINUS_SRC_COLOR',\n    'src-alpha': 'SRC_ALPHA',\n    'one-minus-src-alpha': 'ONE_MINUS_SRC_ALPHA',\n    dst: 'DST_COLOR',\n    'one-minus-dst': 'ONE_MINUS_DST_COLOR',\n    'dst-alpha': 'DST_ALPHA',\n    'one-minus-dst-alpha': 'ONE_MINUS_DST_ALPHA',\n    'src-alpha-saturated': 'SRC_ALPHA_SATURATE',\n    constant: 'CONSTANT_COLOR',\n    'one-minus-constant': 'ONE_MINUS_CONSTANT_COLOR',\n};\n\n/**\n * 混合因子（R分量系数，G分量系数，B分量系数）\n *\n * 混合颜色的公式可以这样描述：color(RGBA) = (sourceColor * sfactor) + (destinationColor * dfactor)。这里的 RGBA 值均在0与1之间。\n *\n * The formula for the blending color can be described like this: color(RGBA) = (sourceColor * sfactor) + (destinationColor * dfactor). The RBGA values are between 0 and 1.\n *\n * * `ZERO` Factor: (0,0,0,0); 把所有颜色都乘以0。\n * * `ONE` Factor: (1,1,1,1); 把所有颜色都乘以1。\n * * `SRC_COLOR` Factor: (Rs, Gs, Bs, As); 将所有颜色乘以源颜色。\n * * `ONE_MINUS_SRC_COLOR` Factor: (1-Rs, 1-Gs, 1-Bs, 1-As); 将所有颜色乘以1减去每个源颜色。\n * * `DST_COLOR` Factor: (Rd, Gd, Bd, Ad); 将所有颜色乘以目标颜色。\n * * `ONE_MINUS_DST_COLOR` Factor: (1-Rd, 1-Gd, 1-Bd, 1-Ad); 将所有颜色乘以1减去每个目标颜色。\n * * `SRC_ALPHA` Factor: (As, As, As, As); 将所有颜色乘以源alpha值。\n * * `ONE_MINUS_SRC_ALPHA` Factor: (1-As, 1-As, 1-As, 1-As); 将所有颜色乘以1减去源alpha值。\n * * `DST_ALPHA` Factor: (Ad, Ad, Ad, Ad); 将所有颜色乘以目标alpha值。\n * * `ONE_MINUS_DST_ALPHA` Factor: (1-Ad, 1-Ad, 1-Ad, 1-Ad); 将所有颜色乘以1减去目标alpha值。\n * * `CONSTANT_COLOR` Factor: (Rc, Gc, Bc, Ac); 将所有颜色乘以一个常数颜色。\n * * `ONE_MINUS_CONSTANT_COLOR` Factor: (1-Rc, 1-Gc, 1-Bc, 1-Ac); 所有颜色乘以1减去一个常数颜色。\n * * `CONSTANT_ALPHA` Factor: (Ac, Ac, Ac, Ac); 将所有颜色乘以一个常量alpha值。\n * * `ONE_MINUS_CONSTANT_ALPHA` Factor: (1-Ac, 1-Ac, 1-Ac, 1-Ac); 将所有颜色乘以1减去一个常数alpha值。\n * * `SRC_ALPHA_SATURATE` Factor: (min(As, 1 - Ad), min(As, 1 - Ad), min(As, 1 - Ad), 1); 将RGB颜色乘以源alpha值与1减去目标alpha值的较小值。alpha值乘以1。\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendFunc\n */\ntype GLBlendFactor = 'ZERO' | 'ONE' | 'SRC_COLOR' | 'ONE_MINUS_SRC_COLOR' | 'DST_COLOR' | 'ONE_MINUS_DST_COLOR' | 'SRC_ALPHA' | 'ONE_MINUS_SRC_ALPHA' | 'DST_ALPHA' | 'ONE_MINUS_DST_ALPHA' | 'SRC_ALPHA_SATURATE' | 'CONSTANT_COLOR' | 'ONE_MINUS_CONSTANT_COLOR' | 'CONSTANT_ALPHA' | 'ONE_MINUS_CONSTANT_ALPHA';\n\n/**\n * 混合方法\n *\n * * FUNC_ADD 源 + 目标\n * * FUNC_SUBTRACT 源 - 目标\n * * FUNC_REVERSE_SUBTRACT 目标 - 源\n * * MIN 源与目标的最小值，在 WebGL 2 中可使用。在 WebGL 1 时，自动使用 EXT_blend_minmax 扩展中 MIN_EXT 值。\n * * MAX 源与目标的最大值，在 WebGL 2 中可使用。在 WebGL 1 时，自动使用 EXT_blend_minmax 扩展中 MAX_EXT 值。\n *\n * A GLenum specifying how source and destination colors are combined. Must be either:\n *\n * * gl.FUNC_ADD: source + destination (default value)\n * * gl.FUNC_SUBTRACT: source - destination\n * * gl.FUNC_REVERSE_SUBTRACT: destination - source\n *\n * When using the EXT_blend_minmax extension:\n *\n * * ext.MIN_EXT: Minimum of source and destination\n * * ext.MAX_EXT: Maximum of source and destination\n *\n * When using a WebGL 2 context, the following values are available additionally:\n *\n * * gl.MIN: Minimum of source and destination\n * * gl.MAX: Maximum of source and destination\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendEquation\n */\ntype GLBlendEquation = 'FUNC_ADD' | 'FUNC_SUBTRACT' | 'FUNC_REVERSE_SUBTRACT' | 'MIN' | 'MAX';\n","import { RenderPipeline } from '@feng3d/render-api';\nimport { getGLProgram } from '../caches/getGLProgram';\nimport { runColorTargetStates } from './runColorTargetStates';\n\nexport function runProgram(gl: WebGLRenderingContext, material: RenderPipeline)\n{\n    const program = getGLProgram(gl, material);\n\n    gl.useProgram(program);\n\n    //\n    runColorTargetStates(gl, material.fragment.targets);\n}\n\n","import { CompareFunction, DepthStencilState, StencilOperation } from '@feng3d/render-api';\n\nexport function runStencilState(gl: WebGLRenderingContext, depthStencil?: DepthStencilState)\n{\n    const { stencilFront, stencilBack } = { ...depthStencil };\n\n    //\n    if (stencilFront || stencilBack)\n    {\n        const ref: number = depthStencil.stencilReference ?? 0;\n        const readMask = depthStencil.stencilReadMask ?? 0xFFFFFFFF;\n        const writeMask = depthStencil.stencilWriteMask ?? 0xFFFFFFFF;\n\n        gl.enable(gl.STENCIL_TEST);\n\n        if (stencilFront)\n        {\n            const func = getGLStencilFunc(stencilFront.compare ?? 'always');\n            const fail = getGLStencilOp(stencilFront.failOp);\n            const zfail = getGLStencilOp(stencilFront.depthFailOp);\n            const zpass = getGLStencilOp(stencilFront.passOp);\n\n            //\n            gl.stencilFuncSeparate(gl.FRONT, gl[func], ref, readMask);\n            gl.stencilOpSeparate(gl.FRONT, gl[fail], gl[zfail], gl[zpass]);\n            gl.stencilMaskSeparate(gl.FRONT, writeMask);\n        }\n        if (stencilBack)\n        {\n            const func = getGLStencilFunc(stencilBack.compare ?? 'always');\n            const fail = getGLStencilOp(stencilBack.failOp);\n            const zfail = getGLStencilOp(stencilBack.depthFailOp);\n            const zpass = getGLStencilOp(stencilBack.passOp);\n\n            //\n            gl.stencilFuncSeparate(gl.BACK, gl[func], ref, readMask);\n            gl.stencilOpSeparate(gl.BACK, gl[fail], gl[zfail], gl[zpass]);\n            gl.stencilMaskSeparate(gl.BACK, writeMask);\n        }\n    }\n    else\n    {\n        gl.disable(gl.STENCIL_TEST);\n    }\n}\n\nfunction getGLStencilFunc(compare: CompareFunction)\n{\n    const stencilFunc: GLStencilFunc = compareMap[compare];\n\n    return stencilFunc;\n}\n\nconst compareMap: { [key: string]: GLStencilFunc } = {\n    never: 'NEVER',\n    less: 'LESS',\n    equal: 'EQUAL',\n    'less-equal': 'LEQUAL',\n    greater: 'GREATER',\n    'not-equal': 'NOTEQUAL',\n    'greater-equal': 'GEQUAL',\n    always: 'ALWAYS',\n};\n\n/**\n * A GLenum specifying the test function. The default function is gl.ALWAYS.\n *\n * * `NEVER` 总是不通过。\n * * `LESS` 如果 (ref & mask) <  (stencil & mask) 则通过。\n * * `EQUAL` 如果 (ref & mask) = (stencil & mask) 则通过。\n * * `LEQUAL` 如果 (ref & mask) <= (stencil & mask) 则通过。\n * * `GREATER` 如果 (ref & mask) > (stencil & mask) 则通过。\n * * `NOTEQUAL` 如果 (ref & mask) != (stencil & mask) 则通过。\n * * `GEQUAL` 如果 (ref & mask) >= (stencil & mask) 则通过。\n * * `ALWAYS` 总是通过。\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilFunc\n */\ntype GLStencilFunc = 'NEVER' | 'LESS' | 'EQUAL' | 'LEQUAL' | 'GREATER' | 'NOTEQUAL' | 'GEQUAL' | 'ALWAYS';\n\nfunction getGLStencilOp(stencilOperation?: StencilOperation)\n{\n    const glStencilOp: GLStencilOp = stencilOperationMap[stencilOperation];\n\n    return glStencilOp;\n}\nconst stencilOperationMap: { [key: string]: GLStencilOp } = {\n    keep: 'KEEP',\n    zero: 'ZERO',\n    replace: 'REPLACE',\n    invert: 'INVERT',\n    'increment-clamp': 'INCR',\n    'decrement-clamp': 'DECR',\n    'increment-wrap': 'INCR_WRAP',\n    'decrement-wrap': 'DECR_WRAP',\n};\n\n/**\n * The WebGLRenderingContext.stencilOp() method of the WebGL API sets both the front and back-facing stencil test actions.\n *\n * * `KEEP` 保持当前值。\n * * `ZERO` 设置模板缓冲值为0\n * * `REPLACE` 将模板缓冲区的值设置为WebGLRenderingContext.stencilFunc()指定的参考值。\n * * `INCR` 增加当前模板缓冲区的值。最大到可表示的无符号值的最大值。\n * * `INCR_WRAP` 增加当前模板缓冲区的值。当增加最大的可表示无符号值时，将模板缓冲区值包装为零。\n * * `DECR` 递减当前模板缓冲区的值。最小为0。\n * * `DECR_WRAP` 递减当前模板缓冲区的值。当模板缓冲区值减为0时，将模板缓冲区值包装为可表示的最大无符号值。\n * * `INVERT` 按位反转当前模板缓冲区值。\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/stencilOp\n */\ntype GLStencilOp = 'KEEP' | 'ZERO' | 'REPLACE' | 'INCR' | 'INCR_WRAP' | 'DECR' | 'DECR_WRAP' | 'INVERT';\n","import { RenderPipeline } from '@feng3d/render-api';\nimport { runDepthState } from '../runDepthState';\nimport { runProgram } from '../runProgram';\nimport { runStencilState } from '../runStencilState';\n\nexport function runRenderPipeline(gl: WebGLRenderingContext, renderPipeline: RenderPipeline, hasDepthAttachment = true)\n{\n    runProgram(gl, renderPipeline);\n\n    runDepthState(gl, renderPipeline.depthStencil, hasDepthAttachment);\n    runStencilState(gl, renderPipeline.depthStencil);\n}\n\n","import { ScissorRect } from '@feng3d/render-api';\n\nexport function runScissor(gl: WebGLRenderingContext, attachmentSize: { width: number, height: number }, scissor: ScissorRect)\n{\n    if (scissor)\n    {\n        const isYup = scissor.isYup ?? true;\n        const x = scissor.x ?? 0;\n        let y = scissor.y ?? 0;\n        const width = scissor.width ?? attachmentSize.width;\n        const height = scissor.height ?? attachmentSize.height;\n\n        if (!isYup)\n        {\n            y = attachmentSize.height - y - height;\n        }\n\n        gl.enable(gl.SCISSOR_TEST);\n        gl.scissor(x, y, width, height);\n    }\n    else\n    {\n        gl.disable(gl.SCISSOR_TEST);\n    }\n}\n\n","import { effect, reactive, UnReadonly } from '@feng3d/reactivity';\nimport { Buffer, BufferBinding, BufferBindingInfo } from '@feng3d/render-api';\n\n/**\n *\n * @param uniformBlock\n * @param uniformData\n *\n * @see https://learnopengl-cn.readthedocs.io/zh/latest/04%20Advanced%20OpenGL/08%20Advanced%20GLSL/#uniform_1\n */\n// 在文件顶部添加Map声明\nconst bufferBindingInfoMap = new WeakMap<BufferBinding, BufferBindingInfo>();\n\nexport function updateBufferBinding(bufferBindingInfo: BufferBindingInfo, uniformData: BufferBinding)\n{\n    // 使用Map替代属性访问\n    if (bufferBindingInfoMap.has(uniformData))\n    {\n        const preVariableInfo = bufferBindingInfoMap.get(uniformData);\n\n        if (preVariableInfo.size !== bufferBindingInfo.size)\n        {\n            console.warn(`updateBufferBinding 出现一份数据对应多个 variableInfo`, { uniformData, bufferBindingInfo, preVariableInfo });\n        }\n\n        return;\n    }\n\n    // 使用Map存储数据\n    bufferBindingInfoMap.set(uniformData, bufferBindingInfo);\n\n    const size = bufferBindingInfo.size;\n    // 是否存在默认值。\n    const hasDefautValue = !!uniformData.bufferView;\n\n    if (!hasDefautValue)\n    {\n        (uniformData as UnReadonly<BufferBinding>).bufferView = new Uint8Array(size);\n    }\n    else\n    {\n        console.assert(uniformData.bufferView.byteLength >= size, `uniformData.bufferView 统一块数据提供数据尺寸不能小于实际尺寸！`);\n    }\n\n    //\n    const buffer = Buffer.getBuffer(uniformData.bufferView.buffer);\n    const offset = uniformData.bufferView.byteOffset;\n\n    const r_uniformData = reactive(uniformData);\n\n    //\n    bufferBindingInfo.items.forEach((v) =>\n    {\n        const { paths, offset: itemInfoOffset, size: itemInfoSize, Cls } = v;\n\n        // 使用 effect 替代 watcher，与 WebGPU 保持一致\n        effect(() =>\n        {\n            let value: any = uniformData.value;\n            let r_value: any = r_uniformData.value; // 监听\n\n            if (value === undefined) return;\n\n            for (let i = 0; i < paths.length; i++)\n            {\n                value = value[paths[i]];\n                r_value = r_value[paths[i]]; // 监听\n                if (value === undefined)\n                {\n                    if (!hasDefautValue)\n                    {\n                        console.warn(`没有找到 统一块变量属性 ${paths.join('.')} 的值！`);\n                    }\n\n                    return;\n                }\n            }\n\n            let data: Int16Array | Int32Array | Uint32Array | Float32Array;\n\n            if (typeof value === 'number')\n            {\n                data = new Cls([value]);\n            }\n            else if (value.constructor.name !== Cls.name)\n            {\n                data = new Cls(value as ArrayLike<number>);\n            }\n            else\n            {\n                data = value as any;\n            }\n\n            const writeBuffers = buffer.writeBuffers ?? [];\n\n            writeBuffers.push({ data: data, bufferOffset: offset + itemInfoOffset, size: Math.min(itemInfoSize, data.byteLength) / data.BYTES_PER_ELEMENT });\n            reactive(buffer).writeBuffers = writeBuffers;\n        });\n    });\n}\n","import { Sampler } from '@feng3d/render-api';\nimport { getGLSampler, getIGLTextureMagFilter, getIGLTextureMinFilter, getIGLTextureWrap, GLTextureMagFilter, GLTextureMinFilter, GLTextureWrap } from '../caches/getGLSampler';\nimport { GLTextureTarget } from '../caches/getGLTextureTarget';\n\ndeclare global\n{\n    interface WebGLTexture\n    {\n        minFilter?: GLTextureMinFilter,\n        magFilter?: GLTextureMagFilter,\n        wrapS?: GLTextureWrap,\n        wrapT?: GLTextureWrap,\n        wrapR?: GLTextureWrap,\n        maxAnisotropy?: number,\n        lodMinClamp?: number;\n        lodMaxClamp?: number;\n    }\n}\n\n/**\n * 设置采样参数\n */\nexport function runSampler(gl: WebGLRenderingContext, textureTarget: GLTextureTarget, webGLTexture: WebGLTexture, sampler: Sampler, textureID: number)\n{\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        const webGLSampler = getGLSampler(gl, sampler);\n\n        gl.bindSampler(textureID, webGLSampler);\n    }\n    else\n    {\n        const minFilter = getIGLTextureMinFilter(sampler.minFilter, sampler.mipmapFilter);\n        const magFilter = getIGLTextureMagFilter(sampler.magFilter);\n        const wrapS = getIGLTextureWrap(sampler.addressModeU);\n        const wrapT = getIGLTextureWrap(sampler.addressModeV);\n\n        // 设置纹理参数\n        if (webGLTexture.minFilter !== minFilter)\n        {\n            gl.texParameteri(gl[textureTarget], gl.TEXTURE_MIN_FILTER, gl[minFilter]);\n            webGLTexture.minFilter = minFilter;\n        }\n        if (webGLTexture.magFilter !== magFilter)\n        {\n            gl.texParameteri(gl[textureTarget], gl.TEXTURE_MAG_FILTER, gl[magFilter]);\n            webGLTexture.magFilter = magFilter;\n        }\n        if (webGLTexture.wrapS !== wrapS)\n        {\n            gl.texParameteri(gl[textureTarget], gl.TEXTURE_WRAP_S, gl[wrapS]);\n            webGLTexture.wrapS = wrapS;\n        }\n        if (webGLTexture.wrapT !== wrapT)\n        {\n            gl.texParameteri(gl[textureTarget], gl.TEXTURE_WRAP_T, gl[wrapT]);\n            webGLTexture.wrapT = wrapT;\n        }\n    }\n\n    //\n    const maxAnisotropy = sampler?.maxAnisotropy || 1;\n\n    if (webGLTexture.maxAnisotropy !== maxAnisotropy)\n    {\n        const extension = gl.getExtension('EXT_texture_filter_anisotropic');\n\n        if (extension)\n        {\n            gl.texParameterf(gl[textureTarget], extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(maxAnisotropy, gl._capabilities.maxAnisotropy));\n        }\n        webGLTexture.maxAnisotropy = maxAnisotropy;\n    }\n}\n\n","import { Sampler } from '@feng3d/render-api';\nimport { UniformItemInfo } from '../caches/getGLProgram';\nimport { getGLTextureTarget } from '../caches/getGLTextureTarget';\nimport { SamplerTexture } from '../data/SamplerTexture';\nimport { getGLTexture } from '../internal';\nimport { runSampler } from './runSampler';\n\nexport function runSamplerTexture(gl: WebGLRenderingContext, uniformInfo: UniformItemInfo, samplerTexture: SamplerTexture)\n{\n    const { texture, sampler } = samplerTexture;\n    const { location, textureID } = uniformInfo;\n\n    const textureTarget = getGLTextureTarget(texture.descriptor.dimension);\n\n    // 设置纹理所在采样编号\n    gl.uniform1i(location, textureID);\n    //\n    const webGLTexture = getGLTexture(gl, texture);\n\n    gl.activeTexture(gl[`TEXTURE${textureID}`]);\n    // 绑定纹理\n    gl.bindTexture(gl[textureTarget], webGLTexture);\n\n    // 检查纹理是否只有单一 mip level，如果是则调整采样器配置\n    const adjustedSampler = adjustSamplerForTexture(texture, sampler);\n\n    // 运行采样器\n    runSampler(gl, textureTarget, webGLTexture, adjustedSampler, textureID);\n\n    return webGLTexture;\n}\n\n// 用于追踪已警告的纹理，避免重复警告\nconst warnedTextures = new WeakSet<SamplerTexture['texture']>();\n\n/**\n * 根据纹理的 mip level 数量调整采样器配置\n * 当纹理只有单一 mip level 时，忽略 mipmapFilter 并限制 lodMaxClamp\n */\nfunction adjustSamplerForTexture(texture: SamplerTexture['texture'], sampler: Sampler): Sampler\n{\n    const descriptor = texture.descriptor;\n    const hasMipmap = descriptor.generateMipmap || (descriptor.mipLevelCount && descriptor.mipLevelCount > 1);\n\n    if (!hasMipmap && sampler.mipmapFilter)\n    {\n        // 只警告一次\n        if (!warnedTextures.has(texture))\n        {\n            warnedTextures.add(texture);\n            console.warn(\n                `[WebGL] 纹理没有 mipmap（generateMipmap: false），但采样器设置了 mipmapFilter: '${sampler.mipmapFilter}'。`\n                + ` 已自动忽略 mipmapFilter 并将 lodMaxClamp 设为 0，以避免黑屏。`\n                + ` 建议：设置 generateMipmap: true 或移除 mipmapFilter 配置。`,\n            );\n        }\n\n        return {\n            ...sampler,\n            mipmapFilter: undefined,\n            lodMaxClamp: 0,\n        };\n    }\n\n    return sampler;\n}\n\n","import { BufferBinding } from '@feng3d/render-api';\nimport { UniformItemInfo } from '../caches/getGLProgram';\nimport { GLUniformBufferType } from '../const/GLUniformType';\n\n/**\n * 设置环境Uniform数据\n */\nexport function runUniform(gl: WebGLRenderingContext, type: GLUniformBufferType, uniformInfo: UniformItemInfo, bufferBinding: BufferBinding)\n{\n    let data: any = bufferBinding.value;\n\n    if (typeof data === 'number')\n    {\n        data = [data];\n    }\n    else if (data.toArray)\n    {\n        data = data.toArray();\n    }\n    const location = uniformInfo.location;\n\n    switch (type)\n    {\n        case 'BOOL':\n        case 'INT':\n            gl.uniform1iv(location, data);\n            break;\n        case 'BOOL_VEC2':\n        case 'INT_VEC2':\n            gl.uniform2iv(location, data);\n            break;\n        case 'BOOL_VEC3':\n        case 'INT_VEC3':\n            gl.uniform3iv(location, data);\n            break;\n        case 'BOOL_VEC4':\n        case 'INT_VEC4':\n            gl.uniform4iv(location, data);\n            break;\n        case 'FLOAT':\n            gl.uniform1fv(location, [data]);\n            break;\n        case 'FLOAT_VEC2':\n            gl.uniform2fv(location, data);\n            break;\n        case 'FLOAT_VEC3':\n            gl.uniform3fv(location, data);\n            break;\n        case 'FLOAT_VEC4':\n            gl.uniform4fv(location, data);\n            break;\n        case 'FLOAT_MAT2':\n            gl.uniformMatrix2fv(location, false, data);\n            break;\n        case 'FLOAT_MAT3':\n            gl.uniformMatrix3fv(location, false, data);\n            break;\n        case 'FLOAT_MAT4':\n            gl.uniformMatrix4fv(location, false, data);\n            break;\n        case 'UNSIGNED_INT':\n            (gl as any as WebGL2RenderingContext).uniform1uiv(location, data);\n            break;\n        case 'UNSIGNED_INT_VEC2':\n            (gl as any as WebGL2RenderingContext).uniform2uiv(location, data);\n            break;\n        case 'UNSIGNED_INT_VEC3':\n            (gl as any as WebGL2RenderingContext).uniform3uiv(location, data);\n            break;\n        case 'UNSIGNED_INT_VEC4':\n            (gl as any as WebGL2RenderingContext).uniform4uiv(location, data);\n            break;\n        case 'FLOAT_MAT2x3':\n            (gl as any as WebGL2RenderingContext).uniformMatrix2x3fv(location, false, data);\n            break;\n        case 'FLOAT_MAT2x4':\n            (gl as any as WebGL2RenderingContext).uniformMatrix2x4fv(location, false, data);\n            break;\n        case 'FLOAT_MAT3x2':\n            (gl as any as WebGL2RenderingContext).uniformMatrix3x2fv(location, false, data);\n            break;\n        case 'FLOAT_MAT3x4':\n            (gl as any as WebGL2RenderingContext).uniformMatrix3x4fv(location, false, data);\n            break;\n        case 'FLOAT_MAT4x2':\n            (gl as any as WebGL2RenderingContext).uniformMatrix4x2fv(location, false, data);\n            break;\n        case 'FLOAT_MAT4x3':\n            (gl as any as WebGL2RenderingContext).uniformMatrix4x3fv(location, false, data);\n            break;\n        default:\n            console.error(`无法识别的uniform类型 ${uniformInfo.paths} ${type}`);\n    }\n}\n\n","import { UnReadonly } from '@feng3d/reactivity';\nimport { BindingResources, Buffer, BufferBinding, RenderPipeline, Sampler, Texture, TextureView, TypedArray } from '@feng3d/render-api';\nimport { getGLBuffer } from '../../caches/getGLBuffer';\nimport { getGLProgram } from '../../caches/getGLProgram';\nimport { GLUniformBufferType } from '../../const/GLUniformType';\nimport { SamplerTexture } from '../../data/SamplerTexture';\nimport { updateBufferBinding } from '../../utils/updateBufferBinding';\nimport { runSamplerTexture } from '../runSamplerTexture';\nimport { runUniform } from '../runUniform';\n\n/**\n * 检查是否是 TextureView 格式（包含 texture 属性）\n */\nfunction isTextureView(value: any): value is TextureView\n{\n    return value && typeof value === 'object' && 'texture' in value;\n}\n\n/**\n * 检查是否是 Sampler 对象\n */\nfunction isSampler(value: any): value is Sampler\n{\n    return value && typeof value === 'object' && !('texture' in value) && !('value' in value) && !('buffer' in value);\n}\n\n/**\n * 检查是否是 Texture 类型（不是 CanvasTexture）\n */\nfunction isTexture(value: any): value is Texture\n{\n    return value && typeof value === 'object' && 'descriptor' in value;\n}\n\n/**\n * 尝试从展开的格式中获取 SamplerTexture\n * 如果找到 name_texture 和 name，且它们分别是 TextureView 和 Sampler，则合并为 SamplerTexture\n */\nfunction getSamplerTextureFromExpanded(bindingResources: BindingResources, name: string): SamplerTexture | undefined\n{\n    const textureKey = `${name}_texture`;\n    const samplerKey = name;\n\n    const textureValue = bindingResources[textureKey];\n    const samplerValue = bindingResources[samplerKey];\n\n    if (textureValue && samplerValue && isTextureView(textureValue) && isSampler(samplerValue))\n    {\n        // 确保 texture 是 Texture 类型（不是 CanvasTexture）\n        if (isTexture(textureValue.texture))\n        {\n            return {\n                texture: textureValue.texture,\n                sampler: samplerValue,\n            };\n        }\n    }\n\n    return undefined;\n}\n\n/**\n * 激活常量\n */\nexport function runUniforms(gl: WebGLRenderingContext, pipeline: RenderPipeline, bindingResources: BindingResources)\n{\n    const webGLProgram = getGLProgram(gl, pipeline);\n\n    webGLProgram.uniforms.forEach((uniformInfo) =>\n    {\n        const { name, type, items, isTexture, inBlock } = uniformInfo;\n\n        if (inBlock) return;\n\n        items.forEach((v) =>\n        {\n            const { paths } = v;\n\n            let uniformData = bindingResources[paths[0]];\n\n            for (let i = 1; i < paths.length; i++)\n            {\n                uniformData = uniformData[paths[i]];\n            }\n\n            // 如果是纹理，检查 uniformData 是否是有效的 SamplerTexture\n            // 如果不是（undefined 或只是 Sampler），尝试从展开的格式中获取\n            if (isTexture)\n            {\n                const isSamplerTexture = uniformData && typeof uniformData === 'object' && 'texture' in uniformData;\n\n                if (!isSamplerTexture)\n                {\n                    // 尝试从展开的格式中获取\n                    const expandedData = getSamplerTextureFromExpanded(bindingResources, paths[0]);\n\n                    if (expandedData)\n                    {\n                        uniformData = expandedData;\n                    }\n                }\n            }\n\n            if (uniformData === undefined)\n            {\n                console.error(`沒有找到Uniform ${name} 數據！`);\n            }\n\n            if (isTexture)\n            {\n                runSamplerTexture(gl, v, uniformData as SamplerTexture);\n            }\n            else\n            {\n                runUniform(gl, type as GLUniformBufferType, v, uniformData as BufferBinding);\n            }\n        });\n    });\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        webGLProgram.uniformBlocks.forEach((uniformBlock) =>\n        {\n            const { name, index } = uniformBlock;\n            // 优先使用块名查找，如果找不到则尝试使用实例名（首字母小写）\n            let uniformData = bindingResources[name] as TypedArray | BufferBinding;\n\n            if (uniformData === undefined)\n            {\n                const instanceName = name.charAt(0).toLowerCase() + name.slice(1);\n\n                uniformData = bindingResources[instanceName] as TypedArray | BufferBinding;\n            }\n            if (uniformData === undefined)\n            {\n                throw new Error(`没有找到 UniformBlock \"${name}\" 的数据，请检查 bindingResources 中是否包含 \"${name}\" 或 \"${name.charAt(0).toLowerCase() + name.slice(1)}\" 键。`);\n            }\n\n            //\n            let typedArray = uniformData as TypedArray;\n\n            if (!(typedArray.buffer && typedArray.BYTES_PER_ELEMENT))\n            {\n                const bufferBinding = uniformData as BufferBinding;\n\n                updateBufferBinding(uniformBlock.bufferBindingInfo, bufferBinding);\n                typedArray = bufferBinding.bufferView;\n            }\n            const buffer = Buffer.getBuffer(typedArray.buffer);\n\n            (buffer as UnReadonly<Buffer>).label = buffer.label || (`UniformBuffer ${name}`);\n\n            const offset = typedArray.byteOffset;\n            const size = uniformBlock.bufferBindingInfo.size;\n\n            //\n            const webGLBuffer = getGLBuffer(gl, buffer, 'UNIFORM_BUFFER', 'DYNAMIC_DRAW');\n\n            gl.bindBufferRange(gl.UNIFORM_BUFFER, index, webGLBuffer, offset, size);\n        });\n    }\n}\n\n","import { reactive } from '@feng3d/reactivity';\nimport { Buffer, IndicesDataTypes } from '@feng3d/render-api';\nimport { getGLBuffer } from '../caches/getGLBuffer';\n\nexport function runIndexBuffer(gl: WebGLRenderingContext, indices?: IndicesDataTypes)\n{\n    if (!indices) return;\n\n    const indexBuffer = Buffer.getBuffer(indices.buffer);\n\n    if (!indexBuffer.label)\n    {\n        reactive(indexBuffer).label = (`顶点索引 ${autoIndex++}`);\n    }\n\n    const buffer = getGLBuffer(gl, indexBuffer, 'ELEMENT_ARRAY_BUFFER', 'STATIC_DRAW');\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n}\n\nlet autoIndex = 0;","import { Buffer, VertexAttribute, vertexFormatMap } from '@feng3d/render-api';\nimport { getGLBuffer } from '../caches/getGLBuffer';\nimport { reactive } from '@feng3d/reactivity';\n\nexport function runVertexAttribute(gl: WebGLRenderingContext, location: number, attribute: VertexAttribute)\n{\n    const { stepMode, format, data } = attribute;\n    let { arrayStride, offset } = attribute;\n\n    const glVertexFormat = vertexFormatMap[format];\n    const { numComponents, normalized, type } = glVertexFormat;\n\n    gl.enableVertexAttribArray(location);\n\n    if (stepMode === 'instance')\n    {\n        if (gl instanceof WebGL2RenderingContext)\n        {\n            gl.vertexAttribDivisor(location, 1);\n        }\n        else\n        {\n            const extension = gl.getExtension('ANGLE_instanced_arrays');\n\n            extension.vertexAttribDivisorANGLE(location, 1);\n        }\n    }\n\n    //\n    arrayStride = arrayStride || glVertexFormat.byteSize;\n    offset = data.byteOffset + (offset || 0);\n\n    //\n    const buffer = Buffer.getBuffer(data.buffer);\n\n    if (!buffer.label)\n    {\n        reactive(buffer).label = (`顶点数据 ${autoVertexIndex++}`);\n    }\n\n    const webGLBuffer = getGLBuffer(gl, buffer, 'ARRAY_BUFFER', 'STATIC_DRAW');\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, webGLBuffer);\n\n    //\n    if (gl instanceof WebGL2RenderingContext && (type === 'INT' || type === 'UNSIGNED_INT'))\n    {\n        gl.vertexAttribIPointer(location, numComponents, gl[type], arrayStride, offset);\n    }\n    else\n    {\n        gl.vertexAttribPointer(location, numComponents, gl[type], normalized, arrayStride, offset);\n    }\n}\n\nlet autoVertexIndex = 0;","import { IndicesDataTypes, RenderPipeline, VertexAttributes } from '@feng3d/render-api';\nimport { getGLProgram } from '../../caches/getGLProgram';\nimport { runIndexBuffer } from '../runIndexBuffer';\nimport { runVertexAttribute } from '../runVertexAttribute';\n\n/**\n * 执行设置或者上传渲染对象的顶点以及索引数据。\n */\nexport function runVertexArray(gl: WebGLRenderingContext, material: RenderPipeline, vertices: VertexAttributes, indices: IndicesDataTypes)\n{\n    if (!vertices && !indices) return;\n\n    let webGLVertexArrayObject: WebGLVertexArrayObject;\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        webGLVertexArrayObject = gl._vertexArrays.get([material, vertices, indices]);\n        if (webGLVertexArrayObject)\n        {\n            gl.bindVertexArray(webGLVertexArrayObject);\n\n            return;\n        }\n\n        webGLVertexArrayObject = gl.createVertexArray();\n        gl.bindVertexArray(webGLVertexArrayObject);\n        gl._vertexArrays.set([material, vertices, indices], webGLVertexArrayObject);\n    }\n\n    const shaderResult = getGLProgram(gl, material);\n\n    //\n    shaderResult.attributes.forEach((activeInfo) =>\n    {\n        const { name, location } = activeInfo;\n\n        // 处理 WebGL 内置属性 gl_VertexID 等\n        if (location < 0) return;\n\n        const attribute = vertices[name];\n\n        if (!attribute)\n        {\n            console.error(`缺少顶点 ${name} 数据！`);\n        }\n\n        runVertexAttribute(gl, location, attribute);\n    });\n\n    runIndexBuffer(gl, indices);\n}\n\n","import { Viewport } from '@feng3d/render-api';\n\nexport function runViewPort(gl: WebGLRenderingContext, attachmentSize: { width: number, height: number }, viewport: Viewport)\n{\n    if (viewport)\n    {\n        const isYup = viewport.isYup ?? true;\n        const x = viewport.x ?? 0;\n        let y = viewport.y ?? 0;\n        const width = viewport.width ?? attachmentSize.width;\n        const height = viewport.height ?? attachmentSize.height;\n\n        if (!isYup)\n        {\n            y = attachmentSize.height - y - height;\n        }\n\n        gl.viewport(x, y, width, height);\n    }\n    else\n    {\n        gl.viewport(0, 0, attachmentSize.width, attachmentSize.height);\n    }\n}\n\n","import { RenderObject } from '@feng3d/render-api';\nimport { getGLDrawMode } from '../../caches/getGLDrawMode';\nimport { runDrawIndexed } from './runDrawIndexed';\nimport { runDrawVertex } from './runDrawVertex';\nimport { runPrimitiveState } from './runPrimitiveState';\nimport { runRenderPipeline } from './runRenderPipeline';\nimport { runScissor } from './runScissor';\nimport { runUniforms } from './runUniforms';\nimport { runVertexArray } from './runVertexArray';\nimport { runViewPort } from './runViewPort';\n\nexport function runRenderObject(gl: WebGLRenderingContext, attachmentSize: { width: number, height: number }, renderObject: RenderObject, hasDepthAttachment = true)\n{\n    const { viewport, scissorRect, pipeline, vertices, indices, draw, bindingResources: uniforms } = renderObject;\n    const primitive = pipeline?.primitive;\n\n    runViewPort(gl, attachmentSize, viewport);\n\n    runScissor(gl, attachmentSize, scissorRect);\n\n    runRenderPipeline(gl, pipeline, hasDepthAttachment);\n\n    runUniforms(gl, pipeline, uniforms);\n\n    runVertexArray(gl, pipeline, vertices, indices);\n\n    runPrimitiveState(gl, primitive);\n\n    const topology = primitive?.topology || 'triangle-list';\n    const drawMode = getGLDrawMode(topology);\n\n    if (draw.__type__ === 'DrawVertex')\n    {\n        runDrawVertex(gl, drawMode, draw);\n    }\n    else\n    {\n        runDrawIndexed(gl, drawMode, indices, draw);\n    }\n}\n\n","import { BlitFramebuffer } from '../data/BlitFramebuffer';\nimport { getGLFramebuffer } from '../caches/getGLFramebuffer';\n\nexport function runBlitFramebuffer(gl: WebGLRenderingContext, blitFramebuffer: BlitFramebuffer)\n{\n    const { read, draw, blitFramebuffers } = blitFramebuffer;\n\n    const readFramebuffer = getGLFramebuffer(gl, read);\n    const drawFramebuffer = getGLFramebuffer(gl, draw);\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        gl.bindFramebuffer(gl.READ_FRAMEBUFFER, readFramebuffer);\n        gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, drawFramebuffer);\n\n        draw.colorAttachments.forEach((item, i) =>\n        {\n            const clearValue = draw.colorAttachments[i]?.clearValue;\n\n            if (clearValue)\n            {\n                gl.clearBufferfv(gl.COLOR, i, clearValue as any);\n            }\n        });\n\n        blitFramebuffers.forEach((item) =>\n        {\n            const [srcX0, srcY0, srcX1, srcY1, dstX0, dstY0, dstX1, dstY1, mask, filter] = item;\n\n            gl.blitFramebuffer(srcX0, srcY0, srcX1, srcY1, dstX0, dstY0, dstX1, dstY1, gl[mask], gl[filter]);\n        });\n    }\n}\n\n","import { OcclusionQuery } from '@feng3d/render-api';\nimport { runRenderObject } from './renderObject/runRenderObject';\n\nexport function runOcclusionQuery(gl: WebGLRenderingContext, attachmentSize: { width: number, height: number }, occlusionQuery: OcclusionQuery, hasDepthAttachment = true)\n{\n    // 开始查询\n    occlusionQuery._step.begin();\n\n    // 正常渲染对象列表\n    occlusionQuery.renderObjects.forEach((renderObject) =>\n    {\n        runRenderObject(gl, attachmentSize, renderObject, hasDepthAttachment);\n    });\n\n    // 结束查询\n    occlusionQuery._step.end();\n}\n\n","import { RenderPassDescriptor } from '@feng3d/render-api';\nimport { getGLFramebuffer } from '../caches/getGLFramebuffer';\n\nexport function runRenderPassDescriptor(gl: WebGLRenderingContext, passDescriptor: RenderPassDescriptor)\n{\n    passDescriptor = passDescriptor || {};\n\n    //\n    const framebuffer = getGLFramebuffer(gl, passDescriptor);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n\n    //\n    const colorAttachment = passDescriptor.colorAttachments?.[0];\n    //\n    const clearValue = colorAttachment?.clearValue ?? [0, 0, 0, 0];\n    const loadOp = colorAttachment?.loadOp ?? 'clear';\n\n    gl.clearColor(clearValue[0], clearValue[1], clearValue[2], clearValue[3]);\n\n    //\n    const depthStencilAttachment = passDescriptor.depthStencilAttachment;\n\n    if (depthStencilAttachment)\n    {\n        const depthClearValue = depthStencilAttachment.depthClearValue ?? 1;\n        const depthLoadOp = depthStencilAttachment.depthLoadOp ?? 'clear'; // 默认清除深度缓冲区\n        const stencilClearValue = depthStencilAttachment.stencilClearValue ?? 0;\n        const stencilLoadOp = depthStencilAttachment.stencilLoadOp ?? 'load';\n\n        //\n        gl.clearDepth(depthClearValue);\n        gl.clearStencil(stencilClearValue);\n\n        //\n        gl.clear((loadOp === 'clear' ? gl.COLOR_BUFFER_BIT : 0)\n            | (depthLoadOp === 'clear' ? gl.DEPTH_BUFFER_BIT : 0)\n            | (stencilLoadOp === 'clear' ? gl.STENCIL_BUFFER_BIT : 0),\n        );\n    }\n    else\n    {\n        //\n        gl.clear((loadOp === 'clear' ? gl.COLOR_BUFFER_BIT : 0));\n    }\n}\n\n","import { CanvasTexture, RenderObject, RenderPass, RenderPassDescriptor, Texture, TextureView } from '@feng3d/render-api';\nimport { getGLRenderOcclusionQuery } from '../caches/getGLRenderOcclusionQuery';\nimport { getGLRenderPassDescriptorWithMultisample } from '../caches/getGLRenderPassDescriptorWithMultisample';\nimport { runRenderObject } from './renderObject/runRenderObject';\nimport { runBlitFramebuffer } from './runBlitFramebuffer';\nimport { runOcclusionQuery } from './runOcclusionQuery';\nimport { runRenderPassDescriptor } from './runRenderPassDescriptor';\n\nexport function runRenderPass(gl: WebGLRenderingContext, renderPass: RenderPass, defaultRenderPassDescriptor?: RenderPassDescriptor)\n{\n    const descriptor = renderPass.descriptor || defaultRenderPassDescriptor;\n    // 获取附件尺寸\n    const attachmentSize = getGLRenderPassAttachmentSize(gl, descriptor);\n\n    // 检查是否有深度附件\n    const hasDepthAttachment = !!(descriptor?.depthStencilAttachment);\n\n    // 处理不被遮挡查询\n    const occlusionQuery = getGLRenderOcclusionQuery(gl, renderPass.renderPassObjects);\n\n    //\n    occlusionQuery.init();\n\n    if (descriptor?.sampleCount && (descriptor.colorAttachments[0].view as TextureView).texture)\n    {\n        const { passDescriptor, blitFramebuffer } = getGLRenderPassDescriptorWithMultisample(descriptor);\n\n        runRenderPassDescriptor(gl, passDescriptor);\n\n        renderPass.renderPassObjects?.forEach((renderObject) =>\n        {\n            if (renderObject.__type__ === 'OcclusionQuery')\n            {\n                runOcclusionQuery(gl, attachmentSize, renderObject, hasDepthAttachment);\n            }\n            else\n            {\n                runRenderObject(gl, attachmentSize, renderObject as RenderObject, hasDepthAttachment);\n            }\n        });\n\n        runBlitFramebuffer(gl, blitFramebuffer);\n    }\n    else\n    {\n        runRenderPassDescriptor(gl, descriptor);\n\n        renderPass.renderPassObjects?.forEach((renderObject) =>\n        {\n            if (renderObject.__type__ === 'OcclusionQuery')\n            {\n                runOcclusionQuery(gl, attachmentSize, renderObject, hasDepthAttachment);\n            }\n            else\n            {\n                runRenderObject(gl, attachmentSize, renderObject as RenderObject, hasDepthAttachment);\n            }\n        });\n    }\n\n    occlusionQuery.resolve(renderPass);\n}\n\n/**\n * 获取渲染通道附件尺寸。\n *\n * @param gl\n * @param descriptor\n */\nfunction getGLRenderPassAttachmentSize(gl: WebGLRenderingContext, descriptor: RenderPassDescriptor): { readonly width: number; readonly height: number; }\n{\n    if (!descriptor) return { width: gl.drawingBufferWidth, height: gl.drawingBufferHeight };\n\n    const colorAttachments = descriptor.colorAttachments;\n\n    if (colorAttachments)\n    {\n        const view = colorAttachments[0]?.view;\n\n        if (view)\n        {\n            const texture = view.texture;\n\n            // 检查是否是 CanvasTexture\n            if ('context' in texture)\n            {\n                // CanvasTexture: 从画布上下文获取尺寸\n                const canvasTexture = texture as CanvasTexture;\n                const canvas = typeof canvasTexture.context.canvasId === 'string'\n                    ? document.getElementById(canvasTexture.context.canvasId) as HTMLCanvasElement\n                    : canvasTexture.context.canvasId;\n\n                if (canvas)\n                {\n                    return { width: canvas.width, height: canvas.height };\n                }\n            }\n            else if ('descriptor' in texture)\n            {\n                // Texture: 从描述符获取尺寸\n                const regularTexture = texture as Texture;\n\n                return { width: regularTexture.descriptor.size[0], height: regularTexture.descriptor.size[1] };\n            }\n        }\n\n        return { width: gl.drawingBufferWidth, height: gl.drawingBufferHeight };\n    }\n\n    const depthStencilAttachment = descriptor.depthStencilAttachment;\n\n    if (depthStencilAttachment)\n    {\n        const view = depthStencilAttachment.view;\n\n        if (view)\n        {\n            const texture = view.texture;\n\n            // 检查是否是 CanvasTexture\n            if ('context' in texture)\n            {\n                // CanvasTexture: 从画布上下文获取尺寸\n                const canvasTexture = texture as CanvasTexture;\n                const canvas = typeof canvasTexture.context.canvasId === 'string'\n                    ? document.getElementById(canvasTexture.context.canvasId) as HTMLCanvasElement\n                    : canvasTexture.context.canvasId;\n\n                if (canvas)\n                {\n                    return { width: canvas.width, height: canvas.height };\n                }\n            }\n            else if ('descriptor' in texture)\n            {\n                // Texture: 从描述符获取尺寸\n                const regularTexture = texture as Texture;\n\n                return { width: regularTexture.descriptor.size[0], height: regularTexture.descriptor.size[1] };\n            }\n        }\n\n        return { width: gl.drawingBufferWidth, height: gl.drawingBufferHeight };\n    }\n\n    return { width: gl.drawingBufferWidth, height: gl.drawingBufferHeight };\n}","import { TransformFeedbackPipeline } from '@feng3d/render-api';\nimport { getGLProgram } from '../caches/getGLProgram';\n\nexport function runTransformFeedbackPipeline(gl: WebGLRenderingContext, renderPipeline: TransformFeedbackPipeline)\n{\n    const program = getGLProgram(gl, renderPipeline);\n\n    gl.useProgram(program);\n}\n\n","import { TransformFeedback } from '@feng3d/render-api';\nimport { getGLTransformFeedback } from '../caches/getGLTransformFeedback';\nimport { GLDrawMode } from '../caches/getGLDrawMode';\n\nexport function runTransformFeedback(gl: WebGLRenderingContext, transformFeedback: TransformFeedback, topology: GLDrawMode)\n{\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        if (transformFeedback)\n        {\n            const webGLTransformFeedback = getGLTransformFeedback(gl, transformFeedback);\n\n            gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, webGLTransformFeedback);\n\n            gl.beginTransformFeedback(gl[topology]);\n        }\n        else\n        {\n            gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, null);\n        }\n    }\n    else if (transformFeedback)\n    {\n        console.log(`WebGL1 不支持顶点着色器回写数据功能！`);\n    }\n}\n\n","import { TransformFeedback } from '@feng3d/render-api';\n\nexport function endTransformFeedback(gl: WebGLRenderingContext, transformFeedback: TransformFeedback)\n{\n    //\n    if (transformFeedback)\n    {\n        if (gl instanceof WebGL2RenderingContext)\n        {\n            gl.endTransformFeedback();\n            gl.bindTransformFeedback(gl.TRANSFORM_FEEDBACK, null);\n            gl.bindBuffer(gl.ARRAY_BUFFER, null);\n            gl.bindBuffer(gl.TRANSFORM_FEEDBACK_BUFFER, null);\n        }\n    }\n}\n\n","import { TransformFeedbackObject } from '@feng3d/render-api';\nimport { getGLDrawMode, GLDrawMode } from '../caches/getGLDrawMode';\nimport { runTransformFeedbackPipeline } from './runTransformFeedbackPipeline';\nimport { runVertexArray } from './renderObject/runVertexArray';\nimport { runUniforms } from './renderObject/runUniforms';\nimport { runTransformFeedback } from './runTransformFeedback';\nimport { runDrawVertex } from './renderObject/runDrawVertex';\nimport { endTransformFeedback } from './endTransformFeedback';\n\nexport function runTransformFeedbackObject(gl: WebGLRenderingContext, renderObject: TransformFeedbackObject)\n{\n    const { pipeline: material, vertices, uniforms, transformFeedback, draw } = renderObject;\n\n    const drawMode = getGLDrawMode('point-list');\n\n    runTransformFeedbackPipeline(gl, material);\n\n    runVertexArray(gl, material, vertices, undefined);\n\n    runUniforms(gl, material, uniforms);\n\n    runTransformFeedback(gl, transformFeedback, drawMode);\n\n    runDrawVertex(gl, drawMode, draw);\n\n    endTransformFeedback(gl, transformFeedback);\n}\n\n","import { TransformFeedbackPass } from '@feng3d/render-api';\nimport { runTransformFeedbackObject } from './runTransformFeedbackObject';\n\nexport function runTransformFeedbackPass(gl: WebGLRenderingContext, transformFeedbackPass: TransformFeedbackPass)\n{\n    // 执行变换反馈通道时关闭光栅化功能\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        gl.enable(gl.RASTERIZER_DISCARD);\n    }\n    transformFeedbackPass.transformFeedbackObjects.forEach((transformFeedbackObject) =>\n    {\n        runTransformFeedbackObject(gl, transformFeedbackObject);\n    });\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        gl.disable(gl.RASTERIZER_DISCARD);\n    }\n}\n\n","import { CopyTextureToTexture, ImageCopyTexture, RenderPassColorAttachment, RenderPassDepthStencilAttachment, TextureView } from '@feng3d/render-api';\nimport { BlitFramebuffer, BlitFramebufferItem } from '../data/BlitFramebuffer';\n\n/**\n * 通过 IGLBlitFramebuffer 实现纹理之间拷贝并不靠谱。\n *\n * @param copyTextureToTexture GL纹理之间拷贝。\n * @returns\n */\nexport function getGLBlitFramebuffer(copyTextureToTexture: CopyTextureToTexture)\n{\n    const { source, destination, copySize } = copyTextureToTexture;\n\n    const sourceAspect = source.aspect || 'all';\n    const destinationAspect = destination.aspect || 'all';\n\n    console.assert(sourceAspect === destinationAspect, `拷贝纹理时两个纹理的 aspect 必须相同！`);\n\n    const sourceColorAttachments: RenderPassColorAttachment[] = [];\n    let sourceDepthStencilAttachment: RenderPassDepthStencilAttachment;\n    const destinationColorAttachments: RenderPassColorAttachment[] = [];\n    let destinationDepthStencilAttachment: RenderPassDepthStencilAttachment;\n\n    //\n    let mask: 'COLOR_BUFFER_BIT' | 'DEPTH_BUFFER_BIT' | 'STENCIL_BUFFER_BIT';\n\n    if (sourceAspect === 'all')\n    {\n        mask = 'COLOR_BUFFER_BIT';\n        sourceColorAttachments.push({ view: getGLTextureView(source) });\n        destinationColorAttachments.push({ view: getGLTextureView(destination) });\n    }\n    else if (sourceAspect === 'depth-only')\n    {\n        mask = 'DEPTH_BUFFER_BIT';\n        sourceDepthStencilAttachment = { view: getGLTextureView(source) };\n        destinationDepthStencilAttachment = { view: getGLTextureView(destination) };\n    }\n    else if (sourceAspect === 'stencil-only')\n    {\n        mask = 'STENCIL_BUFFER_BIT';\n        sourceDepthStencilAttachment = { view: getGLTextureView(source) };\n        destinationDepthStencilAttachment = { view: getGLTextureView(destination) };\n    }\n\n    const sourceOrigin = source.origin || [0, 0];\n    const destinationOrigin = destination.origin || [0, 0];\n    //\n    const blitFramebufferItem: BlitFramebufferItem = [\n        sourceOrigin[0], sourceOrigin[1], sourceOrigin[0] + copySize[0], sourceOrigin[1] + copySize[1],\n        destinationOrigin[0], destinationOrigin[1], destinationOrigin[0] + copySize[0], destinationOrigin[1] + copySize[1],\n        mask, 'NEAREST',\n    ];\n\n    const blitFramebuffer: BlitFramebuffer = {\n        __type__: 'BlitFramebuffer',\n        read: {\n            colorAttachments: sourceColorAttachments,\n            depthStencilAttachment: sourceDepthStencilAttachment,\n        },\n        draw: {\n            colorAttachments: destinationColorAttachments,\n            depthStencilAttachment: destinationDepthStencilAttachment,\n        },\n        blitFramebuffers: [blitFramebufferItem],\n    };\n\n    return blitFramebuffer;\n}\n\nfunction getGLTextureView(source: ImageCopyTexture)\n{\n    if (!source.texture) return undefined;\n\n    const textureView: TextureView = {\n        texture: source.texture,\n        baseMipLevel: source.mipLevel,\n        baseArrayLayer: source.origin?.[2],\n    };\n\n    return textureView;\n}","import { CopyTextureToTexture } from '@feng3d/render-api';\nimport { getGLBlitFramebuffer } from '../caches/getGLBlitFramebuffer';\nimport { runBlitFramebuffer } from './runBlitFramebuffer';\n\nexport function runCopyTextureToTexture(gl: WebGLRenderingContext, copyTextureToTexture: CopyTextureToTexture)\n{\n    const blitFramebuffer = getGLBlitFramebuffer(copyTextureToTexture);\n\n    runBlitFramebuffer(gl, blitFramebuffer);\n}\n\n","import { Buffer, CopyBufferToBuffer } from '@feng3d/render-api';\nimport { getGLBuffer } from '../caches/getGLBuffer';\n\nexport function runCopyBufferToBuffer(gl: WebGLRenderingContext, copyBufferToBuffer: CopyBufferToBuffer)\n{\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        const rb = getGLBuffer(gl, Buffer.getBuffer(copyBufferToBuffer.source.buffer), 'COPY_READ_BUFFER');\n        const wb = getGLBuffer(gl, Buffer.getBuffer(copyBufferToBuffer.destination.buffer), 'COPY_WRITE_BUFFER');\n\n        const sourceOffset = copyBufferToBuffer.source.byteOffset;\n        const destinationOffset = copyBufferToBuffer.destination.byteOffset;\n\n        //\n        const size = copyBufferToBuffer.size ?? Math.min(copyBufferToBuffer.source.byteLength, copyBufferToBuffer.destination.byteLength);\n\n        gl.bindBuffer(gl.COPY_READ_BUFFER, rb);\n        gl.bindBuffer(gl.COPY_WRITE_BUFFER, wb);\n        gl.copyBufferSubData(gl.COPY_READ_BUFFER, gl.COPY_WRITE_BUFFER, sourceOffset, destinationOffset, size);\n\n        //\n        gl.bindBuffer(gl.COPY_READ_BUFFER, null);\n        gl.bindBuffer(gl.COPY_WRITE_BUFFER, null);\n    }\n    else\n    {\n        console.error(`WebGL1 不支持拷贝缓冲区功能！`);\n    }\n}\n\n","import { CommandEncoder, RenderPass, RenderPassDescriptor } from '@feng3d/render-api';\nimport { runRenderPass } from './runRenderPass';\nimport { runTransformFeedbackPass } from './runTransformFeedbackPass';\nimport { runBlitFramebuffer } from './runBlitFramebuffer';\nimport { runCopyTextureToTexture } from './runCopyTextureToTexture';\nimport { runCopyBufferToBuffer } from './runCopyBufferToBuffer';\n\nexport function runCommandEncoder(gl: WebGLRenderingContext, commandEncoder: CommandEncoder, defaultRenderPassDescriptor?: RenderPassDescriptor)\n{\n    commandEncoder.passEncoders.forEach((passEncoder) =>\n    {\n        if (!passEncoder.__type__ || passEncoder.__type__ === 'RenderPass')\n        {\n            runRenderPass(gl, passEncoder as RenderPass, defaultRenderPassDescriptor);\n\n            return;\n        }\n        if (passEncoder.__type__ === 'TransformFeedbackPass')\n        {\n            runTransformFeedbackPass(gl, passEncoder);\n\n            return;\n        }\n        if (passEncoder.__type__ === 'BlitFramebuffer')\n        {\n            runBlitFramebuffer(gl, passEncoder);\n\n            return;\n        }\n        if (passEncoder.__type__ === 'CopyTextureToTexture')\n        {\n            runCopyTextureToTexture(gl, passEncoder);\n\n            return;\n        }\n        if (passEncoder.__type__ === 'CopyBufferToBuffer')\n        {\n            runCopyBufferToBuffer(gl, passEncoder);\n\n            return;\n        }\n\n        console.error(`未处理 passEncoder ${passEncoder}`);\n    });\n}","import { RenderPassDescriptor, Submit } from '@feng3d/render-api';\nimport { _GL_Submit_Times } from '../const/const';\nimport { runCommandEncoder } from './runCommandEncoder';\n\nexport function runSubmit(gl: WebGLRenderingContext, submit: Submit, defaultRenderPassDescriptor?: RenderPassDescriptor)\n{\n    const commandBuffers = submit.commandEncoders.map((v) =>\n    {\n        const commandBuffer = runCommandEncoder(gl, v, defaultRenderPassDescriptor);\n\n        return commandBuffer;\n    });\n\n    // 派发提交WebGPU事件\n    gl[_GL_Submit_Times] = ~~gl[_GL_Submit_Times] + 1;\n}","import { CanvasTexture, ReadPixels, RenderPassDescriptor, Texture, TextureFormat } from '@feng3d/render-api';\nimport { deleteFramebuffer, getGLFramebuffer } from '../caches/getGLFramebuffer';\nimport { getGLTextureFormats } from '../caches/getGLTextureFormats';\n\nexport function readPixels(gl: WebGLRenderingContext, readPixels: ReadPixels)\n{\n    let bufferData: ArrayBufferView;\n\n    if (gl instanceof WebGL2RenderingContext)\n    {\n        const { textureView, origin, copySize } = readPixels;\n        const [width, height] = copySize;\n\n        // 未指定纹理视图时，从画布读取\n        if (!textureView)\n        {\n            // 从默认 framebuffer（画布）读取\n            const textureFormat: TextureFormat = 'rgba8unorm'; // 画布默认格式\n            const { format, type } = getGLTextureFormats(textureFormat);\n            const bytesPerPixel = Texture.getTextureBytesPerPixel(textureFormat);\n            const DataConstructor = Texture.getTextureDataConstructor(textureFormat);\n\n            const bytesPerRow = width * bytesPerPixel;\n            const bufferSize = bytesPerRow * height;\n\n            bufferData = new DataConstructor(bufferSize / DataConstructor.BYTES_PER_ELEMENT);\n\n            // 绑定到默认 framebuffer（画布）\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n            // 设置读取缓冲区（默认 framebuffer 使用 BACK 缓冲区）\n            gl.readBuffer(gl.BACK);\n\n            // 读取像素（注意：WebGL 的坐标系是左下角为原点，需要翻转 y 坐标）\n            // origin[1] 是从顶部计算的 y 坐标，需要转换为从底部计算的坐标\n            // readPixels 的 y 参数是读取区域的左下角坐标\n            // 对于单个像素（height=1），使用：glY = drawingBufferHeight - origin[1] - 1\n            // 对于多个像素，使用：glY = drawingBufferHeight - origin[1] - height\n            const glY = height === 1\n                ? gl.drawingBufferHeight - origin[1] - 1\n                : gl.drawingBufferHeight - origin[1] - height;\n\n            gl.readPixels(origin[0], glY, width, height, gl[format], gl[type], bufferData, 0);\n        }\n        else if ('context' in textureView.texture)\n        {\n            // CanvasTexture: 从默认 framebuffer（画布）读取\n            const canvasTexture = textureView.texture as CanvasTexture;\n            const textureFormat: TextureFormat = 'rgba8unorm'; // 画布默认格式\n            const { format, type } = getGLTextureFormats(textureFormat);\n            const bytesPerPixel = Texture.getTextureBytesPerPixel(textureFormat);\n            const DataConstructor = Texture.getTextureDataConstructor(textureFormat);\n\n            const bytesPerRow = width * bytesPerPixel;\n            const bufferSize = bytesPerRow * height;\n\n            bufferData = new DataConstructor(bufferSize / DataConstructor.BYTES_PER_ELEMENT);\n\n            // 绑定到默认 framebuffer（画布）\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n            // 设置读取缓冲区（默认 framebuffer 使用 BACK 缓冲区）\n            gl.readBuffer(gl.BACK);\n\n            // 读取像素（注意：WebGL 的坐标系是左下角为原点，需要翻转 y 坐标）\n            const glY = height === 1\n                ? gl.drawingBufferHeight - origin[1] - 1\n                : gl.drawingBufferHeight - origin[1] - height;\n\n            gl.readPixels(origin[0], glY, width, height, gl[format], gl[type], bufferData, 0);\n        }\n        else\n        {\n            // Texture: 从纹理 framebuffer 读取\n            const attachmentPoint: GLAttachmentPoint = 'COLOR_ATTACHMENT0';\n            const texture = textureView.texture as Texture;\n            const descriptor = texture.descriptor;\n            const { format, type } = getGLTextureFormats(descriptor.format);\n            const bytesPerPixel = Texture.getTextureBytesPerPixel(descriptor.format);\n            const DataConstructor = Texture.getTextureDataConstructor(descriptor.format);\n\n            const bytesPerRow = width * bytesPerPixel;\n            const bufferSize = bytesPerRow * height;\n\n            bufferData = new DataConstructor(bufferSize / DataConstructor.BYTES_PER_ELEMENT);\n\n            // 使用传入的 textureView 创建 framebuffer，支持纹理数组的特定层\n            const frameBuffer: RenderPassDescriptor = { colorAttachments: [{ view: textureView }] };\n\n            const webGLFramebuffer = getGLFramebuffer(gl, frameBuffer);\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, webGLFramebuffer);\n\n            gl.readBuffer(gl[attachmentPoint]);\n            gl.readPixels(origin[0], origin[1], width, height, gl[format], gl[type], bufferData, 0);\n\n            // 释放\n            deleteFramebuffer(gl, frameBuffer);\n        }\n    }\n    else\n    {\n        console.error(`WebGL1 不支持 readBuffer/readPixels ！`);\n    }\n\n    return bufferData;\n}\n\n/**\n * A GLenum specifying the attachment point for the texture. Possible values:\n *\n * gl.COLOR_ATTACHMENT0: Attaches the texture to the framebuffer's color buffer.\n * gl.DEPTH_ATTACHMENT: Attaches the texture to the framebuffer's depth buffer.\n * gl.STENCIL_ATTACHMENT: Attaches the texture to the framebuffer's stencil buffer.\n *\n * When using a WebGL 2 context, the following values are available additionally:\n *\n * gl.DEPTH_STENCIL_ATTACHMENT: depth and stencil buffer.\n * gl.COLOR_ATTACHMENT1 gl.COLOR_ATTACHMENT2 gl.COLOR_ATTACHMENT3 gl.COLOR_ATTACHMENT4 gl.COLOR_ATTACHMENT5 gl.COLOR_ATTACHMENT6 gl.COLOR_ATTACHMENT7 gl.COLOR_ATTACHMENT8 gl.COLOR_ATTACHMENT9 gl.COLOR_ATTACHMENT10 gl.COLOR_ATTACHMENT11 gl.COLOR_ATTACHMENT12 gl.COLOR_ATTACHMENT13 gl.COLOR_ATTACHMENT14 gl.COLOR_ATTACHMENT15\n */\nexport type GLAttachmentPoint = 'COLOR_ATTACHMENT0' | 'DEPTH_ATTACHMENT' | 'STENCIL_ATTACHMENT'\n    | 'DEPTH_STENCIL_ATTACHMENT'\n    | 'COLOR_ATTACHMENT1' | 'COLOR_ATTACHMENT2' | 'COLOR_ATTACHMENT3' | 'COLOR_ATTACHMENT4' | 'COLOR_ATTACHMENT5'\n    | 'COLOR_ATTACHMENT6' | 'COLOR_ATTACHMENT7' | 'COLOR_ATTACHMENT8' | 'COLOR_ATTACHMENT9' | 'COLOR_ATTACHMENT10'\n    | 'COLOR_ATTACHMENT11' | 'COLOR_ATTACHMENT12' | 'COLOR_ATTACHMENT13' | 'COLOR_ATTACHMENT14' | 'COLOR_ATTACHMENT15'\n    ;\n","import { Buffer, CanvasContext, ReadPixels, RenderPassDescriptor, RenderPipeline, Sampler, renderState, Submit, Texture } from '@feng3d/render-api';\n\nimport { deleteBuffer } from './caches/getGLBuffer';\nimport { getGLCanvasContext } from './caches/getGLCanvasContext';\nimport { deleteFramebuffer } from './caches/getGLFramebuffer';\nimport { deleteProgram } from './caches/getGLProgram';\nimport { deleteRenderbuffer } from './caches/getGLRenderbuffer';\nimport { deleteSampler } from './caches/getGLSampler';\nimport { deleteTexture } from './caches/getGLTexture';\nimport { deleteTransformFeedback } from './caches/getGLTransformFeedback';\nimport { Renderbuffer } from './data/Renderbuffer';\nimport { TransformFeedback } from '@feng3d/render-api';\nimport { runSubmit } from './internal/runSubmit';\nimport { readPixels } from './utils/readPixels';\n\n/**\n * WEBGL 对象。\n *\n * 所有渲染都由该渲染器执行。與2D、3D場景無關，屬於更加底層的API。針對每一個 RenderObject 渲染數據進行渲染。\n */\nexport class WebGL\n{\n    private _renderingContext: CanvasContext;\n    private _gl: WebGLRenderingContext;\n\n    constructor(canvasContext?: CanvasContext)\n    {\n        renderState.isRunWebGL = true;\n        //\n        this._renderingContext = canvasContext;\n        this._gl = getGLCanvasContext(this._renderingContext) as any;\n    }\n\n    /**\n     * 提交 GPU 。\n     *\n     * @param submit 一次 GPU 提交内容。\n     *\n     */\n    submit(submit: Submit)\n    {\n        runSubmit(this._gl, submit);\n    }\n\n    readPixels(glReadPixels: ReadPixels)\n    {\n        const result = readPixels(this._gl, glReadPixels);\n\n        // 设置纹理格式信息\n        const textureView = glReadPixels.textureView;\n\n        if (textureView)\n        {\n            const texture = textureView.texture;\n\n            if ('context' in texture)\n            {\n                // CanvasTexture: 默认使用 rgba8unorm\n                glReadPixels.format = 'rgba8unorm';\n            }\n            else if ('descriptor' in texture)\n            {\n                // Texture: 从描述符获取格式\n                glReadPixels.format = texture.descriptor.format || 'rgba8unorm';\n            }\n        }\n        else\n        {\n            // 如果没有指定纹理视图，默认使用 rgba8unorm\n            glReadPixels.format = 'rgba8unorm';\n        }\n\n        glReadPixels.result = result;\n\n        return result;\n    }\n\n    deleteFramebuffer(passDescriptor: RenderPassDescriptor)\n    {\n        deleteFramebuffer(this._gl, passDescriptor);\n    }\n\n    deleteRenderbuffer(renderbuffer: Renderbuffer)\n    {\n        deleteRenderbuffer(this._gl, renderbuffer);\n    }\n\n    deleteBuffer(buffer: Buffer)\n    {\n        deleteBuffer(this._gl, buffer);\n    }\n\n    deleteTexture(texture: Texture)\n    {\n        deleteTexture(this._gl, texture);\n    }\n\n    deleteSampler(sampler: Sampler)\n    {\n        deleteSampler(this._gl, sampler);\n    }\n\n    deleteProgram(material: RenderPipeline)\n    {\n        deleteProgram(this._gl, material);\n    }\n\n    deleteTransformFeedback(transformFeedback: TransformFeedback)\n    {\n        deleteTransformFeedback(this._gl, transformFeedback);\n    }\n}\n"],"names":["__defProp","__defNormalProp","obj","key","value","__publicField","vertexFormatMap","defaultBlendComponent","BlendState","blendState","color","alpha","constantColor","Buffer2","arrayBuffer","buffer","Texture","format","_a","bytesPerPixel","formatMap","ChainMap","keys","keysLength","map","i","n","wrapKey","result","keyMap","idCounter","wrapper","defaultWebGLContextAttributes","_b","_Reactivity","_shouldTrack","parent","version","Reactivity","forceTrack","fn","preShouldTrack","noTrack","batch","dep","isRunning","_isRunedDeps","_needEffectDeps","batchRun","_batchDepth","node","pre","ComputedReactivity","func","parentReactiveNode","isChanged","preReactiveNode","ReactiveFlags","ReactiveFlags2","TargetType","TargetType2","TrackOpTypes","TrackOpTypes2","TriggerOpTypes","TriggerOpTypes2","ITERATE_KEY","MAP_KEY_ITERATE_KEY","ARRAY_ITERATE_KEY","isObject","val","isArray","isSymbol","isString","isIntegerKey","isMap","toTypeString","hasOwn","hasChanged","oldValue","targetTypeMap","rawType","getTargetType","toRawType","toRaw","observed","raw","warn","msg","args","makeMap","str","effect","EffectReactivity","_EffectReactivity","property","target","depsMap","PropertyReactivity","v","type","newValue","run","targetIsArray","isArrayIndex","newLength","key2","arrayInstrumentations","iterator","toReactive","reactiveReadArray","x","thisArg","apply","searchProxy","separator","noTracking","reduce","comparer","self","method","wrapValue","arr","shallowReadArray","iter","array","wrappedRetFn","needsWrap","methodFn","result2","wrappedFn","item","index","acc","res","isProxy","isRef","r","RefReactivity","BaseReactiveHandler","receiver","reactiveMap","hasOwnProperty","builtInSymbols","isNonTrackableKeys","reactive","MutableReactiveHandler","hadKey","mutableHandlers","mutableCollectionHandlers","createInstrumentationGetter","instrumentations","createInstrumentations","rawTarget","rawKey","has","getProto","wrap","callback","get","checkIdentityKeys","hadItems","oldTarget","createIterableMethod","targetIsMap","isPair","isKeyOnly","innerIterator","done","targetType","existingProxy","proxy","getGLBuffer","gl","usage","webGLBuffer","size","doWriteBuffer","writeBuffer","bufferOffset","data","r_buffer","effects","writeBuffers","eff","deleteBuffer","Capabilities","_gl","_precision","_getMaxPrecision","precision","getGLCanvasContext","canvasContext","canvas","getWebGLContext","_onContextLost","_onContextRestore","_onContextCreationError","event","contextAttributes","getGLRenderbuffer","renderbuffer","sampleCount","webGLRenderbuffer","internalformat","width","height","deleteRenderbuffer","getGLTextureFormats","glTextureFormat","getGLRenderPassDescriptorWithMultisample","sourcePassDescriptor","_IGLRenderPassDescriptorWithMultisample","textureSize","renderbuffers","passDescriptor","texture","getGLRenderbufferInternalformat","blitFramebuffer","Watcher","offFuncs","watchInfo","object","handler","thisObject","onlyChanged","topObject","fullProperty","propertys","object0","property0","object1","property1","__watchs__","_property","watchs","oldPropertyDescriptor","getPropertyDescriptor","orgSet","notifyListener","propertywatchs","handlers","fun0","fun1","binds","notIndex","__watchchains__","watchchains","currentp","nextp","watchchainFun","ov","getObjectPropertyValue","nv","element","objectIsEmpty","getObjectPropertyChains","watcher","host","prototype","hosts","parentPropertyIndices","cp","cv","vks","isBaseType","ps","ci","k","getGLTextureTarget","dimension","dimensionMap","defaultTexturePixelStore","getGLTexture","webGLTexture","descriptor","sources","generateMipmap","depth","mipLevelCount","textureOrigin","mipLevel","zoffset","imageSource","image","imageOrigin","flipY","premultipliedAlpha","pixelStore","setTexturePixelStore","bindTarget","getTextureCubeMapTarget","bufferSource","dataLayout","dataImageOrigin","offset","updateSources","updateTexture","writeTextures","depthOrArrayLayers","xoffset","yoffset","resize","deleteTexture","packAlignment","unpackAlignment","unpackFlipY","unpackPremulAlpha","unpackColorSpaceConversion","packRowLength","packSkipPixels","packSkipRows","unpackRowLength","unpackImageHeight","unpackSkipPixels","unpackSkipRows","unpackSkipImages","textureCubeMapTarget","textureCubeMapTargetMap","getGLFramebuffer","_c","_d","_e","view","webGLFramebuffer","drawBuffers","attachment","baseMipLevel","baseArrayLayer","textureTarget","depthStencilAttachment","colorAttachment","depthRenderbuffer","glAny","deleteFramebuffer","handleMultisample","deleteRenderPassDescriptorWithMultisample","renderPassDescriptorWithMultisample","getWebGLUniformType","webGLUniformValueType","isWebGLUniformTextureType","webGLUniformTextureTypeValue","webGL1UniformBufferTypeValue","webGL1UniformTextureTypeValue","webGL2OnlyUniformBufferTypeValue","webGL2OnlyUniformTextureTypeValue","webGLUniformTypeValue","pv","getGLProgram","material","shaderKey","getKey","vertex","fragment","fragmentState","transformFeedbackVaryings","getWebGLProgram","deleteProgram","vshader","fshader","vertexShader","getWebGLShader","fragmentShader","program","createLinkProgram","numAttributes","attributes","activeInfo","name","location","typeString","getGLAttributeType","numUniforms","uniforms","textureID","isTexture","reg","names","baseName","j","items","paths","numUniformBlocks","uniformBlockActiveInfos","uniformIndices","uniformList","unifrom","info","getBufferBindingInfo","code","shader","error","uniformBlock","currentSize","structName","uniformInfo","uniformBufferType","alignSize","uniformBufferTypeAlignSizeMap","currentstructName","roundUp","itemInfo","itemInfoOffset","itemInfoSize","Cls","webglAttributeValueType","getGLCompareFunction","depthCompare","glDepthCompare","depthCompareMap","getGLSampler","sampler","webGLSampler","minFilter","getIGLTextureMinFilter","magFilter","getIGLTextureMagFilter","wrapS","getIGLTextureWrap","wrapT","wrapR","lodMinClamp","lodMaxClamp","compareMode","compare","deleteSampler","addressMode","textureWrap","addressModeMap","mipmapFilter","glMinFilter","glMagFilter","magFilterMap","getGLTransformFeedback","transformFeedback","webGLTransformFeedback","Buffer","deleteTransformFeedback","_GL_Submit_Times","getGLRenderOcclusionQuery","renderObjects","defautRenderOcclusionQuery","renderOcclusionQuery","occlusionQueryObjects","init","getGLOcclusionQueryStep","resolve","renderPass","results","occlusionQuery","query","webGLQuery","reject","tick","getGLDrawMode","topology","drawMode","drawModeMap","runDrawIndexed","indices","drawIndexed","indexCount","firstIndex","instanceCount","runDrawVertex","drawArrays","vertexCount","firstVertex","cullFaceMap","frontFaceMap","runPrimitiveState","primitive","cullFace","frontFace","glCullMode","glFrontFace","runDepthState","depthStencil","hasDepthAttachment","depthWriteEnabled","factor","units","runColorTargetStates","targets","colorMask","blend","colorOperation","getGLBlendEquation","colorSrcFactor","getGLBlendFactor","colorDstFactor","alphaOperation","alphaSrcFactor","alphaDstFactor","operation","glBlendEquation","operationMap","blendFactor","glBlendFactor","blendFactorMap","runProgram","runStencilState","stencilFront","stencilBack","ref","readMask","writeMask","getGLStencilFunc","fail","getGLStencilOp","zfail","zpass","compareMap","stencilOperation","stencilOperationMap","runRenderPipeline","renderPipeline","runScissor","attachmentSize","scissor","isYup","y","bufferBindingInfoMap","updateBufferBinding","bufferBindingInfo","uniformData","preVariableInfo","hasDefautValue","r_uniformData","r_value","runSampler","maxAnisotropy","extension","runSamplerTexture","samplerTexture","adjustedSampler","adjustSamplerForTexture","warnedTextures","runUniform","bufferBinding","isTextureView","isSampler","getSamplerTextureFromExpanded","bindingResources","textureKey","samplerKey","textureValue","samplerValue","runUniforms","pipeline","webGLProgram","inBlock","expandedData","instanceName","typedArray","runIndexBuffer","indexBuffer","autoIndex","runVertexAttribute","attribute","stepMode","arrayStride","glVertexFormat","numComponents","normalized","autoVertexIndex","runVertexArray","vertices","webGLVertexArrayObject","runViewPort","viewport","runRenderObject","renderObject","scissorRect","draw","runBlitFramebuffer","read","blitFramebuffers","readFramebuffer","drawFramebuffer","clearValue","srcX0","srcY0","srcX1","srcY1","dstX0","dstY0","dstX1","dstY1","mask","filter","runOcclusionQuery","runRenderPassDescriptor","framebuffer","loadOp","depthClearValue","depthLoadOp","stencilClearValue","stencilLoadOp","runRenderPass","defaultRenderPassDescriptor","getGLRenderPassAttachmentSize","colorAttachments","canvasTexture","regularTexture","runTransformFeedbackPipeline","runTransformFeedback","endTransformFeedback","runTransformFeedbackObject","runTransformFeedbackPass","transformFeedbackPass","transformFeedbackObject","getGLBlitFramebuffer","copyTextureToTexture","source","destination","copySize","sourceAspect","destinationAspect","sourceColorAttachments","sourceDepthStencilAttachment","destinationColorAttachments","destinationDepthStencilAttachment","getGLTextureView","sourceOrigin","destinationOrigin","blitFramebufferItem","runCopyTextureToTexture","runCopyBufferToBuffer","copyBufferToBuffer","rb","wb","sourceOffset","destinationOffset","runCommandEncoder","commandEncoder","passEncoder","runSubmit","submit","readPixels","bufferData","textureView","origin","textureFormat","DataConstructor","bufferSize","glY","attachmentPoint","frameBuffer","WebGL","glReadPixels"],"mappings":"wKAAA,IAAIA,GAAY,OAAO,eACnBC,GAAkB,CAACC,EAAKC,EAAKC,IAAUD,KAAOD,EAAMF,GAAUE,EAAKC,EAAK,CAAE,WAAY,GAAM,aAAc,GAAM,SAAU,GAAM,MAAAC,CAAK,CAAE,EAAIF,EAAIC,CAAG,EAAIC,EACtJC,GAAgB,CAACH,EAAKC,EAAKC,IAAUH,GAAgBC,EAAK,OAAOC,GAAQ,SAAWA,EAAM,GAAKA,EAAKC,CAAK,EACxG,MAACE,GAAkB,CACtB,QAAS,CAAE,cAAe,EAAG,KAAM,gBAAiB,WAAY,GAAO,SAAU,eAAgB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EACtK,QAAS,CAAE,cAAe,EAAG,KAAM,gBAAiB,WAAY,GAAO,SAAU,eAAgB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EACtK,QAAS,CAAE,cAAe,EAAG,KAAM,OAAQ,WAAY,GAAO,SAAU,aAAc,SAAU,EAAG,SAAU,YAAa,sBAAuB,SAAS,EAC1J,QAAS,CAAE,cAAe,EAAG,KAAM,OAAQ,WAAY,GAAO,SAAU,aAAc,SAAU,EAAG,SAAU,YAAa,sBAAuB,SAAS,EAC1J,SAAU,CAAE,cAAe,EAAG,KAAM,gBAAiB,WAAY,GAAM,SAAU,sBAAuB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC7K,SAAU,CAAE,cAAe,EAAG,KAAM,gBAAiB,WAAY,GAAM,SAAU,sBAAuB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC7K,SAAU,CAAE,cAAe,EAAG,KAAM,OAAQ,WAAY,GAAM,SAAU,oBAAqB,SAAU,EAAG,SAAU,YAAa,sBAAuB,SAAS,EACjK,SAAU,CAAE,cAAe,EAAG,KAAM,OAAQ,WAAY,GAAM,SAAU,oBAAqB,SAAU,EAAG,SAAU,YAAa,sBAAuB,SAAS,EACjK,SAAU,CAAE,cAAe,EAAG,KAAM,iBAAkB,WAAY,GAAO,SAAU,eAAgB,SAAU,EAAG,SAAU,YAAa,sBAAuB,WAAW,EACzK,SAAU,CAAE,cAAe,EAAG,KAAM,iBAAkB,WAAY,GAAO,SAAU,eAAgB,SAAU,EAAG,SAAU,YAAa,sBAAuB,WAAW,EACzK,SAAU,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAO,SAAU,aAAc,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC7J,SAAU,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAO,SAAU,aAAc,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC7J,UAAW,CAAE,cAAe,EAAG,KAAM,iBAAkB,WAAY,GAAM,SAAU,sBAAuB,SAAU,EAAG,SAAU,YAAa,sBAAuB,WAAW,EAChL,UAAW,CAAE,cAAe,EAAG,KAAM,iBAAkB,WAAY,GAAM,SAAU,sBAAuB,SAAU,EAAG,SAAU,YAAa,sBAAuB,WAAW,EAChL,UAAW,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAM,SAAU,oBAAqB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EACpK,UAAW,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAM,SAAU,oBAAqB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EACpK,UAAW,CAAE,cAAe,EAAG,KAAM,aAAc,WAAY,GAAO,SAAU,QAAS,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC9J,UAAW,CAAE,cAAe,EAAG,KAAM,aAAc,WAAY,GAAO,SAAU,QAAS,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC9J,QAAS,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAO,SAAU,QAAS,SAAU,EAAG,SAAU,MAAO,sBAAuB,YAAY,EACnJ,UAAW,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAO,SAAU,QAAS,SAAU,EAAG,SAAU,YAAa,sBAAuB,YAAY,EAC3J,UAAW,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAO,SAAU,QAAS,SAAU,GAAI,SAAU,YAAa,sBAAuB,YAAY,EAC5J,UAAW,CAAE,cAAe,EAAG,KAAM,QAAS,WAAY,GAAO,SAAU,QAAS,SAAU,GAAI,SAAU,YAAa,sBAAuB,YAAY,EAC5J,OAAQ,CAAE,cAAe,EAAG,KAAM,eAAgB,WAAY,GAAO,SAAU,eAAgB,SAAU,EAAG,SAAU,MAAO,sBAAuB,WAAW,EAC/J,SAAU,CAAE,cAAe,EAAG,KAAM,eAAgB,WAAY,GAAO,SAAU,eAAgB,SAAU,EAAG,SAAU,YAAa,sBAAuB,WAAW,EACvK,SAAU,CAAE,cAAe,EAAG,KAAM,eAAgB,WAAY,GAAO,SAAU,eAAgB,SAAU,GAAI,SAAU,YAAa,sBAAuB,WAAW,EACxK,SAAU,CAAE,cAAe,EAAG,KAAM,eAAgB,WAAY,GAAO,SAAU,eAAgB,SAAU,GAAI,SAAU,YAAa,sBAAuB,WAAW,EACxK,OAAQ,CAAE,cAAe,EAAG,KAAM,MAAO,WAAY,GAAO,SAAU,aAAc,SAAU,EAAG,SAAU,MAAO,sBAAuB,UAAU,EACnJ,SAAU,CAAE,cAAe,EAAG,KAAM,MAAO,WAAY,GAAO,SAAU,aAAc,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,EAC3J,SAAU,CAAE,cAAe,EAAG,KAAM,MAAO,WAAY,GAAO,SAAU,aAAc,SAAU,GAAI,SAAU,YAAa,sBAAuB,UAAU,EAC5J,SAAU,CAAE,cAAe,EAAG,KAAM,MAAO,WAAY,GAAO,SAAU,aAAc,SAAU,GAAI,SAAU,YAAa,sBAAuB,UAAU,EAC5J,kBAAmB,CAAE,cAAe,EAAG,KAAM,8BAA+B,WAAY,GAAM,SAAU,sBAAuB,SAAU,EAAG,SAAU,YAAa,sBAAuB,UAAU,CACtM,EACMC,GAAwB,CAC5B,UAAW,MACX,UAAW,YACX,UAAW,qBACb,EACA,MAAMC,EAAW,CAOf,OAAO,sBAAsBC,EAAY,CACvC,GAAI,CAACA,EAAY,OACjB,KAAM,CAAE,MAAAC,EAAO,MAAAC,CAAK,EAAKF,EACzB,IAAKC,GAAS,KAAO,OAASA,EAAM,aAAe,aAAeA,GAAS,KAAO,OAASA,EAAM,aAAe,uBAAyBA,GAAS,KAAO,OAASA,EAAM,aAAe,aAAeA,GAAS,KAAO,OAASA,EAAM,aAAe,uBAAyBC,GAAS,KAAO,OAASA,EAAM,aAAe,aAAeA,GAAS,KAAO,OAASA,EAAM,aAAe,uBAAyBA,GAAS,KAAO,OAASA,EAAM,aAAe,aAAeA,GAAS,KAAO,OAASA,EAAM,aAAe,qBAAsB,CAChhB,MAAMC,EAAgBH,EAAW,cACjC,OAAIG,IAGGA,GAAiB,CAAC,EAAG,EAAG,EAAG,CAAC,EACrC,CAEF,CACF,CACA,MAAMC,CAAQ,CAOZ,OAAO,UAAUC,EAAa,CAC5B,IAAIC,EAAS,KAAK,UAAU,IAAID,CAAW,EAC3C,OAAIC,IACJA,EAAS,CACP,KAAM,KAAK,KAAKD,EAAY,WAAa,CAAC,EAAI,EAC9C,KAAMA,CACZ,EACI,KAAK,UAAU,IAAIA,EAAaC,CAAM,EAC/BA,EACT,CACF,CAEAV,GAAcQ,EAAS,YAA6B,IAAI,OAAS,EA2GjE,MAAMG,CAAQ,CAMZ,OAAO,wBAAwBC,EAAS,aAAc,CACpD,IAAIC,EACJ,MAAMC,GAAiBD,EAAKE,GAAUH,CAAM,IAAM,KAAO,OAASC,EAAG,cACrE,eAAQ,OAAO,CAAC,CAACC,EAAe,SAASF,CAAM,yBAAyB,EACjEE,CACT,CAOA,OAAO,0BAA0BF,EAAS,aAAc,CACtD,IAAIC,EACJ,MAAMC,GAAiBD,EAAKE,GAAUH,CAAM,IAAM,KAAO,OAASC,EAAG,gBACrE,eAAQ,OAAO,CAAC,CAACC,EAAe,SAASF,CAAM,sBAAsB,EAC9DE,CACT,CACF,CACA,MAAMC,GAAY,CAChB,QAAS,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACxD,QAAS,CAAE,cAAe,EAAG,gBAAiB,SAAS,EACvD,OAAQ,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACvD,OAAQ,CAAE,cAAe,EAAG,gBAAiB,SAAS,EACtD,QAAS,CAAE,cAAe,EAAG,gBAAiB,WAAW,EACzD,QAAS,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACxD,SAAU,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC1D,SAAU,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACzD,SAAU,CAAE,cAAe,EAAG,gBAAiB,SAAS,EACxD,QAAS,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACxD,QAAS,CAAE,cAAe,EAAG,gBAAiB,SAAS,EACvD,QAAS,CAAE,cAAe,EAAG,gBAAiB,WAAW,EACzD,QAAS,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACxD,SAAU,CAAE,cAAe,EAAG,gBAAiB,YAAY,EAC3D,SAAU,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC1D,SAAU,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACzD,UAAW,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC3D,WAAY,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAC3D,kBAAmB,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAClE,WAAY,CAAE,cAAe,EAAG,gBAAiB,SAAS,EAC1D,UAAW,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAC1D,UAAW,CAAE,cAAe,EAAG,gBAAiB,SAAS,EACzD,WAAY,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAC3D,kBAAmB,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAClE,aAAc,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC9D,YAAa,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC7D,aAAc,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC9D,cAAe,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC/D,SAAU,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC1D,SAAU,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACzD,UAAW,CAAE,cAAe,EAAG,gBAAiB,YAAY,EAC5D,WAAY,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC5D,WAAY,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAC3D,YAAa,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC7D,WAAY,CAAE,cAAe,GAAI,gBAAiB,WAAW,EAC7D,WAAY,CAAE,cAAe,GAAI,gBAAiB,UAAU,EAC5D,YAAa,CAAE,cAAe,GAAI,gBAAiB,YAAY,EAC/D,SAAU,CAAE,cAAe,EAAG,gBAAiB,UAAU,EACzD,aAAc,CAAE,cAAe,EAAG,gBAAiB,WAAW,EAC9D,YAAa,CAAE,cAAe,EAAG,gBAAiB,UAAU,EAC5D,uBAAwB,CAAE,cAAe,CAAC,EAC1C,aAAc,CAAE,cAAe,CAAC,EAChC,wBAAyB,CAAE,cAAe,CAAC,EAC3C,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,cAAe,OACf,cAAe,OACf,eAAgB,OAChB,eAAgB,OAChB,kBAAmB,OACnB,iBAAkB,OAClB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,mBAAoB,OACpB,wBAAyB,OACzB,kBAAmB,OACnB,uBAAwB,OACxB,eAAgB,OAChB,eAAgB,OAChB,gBAAiB,OACjB,gBAAiB,OACjB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,kBAAmB,OACnB,uBAAwB,OACxB,kBAAmB,OACnB,uBAAwB,OACxB,kBAAmB,OACnB,uBAAwB,OACxB,mBAAoB,OACpB,wBAAyB,OACzB,mBAAoB,OACpB,wBAAyB,OACzB,mBAAoB,OACpB,wBAAyB,MAC3B,EAwBA,MAAMC,EAAS,CACb,aAAc,CAIZhB,GAAc,KAAM,OAAwB,IAAI,OAAS,EACzDA,GAAc,KAAM,QAAS,CAAC,CAChC,CACA,IAAI,MAAO,CACT,OAAO,KAAK,KACd,CAOA,IAAIiB,EAAM,CACR,MAAMC,EAAaD,EAAK,OACxB,IAAIE,EAAM,KAAK,KACXrB,EACJ,QAASsB,EAAI,EAAGC,EAAIH,EAAa,EAAGE,EAAIC,EAAGD,IAGzC,GAFAtB,EAAMwB,EAAQL,EAAKG,CAAC,CAAC,EACrBD,EAAMA,EAAI,IAAIrB,CAAG,EACbqB,IAAQ,OAAQ,OAEtB,OAAArB,EAAMwB,EAAQL,EAAKC,EAAa,CAAC,CAAC,EAC3BC,EAAI,IAAIrB,CAAG,CACpB,CASA,IAAImB,EAAMlB,EAAO,CACf,MAAMmB,EAAaD,EAAK,OACxB,IAAIE,EAAM,KAAK,KACXrB,EACJ,QAAS,EAAI,EAAG,EAAIoB,EAAa,EAAG,IAClCpB,EAAMwB,EAAQL,EAAK,CAAC,CAAC,EAChBE,EAAI,IAAIrB,CAAG,GACdqB,EAAI,IAAIrB,EAAqB,IAAI,OAAS,EAE5CqB,EAAMA,EAAI,IAAIrB,CAAG,EAEnB,OAAAA,EAAMwB,EAAQL,EAAKC,EAAa,CAAC,CAAC,EAC7BC,EAAI,IAAIrB,CAAG,IACdqB,EAAI,IAAIrB,EAAKC,CAAK,EAClB,KAAK,SAEAA,CACT,CAOA,OAAOkB,EAAM,CACX,MAAMC,EAAaD,EAAK,OACxB,IAAIE,EAAM,KAAK,KACXrB,EACJ,QAAS,EAAI,EAAG,EAAIoB,EAAa,EAAG,IAGlC,GAFApB,EAAMwB,EAAQL,EAAK,CAAC,CAAC,EACrBE,EAAMA,EAAI,IAAIrB,CAAG,EACbqB,IAAQ,OAAQ,MAAO,GAE7BrB,EAAMwB,EAAQL,EAAKC,EAAa,CAAC,CAAC,EAClC,MAAMK,EAASJ,EAAI,OAAOrB,CAAG,EAC7B,OAAIyB,GAAQ,KAAK,QACVA,CACT,CACF,CACA,MAAMC,GAAyB,IAAI,IACnC,IAAIC,GAAY,EAChB,SAASH,EAAQxB,EAAK,CACpB,GAAI,OAAOA,GAAQ,UAAYA,IAAQ,KACrC,OAAOA,EAET,GAAI0B,GAAO,IAAI1B,CAAG,EAChB,OAAO0B,GAAO,IAAI1B,CAAG,EAGvB,MAAM4B,EAAU,CACd,KAFSD,KAGT,QAAS3B,CACb,EACE,OAAA0B,GAAO,IAAI1B,EAAK4B,CAAO,EAChBA,CACT,CAQA,QAAQ,IAAI,2BAA2B,ECvZhC,MAAMC,GAAwD,CACjE,MAAO,GACP,QAAS,GACT,UAAW,GACX,mBAAoB,GACpB,sBAAuB,GACvB,gBAAiB,UACjB,6BAA8B,EAClC,ECjCA,IAAIhC,GAAY,OAAO,eACnBC,GAAkB,CAACC,EAAKC,EAAKC,IAAUD,KAAOD,EAAMF,GAAUE,EAAKC,EAAK,CAAE,WAAY,GAAM,aAAc,GAAM,SAAU,GAAM,MAAAC,EAAO,EAAIF,EAAIC,CAAG,EAAIC,EACtJC,EAAgB,CAACH,EAAKC,EAAKC,IAAUH,GAAgBC,EAAK,OAAOC,GAAQ,SAAWA,EAAM,GAAKA,EAAKC,CAAK,EACzGc,GAAIe,GACR,MAAMC,GAAc,MAAMA,EAAY,CACpC,aAAc,CAIZ7B,EAAc,KAAM,QAAQ,EAY5BA,EAAc,KAAM,WAA4B,IAAI,GAAK,CAC3D,CAOA,IAAI,OAAQ,CACV,YAAK,MAAA,EACE,KAAK,MACd,CASA,OAAQ,CACN,GAAI,CAAC6B,GAAY,kBAAoB,CAACC,EAAc,OACpD,MAAMC,EAASF,GAAY,iBACvBE,GACF,KAAK,SAAS,IAAIA,EAAQA,EAAO,QAAQ,CAE7C,CAaA,SAAU,CACR,KAAK,SAAS,QAAQ,CAACC,EAASD,IAAW,CACrCA,EAAO,WAAaC,IACxBD,EAAO,QAAA,EACPA,EAAO,UAAU,IAAI,KAAM,KAAK,MAAM,EACxC,CAAC,EACD,KAAK,SAAS,MAAA,CAChB,CACF,EASA/B,EAAc6B,GAAa,kBAAkB,EAC7C,IAAII,EAAaJ,GACjB,SAASK,GAAWC,EAAI,CACtB,MAAMC,EAAiBN,EACvBA,EAAe,GACf,MAAMP,EAASY,EAAA,EACf,OAAAL,EAAeM,EACRb,CACT,CACA,SAASc,GAAQF,EAAI,CACnB,MAAMC,EAAiBN,EACvBA,EAAe,GACf,MAAMP,EAASY,EAAA,EACf,OAAAL,EAAeM,EACRb,CACT,CACA,IAAIO,EAAe,GACnB,SAASQ,GAAMC,EAAKC,EAAW,CAC7B,GAAIA,EAAW,CACb,GAAIC,GAAa,QAAQF,CAAG,IAAM,GAChC,OAEFE,GAAa,KAAKF,CAAG,CACvB,KAAO,CACL,GAAIG,GAAgB,QAAQH,CAAG,IAAM,GACnC,OAEFG,GAAgB,KAAKH,CAAG,CAC1B,CACF,CACA,SAASI,GAASR,EAAI,CACpBS,KACA,MAAMrB,EAASY,EAAA,EACf,GAAI,IAAES,GAAc,GAGpB,OAAIH,GAAa,OAAS,IACxBA,GAAa,QAASF,GAAQ,CACjB,QAAQ,OAAOA,EAAI,WAAa,GAAO,qBAAqB,EACvEA,EAAI,UAAU,QAAQ,CAACP,EAASa,IAAS,CACvCA,EAAK,SAAS,IAAIN,EAAKA,EAAI,QAAQ,CACrC,CAAC,EACDA,EAAI,UAAU,MAAA,CAChB,CAAC,EACDE,GAAa,OAAS,GAEpBC,GAAgB,OAAS,IAC3BA,GAAgB,QAASH,GAAQ,CAC/B,MAAMO,EAAMb,EAAW,iBACvBA,EAAW,iBAAmB,KAC9BM,EAAI,WAAA,EACJN,EAAW,iBAAmBa,CAChC,CAAC,EACDJ,GAAgB,OAAS,GAEpBnB,CACT,CACA,IAAIqB,GAAc,EAClB,MAAMF,GAAkB,CAAA,EAClBD,GAAe,CAAA,EAIrB,MAAMM,WAA2Bd,CAAW,CAM1C,YAAYe,EAAM,CAChB,MAAA,EAMAhD,EAAc,KAAM,YAAa,EAAI,EAOrCA,EAAc,KAAM,OAAO,EAS3BA,EAAc,KAAM,YAA6B,IAAI,GAAK,EAU1DA,EAAc,KAAM,WAAY,EAAI,EAUpCA,EAAc,KAAM,WAAY,EAAE,EAClC,KAAK,MAAQgD,CACf,CASA,IAAI,OAAQ,CACV,YAAK,WAAA,EACL,KAAK,MAAA,EACE,KAAK,MACd,CAQA,SAAU,CACJf,EAAW,mBAAqB,MAClCK,GAAM,KAAML,EAAW,mBAAqB,IAAI,EAElD,MAAM,QAAA,CACR,CAWA,KAAM,CACJC,GAAW,IAAM,CACf,MAAMe,EAAqBhB,EAAW,iBACtCA,EAAW,iBAAmB,KAC9B,KAAK,WACL,KAAK,OAAS,KAAK,MAAM,KAAK,MAAM,EACpCA,EAAW,iBAAmBgB,CAChC,CAAC,CACH,CAUA,YAAa,CACX,KAAK,SAAW,KAAK,UAAY,KAAK,kBAAA,EAClC,KAAK,WACP,KAAK,SAAW,GAChB,KAAK,IAAA,EAET,CAeA,mBAAoB,CAClB,GAAI,KAAK,UAAU,OAAS,EAAG,MAAO,GACtC,IAAIC,EAAY,GAChB,MAAMC,EAAkBlB,EAAW,iBACnC,OAAAA,EAAW,iBAAmB,KAC9B,KAAK,UAAU,QAAQ,CAAClC,EAAO8C,IAAS,CACtC,GAAI,CAAAK,GACAL,EAAK,QAAU9C,EAAO,CACxBmD,EAAY,GACZ,MACF,CACF,CAAC,EACDjB,EAAW,iBAAmBkB,EACzBD,GACH,KAAK,UAAU,QAAQ,CAAClB,EAASa,IAAS,CACxCA,EAAK,SAAS,IAAI,KAAM,KAAK,QAAQ,CACvC,CAAC,EAEH,KAAK,UAAU,MAAA,EACRK,CACT,CACF,CACA,IAAIE,GAAkCC,IACpCA,EAAe,YAAiB,iBAChCA,EAAe,IAAS,UACxBA,EAAe,OAAY,YACpBA,IACND,GAAiB,CAAA,CAAE,EAClBE,GAA+BC,IACjCA,EAAYA,EAAY,QAAa,CAAC,EAAI,UAC1CA,EAAYA,EAAY,OAAY,CAAC,EAAI,SACzCA,EAAYA,EAAY,WAAgB,CAAC,EAAI,aACtCA,IACND,GAAc,CAAA,CAAE,EACfE,GAAiCC,IACnCA,EAAc,IAAS,MACvBA,EAAc,IAAS,MACvBA,EAAc,QAAa,UACpBA,IACND,GAAgB,CAAA,CAAE,EACjBE,GAAmCC,IACrCA,EAAgB,IAAS,MACzBA,EAAgB,IAAS,MACzBA,EAAgB,OAAY,SAC5BA,EAAgB,MAAW,QACpBA,IACND,GAAkB,CAAA,CAAE,EACvB,MAAME,EAAc,OAAiB,gBAAqB,EACpDC,GAAsB,OAAiB,kBAAuB,EAC9DC,GAAoB,OAAiB,eAAoB,EAC/D,WAAW,UAAY,WAAW,QAAU,IAC5C,MAAMC,GAAYC,GAAQA,IAAQ,MAAQ,OAAOA,GAAQ,SACnDC,GAAU,MAAM,QAChBC,GAAYF,GAAQ,OAAOA,GAAQ,SACnCG,GAAYH,GAAQ,OAAOA,GAAQ,SACnCI,GAAgBtE,GAAQqE,GAASrE,CAAG,GAAKA,IAAQ,OAASA,EAAI,CAAC,IAAM,KAAO,GAAG,SAASA,EAAK,EAAE,CAAC,KAAOA,EACvGuE,GAASL,GAAQM,GAAaN,CAAG,IAAM,eACvCO,GAAS,CAACP,EAAKlE,IAAQ,OAAO,UAAU,eAAe,KAAKkE,EAAKlE,CAAG,EACpE0E,GAAa,CAACzE,EAAO0E,IAAa,CAAC,OAAO,GAAG1E,EAAO0E,CAAQ,EAClE,SAASC,GAAcC,EAAS,CAC9B,OAAQA,EAAA,CACN,IAAK,SACL,IAAK,QACH,OAAOrB,EAAW,OACpB,IAAK,MACL,IAAK,MACL,IAAK,UACL,IAAK,UACH,OAAOA,EAAW,WACpB,QACE,OAAOA,EAAW,MAAA,CAExB,CACA,SAASsB,GAAc7E,EAAO,CAC5B,OAAK,OAAO,aAAaA,CAAK,EACvB2E,GAAcG,GAAU9E,CAAK,CAAC,EADGuD,EAAW,OAErD,CACA,MAAMgB,GAAgBvE,GAAU,OAAO,UAAU,SAAS,KAAKA,CAAK,EAC9D8E,GAAa9E,GAEjBuE,GAAavE,CAAK,EAAE,MAAM,EAAG,EAAE,EAEjC,SAAS+E,EAAMC,EAAU,CACvB,MAAMC,EAAMD,GAAYA,EAAS3B,EAAc,GAAG,EAClD,OAAO4B,EAAMF,EAAME,CAAG,EAAID,CAC5B,CACA,SAASE,GAAKC,KAAQC,EAAM,CAC1B,QAAQ,KAAK,QAAQD,CAAG,GAAI,GAAGC,CAAI,CACrC,CAEA,SAASC,GAAQC,EAAK,CACpB,MAAMlE,EAAsB,OAAO,OAAO,IAAI,EAC9C,UAAWrB,KAAOuF,EAAI,MAAM,GAAG,EAAGlE,EAAIrB,CAAG,EAAI,EAC7C,OAAQkE,GAAQA,KAAO7C,CACzB,CAmMA,SAASmE,GAAOnD,EAAI,CAClB,OAAO,IAAIoD,GAAiBpD,CAAE,CAChC,CACA,MAAMqD,GAAoB,MAAMA,WAA0BzC,EAAmB,CAC3E,YAAYC,EAAM,CAChB,MAAMA,CAAI,EAMVhD,EAAc,KAAM,YAAa,EAAI,EAIrC,KAAK,WAAA,CACP,CAMA,OAAQ,CACN,KAAK,UAAY,EACnB,CAMA,QAAS,CACH,KAAK,YACT,KAAK,UAAY,GACbwF,GAAkB,mBAAmB,IAAI,IAAI,IAC/CA,GAAkB,mBAAmB,OAAO,IAAI,EAChD,KAAK,QAAA,GAET,CAMA,MAAO,CACL,KAAK,UAAY,GACjBA,GAAkB,mBAAmB,OAAO,IAAI,CAClD,CAMA,SAAU,CACR7C,GAAS,IAAM,CACb,MAAM,QAAA,EACF,KAAK,UACPL,GAAM,KAAML,EAAW,mBAAqB,IAAI,EAEhDuD,GAAkB,mBAAmB,IAAI,IAAI,CAEjD,CAAC,CACH,CAMA,KAAM,CACA,KAAK,UACP,MAAM,IAAA,EAEN,KAAK,MAAM,KAAK,MAAM,CAE1B,CACF,EACAxF,EAAcwF,GAAmB,qBAAsC,IAAI,OAAS,EACpF,IAAID,GAAmBC,GACvB,SAASC,GAASC,EAAQ5F,EAAK,CAC7B,IAAI6F,EAAUC,EAAmB,WAAW,IAAIF,CAAM,EACjDC,IACHA,MAA8B,IAC9BC,EAAmB,WAAW,IAAIF,EAAQC,CAAO,GAEnD,IAAIpD,EAAMoD,EAAQ,IAAI7F,CAAG,EACzB,OAAKyC,IACHA,EAAM,IAAIqD,EAAmBF,EAAQ5F,CAAG,EACxC6F,EAAQ,IAAI7F,EAAKyC,CAAG,GAEfA,CACT,CACA,MAAMqD,UAA2B3D,CAAW,CAC1C,YAAYyD,EAAQ5F,EAAK,CACvB,MAAA,EACAE,EAAc,KAAM,SAAS,EAC7BA,EAAc,KAAM,MAAM,EAC1B,KAAK,QAAU0F,EACf,KAAK,KAAO5F,EACR4F,aAAkB,KAAOA,aAAkB,QAC7C,KAAK,OAASA,EAAO,IAAI5F,CAAG,EACnB4F,aAAkB,KAAOA,aAAkB,QACpD,KAAK,OAASA,EAAO,IAAI5F,CAAG,EAE5B,KAAK,OAAS4F,EAAO5F,CAAG,CAE5B,CAMA,IAAI,OAAQ,CACV,YAAK,MAAA,EACE,KAAK,MACd,CACA,IAAI,MAAM+F,EAAG,CACP,KAAK,OAAS,SAChBA,EAAI,KAAK,QAAQ,OACR3B,GAAS,KAAK,IAAI,IAC3B2B,EAAI,CAAC,CAAC,KAAK,OAAS,GAElBA,IAAM,KAAK,SACf,KAAK,QAAA,EACL,KAAK,OAASA,EAChB,CACA,kBAAmB,CACnB,CAUA,OAAO,MAAMH,EAAQI,EAAMhG,EAAK,CAC9B,GAAI,CAACmC,EAAW,iBAAkB,OACtBwD,GAASC,EAAQ5F,CAAG,EAC5B,MAAA,CACN,CAWA,OAAO,QAAQ4F,EAAQI,EAAMhG,EAAKiG,EAAUtB,EAAU,CACpD,MAAMkB,EAAU,KAAK,WAAW,IAAID,CAAM,EAC1C,GAAI,CAACC,EAAS,OACd,MAAMK,EAAOzD,GAAQ,CACfA,IACFA,EAAI,MAAQwD,EAEhB,EACApD,GAAS,IAAM,CACb,GAAImD,IAASpC,EAAe,MAC1BiC,EAAQ,QAAQK,CAAG,MACd,CACL,MAAMC,EAAgBhC,GAAQyB,CAAM,EAC9BQ,EAAeD,GAAiB7B,GAAatE,CAAG,EACtD,GAAImG,GAAiBnG,IAAQ,SAAU,CACrC,MAAMqG,EAAY,OAAOJ,CAAQ,EACjCJ,EAAQ,QAAQ,CAACpD,EAAK6D,IAAS,EACzBA,IAAS,UAAYA,IAAStC,IAAqB,CAACI,GAASkC,CAAI,GAAKA,GAAQD,IAChFH,EAAIzD,CAAG,CAEX,CAAC,CACH,KAOE,SANIzC,IAAQ,QAAU6F,EAAQ,IAAI,MAAM,IACtCK,EAAIL,EAAQ,IAAI7F,CAAG,CAAC,EAElBoG,GACFF,EAAIL,EAAQ,IAAI7B,EAAiB,CAAC,EAE5BgC,EAAA,CACN,KAAKpC,EAAe,IACbuC,EAKMC,GACTF,EAAIL,EAAQ,IAAI,QAAQ,CAAC,GALzBK,EAAIL,EAAQ,IAAI/B,CAAW,CAAC,EACxBS,GAAMqB,CAAM,GACdM,EAAIL,EAAQ,IAAI9B,EAAmB,CAAC,GAKxC,MACF,KAAKH,EAAe,OACbuC,IACHD,EAAIL,EAAQ,IAAI/B,CAAW,CAAC,EACxBS,GAAMqB,CAAM,GACdM,EAAIL,EAAQ,IAAI9B,EAAmB,CAAC,GAGxC,MACF,KAAKH,EAAe,IACdW,GAAMqB,CAAM,GACdM,EAAIL,EAAQ,IAAI/B,CAAW,CAAC,EAE9B,KAAA,CAGR,CACF,CAAC,CACH,CACF,CAIA5D,EAAc4F,EAAoB,aAA8B,IAAI,OAAS,EAC7E,MAAMS,GAAwB,CAC5B,UAAW,KAWX,CAAC,OAAO,QAAQ,GAAI,CAClB,OAAOC,GAAS,KAAM,OAAO,SAAUC,CAAU,CACnD,EAYA,UAAUpB,EAAM,CACd,OAAOqB,EAAkB,IAAI,EAAE,OAC7B,GAAGrB,EAAK,IAAKsB,GAAMxC,GAAQwC,CAAC,EAAID,EAAkBC,CAAC,EAAIA,CAAC,CAAA,CAE5D,EAWA,SAAU,CACR,OAAOH,GAAS,KAAM,UAAYvG,IAChCA,EAAM,CAAC,EAAIwG,EAAWxG,EAAM,CAAC,CAAC,EACvBA,EACR,CACH,EAcA,MAAMoC,EAAIuE,EAAS,CACjB,OAAOC,EAAM,KAAM,QAASxE,EAAIuE,EAAS,OAAQ,SAAS,CAC5D,EAcA,OAAOvE,EAAIuE,EAAS,CAClB,OAAOC,EAAM,KAAM,SAAUxE,EAAIuE,EAAUb,GAAMA,EAAE,IAAIU,CAAU,EAAG,SAAS,CAC/E,EAcA,KAAKpE,EAAIuE,EAAS,CAChB,OAAOC,EAAM,KAAM,OAAQxE,EAAIuE,EAASH,EAAY,SAAS,CAC/D,EAcA,UAAUpE,EAAIuE,EAAS,CACrB,OAAOC,EAAM,KAAM,YAAaxE,EAAIuE,EAAS,OAAQ,SAAS,CAChE,EAcA,SAASvE,EAAIuE,EAAS,CACpB,OAAOC,EAAM,KAAM,WAAYxE,EAAIuE,EAASH,EAAY,SAAS,CACnE,EAcA,cAAcpE,EAAIuE,EAAS,CACzB,OAAOC,EAAM,KAAM,gBAAiBxE,EAAIuE,EAAS,OAAQ,SAAS,CACpE,EAcA,QAAQvE,EAAIuE,EAAS,CACnB,OAAOC,EAAM,KAAM,UAAWxE,EAAIuE,EAAS,OAAQ,SAAS,CAC9D,EAYA,YAAYvB,EAAM,CAChB,OAAOyB,GAAY,KAAM,WAAYzB,CAAI,CAC3C,EAYA,WAAWA,EAAM,CACf,OAAOyB,GAAY,KAAM,UAAWzB,CAAI,CAC1C,EAYA,KAAK0B,EAAW,CACd,OAAOL,EAAkB,IAAI,EAAE,KAAKK,CAAS,CAC/C,EAaA,eAAe1B,EAAM,CACnB,OAAOyB,GAAY,KAAM,cAAezB,CAAI,CAC9C,EAcA,IAAIhD,EAAIuE,EAAS,CACf,OAAOC,EAAM,KAAM,MAAOxE,EAAIuE,EAAS,OAAQ,SAAS,CAC1D,EAWA,KAAM,CACJ,OAAOI,GAAW,KAAM,KAAK,CAC/B,EAYA,QAAQ3B,EAAM,CACZ,OAAO2B,GAAW,KAAM,OAAQ3B,CAAI,CACtC,EAcA,OAAOhD,KAAOgD,EAAM,CAClB,OAAO4B,GAAO,KAAM,SAAU5E,EAAIgD,CAAI,CACxC,EAcA,YAAYhD,KAAOgD,EAAM,CACvB,OAAO4B,GAAO,KAAM,cAAe5E,EAAIgD,CAAI,CAC7C,EAWA,OAAQ,CACN,OAAO2B,GAAW,KAAM,OAAO,CACjC,EAeA,KAAK3E,EAAIuE,EAAS,CAChB,OAAOC,EAAM,KAAM,OAAQxE,EAAIuE,EAAS,OAAQ,SAAS,CAC3D,EAYA,UAAUvB,EAAM,CACd,OAAO2B,GAAW,KAAM,SAAU3B,CAAI,CACxC,EAWA,YAAa,CACX,OAAOqB,EAAkB,IAAI,EAAE,WAAA,CACjC,EAYA,SAASQ,EAAU,CACjB,OAAOR,EAAkB,IAAI,EAAE,SAASQ,CAAQ,CAClD,EAYA,aAAa7B,EAAM,CACjB,OAAOqB,EAAkB,IAAI,EAAE,UAAU,GAAGrB,CAAI,CAClD,EAYA,WAAWA,EAAM,CACf,OAAO2B,GAAW,KAAM,UAAW3B,CAAI,CACzC,EAWA,QAAS,CACP,OAAOmB,GAAS,KAAM,SAAUC,CAAU,CAC5C,CACF,EACA,SAASD,GAASW,EAAMC,EAAQC,EAAW,CACzC,MAAMC,EAAMC,GAAiBJ,CAAI,EAC3BK,EAAOF,EAAIF,CAAM,EAAA,EACvB,OAAIE,IAAQH,IACVK,EAAK,MAAQA,EAAK,KAClBA,EAAK,KAAO,IAAM,CAChB,MAAM/F,EAAS+F,EAAK,MAAA,EACpB,OAAI/F,EAAO,QACTA,EAAO,MAAQ4F,EAAU5F,EAAO,KAAK,GAEhCA,CACT,GAEK+F,CACT,CACA,SAASD,GAAiBD,EAAK,CAC7B,OAAAxB,EAAmB,MAAMwB,EAAMtC,EAAMsC,CAAG,EAAG5D,EAAa,QAASM,EAAiB,EAC3EsD,CACT,CACA,SAASZ,EAAkBe,EAAO,CAChC,MAAMvC,EAAMF,EAAMyC,CAAK,EACvB,OAAIvC,IAAQuC,EAAcvC,GAC1BY,EAAmB,MAAMZ,EAAKxB,EAAa,QAASM,EAAiB,EAC9DkB,EAAI,IAAIuB,CAAU,EAC3B,CACA,SAASI,EAAMM,EAAMC,EAAQ/E,EAAIuE,EAASc,EAAcrC,EAAM,CAC5D,MAAMiC,EAAMC,GAAiBJ,CAAI,EAC3BQ,EAAYL,IAAQH,EACpBS,EAAWN,EAAIF,CAAM,EAC3B,GAAIQ,IAAa,MAAM,UAAUR,CAAM,EAAG,CACxC,MAAMS,EAAUD,EAAS,MAAMT,EAAM9B,CAAI,EACzC,OAAOsC,EAAYlB,EAAWoB,CAAO,EAAIA,CAC3C,CACA,IAAIC,EAAYzF,EACZiF,IAAQH,IACNQ,EACFG,EAAY,SAASC,EAAMC,EAAO,CAChC,OAAO3F,EAAG,KAAK,KAAMoE,EAAWsB,CAAI,EAAGC,EAAOb,CAAI,CACpD,EACS9E,EAAG,OAAS,IACrByF,EAAY,SAASC,EAAMC,EAAO,CAChC,OAAO3F,EAAG,KAAK,KAAM0F,EAAMC,EAAOb,CAAI,CACxC,IAGJ,MAAM1F,EAASmG,EAAS,KAAKN,EAAKQ,EAAWlB,CAAO,EACpD,OAAOe,GAAaD,EAAeA,EAAajG,CAAM,EAAIA,CAC5D,CACA,SAASwF,GAAOE,EAAMC,EAAQ/E,EAAIgD,EAAM,CACtC,MAAMiC,EAAMC,GAAiBJ,CAAI,EACjC,IAAIW,EAAYzF,EAChB,OAAIiF,IAAQH,IACVW,EAAY,SAASG,EAAKF,EAAMC,EAAO,CACrC,OAAO3F,EAAG,KAAK,KAAM4F,EAAKxB,EAAWsB,CAAI,EAAGC,EAAOb,CAAI,CACzD,GAEKG,EAAIF,CAAM,EAAEU,EAAW,GAAGzC,CAAI,CACvC,CACA,SAASyB,GAAYK,EAAMC,EAAQ/B,EAAM,CACvC,MAAMiC,EAAMtC,EAAMmC,CAAI,EACtBrB,EAAmB,MAAMwB,EAAK5D,EAAa,QAASM,EAAiB,EACrE,MAAMkE,EAAMZ,EAAIF,CAAM,EAAE,GAAG/B,CAAI,EAC/B,OAAK6C,IAAQ,IAAMA,IAAQ,KAAUC,GAAQ9C,EAAK,CAAC,CAAC,GAClDA,EAAK,CAAC,EAAIL,EAAMK,EAAK,CAAC,CAAC,EAChBiC,EAAIF,CAAM,EAAE,GAAG/B,CAAI,GAErB6C,CACT,CACA,SAASlB,GAAWG,EAAMC,EAAQ/B,EAAO,CAAA,EAAI,CAM3C,OALYxC,GACV,IAAMN,GACJ,IAAMyC,EAAMmC,CAAI,EAAEC,CAAM,EAAE,MAAMD,EAAM9B,CAAI,CAAA,CAC5C,CAGJ,CAOA,SAAS+C,GAAMC,EAAG,CAChB,OAAOA,EAAIA,EAAE/E,EAAc,MAAM,IAAM,GAAO,EAChD,CACA,MAAMgF,WAAuBxG,GAAKK,EAAYpB,GAAKuC,EAAc,OAAQxB,GAAI,CAM3E,YAAY7B,EAAO,CACjB,MAAA,EAMAC,EAAc,KAAMa,GAAI,EAAI,EAS5Bb,EAAc,KAAM,WAAW,EAC/B,KAAK,UAAY8E,EAAM/E,CAAK,EAC5B,KAAK,OAASwG,EAAWxG,CAAK,CAChC,CAQA,IAAI,OAAQ,CACV,YAAK,MAAA,EACE,KAAK,MACd,CAaA,IAAI,MAAM8F,EAAG,CACX,MAAMpB,EAAW,KAAK,UAChBsB,EAAWjB,EAAMe,CAAC,EACnBrB,GAAWC,EAAUsB,CAAQ,GAClCpD,GAAS,IAAM,CACb,KAAK,QAAA,EACL,KAAK,UAAYoD,EACjB,KAAK,OAASQ,EAAWR,CAAQ,CACnC,CAAC,CACH,CACF,CACA,MAAMsC,EAAoB,CAiBxB,IAAI3C,EAAQ5F,EAAKwI,EAAU,CACzB,GAAIxI,IAAQsD,EAAc,YACxB,MAAO,GACT,GAAWtD,IAAQsD,EAAc,IAC/B,OAAIkF,IAAaC,GAAY,IAAI7C,CAAM,GAAK,OAAO,eAAeA,CAAM,IAAM,OAAO,eAAe4C,CAAQ,EACnG5C,EAET,OAEF,MAAMO,EAAgBhC,GAAQyB,CAAM,EACpC,IAAIvD,EACJ,GAAI8D,IAAkB9D,EAAKkE,GAAsBvG,CAAG,GAClD,OAAOqC,EAET,GAAIrC,IAAQ,iBACV,OAAO0I,GAET,MAAMR,EAAM,QAAQ,IAClBtC,EACA5F,EACAoI,GAAMxC,CAAM,EAAIA,EAAS4C,CAAA,EAE3B,OAAIpE,GAASpE,CAAG,EAAI2I,GAAe,IAAI3I,CAAG,EAAI4I,GAAmB5I,CAAG,GAC3DkI,GAETpC,EAAmB,MAAMF,EAAQlC,EAAa,IAAK1D,CAAG,EAClDoI,GAAMF,CAAG,EACJ/B,GAAiB7B,GAAatE,CAAG,EAAIkI,EAAMA,EAAI,MAEpDjE,GAASiE,CAAG,EACPW,EAASX,CAAG,EAEdA,EACT,CACF,CACA,MAAMY,WAA+BP,EAAoB,CAgBvD,IAAI3C,EAAQ5F,EAAKC,EAAOuI,EAAU,CAChC,IAAI7D,EAAWiB,EAAO5F,CAAG,EAGzB,GAFA2E,EAAWK,EAAML,CAAQ,EACzB1E,EAAQ+E,EAAM/E,CAAK,EACf,CAACkE,GAAQyB,CAAM,GAAKwC,GAAMzD,CAAQ,GAAK,CAACyD,GAAMnI,CAAK,EACrD,OAAA0E,EAAS,MAAQ1E,EACV,GAET,MAAM8I,EAAS5E,GAAQyB,CAAM,GAAKtB,GAAatE,CAAG,EAAI,OAAOA,CAAG,EAAI4F,EAAO,OAASnB,GAAOmB,EAAQ5F,CAAG,EAChGyB,EAAS,QAAQ,IACrBmE,EACA5F,EACAC,EACAmI,GAAMxC,CAAM,EAAIA,EAAS4C,CAAA,EAEhB,eAAQ,OAAO5C,IAAWZ,EAAMwD,CAAQ,CAAC,EAChD5C,IAAWZ,EAAMwD,CAAQ,IACtBO,EAEMrE,GAAWzE,EAAO0E,CAAQ,GACnCmB,EAAmB,QAAQF,EAAQhC,EAAe,IAAK5D,EAAKC,EAAO0E,CAAQ,EAF3EmB,EAAmB,QAAQF,EAAQhC,EAAe,IAAK5D,EAAKC,CAAK,GAK9DwB,CACT,CAYA,eAAemE,EAAQ5F,EAAK,CAC1B,MAAM+I,EAAStE,GAAOmB,EAAQ5F,CAAG,EAC3B2E,EAAWiB,EAAO5F,CAAG,EACrByB,EAAS,QAAQ,eAAemE,EAAQ5F,CAAG,EACjD,OAAIyB,GAAUsH,GACZjD,EAAmB,QAAQF,EAAQhC,EAAe,OAAQ5D,EAAK,OAAQ2E,CAAQ,EAE1ElD,CACT,CAYA,IAAImE,EAAQ5F,EAAK,CACf,MAAMyB,EAAS,QAAQ,IAAImE,EAAQ5F,CAAG,EACtC,OAAI,CAACoE,GAASpE,CAAG,GAAK,CAAC2I,GAAe,IAAI3I,CAAG,IAC3C8F,EAAmB,MAAMF,EAAQlC,EAAa,IAAK1D,CAAG,EAEjDyB,CACT,CAWA,QAAQmE,EAAQ,CACd,OAAAE,EAAmB,MACjBF,EACAlC,EAAa,QACbS,GAAQyB,CAAM,EAAI,SAAW9B,CAAA,EAExB,QAAQ,QAAQ8B,CAAM,CAC/B,CACF,CACA,MAAMoD,GAAkB,IAAIF,GAC5B,SAASJ,GAAe1I,EAAK,CACtBoE,GAASpE,CAAG,IAAGA,EAAM,OAAOA,CAAG,GACpC,MAAMD,EAAMiF,EAAM,IAAI,EACtB,OAAAc,EAAmB,MAAM/F,EAAK2D,EAAa,IAAK1D,CAAG,EAC5CD,EAAI,eAAeC,CAAG,CAC/B,CACA,MAAM2I,GAAiB,IAAI,IACT,OAAO,oBAAoB,MAAM,EAAE,OAAQ3I,GAAQA,IAAQ,aAAeA,IAAQ,QAAQ,EAAE,IAAKA,GAAQ,OAAOA,CAAG,CAAC,EAAE,OAAOoE,EAAQ,CACvJ,EACMwE,MAA6C,6BAA6B,EAC1EK,GAA4B,CAChC,IAAKC,GAAA,CACP,EACA,SAASA,IAA8B,CACrC,MAAMC,EAAmBC,GAAA,EACzB,MAAO,CAACxD,EAAQ5F,EAAKwI,IACfxI,IAAQsD,EAAc,YACjB,GACEtD,IAAQsD,EAAc,IACxBsC,EAEF,QAAQ,IACbnB,GAAO0E,EAAkBnJ,CAAG,GAAKA,KAAO4F,EAASuD,EAAmBvD,EACpE5F,EACAwI,CAAA,CAGN,CACA,SAASY,IAAyB,CAChC,MAAMD,EAAmB,CAYvB,IAAInJ,EAAK,CACP,MAAM4F,EAAS,KAAKtC,EAAc,GAAG,EAC/B+F,EAAYrE,EAAMY,CAAM,EACxB0D,EAAStE,EAAMhF,CAAG,EACpB0E,GAAW1E,EAAKsJ,CAAM,GACxBxD,EAAmB,MAAMuD,EAAW3F,EAAa,IAAK1D,CAAG,EAE3D8F,EAAmB,MAAMuD,EAAW3F,EAAa,IAAK4F,CAAM,EAC5D,KAAM,CAAE,IAAAC,CAAA,EAAQC,GAASH,CAAS,EAC5BI,EAAOhD,EACb,GAAI8C,EAAI,KAAKF,EAAWrJ,CAAG,EACzB,OAAOyJ,EAAK7D,EAAO,IAAI5F,CAAG,CAAC,EAC7B,GAAWuJ,EAAI,KAAKF,EAAWC,CAAM,EACnC,OAAOG,EAAK7D,EAAO,IAAI0D,CAAM,CAAC,EACrB1D,IAAWyD,GACpBzD,EAAO,IAAI5F,CAAG,CAElB,EAQA,IAAI,MAAO,CACT,MAAM4F,EAAS,KAAKtC,EAAc,GAAG,EACrC,OAAAwC,EAAmB,MAAMd,EAAMY,CAAM,EAAGlC,EAAa,QAASI,CAAW,EAClE,QAAQ,IAAI8B,EAAQ,OAAQA,CAAM,CAC3C,EAWA,IAAI5F,EAAK,CACP,MAAM4F,EAAS,KAAKtC,EAAc,GAAG,EAC/B+F,EAAYrE,EAAMY,CAAM,EACxB0D,EAAStE,EAAMhF,CAAG,EACxB,OAAI0E,GAAW1E,EAAKsJ,CAAM,GACxBxD,EAAmB,MAAMuD,EAAW3F,EAAa,IAAK1D,CAAG,EAE3D8F,EAAmB,MAAMuD,EAAW3F,EAAa,IAAK4F,CAAM,EACrDtJ,IAAQsJ,EAAS1D,EAAO,IAAI5F,CAAG,EAAI4F,EAAO,IAAI5F,CAAG,GAAK4F,EAAO,IAAI0D,CAAM,CAChF,EAYA,QAAQI,EAAU9C,EAAS,CACzB,MAAM3B,EAAW,KACXW,EAASX,EAAS3B,EAAc,GAAG,EACnC+F,EAAYrE,EAAMY,CAAM,EACxB6D,EAAOhD,EACb,OAAAX,EAAmB,MAAMuD,EAAW3F,EAAa,QAASI,CAAW,EAC9D8B,EAAO,QACZ,CAAC3F,EAAOD,IAIN0J,EAAS,KAAK9C,EAAS6C,EAAKxJ,CAAK,EAAGwJ,EAAKzJ,CAAG,EAAGiF,CAAQ,CAAA,CAG7D,EAYA,IAAIhF,EAAO,CACTA,EAAQ+E,EAAM/E,CAAK,EACnB,MAAM2F,EAASZ,EAAM,IAAI,EAGzB,OAFcwE,GAAS5D,CAAM,EACR,IAAI,KAAKA,EAAQ3F,CAAK,IAEzC2F,EAAO,IAAI3F,CAAK,EAChB6F,EAAmB,QAAQF,EAAQhC,EAAe,IAAK3D,EAAOA,CAAK,GAE9D,IACT,EAaA,IAAID,EAAKC,EAAO,CACdA,EAAQ+E,EAAM/E,CAAK,EACnB,MAAM2F,EAASZ,EAAM,IAAI,EACnB,CAAE,IAAAuE,EAAK,IAAAI,GAAQH,GAAS5D,CAAM,EACpC,IAAImD,EAASQ,EAAI,KAAK3D,EAAQ5F,CAAG,EAC5B+I,EAIHa,GAAkBhE,EAAQ2D,EAAKvJ,CAAG,GAHlCA,EAAMgF,EAAMhF,CAAG,EACf+I,EAASQ,EAAI,KAAK3D,EAAQ5F,CAAG,GAI/B,MAAM2E,EAAWgF,EAAI,KAAK/D,EAAQ5F,CAAG,EACrC,OAAA4F,EAAO,IAAI5F,EAAKC,CAAK,EAChB8I,EAEMrE,GAAWzE,EAAO0E,CAAQ,GACnCmB,EAAmB,QAAQF,EAAQhC,EAAe,IAAK5D,EAAKC,EAAO0E,CAAQ,EAF3EmB,EAAmB,QAAQF,EAAQhC,EAAe,IAAK5D,EAAKC,CAAK,EAI5D,IACT,EAWA,OAAOD,EAAK,CACV,MAAM4F,EAASZ,EAAM,IAAI,EACnB,CAAE,IAAAuE,EAAK,IAAAI,GAAQH,GAAS5D,CAAM,EACpC,IAAImD,EAASQ,EAAI,KAAK3D,EAAQ5F,CAAG,EAC5B+I,EAIHa,GAAkBhE,EAAQ2D,EAAKvJ,CAAG,GAHlCA,EAAMgF,EAAMhF,CAAG,EACf+I,EAASQ,EAAI,KAAK3D,EAAQ5F,CAAG,GAI/B,MAAM2E,EAAWgF,EAAMA,EAAI,KAAK/D,EAAQ5F,CAAG,EAAI,OACzCyB,EAASmE,EAAO,OAAO5F,CAAG,EAChC,OAAI+I,GACFjD,EAAmB,QAAQF,EAAQhC,EAAe,OAAQ5D,EAAK,OAAQ2E,CAAQ,EAE1ElD,CACT,EAWA,OAAQ,CACN,MAAMmE,EAASZ,EAAM,IAAI,EACnB6E,EAAWjE,EAAO,OAAS,EAC3BkE,EAAsBvF,GAAMqB,CAAM,EAAI,IAAI,IAAIA,CAAM,EAAI,IAAI,IAAIA,CAAM,EACtEnE,EAASmE,EAAO,MAAA,EACtB,OAAIiE,GACF/D,EAAmB,QACjBF,EACAhC,EAAe,MACf,OACA,OACAkG,CAAA,EAGGrI,CACT,CAAA,EAQF,MANwB,CACtB,OACA,SACA,UACA,OAAO,QAAA,EAEO,QAAS2F,GAAW,CAClC+B,EAAiB/B,CAAM,EAAI2C,GAAqB3C,CAAM,CACxD,CAAC,EACM+B,CACT,CACA,SAASY,GAAqB3C,EAAQ,CACpC,OAAO,YAAY/B,EAAM,CACvB,MAAMO,EAAS,KAAKtC,EAAc,GAAG,EAC/B+F,EAAYrE,EAAMY,CAAM,EACxBoE,EAAczF,GAAM8E,CAAS,EAC7BY,EAAS7C,IAAW,WAAaA,IAAW,OAAO,UAAY4C,EAC/DE,EAAY9C,IAAW,QAAU4C,EACjCG,EAAgBvE,EAAOwB,CAAM,EAAE,GAAG/B,CAAI,EACtCoE,EAAOhD,EACb,OAAAX,EAAmB,MACjBuD,EACA3F,EAAa,QACbwG,EAAYnG,GAAsBD,CAAA,EAE7B,CAEL,MAAO,CACL,KAAM,CAAE,MAAA7D,EAAO,KAAAmK,GAASD,EAAc,KAAA,EACtC,OAAOC,EAAO,CAAE,MAAAnK,EAAO,KAAAmK,GAAS,CAC9B,MAAOH,EAAS,CAACR,EAAKxJ,EAAM,CAAC,CAAC,EAAGwJ,EAAKxJ,EAAM,CAAC,CAAC,CAAC,EAAIwJ,EAAKxJ,CAAK,EAC7D,KAAAmK,CAAA,CAEJ,EAEA,CAAC,OAAO,QAAQ,GAAI,CAClB,OAAO,IACT,CAAA,CAEJ,CACF,CACA,SAASR,GAAkBhE,EAAQ2D,EAAKvJ,EAAK,CAC3C,MAAMsJ,EAAStE,EAAMhF,CAAG,EACxB,GAAIsJ,IAAWtJ,GAAOuJ,EAAI,KAAK3D,EAAQ0D,CAAM,EAAG,CAC9C,MAAMtD,EAAOjB,GAAUa,CAAM,EAC7BT,GACE,OAAOa,CAAI,uBAAuBA,IAAS,MAAQ,MAAQ,EAAE,uBAAA,CAEjE,CACF,CACA,MAAMwD,GAAYzD,GAAM,QAAQ,eAAeA,CAAC,EAChD,SAAS8C,EAASjD,EAAQ,CAIxB,GAHI,CAAC3B,GAAS2B,CAAM,GAGhBA,EAAOtC,EAAc,GAAG,EAC1B,OAAOsC,EAET,MAAMyE,EAAavF,GAAcc,CAAM,EACvC,GAAIyE,IAAe7G,EAAW,QAC5B,OAAOoC,EAET,MAAM0E,EAAgB7B,GAAY,IAAI7C,CAAM,EAC5C,GAAI0E,EACF,OAAOA,EAET,MAAMC,EAAQ,IAAI,MAChB3E,EACAyE,IAAe7G,EAAW,WAAayF,GAA4BD,EAAA,EAErE,OAAAP,GAAY,IAAI7C,EAAQ2E,CAAK,EACtBA,CACT,CACA,MAAM9B,OAAkC,QAIlChC,EAAcxG,GACdgE,GAAShE,CAAK,EACT4I,EAAS5I,CAAK,EAEhBA,EAET,SAASkI,GAAQlI,EAAO,CACtB,OAAOA,EAAQ,CAAC,CAACA,EAAMqD,EAAc,GAAG,EAAI,EAC9C,CA8FA,QAAQ,IAAI,4BAA4B,ECl0DjC,SAASkH,GAAYC,EAA2B7J,EAAgBgF,EAAsB8E,EAAqB,cAClH,CACI,IAAIC,EAAcF,EAAG,WAAW,IAAI7J,CAAM,EAE1C,GAAI+J,EAAa,OAAOA,EAExBA,EAAcF,EAAG,aAAA,EACjBA,EAAG,WAAW,IAAI7J,EAAQ+J,CAAW,EAErC,MAAMC,EAAOhK,EAAO,KAGpB6J,EAAG,WAAWA,EAAG7E,CAAM,EAAG+E,CAAW,EACrCF,EAAG,WAAWA,EAAG7E,CAAM,EAAGgF,EAAMH,EAAGC,CAAK,CAAC,EAEzC,MAAMG,EAAiBC,GACvB,CACI,MAAMC,EAAeD,EAAY,cAAgB,EACjD,IAAIE,EAAOF,EAAY,KAEnBA,EAAY,OAEZE,EAAO,IAAI,WAAWA,EAAK,OAAQA,EAAK,WAAYF,EAAY,KAAOE,EAAK,iBAAiB,GAEjGP,EAAG,cAAcA,EAAG7E,CAAM,EAAGmF,EAAcC,CAAI,CACnD,EAEMC,EAAWpC,EAASjI,CAAM,EAE1BsK,EAAoB,CAAA,EAG1B,OAAAA,EAAQ,KAAK1F,GAAO,IACpB,CACIyF,EAAS,KAEJrK,EAAO,OAEZ6J,EAAG,WAAWA,EAAG7E,CAAM,EAAG+E,CAAW,EACrCE,EAAc,CAAE,KAAM,IAAI,WAAWjK,EAAO,IAAI,EAAG,EACvD,CAAC,CAAC,EAGFsK,EAAQ,KAAK1F,GAAO,IACpB,CH1DJ,IAAAzE,GG4DQA,EAAAkK,EAAS,eAAT,MAAAlK,EAAuB,QAAQ,IAC/B,CAAE,GAEF,MAAMoK,EAAevK,EAAO,aAEvBuK,IAELV,EAAG,WAAWA,EAAG7E,CAAM,EAAG+E,CAAW,EACrCQ,EAAa,QAAQN,CAAa,EAI9BhC,EAASjI,CAAM,EAAE,aAAe,KASxC,CAAC,CAAC,EAGF+J,EAAY,QAAU,IACtB,CACIO,EAAQ,QAASE,GAAQA,EAAI,MAAM,CACvC,EAEOT,CACX,CAEO,SAASU,GAAaZ,EAA2B7J,EACxD,CACI,MAAM+J,EAAcF,EAAG,WAAW,IAAI7J,CAAM,EAExC+J,IAEAF,EAAG,WAAW,OAAO7J,CAAM,EAC3B+J,EAAY,QAAA,EACZ,OAAOA,EAAY,QAEnBF,EAAG,aAAaE,CAAW,EAEnC,CClGO,MAAMW,EACb,CAiNI,YAAoBC,EAA6DC,EAA2C,QAC5H,CAtMQtL,EAAA,uBAaAA,EAAA,qBAaAA,EAAA,2BAaAA,EAAA,wBAaAA,EAAA,wBAaAA,EAAA,uBAaAA,EAAA,2BAaAA,EAAA,qBAaAA,EAAA,6BAaAA,EAAA,wBAaAA,EAAA,+BAaAA,EAAA,6BAaAA,EAAA,sBAaAA,EAAA,oBAaAA,EAAA,qBAaAA,EAAA,sBAEY,KAAA,IAAAqL,EAA6D,KAAA,WAAAC,CAEjF,CA/MA,IAAI,eACJ,CACI,OAAI,KAAK,eAAuB,KAAK,gBACrC,KAAK,eAAiB,KAAK,IAAI,aAAa,gCAAgC,EAAI,KAAK,IAAI,aAAa,KAAK,IAAI,aAAa,gCAAgC,EAAE,8BAA8B,EAAI,EAEzL,KAAK,eAChB,CAOA,IAAI,aACJ,CACI,OAAI,KAAK,aAAqB,KAAK,cACnC,KAAK,aAAe,KAAK,IAAI,aAAa,KAAK,IAAI,uBAAuB,EAEnE,KAAK,aAChB,CAOA,IAAI,mBACJ,CACI,OAAI,KAAK,mBAA2B,KAAK,oBACzC,KAAK,mBAAqB,KAAK,IAAI,aAAa,KAAK,IAAI,8BAA8B,EAEhF,KAAK,mBAChB,CAOA,IAAI,gBACJ,CACI,OAAI,KAAK,gBAAwB,KAAK,iBACtC,KAAK,gBAAkB,KAAK,IAAI,aAAa,KAAK,IAAI,gBAAgB,EAE/D,KAAK,gBAChB,CAOA,IAAI,gBACJ,CACI,OAAI,KAAK,gBAAwB,KAAK,iBACtC,KAAK,gBAAkB,KAAK,IAAI,aAAa,KAAK,IAAI,yBAAyB,EAExE,KAAK,gBAChB,CAOA,IAAI,eACJ,CACI,OAAI,KAAK,eAAuB,KAAK,gBACrC,KAAK,eAAiB,KAAK,IAAI,aAAa,KAAK,IAAI,kBAAkB,EAEhE,KAAK,eAChB,CAOA,IAAI,mBACJ,CACI,OAAI,KAAK,mBAA2B,KAAK,oBACzC,KAAK,mBAAqB,KAAK,IAAI,aAAa,KAAK,IAAI,0BAA0B,EAE5E,KAAK,mBAChB,CAOA,IAAI,aACJ,CACI,OAAI,KAAK,aAAqB,KAAK,cACnC,KAAK,aAAe,KAAK,IAAI,aAAa,KAAK,IAAI,mBAAmB,EAE/D,KAAK,aAChB,CAOA,IAAI,qBACJ,CACI,OAAI,KAAK,qBAA6B,KAAK,sBAC3C,KAAK,qBAAuB,KAAK,IAAI,aAAa,KAAK,IAAI,4BAA4B,EAEhF,KAAK,qBAChB,CAOA,IAAI,gBACJ,CACI,OAAI,KAAK,gBAAwB,KAAK,iBACtC,KAAK,gBAAkB,KAAK,kBAAoB,EAEzC,KAAK,gBAChB,CAOA,IAAI,uBACJ,CACI,OAAI,KAAK,uBAA+B,KAAK,wBAC7C,KAAK,uBAAyB,KAAK,eAAe,wBAA0B,CAAC,CAAC,KAAK,IAAI,aAAa,mBAAmB,EAEhH,KAAK,uBAChB,CAOA,IAAI,qBACJ,CACI,OAAI,KAAK,qBAA6B,KAAK,sBAC3C,KAAK,qBAAuB,KAAK,gBAAkB,KAAK,sBAEjD,KAAK,qBAChB,CAOA,IAAI,cACJ,CACI,OAAI,KAAK,cAAsB,KAAK,eACpC,KAAK,cAAgBC,GAAiB,KAAK,IAAK,KAAK,UAAU,EAExD,KAAK,cAChB,CAOA,IAAI,YACJ,CACI,OAAI,KAAK,YAAoB,KAAK,aAClC,KAAK,YAAc,KAAK,eAAe,uBAAyB,KAAK,IAAI,aAAa,KAAK,IAAI,WAAW,EAAI,EAEvG,KAAK,YAChB,CAOA,IAAI,aACJ,CACI,OAAI,KAAK,aAAqB,KAAK,cACnC,KAAK,aAAe,KAAK,IAAI,aAAa,KAAK,IAAI,YAAY,EAExD,KAAK,aAChB,CAOA,IAAI,cACJ,CACI,OAAI,KAAK,cAAsB,KAAK,eACpC,KAAK,cAAgB,KAAK,eAAe,wBAA0B,CAAC,CAAC,KAAK,IAAI,aAAa,yBAAyB,EAE7G,KAAK,cAChB,CAOJ,CAEA,SAASA,GAAiBhB,EAAoDiB,EAA0C,QACxH,CACI,GAAIA,IAAc,QAClB,CACI,GAAIjB,EAAG,yBAAyBA,EAAG,cAAeA,EAAG,UAAU,EAAE,UAAY,GACtEA,EAAG,yBAAyBA,EAAG,gBAAiBA,EAAG,UAAU,EAAE,UAAY,EAE9E,MAAO,QAEXiB,EAAY,SAChB,CACA,OAAIA,IAAc,WAEVjB,EAAG,yBAAyBA,EAAG,cAAeA,EAAG,YAAY,EAAE,UAAY,GACxEA,EAAG,yBAAyBA,EAAG,gBAAiBA,EAAG,YAAY,EAAE,UAAY,EAEzE,UAIR,MACX,CCpNO,SAASkB,GAAmBC,EACnC,CACI,IAAInB,EAA4BmB,EAAc,IAE9C,GAAInB,EAAI,OAAOA,EAEf,MAAMoB,EAAS,OAAOD,EAAc,UAAa,SAAW,SAAS,eAAeA,EAAc,QAAQ,EAAyBA,EAAc,SAEjJ,OAAAnB,EAAKmB,EAAc,IAASE,GAAgBD,EAAQD,CAAa,EAEjEA,EAAc,uBAEdnB,EAAG,cAAgB,IAAIa,GAAab,CAAE,EAEtCA,EAAG,eAAiB,QACpBA,EAAG,cAAgB,QACnBA,EAAG,mBAAqB,QACxBA,EAAG,kBAAoB,QACvBA,EAAG,cAAgB,IAAIvJ,GACvBuJ,EAAG,cAAgB,QACnBA,EAAG,gBAAkB,QACrBA,EAAG,UAAY,CAAA,EACfA,EAAG,SAAW,CAAA,EAGdoB,EAAO,iBAAiB,mBAAoBE,GAAgB,EAAK,EACjEF,EAAO,iBAAiB,uBAAwBG,GAAmB,EAAK,EACxEH,EAAO,iBAAiB,4BAA6BI,GAAyB,EAAK,EAE5ExB,CACX,CAEA,SAASsB,GAAeG,EACxB,CACIA,EAAM,eAAA,EAEN,QAAQ,KAAK,8BAA8B,CAC/C,CAEA,SAASF,IACT,CACI,QAAQ,KAAK,kCAAkC,CACnD,CAEA,SAASC,GAAwBC,EACjC,CACI,QAAQ,MAAM,gEAAiEA,EAAM,aAAa,CACtG,CAEA,SAASJ,GAAgBD,EAA6CD,EACtE,CACI,MAAMO,EAAoB,OAAO,OAAO,CAAA,EAAItK,GAA+B+J,EAAc,sBAAsB,EAG/G,IAAInB,EAAKoB,EAAO,WAAWD,EAAc,gBAAkB,SAAUO,CAAiB,EAEtF,OAAA1B,GAAM,QAAQ,KAAK,yBAA0B0B,CAAiB,EAE9D1B,EAAKoB,EAAO,WAAW,SAAUM,CAAiB,GAC3CN,EAAO,WAAW,QAAQ,GAC1BA,EAAO,WAAW,QAASM,CAAiB,GAC5CN,EAAO,WAAW,OAAO,EAEhCpB,GAAM,QAAQ,MAAM,eAAe,EAE5BA,CACX,CC9FO,SAAS2B,GAAkB3B,EAA2B4B,EAA4BC,EACzF,CACI,IAAIC,EAAoB9B,EAAG,eAAe,IAAI4B,CAAY,EAE1D,GAAIE,EAAmB,OAAOA,EAE9BA,EAAoB9B,EAAG,mBAAA,EACvBA,EAAG,eAAe,IAAI4B,EAAcE,CAAiB,EAErD,KAAM,CAAE,eAAAC,EAAgB,MAAAC,EAAO,OAAAC,CAAA,EAAWL,EAE1C,OAAA5B,EAAG,iBAAiBA,EAAG,aAAc8B,CAAiB,EAClDD,IAAgB,GAAK7B,aAAc,uBAEnCA,EAAG,+BAA+BA,EAAG,aAAc6B,EAAa7B,EAAG+B,CAAc,EAAGC,EAAOC,CAAM,EAIjGjC,EAAG,oBAAoBA,EAAG,aAAcA,EAAG+B,CAAc,EAAGC,EAAOC,CAAM,EAGtEH,CACX,CAEO,SAASI,GAAmBlC,EAA2B4B,EAC9D,CACI,MAAME,EAAoB9B,EAAG,eAAe,IAAI4B,CAAY,EAE5D5B,EAAG,eAAe,OAAO4B,CAAY,EAErC5B,EAAG,mBAAmB8B,CAAiB,CAC3C,CC/BO,SAASK,GAAoB9L,EAAwB,aAC5D,CACI,MAAM+L,EAAoC5L,GAAUH,CAAM,EAE1D,eAAQ,OAAO,CAAC,CAAC+L,EAAiB,SAAS/L,CAAM,gCAAgC,EAE1E+L,CACX,CA0BA,MAAM5L,GAAiD,CACnD,QAAS,CAAE,eAAgB,KAAM,OAAQ,MAAO,KAAM,eAAA,EACtD,QAAS,OACT,OAAQ,CAAE,eAAgB,KAAM,OAAQ,MAAO,KAAM,eAAA,EACrD,OAAQ,OACR,QAAS,OACT,QAAS,OACT,SAAU,CAAE,eAAgB,OAAQ,OAAQ,MAAO,KAAM,YAAA,EACzD,SAAU,CAAE,eAAgB,MAAO,OAAQ,KAAM,KAAM,eAAA,EACvD,SAAU,OACV,QAAS,CAAE,eAAgB,QAAS,OAAQ,aAAc,KAAM,eAAA,EAChE,QAAS,OACT,QAAS,OACT,QAAS,OACT,SAAU,CAAE,eAAgB,OAAQ,OAAQ,MAAO,KAAM,OAAA,EACzD,SAAU,OACV,SAAU,OACV,UAAW,CAAE,eAAgB,QAAS,OAAQ,KAAM,KAAM,YAAA,EAC1D,WAAY,CAAE,eAAgB,QAAS,OAAQ,OAAQ,KAAM,eAAA,EAC7D,kBAAmB,CAAE,eAAgB,eAAgB,OAAQ,OAAQ,KAAM,eAAA,EAC3E,WAAY,OACZ,UAAW,CAAE,eAAgB,UAAW,OAAQ,eAAgB,KAAM,eAAA,EACtE,UAAW,OACX,WAAY,CAAE,eAAgB,QAAS,OAAQ,OAAQ,KAAM,eAAA,EAC7D,kBAAmB,OACnB,aAAc,CAAE,eAAgB,UAAW,OAAQ,MAAO,KAAM,YAAA,EAChE,YAAa,OACb,aAAc,CAAE,eAAgB,WAAY,OAAQ,OAAQ,KAAM,6BAAA,EAClE,cAAe,CAAE,eAAgB,iBAAkB,OAAQ,MAAO,KAAM,8BAAA,EACxE,SAAU,OACV,SAAU,OACV,UAAW,CAAE,eAAgB,QAAS,OAAQ,KAAM,KAAM,OAAA,EAC1D,WAAY,OACZ,WAAY,OACZ,YAAa,CAAE,eAAgB,UAAW,OAAQ,OAAQ,KAAM,YAAA,EAChE,WAAY,OACZ,WAAY,OACZ,YAAa,CAAE,eAAgB,UAAW,OAAQ,OAAQ,KAAM,OAAA,EAChE,SAAU,OACV,aAAc,CAAE,eAAgB,oBAAqB,OAAQ,kBAAmB,KAAM,gBAAA,EACtF,YAAa,OACb,uBAAwB,OACxB,aAAc,OACd,wBAAyB,OACzB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,cAAe,OACf,cAAe,OACf,eAAgB,OAChB,eAAgB,OAChB,kBAAmB,OACnB,iBAAkB,OAClB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,mBAAoB,OACpB,wBAAyB,OACzB,kBAAmB,OACnB,uBAAwB,OACxB,eAAgB,OAChB,eAAgB,OAChB,gBAAiB,OACjB,gBAAiB,OACjB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,iBAAkB,OAClB,sBAAuB,OACvB,kBAAmB,OACnB,uBAAwB,OACxB,kBAAmB,OACnB,uBAAwB,OACxB,kBAAmB,OACnB,uBAAwB,OACxB,mBAAoB,OACpB,wBAAyB,OACzB,mBAAoB,OACpB,wBAAyB,OACzB,mBAAoB,OACpB,wBAAyB,MAC7B,ECtHO,SAAS6L,GAAyCC,EACzD,CACI,GAAIA,EAAqBC,EAAuC,EAAG,OAAOD,EAAqBC,EAAuC,EAItI,MAAMC,EAFWF,EAAqB,iBAAiB,CAAC,EAAE,KAAqB,QAEtC,WAAW,KAE9CG,EAAgC,CAAA,EAGhCC,EAAuC,CACzC,iBAAkBJ,EAAqB,iBAAiB,IAAKhH,GAC7D,CACI,MAAMqH,EAAUrH,EAAE,KAAK,QAEjBsG,EAA6B,CAC/B,eAAgBgB,GAAiCD,EAAoB,WAAW,MAAM,EACtF,MAAOH,EAAY,CAAC,EACpB,OAAQA,EAAY,CAAC,CAAA,EAGzB,OAAAC,EAAc,KAAKb,CAAY,EAEoB,CAC/C,GAAGtG,EACH,KAAMsG,CAAA,CAId,CAAC,EACD,uBAAwBU,EAAqB,uBAC7C,YAAaA,EAAqB,WAAA,EAIhCO,EAAmC,CACrC,SAAU,kBACV,KAAMH,EACN,KAAMJ,EACN,iBAAkB,CAAC,CAAC,EAAG,EAAGE,EAAY,CAAC,EAAGA,EAAY,CAAC,EACnD,EAAG,EAAGA,EAAY,CAAC,EAAGA,EAAY,CAAC,EACnC,mBAAoB,SAAA,CAAU,CAAA,EAGtC,OAAAF,EAAqBC,EAAuC,EAAI,CAAE,eAAAG,EAAgB,gBAAAG,EAAiB,cAAAJ,CAAA,EAE5FH,EAAqBC,EAAuC,CACvE,CAEA,SAASK,GAAgCvM,EACzC,CACI,KAAM,CAAE,eAAA0L,CAAA,EAAmBI,GAAoB9L,CAAM,EAErD,OAAO0L,CACX,CAEO,MAAMQ,GAA0C,0CCtEvD,MAAMO,EAAQ,CACZ,aAAc,CACZ,KAAK,OAAS,CAAA,CAChB,CAOA,IAAK,CACH,MAAMC,EAAW,CAAA,EACXC,EAAY,CAChB,MAAO,CAACC,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAc,GAAMC,EAAWC,KAC5E,KAAK,MAAML,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAaC,EAAWC,CAAY,EACtFP,EAAS,KAAK,IAAM,KAAK,QAAQE,EAAQ/H,EAAUgI,EAASC,CAAU,CAAC,EAChEH,GAET,OAAQ,CAACC,EAAQM,EAAWL,EAASC,EAAYC,KAC/C,KAAK,OAAOH,EAAQM,EAAWL,EAASC,EAAYC,CAAW,EAC/DL,EAAS,KAAK,IAAM,KAAK,SAASE,EAAQM,EAAWL,EAASC,CAAU,CAAC,EAClEH,GAET,KAAM,CAACQ,EAASC,EAAWC,EAASC,KAClC,KAAK,KAAKH,EAASC,EAAWC,EAASC,CAAS,EAChDZ,EAAS,KAAK,IAAM,KAAK,OAAOS,EAASC,EAAWC,EAASC,CAAS,CAAC,EAChEX,GAET,WAAY,CAACC,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAc,GAAMC,EAAWC,KACjF,KAAK,WAAWL,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAaC,EAAWC,CAAY,EAC3FP,EAAS,KAAK,IAAM,KAAK,aAAaE,EAAQ/H,EAAUgI,EAASC,CAAU,CAAC,EACrEH,GAET,YAAa,CAACC,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAc,MACjE,KAAK,YAAYH,EAAQ/H,EAAUgI,EAASC,EAAYC,CAAW,EACnEL,EAAS,KAAK,IAAM,KAAK,cAAcE,EAAQ/H,EAAUgI,EAASC,CAAU,CAAC,EACtEH,GAET,IAAK,IAAM,CACTD,EAAS,QAAStK,GAASA,EAAI,CAAE,EACjCsK,EAAS,OAAS,CACpB,CACN,EACI,OAAOC,CACT,CAYA,MAAMC,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAc,GAAMC,EAAWC,EAAc,CACxFD,EAAYA,GAAaJ,EACzBK,EAAeA,GAAgBpI,EAC1B,OAAO,yBAAyB+H,EAAQW,CAAU,GACrD,OAAO,eAAeX,EAAQW,EAAY,CACxC,MAAO,CAAA,EACP,WAAY,GACZ,aAAc,GACd,SAAU,EAClB,CAAO,EAEH,MAAMC,EAAY3I,EACZ4I,EAASb,EAAOW,CAAU,EAChC,GAAI,CAACE,EAAOD,CAAS,EAAG,CACtB,MAAME,EAAwB,OAAO,yBAAyBd,EAAQY,CAAS,EAC/EC,EAAOD,CAAS,EAAI,CAAE,MAAOZ,EAAOY,CAAS,EAAG,sBAAAE,EAAuB,SAAU,EAAE,EACnF,IAAIxD,EAAOyD,GAAsBf,EAAQY,CAAS,EAClD,GAAItD,GAAQA,EAAK,KAAOA,EAAK,IAAK,CAChCA,EAAO,CAAE,WAAYA,EAAK,WAAY,aAAc,GAAM,IAAKA,EAAK,IAAK,IAAKA,EAAK,GAAG,EACtF,MAAM0D,EAAS1D,EAAK,IACpBA,EAAK,IAAM,SAAS/K,EAAO,CACzB,MAAM0E,EAAW,KAAK2J,CAAS,EAC/BI,GAAUA,EAAO,KAAK,KAAMzO,CAAK,EACjC0O,GAAe1O,EAAO0E,EAAU,KAAM2J,EAAWR,EAAWC,CAAY,CAC1E,CACF,SAAW,CAAC/C,GAAQ,CAACA,EAAK,KAAO,CAACA,EAAK,IACrCA,EAAO,CAAE,WAAY,GAAM,aAAc,EAAI,EAC7CA,EAAK,IAAM,UAAW,CACpB,OAAO,KAAKqD,CAAU,EAAEC,CAAS,EAAE,KACrC,EACAtD,EAAK,IAAM,SAAS/K,EAAO,CACzB,MAAM0E,EAAW,KAAK0J,CAAU,EAAEC,CAAS,EAAE,MAC7C,KAAKD,CAAU,EAAEC,CAAS,EAAE,MAAQrO,EACpC0O,GAAe1O,EAAO0E,EAAU,KAAM2J,EAAWR,EAAWC,CAAY,CAC1E,MACK,CACL,QAAQ,KAAK,oBAAqBL,EAAQY,EAAWX,EAASC,CAAU,EACxE,MACF,CACA,OAAO,eAAeF,EAAQY,EAAWtD,CAAI,CAC/C,CACA,MAAM4D,EAAiBL,EAAOD,CAAS,EAC3BM,EAAe,SAAS,OAAO,CAAC7I,EAAGgC,IAAShC,GAAKgC,EAAK,UAAY4F,GAAW5F,EAAK,aAAe6F,EAAY,EAAK,EAI5H,QAAQ,KAAK,cAAeF,EAAQY,EAAWX,EAASC,CAAU,EAFlEgB,EAAe,SAAS,KAAK,CAAE,QAAAjB,EAAS,WAAAC,EAAY,YAAAC,EAAa,CAIrE,CASA,QAAQH,EAAQ/H,EAAUgI,EAASC,EAAY,CAC7C,MAAMW,EAASb,EAAOW,CAAU,EAChC,GAAI,CAACE,EACH,OACF,MAAMD,EAAY3I,EAClB,GAAI4I,EAAOD,CAAS,EAAG,CACrB,MAAMO,EAAWN,EAAOD,CAAS,EAAE,SAC/BX,IAAY,SACdkB,EAAS,OAAS,GAEpB,QAASvN,EAAIuN,EAAS,OAAS,EAAGvN,GAAK,EAAGA,IACpCuN,EAASvN,CAAC,EAAE,UAAYqM,IAAYkB,EAASvN,CAAC,EAAE,aAAesM,GAAcA,IAAe,SAC9FiB,EAAS,OAAOvN,EAAG,CAAC,EAGxB,GAAIuN,EAAS,SAAW,EAAG,CACzB,MAAM5O,EAAQyN,EAAOY,CAAS,EAC9B,OAAOZ,EAAOY,CAAS,EACnBC,EAAOD,CAAS,EAAE,uBACpB,OAAO,eAAeZ,EAAQY,EAAWC,EAAOD,CAAS,EAAE,qBAAqB,EAElFZ,EAAOY,CAAS,EAAIrO,EACpB,OAAOsO,EAAOD,CAAS,CACzB,CACI,OAAO,KAAKC,CAAM,EAAE,SAAW,GACjC,OAAOb,EAAOW,CAAU,CAE5B,CACF,CAYA,OAAOX,EAAQM,EAAWL,EAASC,EAAYC,EAAc,GAAM,CACjEG,EAAU,QAASjI,GAAM,CACvB,KAAK,MAAM2H,EAAQ3H,EAAG4H,EAASC,EAAYC,CAAW,CACxD,CAAC,CACH,CASA,SAASH,EAAQM,EAAWL,EAASC,EAAY,CAC/CI,EAAU,QAASjI,GAAM,CACvB,KAAK,QAAQ2H,EAAQ3H,EAAG4H,EAASC,CAAU,CAC7C,CAAC,CACH,CASA,KAAKK,EAASC,EAAWC,EAASC,EAAW,CAC3C,MAAMU,EAAO,IAAM,CACjBX,EAAQC,CAAS,EAAIH,EAAQC,CAAS,CACxC,EACMa,EAAO,IAAM,CACjBd,EAAQC,CAAS,EAAIC,EAAQC,CAAS,CACxC,EACA,KAAK,MAAMH,EAASC,EAAWY,CAAI,EACnC,KAAK,MAAMX,EAASC,EAAWW,CAAI,EACnC,KAAK,OAAO,KAAK,CAACd,EAASC,EAAWY,EAAMX,EAASC,EAAWW,CAAI,CAAC,CACvE,CASA,OAAOd,EAASC,EAAWC,EAASC,EAAW,CAC7C,MAAMY,EAAQ,KAAK,OACnB,QAAS,EAAIA,EAAM,OAAS,EAAG,GAAK,EAAG,IAAK,CAC1C,MAAMjJ,EAAIiJ,EAAM,CAAC,EACjB,IAAIjJ,EAAE,CAAC,IAAMmI,GAAanI,EAAE,CAAC,IAAMqI,GAAarI,EAAE,CAAC,IAAMqI,GAAarI,EAAE,CAAC,IAAMmI,KACzEnI,EAAE,CAAC,IAAMkI,GAAWlI,EAAE,CAAC,IAAMoI,GAAWpI,EAAE,CAAC,IAAMoI,GAAWpI,EAAE,CAAC,IAAMkI,GAAS,CAChF,KAAK,QAAQlI,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAC7B,KAAK,QAAQA,EAAE,CAAC,EAAGA,EAAE,CAAC,EAAGA,EAAE,CAAC,CAAC,EAC7BiJ,EAAM,OAAO,EAAG,CAAC,EACjB,KACF,CAEJ,CACF,CAUA,WAAWtB,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAc,GAAMC,EAAWC,EAAc,CAC7FD,EAAYA,GAAaJ,EACzBK,EAAeA,GAAgBpI,EAC/B,MAAMsJ,EAAWtJ,EAAS,QAAQ,GAAG,EACrC,GAAIsJ,IAAa,GAAI,CACnB,KAAK,MAAMvB,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAaC,EAAWC,CAAY,EACtF,MACF,CACK,OAAO,yBAAyBL,EAAQwB,EAAe,GAC1D,OAAO,eAAexB,EAAQwB,GAAiB,CAAE,MAAO,CAAA,EAAI,WAAY,GAAO,SAAU,GAAO,aAAc,EAAI,CAAE,EAEtH,MAAMC,EAAczB,EAAOwB,EAAe,EACrCC,EAAYxJ,CAAQ,IACvBwJ,EAAYxJ,CAAQ,EAAI,CAAA,GAE1B,MAAMiJ,EAAiBO,EAAYxJ,CAAQ,EAE3C,GAAI,CADQiJ,EAAe,OAAO,CAAC7I,EAAGgC,IAAShC,GAAKgC,EAAK,UAAY4F,GAAW5F,EAAK,aAAe6F,EAAY,EAAK,EAC3G,CACR,MAAMwB,EAAWzJ,EAAS,OAAO,EAAGsJ,CAAQ,EACtCI,EAAQ1J,EAAS,OAAOsJ,EAAW,CAAC,EACtCvB,EAAO0B,CAAQ,GACjB,KAAK,WAAW1B,EAAO0B,CAAQ,EAAGC,EAAO1B,EAASC,EAAYC,EAAaC,EAAWC,CAAY,EAEpG,MAAMuB,EAAgB,CAACrJ,EAAUtB,IAAa,CACxCA,GACF,KAAK,aAAaA,EAAU0K,EAAO1B,EAASC,CAAU,EACpD3H,GACF,KAAK,WAAWA,EAAUoJ,EAAO1B,EAASC,EAAYC,EAAaC,EAAWC,CAAY,EAC5F,MAAMwB,EAAKC,GAAuB7K,EAAU0K,CAAK,EAC3CI,EAAKD,GAAuBvJ,EAAUoJ,CAAK,GAC7C,CAACxB,GAAe0B,IAAOE,IACzB9B,EAAQ,KAAKC,EAAY6B,EAAIF,EAAIzB,EAAWC,CAAY,CAE5D,EACA,KAAK,MAAML,EAAQ0B,EAAUE,EAAe,OAAQzB,CAAW,EAC/De,EAAe,KAAK,CAAE,QAAAjB,EAAS,WAAAC,EAAY,cAAA0B,CAAa,CAAE,CAC5D,CACF,CASA,aAAa5B,EAAQ/H,EAAUgI,EAASC,EAAY,CAClD,MAAMqB,EAAWtJ,EAAS,QAAQ,GAAG,EACrC,GAAIsJ,IAAa,GAAI,CACnB,KAAK,QAAQvB,EAAQ/H,EAAUgI,EAASC,CAAU,EAClD,MACF,CACA,MAAMwB,EAAWzJ,EAAS,OAAO,EAAGsJ,CAAQ,EACtCI,EAAQ1J,EAAS,OAAOsJ,EAAW,CAAC,EACpCE,EAAczB,EAAOwB,EAAe,EAC1C,GAAI,CAACC,GAAe,CAACA,EAAYxJ,CAAQ,EACvC,OACF,MAAMiJ,EAAiBO,EAAYxJ,CAAQ,EAC3C,QAASrE,EAAIsN,EAAe,OAAS,EAAGtN,GAAK,EAAGA,IAAK,CACnD,MAAMoO,EAAUd,EAAetN,CAAC,GAC5BqO,GAAchC,CAAO,GAAKA,IAAY+B,EAAQ,SAAW9B,IAAe8B,EAAQ,cAC9EhC,EAAO0B,CAAQ,GACjB,KAAK,aAAa1B,EAAO0B,CAAQ,EAAGC,EAAOK,EAAQ,QAASA,EAAQ,UAAU,EAEhF,KAAK,QAAQhC,EAAQ0B,EAAUM,EAAQ,aAAa,EACpDd,EAAe,OAAOtN,EAAG,CAAC,EAE9B,CACIsN,EAAe,SAAW,GAC5B,OAAOO,EAAYxJ,CAAQ,EACzB,OAAO,KAAKwJ,CAAW,EAAE,SAAW,GACtC,OAAOzB,EAAOwB,EAAe,CAEjC,CAUA,YAAYxB,EAAQ/H,EAAUgI,EAASC,EAAYC,EAAc,GAAM,CACtD+B,GAAwBjK,CAAQ,EACxC,QAASI,GAAM,CACpB,KAAK,WAAW2H,EAAQ3H,EAAG4H,EAASC,EAAYC,CAAW,CAC7D,CAAC,CACH,CASA,cAAcH,EAAQ/H,EAAUgI,EAASC,EAAY,CACpCgC,GAAwBjK,CAAQ,EACxC,QAASI,GAAM,CACpB,KAAK,aAAa2H,EAAQ3H,EAAG4H,EAASC,CAAU,CAClD,CAAC,CACH,CACF,CACA,MAAMiC,EAAU,IAAItC,GACdc,EAAa,aACba,GAAkB,kBACxB,SAASP,GAAe1I,EAAUtB,EAAUmL,EAAMnK,EAAUmI,EAAWC,EAAc,CACnFD,EAAYA,GAAagC,EACzB/B,EAAeA,GAAgBpI,EAChBmK,EAAKzB,CAAU,EACN1I,CAAQ,EAAE,SAAS,OAAM,EACxC,QAAS+J,GAAY,EACxB,CAACA,EAAQ,aAAezJ,IAAatB,IACvC+K,EAAQ,QAAQ,KAAKA,EAAQ,WAAYzJ,EAAUtB,EAAUmJ,EAAWC,CAAY,CAExF,CAAC,CACH,CACA,SAASU,GAAsBf,EAAQ/H,EAAU,CAC/C,MAAMqF,EAAO,OAAO,yBAAyB0C,EAAQ/H,CAAQ,EAC7D,GAAIqF,EACF,OAAOA,EAET,MAAM+E,EAAY,OAAO,eAAerC,CAAM,EAC9C,GAAIqC,EACF,OAAOtB,GAAsBsB,EAAWpK,CAAQ,CAGpD,CACA,SAASgK,GAAc5P,EAAK,CAC1B,OAAsBA,GAAQ,IAIhC,CACA,SAASyP,GAAuB9B,EAAQ/H,EAAU,CAC5C,OAAOA,GAAa,WACtBA,EAAWA,EAAS,MAAM,GAAG,GAC/B,IAAI1F,EAAQyN,EACZ,QAASpM,EAAI,EAAGA,EAAIqE,EAAS,OAAQrE,IAAK,CACxC,GAAIqO,GAAc1P,CAAK,EACrB,OACFA,EAAQA,EAAM0F,EAASrE,CAAC,CAAC,CAC3B,CACA,OAAOrB,CACT,CACA,SAAS2P,GAAwBlC,EAAQ,CACvC,MAAMjM,EAAS,CAAA,EACTuM,EAAY,OAAO,KAAKN,CAAM,EAC9BsC,EAAQ,IAAI,MAAMhC,EAAU,MAAM,EAAE,KAAKN,CAAM,EAC/CuC,EAAwB,IAAI,MAAMjC,EAAU,MAAM,EAAE,KAAK,EAAE,EACjE,IAAIhG,EAAQ,EACZ,KAAOA,EAAQgG,EAAU,QAAQ,CAC/B,MAAM8B,EAAOE,EAAMhI,CAAK,EAClBkI,EAAKlC,EAAUhG,CAAK,EACpBmI,EAAKL,EAAKI,CAAE,EAClB,IAAIE,EACJ,GAAIT,GAAcQ,CAAE,GAAKE,GAAWF,CAAE,IAAMC,EAAM,OAAO,KAAKD,CAAE,GAAG,SAAW,EAAG,CAC/E,MAAMG,EAAK,CAACJ,CAAE,EACd,IAAIK,EAAKvI,EACT,MAAQuI,EAAKN,EAAsBM,CAAE,KAAO,IAC1CD,EAAG,KAAKtC,EAAUuC,CAAE,CAAC,EAEvBD,EAAG,QAAO,EACV7O,EAAO,KAAK6O,EAAG,KAAK,GAAG,CAAC,CAC1B,MACEF,EAAI,QAASI,GAAM,CACjBxC,EAAU,KAAKwC,CAAC,EAChBR,EAAM,KAAKG,CAAE,EACbF,EAAsB,KAAKjI,CAAK,CAClC,CAAC,EAEHA,GACF,CACA,OAAOvG,CACT,CACA,SAAS4O,GAAW3C,EAAQ,CAC1B,OAAyBA,GAAW,MAAQ,OAAOA,GAAW,WAAa,OAAOA,GAAW,UAAY,OAAOA,GAAW,QAI7H,CCjYO,SAAS+C,GAAmBC,EAA8B,KACjE,CACI,MAAM9K,EAA0B+K,GAAaD,CAAS,EAEtD,eAAQ,OAAO,CAAC,CAAC9K,EAAQ,iBAAiB8K,CAAS,oBAAoB,EAEhE9K,CACX,CAEA,MAAM+K,GAAmD,CACrD,KAAM,OACN,KAAM,aACN,WAAY,mBACZ,KAAM,mBACN,aAAc,OACd,KAAM,YACV,ECjBaC,GAAgD,CACzD,cAAe,EACf,gBAAiB,EACjB,YAAa,GACb,kBAAmB,GACnB,2BAA4B,wBAC5B,cAAe,EACf,eAAgB,EAChB,aAAc,EACd,gBAAiB,EACjB,kBAAmB,EACnB,iBAAkB,EAClB,eAAgB,EAChB,iBAAkB,CACtB,EAEO,SAASC,GAAapG,EAA2B2C,EACxD,CACI,IAAI0D,EAAerG,EAAG,UAAU,IAAI2C,CAAO,EAE3C,GAAI0D,EAAc,OAAOA,GAGH,IACtB,CACI,MAAMC,EAAa3D,EAAQ,WAErBxH,EAAS6K,GAAmBM,EAAW,SAAS,EAChD,CAAE,eAAAvE,EAAgB,OAAA1L,EAAQ,KAAAkF,GAAS4G,GAAoBmE,EAAW,MAAM,EAE9ED,EAAerG,EAAG,cAAA,EAClBA,EAAG,UAAU,IAAI2C,EAAS0D,CAAY,EAEtCrG,EAAG,YAAYA,EAAG7E,CAAM,EAAGkL,CAAY,EAGvC,KAAM,CAAE,QAAAE,GAAY5D,EACd6D,EAAiBF,EAAW,eAG5B,CAACtE,EAAOC,EAAQwE,CAAK,EAAIH,EAAW,KACpCI,EAAgBJ,EAAW,eAAiB,EAElD,GAAIC,EAEAA,EAAQ,QAASjL,GACjB,CACI,KAAM,CAAE,cAAAqL,EAAe,KAAAxG,CAAA,EAAS7E,EAE1BsL,EAAWtL,EAAE,UAAY,EACzB0G,EAAQ7B,GAAA,YAAAA,EAAO,GACf8B,EAAS9B,GAAA,YAAAA,EAAO,GACKA,GAAA,MAAAA,EAAO,GAClBwG,GAAA,MAAAA,EAAgB,GAChBA,GAAA,MAAAA,EAAgB,GAChC,MAAME,EAAUF,GAAA,YAAAA,EAAgB,GAEhC,GAAI3G,aAAc,uBAClB,CACI,MAAM8G,EAAcxL,EAEpB,GAAIwL,EAAY,MAChB,CACI,KAAM,CAAE,MAAAC,EAAO,YAAAC,EAAa,MAAAC,EAAO,mBAAAC,GAAuBJ,EAGpDK,EAAkC,CAAA,EASxC,GAPAA,EAAW,kBAAmBH,GAAA,YAAAA,EAAc,KAAM,EAClDG,EAAW,gBAAiBH,GAAA,YAAAA,EAAc,KAAM,EAChDG,EAAW,YAAcF,GAAS,GAClCE,EAAW,kBAAoBD,GAAsB,GAErDE,GAAqBpH,EAAImH,CAAU,EAE/BhM,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,EAAalM,IAAW,mBAAqBmM,EAAwBT,CAAO,EAAI1L,EAElF6G,GAASC,EAETjC,EAAG,WAAWA,EAAGqH,CAAU,EAAGT,EAAU5G,EAAG+B,CAAc,EAAGC,EAAOC,EAAQ,EAAGjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,EAIzG/G,EAAG,WAAWA,EAAGqH,CAAU,EAAGT,EAAU5G,EAAG+B,CAAc,EAAG/B,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,CAE/F,MACS5L,IAAW,cAAgBA,IAAW,mBAE3C6E,EAAG,WAAWA,EAAG7E,CAAM,EAAGyL,EAAU5G,EAAG+B,CAAc,EAAGC,EAAOC,EAAQwE,EAAO,EAAGzG,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,EAI5G,QAAQ,MAAM,OAAO5L,CAAM,WAAW,CAE9C,KAEA,CACI,MAAMoM,EAAejM,EACf,CAAE,KAAAiF,EAAM,WAAAiH,EAAY,gBAAAC,CAAA,EAAoBF,EAGxCG,GAASF,GAAA,YAAAA,EAAY,SAAU,EAG/BL,EAAkC,CAAA,EAUxC,GARAA,EAAW,kBAAmBM,GAAA,YAAAA,EAAkB,KAAM,EACtDN,EAAW,gBAAiBM,GAAA,YAAAA,EAAkB,KAAM,EACpDN,EAAW,kBAAmBM,GAAA,YAAAA,EAAkB,KAAM,EACtDN,EAAW,gBAAkBK,GAAA,YAAAA,EAAY,MACzCL,EAAW,kBAAoBK,GAAA,YAAAA,EAAY,OAE3CJ,GAAqBpH,EAAImH,CAAU,EAE/BhM,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,GAAalM,IAAW,mBAAqBmM,EAAwBT,CAAO,EAAI1L,EAEtF6E,EAAG,WAAWA,EAAGqH,EAAU,EAAGT,EAAU5G,EAAG+B,CAAc,EAAGC,EAAOC,EAAQ,EAAGjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGgF,EAAMmH,CAAM,CACpH,MACSvM,IAAW,cAAgBA,IAAW,mBAE3C6E,EAAG,WAAWA,EAAG7E,CAAM,EAAGyL,EAAU5G,EAAG+B,CAAc,EAAGC,EAAOC,EAAQwE,EAAO,EAAGzG,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGgF,EAAMmH,CAAM,EAInH,QAAQ,MAAM,OAAOvM,CAAM,WAAW,CAE9C,CACJ,KAEA,CACI,MAAM2L,EAAcxL,EAEpB,GAAIwL,EAAY,MAChB,CACI,KAAM,CAAE,MAAAC,EAAO,YAAAC,EAAa,MAAAC,EAAO,mBAAAC,GAAuBJ,EAGpDK,EAAkC,CAAA,EASxC,GAPAA,EAAW,kBAAmBH,GAAA,YAAAA,EAAc,KAAM,EAClDG,EAAW,gBAAiBH,GAAA,YAAAA,EAAc,KAAM,EAChDG,EAAW,YAAcF,GAAS,GAClCE,EAAW,kBAAoBD,GAAsB,GAErDE,GAAqBpH,EAAImH,CAAU,EAE/BhM,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,EAAalM,IAAW,mBAAqBmM,EAAwBT,CAAO,EAAI1L,EAEtF6E,EAAG,WAAWA,EAAGqH,CAAU,EAAGT,EAAU5G,EAAG3J,CAAM,EAAG2J,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,CACnF,MAGI,QAAQ,MAAM,OAAO5L,CAAM,WAAW,CAE9C,KAEA,CACI,MAAMoM,EAAejM,EACf,CAAE,KAAAiF,EAAM,WAAAiH,EAAY,gBAAAC,CAAA,EAAoBF,EAGxCG,GAASF,GAAA,YAAAA,EAAY,SAAU,EAG/BL,EAAkC,CAAA,EAUxC,GARAA,EAAW,kBAAmBM,GAAA,YAAAA,EAAkB,KAAM,EACtDN,EAAW,gBAAiBM,GAAA,YAAAA,EAAkB,KAAM,EACpDN,EAAW,kBAAmBM,GAAA,YAAAA,EAAkB,KAAM,EACtDN,EAAW,gBAAkBK,GAAA,YAAAA,EAAY,MACzCL,EAAW,kBAAoBK,GAAA,YAAAA,EAAY,OAE3CJ,GAAqBpH,EAAImH,CAAU,EAE/BhM,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,GAAalM,IAAW,mBAAqBmM,EAAwBT,CAAO,EAAI1L,EAEtF,QAAQ,OAAOuM,IAAW,EAAG,sCAAsC,EACnE1H,EAAG,WAAWA,EAAGqH,EAAU,EAAGT,EAAU5G,EAAG3J,CAAM,EAAG2L,EAAOC,EAAQ,EAAGjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGgF,CAAI,CACpG,MAGI,QAAQ,MAAM,OAAOpF,CAAM,WAAW,CAE9C,CACJ,CACJ,CAAC,EAGGqL,GAEAxG,EAAG,eAAeA,EAAG7E,CAAM,CAAC,UAK5B6E,aAAc,uBAEV7E,IAAW,cAAgBA,IAAW,mBAEtC6E,EAAG,aAAaA,EAAG7E,CAAM,EAAGuL,EAAe1G,EAAG+B,CAAc,EAAGC,EAAOC,CAAM,EAEvE9G,IAAW,cAAgBA,IAAW,mBAE3C6E,EAAG,aAAaA,EAAG7E,CAAM,EAAGuL,EAAe1G,EAAG+B,CAAc,EAAGC,EAAOC,EAAQwE,CAAK,EAInF,QAAQ,MAAM,OAAOtL,CAAM,WAAW,UAKtCA,IAAW,cAAgBA,IAAW,mBAEtC,QAAStE,EAAI,EAAGA,EAAI6P,EAAe7P,IAE/BmJ,EAAG,WAAWA,EAAG7E,CAAM,EAAGtE,EAAGmJ,EAAG3J,CAAM,EAAG2L,EAAOC,EAAQ,EAAGjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAG,IAAI,OAKzF,QAAQ,MAAM,OAAOJ,CAAM,WAAW,CAItD,GAEA,EAEA,MAAMwM,EAAgB,IACtB,CACItB,EAAa,QAAA,CACjB,EAEAjB,EAAQ,MAAMzC,EAAS,UAAWgF,CAAa,EAG/C,MAAMC,EAAgB,IACtB,CACI,KAAM,CAAE,cAAAC,GAAkBlF,EAE1B,GAAI,CAACkF,GAAiBA,EAAc,SAAW,EAAG,OAElD,MAAMvB,EAAa3D,EAAQ,WAErBxH,EAAS6K,GAAmBM,EAAW,SAAS,EAChD,CAAE,OAAAjQ,EAAQ,KAAAkF,CAAA,EAAS4G,GAAoBmE,EAAW,MAAM,EAE9DtG,EAAG,YAAYA,EAAG7E,CAAM,EAAGkL,CAAY,EAEvCwB,EAAc,QAASvM,GACvB,CACI,KAAM,CAAE,SAAAsL,EAAU,cAAAD,EAAe,KAAAxG,CAAA,EAAS7E,EAEpC0G,EAAQ7B,GAAA,YAAAA,EAAO,GACf8B,EAAS9B,GAAA,YAAAA,EAAO,GAChB2H,EAAqB3H,GAAA,YAAAA,EAAO,GAC5B4H,EAAUpB,GAAA,YAAAA,EAAgB,GAC1BqB,EAAUrB,GAAA,YAAAA,EAAgB,GAC1BE,EAAUF,GAAA,YAAAA,EAAgB,GAG1BG,EAAcxL,EAEpB,GAAIwL,EAAY,MAChB,CACI,KAAM,CAAE,MAAAC,EAAO,YAAAC,EAAa,MAAAC,EAAO,mBAAAC,IAAuBJ,EAGpDK,GAAkC,CAAA,EASxC,GAPAA,GAAW,kBAAmBH,GAAA,YAAAA,EAAc,KAAM,EAClDG,GAAW,gBAAiBH,GAAA,YAAAA,EAAc,KAAM,EAChDG,GAAW,YAAcF,GAAS,GAClCE,GAAW,kBAAoBD,IAAsB,GAErDE,GAAqBpH,EAAImH,EAAU,EAE/BnH,aAAc,uBAEd,GAAI7E,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,GAAalM,IAAW,mBAAqBmM,EAAwBQ,CAAkB,EAAI3M,EAE7F6G,GAASC,EAETjC,EAAG,cAAcA,EAAGqH,EAAU,EAAGT,EAAUmB,EAASC,EAAShG,EAAOC,EAAQjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,EAIvG/G,EAAG,cAAcA,EAAGqH,EAAU,EAAGT,EAAUmB,EAASC,EAAShI,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,CAEhG,MACS5L,IAAW,cAAgBA,IAAW,mBAE3C6E,EAAG,cAAcA,EAAG7E,CAAM,EAAGyL,EAAUmB,EAASC,EAASnB,EAAS7E,EAAOC,EAAQ6F,EAAoB9H,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,EAIhI,QAAQ,MAAM,gBAAgB5L,CAAM,eAAe,UAOnDA,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,GAAalM,IAAW,mBAAqBmM,EAAwBQ,CAAkB,EAAI3M,EAEjG6E,EAAG,cAAcA,EAAGqH,EAAU,EAAGT,EAAUmB,EAASC,EAAShI,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGwL,CAAK,CAC5F,MAGI,QAAQ,MAAM,gBAAgB5L,CAAM,QAAQ,EAIpD,MACJ,CAGA,MAAMoM,EAAejM,EACf,CAAE,KAAAiF,EAAM,WAAAiH,EAAY,gBAAAC,CAAA,EAAoBF,EAGxCG,GAASF,GAAA,YAAAA,EAAY,SAAU,EAG/BL,EAAkC,CAAA,EAUxC,GARAA,EAAW,kBAAmBM,GAAA,YAAAA,EAAkB,KAAM,EACtDN,EAAW,gBAAiBM,GAAA,YAAAA,EAAkB,KAAM,EACpDN,EAAW,kBAAmBM,GAAA,YAAAA,EAAkB,KAAM,EACtDN,EAAW,gBAAkBK,GAAA,YAAAA,EAAY,MACzCL,EAAW,kBAAoBK,GAAA,YAAAA,EAAY,OAE3CJ,GAAqBpH,EAAImH,CAAU,EAE/BnH,aAAc,uBAGd,GAAI7E,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,EAAalM,IAAW,mBAAqBmM,EAAwBQ,CAAkB,EAAI3M,EAEjG6E,EAAG,cAAcA,EAAGqH,CAAU,EAAGT,EAAUmB,EAASC,EAAShG,EAAOC,EAAQjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGgF,EAAMmH,CAAM,CAClH,MACSvM,IAAW,cAAgBA,IAAW,mBAE3C6E,EAAG,cAAcA,EAAG7E,CAAM,EAAGyL,EAAUmB,EAASC,EAASnB,EAAS7E,EAAOC,EAAQ6F,EAAoB9H,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGgF,EAAMmH,CAAM,EAIvI,QAAQ,MAAM,gBAAgBvM,CAAM,eAAe,UAOnDA,IAAW,cAAgBA,IAAW,mBAC1C,CACI,MAAMkM,EAAalM,IAAW,mBAAqBmM,EAAwBQ,CAAkB,EAAI3M,EAEjG6E,EAAG,cAAcA,EAAGqH,CAAU,EAAGT,EAAUmB,EAASC,EAAShG,EAAOC,EAAQjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAGgF,CAAI,EAEtG,QAAQ,OAAO,CAACmH,EAAQ,qDAAqD,CACjF,MAGI,QAAQ,MAAM,gBAAgBvM,CAAM,QAAQ,CAGxD,CAAC,CACL,EAEAyM,EAAA,EAEA,MAAMtB,EAAa3D,EAAQ,WAE3ByC,EAAQ,OAAOkB,EAAY,CAAC,gBAAgB,EAAGsB,CAAa,EAC5DxC,EAAQ,MAAMzC,EAAS,gBAAiBiF,CAAa,EAGrD,MAAMK,EAAS,CAACzM,EAAuBtB,IACvC,CACUsB,GAActB,GAEZsB,EAAS,CAAC,IAAMtB,EAAS,CAAC,GACvBsB,EAAS,CAAC,IAAMtB,EAAS,CAAC,IACzBsB,EAAS,CAAC,GAAK,MAAQtB,EAAS,CAAC,GAAK,IAOlDmM,EAAa,QAAA,CACjB,EAEA,OAAAjB,EAAQ,MAAMkB,EAAY,OAAQ2B,CAAM,EAExC5B,EAAa,QAAU,IACvB,CAEIrG,EAAG,cAAcqG,CAAY,EAC7BrG,EAAG,UAAU,OAAO2C,CAAO,EAE3ByC,EAAQ,SAASkB,EAAY,CAAC,gBAAgB,EAAGsB,CAAa,EAC9DxC,EAAQ,QAAQzC,EAAS,UAAWgF,CAAa,EACjDvC,EAAQ,QAAQzC,EAAS,gBAAiBiF,CAAa,EACvDxC,EAAQ,QAAQkB,EAAY,OAAQ2B,CAAM,EAE1C,OAAO5B,EAAa,OACxB,EAEOA,CACX,CAEO,SAAS6B,GAAclI,EAA2B2C,EACzD,CACI,MAAM0D,EAAerG,EAAG,UAAU,IAAI2C,CAAO,EAExC0D,GAELA,EAAa,QAAA,CACjB,CAQA,SAASe,GAAqBpH,EAA2BmH,EACzD,CACI,KAAM,CACF,cAAAgB,EACA,gBAAAC,EACA,YAAAC,EACA,kBAAAC,EACA,2BAAAC,EACA,cAAAC,EACA,eAAAC,EACA,aAAAC,EACA,gBAAAC,EACA,kBAAAC,EACA,iBAAAC,EACA,eAAAC,EACA,iBAAAC,CAAA,EACA,CAAE,GAAG5C,GAA0B,GAAGgB,CAAA,EAGtCnH,EAAG,YAAYA,EAAG,eAAgBmI,CAAa,EAC/CnI,EAAG,YAAYA,EAAG,iBAAkBoI,CAAe,EACnDpI,EAAG,YAAYA,EAAG,oBAAqBqI,CAAW,EAClDrI,EAAG,YAAYA,EAAG,+BAAgCsI,CAAiB,EACnEtI,EAAG,YAAYA,EAAG,mCAAoCA,EAAGuI,CAA0B,CAAC,EAEhFvI,aAAc,yBAEdA,EAAG,YAAYA,EAAG,gBAAiBwI,CAAa,EAChDxI,EAAG,YAAYA,EAAG,iBAAkByI,CAAc,EAClDzI,EAAG,YAAYA,EAAG,eAAgB0I,CAAY,EAC9C1I,EAAG,YAAYA,EAAG,kBAAmB2I,CAAe,EACpD3I,EAAG,YAAYA,EAAG,oBAAqB4I,CAAiB,EACxD5I,EAAG,YAAYA,EAAG,mBAAoB6I,CAAgB,EACtD7I,EAAG,YAAYA,EAAG,iBAAkB8I,CAAc,EAClD9I,EAAG,YAAYA,EAAG,mBAAoB+I,CAAgB,EAE9D,CAsJA,SAASzB,EAAwBQ,EACjC,CACI,MAAMkB,EAA+CC,GAAwBnB,CAAkB,EAE/F,eAAQ,OAAO,CAAC,CAACkB,EAAsB,uCAAuC,EAEvEA,CACX,CAEA,MAAMC,GAAoD,CACtD,8BACA,8BACA,8BACA,8BACA,8BACA,6BACJ,EC3oBO,SAASC,GAAiBlJ,EAA2B0C,EAC5D,CZXA,IAAApM,EAAAe,EAAA8R,EAAAC,EAAAC,EYYI,MAAMC,IAAOjS,GAAAf,EAAAoM,GAAA,YAAAA,EAAgB,mBAAhB,YAAApM,EAAmC,KAAnC,YAAAe,EAAuC,SAAQ8R,EAAAzG,GAAA,YAAAA,EAAgB,yBAAhB,YAAAyG,EAAwC,MAKpG,GAHI,CAACG,GAGD,YAAaA,GAIT,YAFYA,EAAK,QAKjB,OAAO,KAIf,IAAIC,EAAmBvJ,EAAG,cAAc,IAAI0C,CAAc,EAE1D,GAAI6G,EAAkB,OAAOA,EAE7B,MAAM1H,EAAca,EAAe,YAEnC6G,EAAmBvJ,EAAG,kBAAA,EACtBA,EAAG,gBAAgBA,EAAG,YAAauJ,CAAgB,EACnDvJ,EAAG,cAAc,IAAI0C,EAAgB6G,CAAgB,EAGrD,MAAMC,EAAwB,CAAA,GAE9BJ,EAAA1G,EAAe,mBAAf,MAAA0G,EAAiC,QAAQ,CAAC9L,EAAMzG,IAChD,CACI,MAAMyS,EAAOhM,EAAK,KACZmM,EAAazJ,EAAG,mBAAmBnJ,CAAC,EAAE,EAG5C,GADA2S,EAAY,KAAKC,CAAU,EACvB,YAAaH,EACjB,CACI,MAAM3G,EAAU2G,EAAK,QACfI,EAAeJ,EAAK,cAAgB,EACpCK,EAAiBL,EAAK,gBAAkB,EAG9C,GAAI,YAAa3G,EACjB,CAGI6G,EAAY,IAAA,EAEZ,MACJ,CAEA,MAAMnD,EAAeD,GAAapG,EAAI2C,CAAkB,EAClDiH,EAAgB5D,GAAoBrD,EAAoB,WAAW,SAAS,EAE9EiH,IAAkB,aAElB5J,EAAG,qBAAqBA,EAAG,YAAayJ,EAAYzJ,EAAG4J,CAAa,EAAGvD,EAAcqD,CAAY,EAE5FE,IAAkB,mBAEnB5J,aAAc,wBAEdA,EAAG,wBAAwBA,EAAG,iBAAkByJ,EAAYpD,EAAcqD,EAAcC,CAAc,EAK1G,QAAQ,MAAM,OAAOC,CAAa,aAAa,CAEvD,KAEA,CACI,MAAMhI,EAAeD,GAAkB3B,EAAIsJ,EAAMzH,CAAW,EAE5D7B,EAAG,wBAAwBA,EAAG,YAAayJ,EAAYzJ,EAAG,aAAc4B,CAAY,CACxF,CACJ,GAEI5B,aAAc,uBAEdA,EAAG,YAAYwJ,CAAW,EAI1B,QAAQ,MAAM,0BAA0B,EAI5C,MAAMK,EAAyBnH,EAAe,uBAE9C,GAAImH,GAGA,GAAIA,EAAuB,KAC3B,CACI,MAAMP,EAAOO,EAAuB,KAE9BlH,EAAU2G,EAAK,QACfI,EAAeJ,EAAK,cAAgB,EACpCK,EAAiBL,EAAK,gBAAkB,EAG9C,GAAI,cAAa3G,GAMjB,CACI,MAAM0D,EAAeD,GAAapG,EAAI2C,CAAkB,EAClDiH,EAAgB5D,GAAoBrD,EAAoB,WAAW,SAAS,EAE9EiH,IAAkB,aAElB5J,EAAG,qBAAqBA,EAAG,YAAaA,EAAG,iBAAkBA,EAAG4J,CAAa,EAAGvD,EAAcqD,CAAY,EAErGE,IAAkB,mBAEnB5J,aAAc,wBAEdA,EAAG,wBAAwBA,EAAG,iBAAkBA,EAAG,iBAAkBqG,EAAcqD,EAAcC,CAAc,EAKnH,QAAQ,MAAM,OAAOC,CAAa,eAAe,CAEzD,CACJ,SAESL,EACT,CAEI,MAAMO,GAAkBT,EAAA3G,EAAe,mBAAf,YAAA2G,EAAkC,GAC1D,IAAIrH,EAAQhC,EAAG,mBACXiC,EAASjC,EAAG,oBAEhB,GAAI8J,GAAA,MAAAA,EAAiB,KACrB,CACI,MAAMR,EAAOQ,EAAgB,KAE7B,GAAI,YAAaR,EACjB,CACI,MAAM3G,EAAU2G,EAAK,QAEjB,eAAgB3G,IAEhBX,EAAQW,EAAQ,WAAW,KAAK,CAAC,EACjCV,EAASU,EAAQ,WAAW,KAAK,CAAC,EAE1C,CACJ,CAGA,MAAMoH,EAAoB/J,EAAG,mBAAA,EAE7BA,EAAG,iBAAiBA,EAAG,aAAc+J,CAAiB,EAClD/J,aAAc,wBAEdA,EAAG,oBAAoBA,EAAG,aAAcA,EAAG,iBAAkBgC,EAAOC,CAAM,EAC1EjC,EAAG,wBAAwBA,EAAG,YAAaA,EAAG,yBAA0BA,EAAG,aAAc+J,CAAiB,IAI1G/J,EAAG,oBAAoBA,EAAG,aAAcA,EAAG,kBAAmBgC,EAAOC,CAAM,EAC3EjC,EAAG,wBAAwBA,EAAG,YAAaA,EAAG,iBAAkBA,EAAG,aAAc+J,CAAiB,GAKtG,MAAMC,EAAQhK,EAETgK,EAAM,iCAEPA,EAAM,mCAAqC,KAE/CA,EAAM,+BAA+B,IAAIT,EAAkBQ,CAAiB,CAChF,EAGJ,OAAOR,CACX,CASO,SAASU,GAAkBjK,EAA2B0C,EAAsCwH,EAAoB,GACvH,CACI,GAAIA,IAAqBxH,GAAA,MAAAA,EAAiBH,KAC1C,CACI4H,GAA0CnK,EAAI0C,EAAeH,EAAuC,CAAC,EAErG,MACJ,CAEA,MAAMgH,EAAmBvJ,EAAG,cAAc,IAAI0C,CAAc,EAE5D1C,EAAG,cAAc,OAAO0C,CAAc,EAGtC,MAAMsH,EAAQhK,EAEd,GAAIgK,EAAM,gCAAkCT,EAC5C,CACI,MAAMQ,EAAoBC,EAAM,+BAA+B,IAAIT,CAAgB,EAE/EQ,IAEA/J,EAAG,mBAAmB+J,CAAiB,EACvCC,EAAM,+BAA+B,OAAOT,CAAgB,EAEpE,CAGAvJ,EAAG,kBAAkBuJ,CAAgB,CACzC,CAEA,SAASY,GAA0CnK,EAA2BoK,EAC9E,CACIH,GAAkBjK,EAAIoK,EAAoC,gBAAgB,KAAM,EAAK,EACrFH,GAAkBjK,EAAIoK,EAAoC,gBAAgB,KAAM,EAAK,EAErFA,EAAoC,cAAc,QAAS9O,GAC3D,CACI4G,GAAmBlC,EAAI1E,CAAC,CAC5B,CAAC,CACL,CC7NO,SAAS+O,GAAoB7U,EACpC,CACI,MAAMwB,EAASsT,GAAsB9U,CAAK,EAE1C,eAAQ,OAAO,CAAC,CAACwB,CAAM,EAEhBA,CACX,CAQO,SAASuT,GAA0BhP,EAC1C,CACI,OAAOiP,GAA6BjP,CAAI,IAAM,MAClD,CAKA,MAAMkP,GAA+B,CAAE,MAAO,KAAM,WAAY,MAAO,WAAY,MAAO,WAAY,MAAO,IAAK,KAAM,SAAU,MAAO,SAAU,MAAO,SAAU,MAAO,KAAM,MAAO,UAAW,MAAO,UAAW,MAAO,UAAW,MAAO,WAAY,MAAO,WAAY,MAAO,WAAY,KAAA,EAI1RC,GAAgC,CAAE,WAAY,MAAO,aAAc,KAAA,EAKnEC,GAAmC,CAAE,aAAc,KAAM,kBAAmB,MAAO,kBAAmB,MAAO,kBAAmB,MAAO,aAAc,MAAO,aAAc,MAAO,aAAc,MAAO,aAAc,MAAO,aAAc,MAAO,aAAc,KAAA,EAI9PC,GAAoC,CAAE,WAAY,MAAO,kBAAmB,MAAO,iBAAkB,MAAO,wBAAyB,MAAO,oBAAqB,MAAO,eAAgB,MAAO,eAAgB,MAAO,iBAAkB,MAAO,qBAAsB,MAAO,wBAAyB,MAAO,wBAAyB,MAAO,0BAA2B,MAAO,8BAA+B,KAAA,EAK7YC,GAAwB,CAAE,GAAGJ,GAA8B,GAAGC,GAA+B,GAAGC,GAAkC,GAAGC,EAAA,EAKrIJ,GAA+B,CAAE,GAAGE,GAA+B,GAAGE,EAAA,EAUtEN,GAAwB,OAAO,KAAKO,EAAqB,EAAE,OAAO,CAACC,EAAIpF,KAEzEoF,EAAGD,GAAsBnF,CAAE,CAAC,EAAIA,EAEzBoF,GACR,EAAE,EC5BE,SAASC,GAAa/K,EAA2BgL,EACxD,CACI,MAAMC,EAAYC,GAAOF,CAAQ,EACjC,IAAIhU,EAASgJ,EAAG,UAAUiL,CAAS,EAEnC,GAAIjU,EAAQ,OAAOA,EAEnB,MAAMmU,EAASH,EAAS,OAAO,MAAQA,EAAS,OAAO,KACvD,IAAII,EACJ,MAAMC,EAAiBL,EAA4B,SAE/CK,IAEAD,EAAWC,EAAc,MAAQA,EAAc,MAGnDD,EAAWA,GAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAQvB,MAAME,EAA6BN,EAAuC,0BAE1E,OAAAhU,EAASuU,GAAgBvL,EAAImL,EAAQC,EAAUE,CAAyB,EACxEtL,EAAG,UAAUiL,CAAS,EAAIjU,EAEnBA,CACX,CAEO,SAASwU,GAAcxL,EAA2BgL,EACzD,CACI,MAAMC,EAAYC,GAAOF,CAAQ,EAC3BhU,EAASgJ,EAAG,UAAUiL,CAAS,EAEjCjU,IAEA,OAAOgJ,EAAG,UAAUiL,CAAS,EAC7BjL,EAAG,cAAchJ,CAAM,EAE/B,CAEA,SAASkU,GAAOF,EAChB,CACI,MAAMG,EAASH,EAAS,OAAO,MAAQA,EAAS,OAAO,KACvD,IAAII,EACJ,MAAMC,EAAiBL,EAA4B,SAE/CK,IAEAD,EAAWC,EAAc,MAAQA,EAAc,MAEnD,MAAMC,EAA6BN,EAAuC,0BAE1E,MAAO;AAAA,EAAuBG,CAAM;AAAA;AAAA,EAAqBC,CAAQ;AAAA,gBAAmBE,GAAA,YAAAA,EAA2B,SAAS,UAAU,IAAIA,GAAA,YAAAA,EAA2B,UAAU,EAC/K,CAEA,SAASC,GAAgBvL,EAA2ByL,EAAiBC,EAAiBJ,EACtF,CAEI,MAAMK,EAAeC,GAAe5L,EAAI,gBAAiByL,CAAO,EAG1DI,EAAiBD,GAAe5L,EAAI,kBAAmB0L,CAAO,EAG9DI,EAAUC,GAAkB/L,EAAI2L,EAAcE,EAAgBP,CAAyB,EAGvFU,EAAgBhM,EAAG,oBAAoB8L,EAAS9L,EAAG,iBAAiB,EACpEiM,EAAgC,CAAA,EAEtC,QAASpV,EAAI,EAAGA,EAAImV,EAAenV,IACnC,CACI,MAAMqV,EAAalM,EAAG,gBAAgB8L,EAASjV,CAAC,EAC1C,CAAE,KAAAsV,EAAM,KAAAhM,EAAM,KAAA5E,CAAA,EAAS2Q,EACvBE,EAAWpM,EAAG,kBAAkB8L,EAASK,CAAI,EAC7CE,EAAaC,GAAmB/Q,CAAW,EAEjD0Q,EAAW,KAAK,CAAE,KAAAE,EAAM,KAAAhM,EAAM,KAAMkM,EAAY,SAAAD,EAAU,CAC9D,CAEA,MAAMG,EAAcvM,EAAG,oBAAoB8L,EAAS9L,EAAG,eAAe,EAChEwM,EAA4B,CAAA,EAClC,IAAIC,EAAY,EAEhB,QAAS5V,EAAI,EAAGA,EAAI0V,EAAa1V,IACjC,CACI,MAAMqV,EAAalM,EAAG,iBAAiB8L,EAASjV,CAAC,EAC3C,CAAE,KAAAsV,EAAM,KAAAhM,EAAM,KAAA5E,CAAA,EAAS2Q,EACvBG,EAAahC,GAAoB9O,CAAI,EACrCmR,EAAYnC,GAA0B8B,CAAU,EAEhDM,EAAM,SAENC,EAAQ,CAACT,CAAI,EAEnB,GAAIhM,EAAO,EACX,CACI,QAAQ,OAAOgM,EAAK,UAAUA,EAAK,OAAS,CAAC,IAAM,KAAK,EACxD,MAAMU,EAAWV,EAAK,UAAU,EAAGA,EAAK,OAAS,CAAC,EAElD,QAASW,EAAI,EAAGA,EAAI3M,EAAM2M,IAEtBF,EAAME,CAAC,EAAI,GAAGD,CAAQ,IAAIC,CAAC,GAEnC,CAEA,MAAMC,EAA2B,CAAA,EAEjC,QAASD,EAAI,EAAGA,EAAIF,EAAM,OAAQE,IAClC,CACI,MAAMX,EAAOS,EAAME,CAAC,EACpB,IAAI9V,EAA0B2V,EAAI,KAAKR,CAAI,EAC3C,MAAMa,EAAkB,CAAA,EAExB,KAAOhW,GAEHgW,EAAM,KAAKhW,EAAO,CAAC,CAAC,EACpBA,EAAS2V,EAAI,KAAKR,CAAI,EAE1B,MAAMC,EAAWpM,EAAG,mBAAmB8L,EAASK,CAAI,EAEhDO,GAEAK,EAAM,KAAK,CAAE,SAAAX,EAAU,MAAAY,EAAO,UAAAP,EAAW,EACzCA,KAIAM,EAAM,KAAK,CAAE,SAAAX,EAAU,MAAAY,EAAO,UAAW,GAAI,CAErD,CACAR,EAAS3V,CAAC,EAAI,CAAE,KAAAsV,EAAM,KAAME,EAAY,UAAAK,EAAW,MAAAK,CAAA,CACvD,CACA,GAAI/M,aAAc,uBAClB,CACI,MAAMiN,EAAmBjN,EAAG,oBAAoB8L,EAAS9L,EAAG,qBAAqB,EAC3EkN,EAA0B,IAAI,MAAMD,CAAgB,EAAE,KAAK,CAAC,EAAE,IAAI,CAAC3R,EAAGzE,IAC5E,CAEImJ,EAAG,oBAAoB8L,EAASjV,EAAGA,CAAC,EAEpC,MAAMsW,EAA8BnN,EAAG,+BAA+B8L,EAASjV,EAAGmJ,EAAG,oCAAoC,EACnHoN,EAA+B,CAAA,EAErC,QAASvW,EAAI,EAAGA,EAAIsW,EAAe,OAAQtW,IAC3C,CACI,MAAMwW,EAAUb,EAASW,EAAetW,CAAC,CAAC,EAE1CwW,EAAQ,QAAU,GAClBD,EAAY,KAAKC,CAAO,CAC5B,CAGA,MAAMC,EAAyB,CAC3B,KAHStN,EAAG,0BAA0B8L,EAASjV,CAAC,EAIhD,MAAOA,EACP,SAAUmJ,EAAG,+BAA+B8L,EAASjV,EAAGmJ,EAAG,uBAAuB,EAClF,SAAUoN,EACV,kBAAmB,MAAA,EAIvB,OAAAE,EAAK,kBAAoBC,GAAqBD,CAAI,EAE3CA,CACX,CAAC,EAEDxB,EAAQ,cAAgBoB,CAC5B,CAGA,OAAApB,EAAQ,OAASL,EACjBK,EAAQ,SAAWJ,EACnBI,EAAQ,WAAaG,EACrBH,EAAQ,SAAWU,EAEZV,CACX,CAwCA,SAASF,GAAe5L,EAA2BzE,EAAkBiS,EACrE,CACI,IAAIC,EAASzN,EAAG,SAASwN,CAAI,EAE7B,GAAIC,EAAQ,OAAOA,EAWnB,GATAA,EAASzN,EAAG,aAAaA,EAAGzE,CAAI,CAAC,EACjCyE,EAAG,SAASwN,CAAI,EAAIC,EAEpBzN,EAAG,aAAayN,EAAQD,CAAI,EAC5BxN,EAAG,cAAcyN,CAAM,EAKnB,CAFazN,EAAG,mBAAmByN,EAAQzN,EAAG,cAAc,EAGhE,CACI,MAAM0N,EAAQ1N,EAAG,iBAAiByN,CAAM,EAExC,MAAAzN,EAAG,aAAayN,CAAM,EAChB,6BAA6BC,CAAK,EAC5C,CAEA,OAAOD,CACX,CAEA,SAAS1B,GAAkB/L,EAA2B2L,EAA2BE,EAA6BP,EAC9G,CAEI,MAAMQ,EAAU9L,EAAG,cAAA,EAwBnB,GArBAA,EAAG,aAAa8L,EAASH,CAAY,EACrC3L,EAAG,aAAa8L,EAASD,CAAc,EAEnCP,IAEItL,aAAc,uBAEdA,EAAG,0BAA0B8L,EAASR,EAA0B,SAAUtL,EAAGsL,EAA0B,UAAU,CAAC,EAIlH,QAAQ,MAAM,0CAA0C,GAKhEtL,EAAG,YAAY8L,CAAO,EAKlB,CAFW9L,EAAG,oBAAoB8L,EAAS9L,EAAG,WAAW,EAG7D,CACI,MAAM0N,EAAQ1N,EAAG,kBAAkB8L,CAAO,EAE1C,MAAA9L,EAAG,cAAc8L,CAAO,EACxB9L,EAAG,aAAa6L,CAAc,EAC9B7L,EAAG,aAAa2L,CAAY,EACtB,2BAA2B+B,CAAK,EAC1C,CAEA,OAAO5B,CACX,CASA,SAASyB,GAAqBI,EAC9B,CACI,MAAMxN,EAAOwN,EAAa,SAE1B,IAAIC,EAAc,EACdC,EAEJ,MAAMd,EAA4I,CAAA,EAElJ,OAAAY,EAAa,SAAS,QAASG,GAC/B,CACI,MAAMC,EAAoBD,EAAY,KAChCE,EAAYC,GAA8BF,CAAiB,EAEjE,QAAQ,OAAO,CAAC,CAACC,EAAW,QAAQD,CAAiB,kBAAkB,EAGvE,MAAMG,EAAoBJ,EAAY,KAAK,UAAU,EAAGA,EAAY,KAAK,YAAY,GAAG,CAAC,EAErFD,IAAeK,IAEfN,EAAcO,GAAQ,GAAIP,CAAW,EACrCC,EAAaK,GAIjBJ,EAAY,MAAM,QAASM,GAC3B,CACIR,EAAcO,GAAQH,EAAU,MAAOJ,CAAW,EAClD,MAAMS,EAAiBT,EACjBU,EAAeN,EAAU,KAG/BJ,GAAeI,EAAU,KACzB,MAAMO,EAAMP,EAAU,QAEhBhB,EAAQoB,EAAS,MAAM,MAAM,CAAC,EAGpCrB,EAAM,KAAK,CAAE,MAAAC,EAAO,OAAQqB,EAAgB,KAAMC,EAAc,IAAAC,EAAK,CACzE,CAAC,CACL,CAAC,EACDX,EAAcO,GAAQ,GAAIP,CAAW,EAErC,QAAQ,OAAOzN,IAASyN,EAAa,yBAAyBzN,CAAI,KAAKyN,CAAW,KAAK,EAE1C,CACzC,KAAMD,EAAa,SACnB,MAAAZ,CAAA,CAIR,CAEA,SAASoB,GAAQpI,EAAWjP,EAC5B,CACI,OAAO,KAAK,KAAKA,EAAIiP,CAAC,EAAIA,CAC9B,CAOA,MAAMkI,GAMF,CACA,MAAO,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,YAAA,EACrC,WAAY,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,YAAA,EAC1C,WAAY,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC5C,WAAY,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC5C,IAAK,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,UAAA,EACnC,SAAU,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,UAAA,EACxC,SAAU,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,UAAA,EAC1C,SAAU,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,UAAA,EAC1C,KAAM,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,UAAA,EACpC,UAAW,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,UAAA,EACzC,UAAW,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,UAAA,EAC3C,UAAW,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,UAAA,EAC3C,WAAY,CAAE,MAAO,EAAG,KAAM,GAAI,QAAS,YAAA,EAC3C,WAAY,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC5C,WAAY,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC5C,aAAc,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,WAAA,EAC5C,kBAAmB,CAAE,MAAO,EAAG,KAAM,EAAG,QAAS,WAAA,EACjD,kBAAmB,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,WAAA,EACnD,kBAAmB,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,WAAA,EACnD,aAAc,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC9C,aAAc,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC9C,aAAc,CAAE,MAAO,EAAG,KAAM,GAAI,QAAS,YAAA,EAC7C,aAAc,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,EAC9C,aAAc,CAAE,MAAO,EAAG,KAAM,GAAI,QAAS,YAAA,EAC7C,aAAc,CAAE,MAAO,GAAI,KAAM,GAAI,QAAS,YAAA,CAClD,EA8DO,SAAS3B,GAAmB9W,EACnC,CACI,OAAOgZ,GAAwBhZ,CAAK,CACxC,CAGA,MAAMgZ,GAA0B,OAAO,OAAO,CAAE,KAAM,OAAQ,KAAM,gBAAiB,KAAM,QAAS,KAAM,iBAAkB,KAAM,MAAO,KAAM,eAAgB,KAAM,QAAS,KAAM,aAAc,EC9f3L,SAASC,GAAqBC,EACrC,CACI,MAAMC,EAAoCC,GAAgBF,CAAY,EAEtE,eAAQ,OAAO,CAAC,CAACC,EAAgB,aAAa,OAAO,KAAKC,EAAe,EAAE,SAAA,CAAU,OAAO,EAErFD,CACX,CAEA,MAAMC,GAAwD,CAC1D,MAAO,QACP,KAAM,OACN,MAAO,QACP,aAAc,SACd,QAAS,UACT,YAAa,WACb,gBAAiB,SACjB,OAAQ,QACZ,ECfO,SAASC,GAAa7O,EAA2B8O,EACxD,CACI,IAAIC,EAAe/O,EAAG,UAAU,IAAI8O,CAAO,EAE3C,GAAIC,EAAc,OAAOA,EAEzB,GAAI/O,aAAc,uBAClB,CACI+O,EAAe/O,EAAG,cAAA,EAClBA,EAAG,UAAU,IAAI8O,EAASC,CAAY,EAEtC,MAAMC,EAAgCC,GAAuBH,EAAQ,UAAWA,EAAQ,YAAY,EAC9FI,EAAgCC,GAAuBL,EAAQ,SAAS,EACxEM,EAAuBC,GAAkBP,EAAQ,YAAY,EAC7DQ,EAAuBD,GAAkBP,EAAQ,YAAY,EAC7DS,EAAuBF,GAAkBP,EAAQ,YAAY,EAC7DU,EAAcV,EAAQ,aAAe,EACrCW,EAAcX,EAAQ,aAAe,GACrCY,EAAoCZ,EAAQ,QAAU,yBAA2B,OACjFa,EAAUlB,GAAqBK,EAAQ,SAAW,YAAY,EAGpE9O,EAAG,kBAAkB+O,EAAc/O,EAAG,mBAAoBA,EAAGgP,CAAS,CAAC,EACvEhP,EAAG,kBAAkB+O,EAAc/O,EAAG,mBAAoBA,EAAGkP,CAAS,CAAC,EACvElP,EAAG,kBAAkB+O,EAAc/O,EAAG,eAAgBA,EAAGoP,CAAK,CAAC,EAC/DpP,EAAG,kBAAkB+O,EAAc/O,EAAG,eAAgBA,EAAGsP,CAAK,CAAC,EAC/DtP,EAAG,kBAAkB+O,EAAc/O,EAAG,eAAgBA,EAAGuP,CAAK,CAAC,EAC/DvP,EAAG,kBAAkB+O,EAAc/O,EAAG,gBAAiBwP,CAAW,EAClExP,EAAG,kBAAkB+O,EAAc/O,EAAG,gBAAiByP,CAAW,EAClEzP,EAAG,kBAAkB+O,EAAc/O,EAAG,qBAAsBA,EAAG0P,CAAW,CAAC,EAC3E1P,EAAG,kBAAkB+O,EAAc/O,EAAG,qBAAsBA,EAAG2P,CAAO,CAAC,CAC3E,CAEA,OAAOZ,CACX,CAEO,SAASa,GAAc5P,EAA2B8O,EACzD,CACI,GAAI9O,aAAc,uBAClB,CACI,MAAM+O,EAAe/O,EAAG,UAAU,IAAI8O,CAAO,EAE7C9O,EAAG,UAAU,OAAO8O,CAAO,EAC3B9O,EAAG,cAAc+O,CAAY,CACjC,CACJ,CAcO,SAASM,GAAkBQ,EAA4B,SAC9D,CACI,MAAMC,EAA6BC,GAAeF,CAAW,EAE7D,eAAQ,OAAO,CAAC,CAACC,EAAa,aAAa,OAAO,KAAKC,EAAc,EAAE,SAAA,CAAU,OAAO,EAEjFD,CACX,CAEA,MAAMC,GAAmD,CACrD,gBAAiB,gBACjB,OAAQ,SACR,gBAAiB,iBACrB,EAiBO,SAASd,GAAuBD,EAAyB,UAAWgB,EAC3E,CACI,IAAIC,EAEJ,OAAIjB,IAAc,SAEVgB,IAAiB,SAEjBC,EAAc,uBAETD,IAAiB,UAEtBC,EAAc,wBAIdA,EAAc,SAKdD,IAAiB,SAEjBC,EAAc,wBAETD,IAAiB,UAEtBC,EAAc,yBAIdA,EAAc,UAIfA,CACX,CAYO,SAASd,GAAuBD,EAAyB,UAChE,CACI,MAAMgB,EAAkCC,GAAajB,CAAS,EAE9D,eAAQ,OAAO,CAAC,CAACgB,EAAa,aAAa,OAAO,KAAKC,EAAY,EAAE,SAAA,CAAU,OAAO,EAE/ED,CACX,CAEA,MAAMC,GAAsD,CACxD,QAAS,UACT,OAAQ,QACZ,ECtJO,SAASC,GAAuBpQ,EAA2BqQ,EAClE,CACI,IAAIC,EAAyBtQ,EAAG,YAAY,IAAIqQ,CAAiB,EAEjE,OAAIC,IAEAtQ,aAAc,yBAEdsQ,EAAyBtQ,EAAG,wBAAA,EAC5BA,EAAG,YAAY,IAAIqQ,EAAmBC,CAAsB,EAE5DtQ,EAAG,sBAAsBA,EAAG,mBAAoBsQ,CAAsB,EACtED,EAAkB,YAAY,QAAS/U,GACvC,CACI,KAAM,CAAE,MAAAiC,EAAO,KAAAgD,CAAA,EAASjF,EAClBnF,EAASoa,EAAO,UAAUhQ,EAAK,MAAM,EAErCL,EAAcH,GAAYC,EAAI7J,EAAQ,4BAA6B,aAAa,EAEtF6J,EAAG,eAAeA,EAAG,0BAA2BzC,EAAO2C,CAAW,CACtE,CAAC,EAGDF,EAAG,WAAWA,EAAG,aAAc,IAAI,GAGhCsQ,EACX,CAEO,SAASE,GAAwBxQ,EAA2BqQ,EACnE,CACI,MAAMC,EAAyBtQ,EAAG,YAAY,IAAIqQ,CAAiB,EAE9DC,IAELtQ,EAAG,YAAY,OAAOqQ,CAAiB,EACnCrQ,aAAc,wBAEdA,EAAG,wBAAwBsQ,CAAsB,EAEzD,CCzCO,MAAMG,GAAmB,mBCCzB,SAASC,GAA0B1Q,EAA2B2Q,EACrE,CAEI,GADI,CAACA,GACD,EAAE3Q,aAAc,wBAAyB,OAAO4Q,GACpD,IAAIC,EAA+CF,EAAc,wBAEjE,GAAIE,EAAsB,OAAOA,EAEjC,MAAMC,EAA0CH,EAAc,OAAQjL,GAAOA,EAAG,WAAa,gBAAgB,EAE7G,GAAIoL,EAAsB,SAAW,EAEjC,OAAAH,EAAc,wBAA6BC,GAEpCA,GAMX,MAAMG,EAAO,IACb,CACID,EAAsB,QAAQ,CAACxV,EAAGzE,IAClC,CACIyE,EAAE,MAAQ0V,GAAwBhR,EAAI1E,CAAC,CAC3C,CAAC,CACL,EAKM2V,EAAWC,GACjB,CACI,MAAMC,EAAUL,EAAsB,IAAKxV,GAAMA,EAAE,MAAM,SAAS,EAElE,QAAQ,IAAI6V,CAAO,EAAE,KAAM7V,GAC3B,CnBxCR,IAAAhF,GmByCYA,EAAA4a,EAAW,mBAAX,MAAA5a,EAAA,KAAA4a,EAA8BJ,EAAuBxV,EACzD,CAAC,CACL,EAEA,OAAAqV,EAAc,wBAA6BE,EAAuB,CAAE,KAAAE,EAAM,QAAAE,CAAA,EAEnEJ,CACX,CAQA,MAAMD,GAA6B,CAAE,KAAM,IAC3C,CAAE,EAAG,QAAS,IACd,CAAE,CAAA,EAEK,SAASI,GAAwBhR,EAA4BoR,EACpE,CACI,MAAMC,EAA6B,CAAA,EACnC,IAAIC,EAsDJ,MAAO,CAAE,MAnDK,IACd,CACIA,EAAatR,EAAG,YAAA,EAEhBA,EAAG,WAAWA,EAAG,mBAAoBsR,CAAU,CACnD,EA8CgB,IA5CJ,IACZ,CAEItR,EAAG,SAASA,EAAG,kBAAkB,CACrC,EAwCqB,QAnCL,SAChB,CACI,GAAIqR,EAAM,SAAW,OAAW,OAAOA,EAAM,OAE7C,GAAIrR,aAAc,uBAyBd,OAvBuB,MAAM,IAAI,QAAQ,CAACiR,EAASM,IACnD,EACK,SAASC,GACV,CACI,GAAI,CAACxR,EAAG,kBAAkBsR,EAAYtR,EAAG,sBAAsB,EAC/D,CAGI,sBAAsBwR,CAAI,EAE1B,MACJ,CAEA,MAAMxa,EAASqa,EAAM,OAASrR,EAAG,kBAAkBsR,EAAYtR,EAAG,YAAY,EAE9EoR,EAAe,QAAQpa,CAAM,EAE7Bia,EAAQja,CAAM,EAEdgJ,EAAG,YAAYsR,CAAU,CAC7B,GAAA,CACJ,CAAC,CAMT,CAEqB,CACzB,CCpHO,SAASG,GAAcC,EAC9B,CACI,IAAIC,EAAWC,GAAYF,CAAQ,EAEnC,eAAQ,OAAO,CAAC,CAACC,EAAU,kCAAkCD,CAAQ,IAAI,EAEzEC,EAAWA,GAAYD,EAEhBC,CACX,CAEA,MAAMC,GAA6C,CAC/C,aAAc,SACd,YAAa,QACb,aAAc,aACd,gBAAiB,YACjB,iBAAkB,iBAClB,UAAW,YACX,aAAc,cAClB,EClBO,SAASC,GAAe7R,EAA2B2R,EAAsBG,EAA2BC,EAC3G,CACI,MAAMxW,EAAOuW,EAAQ,oBAAsB,EAAI9R,EAAG,eAAiBA,EAAG,aAEhEgS,EAAaD,EAAY,WACzBE,EAAaF,EAAY,YAAc,EACvCG,EAAgBH,EAAY,eAAiB,EAE7CrK,EAASuK,EAAaH,EAAQ,kBAAoBA,EAAQ,WAG5DI,EAAgB,EAEZlS,aAAc,uBAEdA,EAAG,sBAAsBA,EAAG2R,CAAQ,EAAGK,EAAYzW,EAAMmM,EAAQwK,CAAa,EAI5DlS,EAAG,aAAa,wBAAwB,EAEhD,2BAA2BA,EAAG2R,CAAQ,EAAGK,EAAYzW,EAAMmM,EAAQwK,CAAa,EAK9FlS,EAAG,aAAaA,EAAG2R,CAAQ,EAAGK,EAAYzW,EAAMmM,CAAM,CAE9D,CC5BO,SAASyK,GAAcnS,EAA2B2R,EAAsBS,EAC/E,CAEI,MAAMC,EAAcD,EAAW,YACzBE,EAAcF,EAAW,aAAe,EACxCF,EAAgBE,EAAW,eAAiB,EAE9CF,EAAgB,EAEZlS,aAAc,uBAEdA,EAAG,oBAAoBA,EAAG2R,CAAQ,EAAGW,EAAaD,EAAaH,CAAa,EAI1DlS,EAAG,aAAa,wBAAwB,EAEhD,yBAAyBA,EAAG2R,CAAQ,EAAGW,EAAaD,EAAaH,CAAa,EAK5FlS,EAAG,WAAWA,EAAG2R,CAAQ,EAAGW,EAAaD,CAAW,CAE5D,CCzBA,MAAME,GAAc,OAAO,OAAO,CAC9B,eAAgB,iBAChB,KAAM,OACN,MAAO,QACP,KAAM,MACV,CAAC,EAEKC,GAAe,OAAO,OAAO,CAAE,IAAK,MAAO,GAAI,KAAM,EAEpD,SAASC,GAAkBzS,EAA2B0S,EAC7D,CACI,MAAMC,GAAqBD,GAAA,YAAAA,EAAW,WAAY,OAC5CE,GAAuBF,GAAA,YAAAA,EAAW,YAAa,MAErD,GAAIC,IAAa,OACjB,CACI,MAAME,EAAaN,GAAYI,CAAQ,EAEvC,QAAQ,OAAO,CAAC,CAACE,EAAY,aAAa,OAAO,KAAKN,EAAW,EAAE,SAAA,CAAU,OAAO,EAEpF,MAAMO,EAAcN,GAAaI,CAAS,EAE1C,QAAQ,OAAO,CAAC,CAACE,EAAa,yBAAyB,OAAO,KAAKN,EAAY,EAAE,SAAA,CAAU,OAAO,EAGlGxS,EAAG,OAAOA,EAAG,SAAS,EACtBA,EAAG,SAASA,EAAG6S,CAAU,CAAC,EAC1B7S,EAAG,UAAUA,EAAG8S,CAAW,CAAC,CAChC,MAGI9S,EAAG,QAAQA,EAAG,SAAS,CAE/B,CChCO,SAAS+S,GAAc/S,EAA2BgT,EAAkCC,EAAqB,GAChH,CAEI,GAAI,CAACA,EACL,CACIjT,EAAG,QAAQA,EAAG,UAAU,EAExB,MACJ,CAEA,GAAIgT,IAAiBA,EAAa,mBAAqBA,EAAa,eAAiB,UACrF,CACI,MAAMtE,EAAeD,GAAqBuE,EAAa,cAAgB,MAAM,EACvEE,EAAoBF,EAAa,mBAAqB,GAS5D,GANAhT,EAAG,OAAOA,EAAG,UAAU,EAEvBA,EAAG,UAAUA,EAAG0O,CAAY,CAAC,EAC7B1O,EAAG,UAAUkT,CAAiB,EAG1BF,EAAa,WAAaA,EAAa,oBAC3C,CACI,MAAMG,EAASH,EAAa,qBAAuB,EAC7CI,EAAQJ,EAAa,WAAa,EAGxChT,EAAG,OAAOA,EAAG,mBAAmB,EAChCA,EAAG,cAAcmT,EAAQC,CAAK,CAClC,MAGIpT,EAAG,QAAQA,EAAG,mBAAmB,CAEzC,MAGIA,EAAG,QAAQA,EAAG,UAAU,CAEhC,CCzCO,SAASqT,GAAqBrT,EAA2BsT,EAChE,CzBHA,IAAAhd,EAAAe,EyBKI,MAAMkc,IAAYjd,EAAAgd,GAAA,YAAAA,EAAU,KAAV,YAAAhd,EAAc,YAAa,CAAC,GAAM,GAAM,GAAM,EAAI,EAEpE0J,EAAG,UAAUuT,EAAU,CAAC,EAAGA,EAAU,CAAC,EAAGA,EAAU,CAAC,EAAGA,EAAU,CAAC,CAAC,EAGnE,MAAMC,GAAQnc,EAAAic,GAAA,YAAAA,EAAU,KAAV,YAAAjc,EAAc,MAE5B,GAAImc,EACJ,CACI,MAAM1d,EAAwB0d,EAAM,MAC9Bzd,EAAwByd,EAAM,MAE9BC,EAAkCC,IAAmB5d,GAAA,YAAAA,EAAO,YAAaH,GAAsB,SAAS,EACxGge,EAAgCC,IAAiB9d,GAAA,YAAAA,EAAO,YAAaH,GAAsB,UAAWG,GAAA,YAAAA,EAAO,SAAS,EACtH+d,EAAgCD,IAAiB9d,GAAA,YAAAA,EAAO,YAAaH,GAAsB,UAAWG,GAAA,YAAAA,EAAO,SAAS,EAEtHge,EAAkCJ,GAAmB3d,GAAA,YAAAA,EAAO,SAAS,GAAK0d,EAC1EM,EAAgCH,GAAiB7d,GAAA,YAAAA,EAAO,UAAWD,GAAA,YAAAA,EAAO,SAAS,GAAK6d,EACxFK,EAAgCJ,GAAiB7d,GAAA,YAAAA,EAAO,UAAWD,GAAA,YAAAA,EAAO,SAAS,GAAK+d,EAK9F,GAFsBje,GAAW,sBAAsB4d,CAAK,EAG5D,CACI,MAAMxd,EAAgBwd,EAAM,eAAiB,CAAC,EAAG,EAAG,EAAG,CAAC,EAExDxT,EAAG,WAAWhK,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,EAAGA,EAAc,CAAC,CAAC,CACxF,CAGAgK,EAAG,OAAOA,EAAG,KAAK,EAClBA,EAAG,sBAAsBA,EAAGyT,CAAc,EAAGzT,EAAG8T,CAAc,CAAC,EAC/D9T,EAAG,kBAAkBA,EAAG2T,CAAc,EAAG3T,EAAG6T,CAAc,EAAG7T,EAAG+T,CAAc,EAAG/T,EAAGgU,CAAc,CAAC,CACvG,MAGIhU,EAAG,QAAQA,EAAG,KAAK,CAE3B,CAEA,SAAS0T,GAAmBO,EAC5B,CACI,GAAI,CAACA,EAAW,OAEhB,MAAMC,EAAmCC,GAAaF,CAAS,EAE/D,eAAQ,OAAO,CAAC,CAACC,EAAiB,aAAa,OAAO,KAAKC,EAAY,EAAE,SAAA,CAAU,OAAO,EAEnFD,CACX,CAEA,MAAMC,GAAmD,CACrD,IAAK,WACL,SAAU,gBACV,mBAAoB,wBACpB,IAAK,MACL,IAAK,KACT,EAEA,SAASP,GAAiBQ,EAA0BH,EACpD,CACI,GAAI,CAACG,EAAa,QAEdH,IAAc,OAASA,IAAc,SAAOG,EAAc,OAE9D,MAAMC,EAA+BC,GAAeF,CAAW,EAE/D,eAAQ,OAAO,CAAC,CAACC,EAAe,aAAa,OAAO,KAAKC,EAAc,EAAE,SAAA,CAAU,OAAO,EAEnFD,CACX,CAEA,MAAMC,GAAmD,CACrD,KAAM,OACN,IAAK,MACL,IAAK,YACL,gBAAiB,sBACjB,YAAa,YACb,sBAAuB,sBACvB,IAAK,YACL,gBAAiB,sBACjB,YAAa,YACb,sBAAuB,sBACvB,sBAAuB,qBACvB,SAAU,iBACV,qBAAsB,0BAC1B,ECxFO,SAASC,GAAWvU,EAA2BgL,EACtD,CACI,MAAMc,EAAUf,GAAa/K,EAAIgL,CAAQ,EAEzChL,EAAG,WAAW8L,CAAO,EAGrBuH,GAAqBrT,EAAIgL,EAAS,SAAS,OAAO,CACtD,CCVO,SAASwJ,GAAgBxU,EAA2BgT,EAC3D,CACI,KAAM,CAAE,aAAAyB,EAAc,YAAAC,GAAgB,CAAE,GAAG1B,CAAA,EAG3C,GAAIyB,GAAgBC,EACpB,CACI,MAAMC,EAAc3B,EAAa,kBAAoB,EAC/C4B,EAAW5B,EAAa,iBAAmB,WAC3C6B,EAAY7B,EAAa,kBAAoB,WAInD,GAFAhT,EAAG,OAAOA,EAAG,YAAY,EAErByU,EACJ,CACI,MAAMhc,EAAOqc,GAAiBL,EAAa,SAAW,QAAQ,EACxDM,EAAOC,GAAeP,EAAa,MAAM,EACzCQ,EAAQD,GAAeP,EAAa,WAAW,EAC/CS,EAAQF,GAAeP,EAAa,MAAM,EAGhDzU,EAAG,oBAAoBA,EAAG,MAAOA,EAAGvH,CAAI,EAAGkc,EAAKC,CAAQ,EACxD5U,EAAG,kBAAkBA,EAAG,MAAOA,EAAG+U,CAAI,EAAG/U,EAAGiV,CAAK,EAAGjV,EAAGkV,CAAK,CAAC,EAC7DlV,EAAG,oBAAoBA,EAAG,MAAO6U,CAAS,CAC9C,CACA,GAAIH,EACJ,CACI,MAAMjc,EAAOqc,GAAiBJ,EAAY,SAAW,QAAQ,EACvDK,EAAOC,GAAeN,EAAY,MAAM,EACxCO,EAAQD,GAAeN,EAAY,WAAW,EAC9CQ,EAAQF,GAAeN,EAAY,MAAM,EAG/C1U,EAAG,oBAAoBA,EAAG,KAAMA,EAAGvH,CAAI,EAAGkc,EAAKC,CAAQ,EACvD5U,EAAG,kBAAkBA,EAAG,KAAMA,EAAG+U,CAAI,EAAG/U,EAAGiV,CAAK,EAAGjV,EAAGkV,CAAK,CAAC,EAC5DlV,EAAG,oBAAoBA,EAAG,KAAM6U,CAAS,CAC7C,CACJ,MAGI7U,EAAG,QAAQA,EAAG,YAAY,CAElC,CAEA,SAAS8U,GAAiBnF,EAC1B,CAGI,OAFmCwF,GAAWxF,CAAO,CAGzD,CAEA,MAAMwF,GAA+C,CACjD,MAAO,QACP,KAAM,OACN,MAAO,QACP,aAAc,SACd,QAAS,UACT,YAAa,WACb,gBAAiB,SACjB,OAAQ,QACZ,EAkBA,SAASH,GAAeI,EACxB,CAGI,OAFiCC,GAAoBD,CAAgB,CAGzE,CACA,MAAMC,GAAsD,CACxD,KAAM,OACN,KAAM,OACN,QAAS,UACT,OAAQ,SACR,kBAAmB,OACnB,kBAAmB,OACnB,iBAAkB,YAClB,iBAAkB,WACtB,EC1FO,SAASC,GAAkBtV,EAA2BuV,EAAgCtC,EAAqB,GAClH,CACIsB,GAAWvU,EAAIuV,CAAc,EAE7BxC,GAAc/S,EAAIuV,EAAe,aAActC,CAAkB,EACjEuB,GAAgBxU,EAAIuV,EAAe,YAAY,CACnD,CCTO,SAASC,GAAWxV,EAA2ByV,EAAmDC,EACzG,CACI,GAAIA,EACJ,CACI,MAAMC,EAAQD,EAAQ,OAAS,GACzBxZ,EAAIwZ,EAAQ,GAAK,EACvB,IAAIE,EAAIF,EAAQ,GAAK,EACrB,MAAM1T,EAAQ0T,EAAQ,OAASD,EAAe,MACxCxT,EAASyT,EAAQ,QAAUD,EAAe,OAE3CE,IAEDC,EAAIH,EAAe,OAASG,EAAI3T,GAGpCjC,EAAG,OAAOA,EAAG,YAAY,EACzBA,EAAG,QAAQ9D,EAAG0Z,EAAG5T,EAAOC,CAAM,CAClC,MAGIjC,EAAG,QAAQA,EAAG,YAAY,CAElC,CCbA,MAAM6V,OAA2B,QAE1B,SAASC,GAAoBC,EAAsCC,EAC1E,CAEI,GAAIH,GAAqB,IAAIG,CAAW,EACxC,CACI,MAAMC,EAAkBJ,GAAqB,IAAIG,CAAW,EAExDC,EAAgB,OAASF,EAAkB,MAE3C,QAAQ,KAAK,8CAA+C,CAAE,YAAAC,EAAa,kBAAAD,EAAmB,gBAAAE,EAAiB,EAGnH,MACJ,CAGAJ,GAAqB,IAAIG,EAAaD,CAAiB,EAEvD,MAAM5V,EAAO4V,EAAkB,KAEzBG,EAAiB,CAAC,CAACF,EAAY,WAEhCE,EAMD,QAAQ,OAAOF,EAAY,WAAW,YAAc7V,EAAM,6CAA6C,EAJtG6V,EAA0C,WAAa,IAAI,WAAW7V,CAAI,EAQ/E,MAAMhK,EAASoa,EAAO,UAAUyF,EAAY,WAAW,MAAM,EACvDtO,EAASsO,EAAY,WAAW,WAEhCG,EAAgB/X,EAAS4X,CAAW,EAG1CD,EAAkB,MAAM,QAASza,GACjC,CACI,KAAM,CAAE,MAAA0R,EAAO,OAAQqB,EAAgB,KAAMC,EAAc,IAAAC,GAAQjT,EAGnEP,GAAO,IACP,CACI,IAAIvF,EAAawgB,EAAY,MACzBI,EAAeD,EAAc,MAEjC,GAAI3gB,IAAU,OAAW,OAEzB,QAASqB,EAAI,EAAGA,EAAImW,EAAM,OAAQnW,IAI9B,GAFArB,EAAQA,EAAMwX,EAAMnW,CAAC,CAAC,EACtBuf,EAAUA,EAAQpJ,EAAMnW,CAAC,CAAC,EACtBrB,IAAU,OACd,CACS0gB,GAED,QAAQ,KAAK,gBAAgBlJ,EAAM,KAAK,GAAG,CAAC,MAAM,EAGtD,MACJ,CAGJ,IAAIzM,EAEA,OAAO/K,GAAU,SAEjB+K,EAAO,IAAIgO,EAAI,CAAC/Y,CAAK,CAAC,EAEjBA,EAAM,YAAY,OAAS+Y,EAAI,KAEpChO,EAAO,IAAIgO,EAAI/Y,CAA0B,EAIzC+K,EAAO/K,EAGX,MAAMkL,EAAevK,EAAO,cAAgB,CAAA,EAE5CuK,EAAa,KAAK,CAAE,KAAAH,EAAY,aAAcmH,EAAS2G,EAAgB,KAAM,KAAK,IAAIC,EAAc/N,EAAK,UAAU,EAAIA,EAAK,kBAAmB,EAC/InC,EAASjI,CAAM,EAAE,aAAeuK,CACpC,CAAC,CACL,CAAC,CACL,CC7EO,SAAS2V,GAAWrW,EAA2B4J,EAAgCvD,EAA4ByI,EAAkBrC,EACpI,CACI,GAAIzM,aAAc,uBAClB,CACI,MAAM+O,EAAeF,GAAa7O,EAAI8O,CAAO,EAE7C9O,EAAG,YAAYyM,EAAWsC,CAAY,CAC1C,KAEA,CACI,MAAMC,EAAYC,GAAuBH,EAAQ,UAAWA,EAAQ,YAAY,EAC1EI,EAAYC,GAAuBL,EAAQ,SAAS,EACpDM,EAAQC,GAAkBP,EAAQ,YAAY,EAC9CQ,EAAQD,GAAkBP,EAAQ,YAAY,EAGhDzI,EAAa,YAAc2I,IAE3BhP,EAAG,cAAcA,EAAG4J,CAAa,EAAG5J,EAAG,mBAAoBA,EAAGgP,CAAS,CAAC,EACxE3I,EAAa,UAAY2I,GAEzB3I,EAAa,YAAc6I,IAE3BlP,EAAG,cAAcA,EAAG4J,CAAa,EAAG5J,EAAG,mBAAoBA,EAAGkP,CAAS,CAAC,EACxE7I,EAAa,UAAY6I,GAEzB7I,EAAa,QAAU+I,IAEvBpP,EAAG,cAAcA,EAAG4J,CAAa,EAAG5J,EAAG,eAAgBA,EAAGoP,CAAK,CAAC,EAChE/I,EAAa,MAAQ+I,GAErB/I,EAAa,QAAUiJ,IAEvBtP,EAAG,cAAcA,EAAG4J,CAAa,EAAG5J,EAAG,eAAgBA,EAAGsP,CAAK,CAAC,EAChEjJ,EAAa,MAAQiJ,EAE7B,CAGA,MAAMgH,GAAgBxH,GAAA,YAAAA,EAAS,gBAAiB,EAEhD,GAAIzI,EAAa,gBAAkBiQ,EACnC,CACI,MAAMC,EAAYvW,EAAG,aAAa,gCAAgC,EAE9DuW,GAEAvW,EAAG,cAAcA,EAAG4J,CAAa,EAAG2M,EAAU,2BAA4B,KAAK,IAAID,EAAetW,EAAG,cAAc,aAAa,CAAC,EAErIqG,EAAa,cAAgBiQ,CACjC,CACJ,CClEO,SAASE,GAAkBxW,EAA2B8N,EAA8B2I,EAC3F,CACI,KAAM,CAAE,QAAA9T,EAAS,QAAAmM,CAAA,EAAY2H,EACvB,CAAE,SAAArK,EAAU,UAAAK,CAAA,EAAcqB,EAE1BlE,EAAgB5D,GAAmBrD,EAAQ,WAAW,SAAS,EAGrE3C,EAAG,UAAUoM,EAAUK,CAAS,EAEhC,MAAMpG,EAAeD,GAAapG,EAAI2C,CAAO,EAE7C3C,EAAG,cAAcA,EAAG,UAAUyM,CAAS,EAAE,CAAC,EAE1CzM,EAAG,YAAYA,EAAG4J,CAAa,EAAGvD,CAAY,EAG9C,MAAMqQ,EAAkBC,GAAwBhU,EAASmM,CAAO,EAGhE,OAAAuH,GAAWrW,EAAI4J,EAAevD,EAAcqQ,EAAiBjK,CAAS,EAE/DpG,CACX,CAGA,MAAMuQ,OAAqB,QAM3B,SAASD,GAAwBhU,EAAoCmM,EACrE,CACI,MAAMxI,EAAa3D,EAAQ,WAG3B,MAAI,EAFc2D,EAAW,gBAAmBA,EAAW,eAAiBA,EAAW,cAAgB,IAErFwI,EAAQ,cAGjB8H,GAAe,IAAIjU,CAAO,IAE3BiU,GAAe,IAAIjU,CAAO,EAC1B,QAAQ,KACJ,qEAAqEmM,EAAQ,YAAY,kGAAA,GAM1F,CACH,GAAGA,EACH,aAAc,OACd,YAAa,CAAA,GAIdA,CACX,CC1DO,SAAS+H,GAAW7W,EAA2BzE,EAA2BuS,EAA8BgJ,EAC/G,CACI,IAAIvW,EAAYuW,EAAc,MAE1B,OAAOvW,GAAS,SAEhBA,EAAO,CAACA,CAAI,EAEPA,EAAK,UAEVA,EAAOA,EAAK,QAAA,GAEhB,MAAM6L,EAAW0B,EAAY,SAE7B,OAAQvS,EAAA,CAEJ,IAAK,OACL,IAAK,MACDyE,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,YACL,IAAK,WACDP,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,YACL,IAAK,WACDP,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,YACL,IAAK,WACDP,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,QACDP,EAAG,WAAWoM,EAAU,CAAC7L,CAAI,CAAC,EAC9B,MACJ,IAAK,aACDP,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,aACDP,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,aACDP,EAAG,WAAWoM,EAAU7L,CAAI,EAC5B,MACJ,IAAK,aACDP,EAAG,iBAAiBoM,EAAU,GAAO7L,CAAI,EACzC,MACJ,IAAK,aACDP,EAAG,iBAAiBoM,EAAU,GAAO7L,CAAI,EACzC,MACJ,IAAK,aACDP,EAAG,iBAAiBoM,EAAU,GAAO7L,CAAI,EACzC,MACJ,IAAK,eACAP,EAAqC,YAAYoM,EAAU7L,CAAI,EAChE,MACJ,IAAK,oBACAP,EAAqC,YAAYoM,EAAU7L,CAAI,EAChE,MACJ,IAAK,oBACAP,EAAqC,YAAYoM,EAAU7L,CAAI,EAChE,MACJ,IAAK,oBACAP,EAAqC,YAAYoM,EAAU7L,CAAI,EAChE,MACJ,IAAK,eACAP,EAAqC,mBAAmBoM,EAAU,GAAO7L,CAAI,EAC9E,MACJ,IAAK,eACAP,EAAqC,mBAAmBoM,EAAU,GAAO7L,CAAI,EAC9E,MACJ,IAAK,eACAP,EAAqC,mBAAmBoM,EAAU,GAAO7L,CAAI,EAC9E,MACJ,IAAK,eACAP,EAAqC,mBAAmBoM,EAAU,GAAO7L,CAAI,EAC9E,MACJ,IAAK,eACAP,EAAqC,mBAAmBoM,EAAU,GAAO7L,CAAI,EAC9E,MACJ,IAAK,eACAP,EAAqC,mBAAmBoM,EAAU,GAAO7L,CAAI,EAC9E,MACJ,QACI,QAAQ,MAAM,kBAAkBuN,EAAY,KAAK,IAAIvS,CAAI,EAAE,CAAA,CAEvE,CChFA,SAASwb,GAAcvhB,EACvB,CACI,OAAOA,GAAS,OAAOA,GAAU,UAAY,YAAaA,CAC9D,CAKA,SAASwhB,GAAUxhB,EACnB,CACI,OAAOA,GAAS,OAAOA,GAAU,UAAY,EAAE,YAAaA,IAAU,EAAE,UAAWA,IAAU,EAAE,WAAYA,EAC/G,CAKA,SAASkX,GAAUlX,EACnB,CACI,OAAOA,GAAS,OAAOA,GAAU,UAAY,eAAgBA,CACjE,CAMA,SAASyhB,GAA8BC,EAAoC/K,EAC3E,CACI,MAAMgL,EAAa,GAAGhL,CAAI,WACpBiL,EAAajL,EAEbkL,EAAeH,EAAiBC,CAAU,EAC1CG,EAAeJ,EAAiBE,CAAU,EAEhD,GAAIC,GAAgBC,GAAgBP,GAAcM,CAAY,GAAKL,GAAUM,CAAY,GAGjF5K,GAAU2K,EAAa,OAAO,EAE9B,MAAO,CACH,QAASA,EAAa,QACtB,QAASC,CAAA,CAMzB,CAKO,SAASC,GAAYvX,EAA2BwX,EAA0BN,EACjF,CACI,MAAMO,EAAe1M,GAAa/K,EAAIwX,CAAQ,EAE9CC,EAAa,SAAS,QAAS3J,GAC/B,CACI,KAAM,CAAE,KAAA3B,EAAM,KAAA5Q,EAAM,MAAAwR,EAAO,UAAAL,EAAW,QAAAgL,GAAY5J,EAE9C4J,GAEJ3K,EAAM,QAASzR,GACf,CACI,KAAM,CAAE,MAAA0R,GAAU1R,EAElB,IAAI0a,EAAckB,EAAiBlK,EAAM,CAAC,CAAC,EAE3C,QAASnW,EAAI,EAAGA,EAAImW,EAAM,OAAQnW,IAE9Bmf,EAAcA,EAAYhJ,EAAMnW,CAAC,CAAC,EAKtC,GAAI6V,GAII,EAFqBsJ,GAAe,OAAOA,GAAgB,UAAY,YAAaA,GAGxF,CAEI,MAAM2B,EAAeV,GAA8BC,EAAkBlK,EAAM,CAAC,CAAC,EAEzE2K,IAEA3B,EAAc2B,EAEtB,CAGA3B,IAAgB,QAEhB,QAAQ,MAAM,eAAe7J,CAAI,MAAM,EAGvCO,EAEA8J,GAAkBxW,EAAI1E,EAAG0a,CAA6B,EAItDa,GAAW7W,EAAIzE,EAA6BD,EAAG0a,CAA4B,CAEnF,CAAC,CACL,CAAC,EAEGhW,aAAc,wBAEdyX,EAAa,cAAc,QAAS9J,GACpC,CACI,KAAM,CAAE,KAAAxB,EAAM,MAAA5O,CAAA,EAAUoQ,EAExB,IAAIqI,EAAckB,EAAiB/K,CAAI,EAEvC,GAAI6J,IAAgB,OACpB,CACI,MAAM4B,EAAezL,EAAK,OAAO,CAAC,EAAE,cAAgBA,EAAK,MAAM,CAAC,EAEhE6J,EAAckB,EAAiBU,CAAY,CAC/C,CACA,GAAI5B,IAAgB,OAEhB,MAAM,IAAI,MAAM,sBAAsB7J,CAAI,qCAAqCA,CAAI,QAAQA,EAAK,OAAO,CAAC,EAAE,cAAgBA,EAAK,MAAM,CAAC,CAAC,MAAM,EAIjJ,IAAI0L,EAAa7B,EAEjB,GAAI,EAAE6B,EAAW,QAAUA,EAAW,mBACtC,CACI,MAAMf,EAAgBd,EAEtBF,GAAoBnI,EAAa,kBAAmBmJ,CAAa,EACjEe,EAAaf,EAAc,UAC/B,CACA,MAAM3gB,EAASoa,EAAO,UAAUsH,EAAW,MAAM,EAEhD1hB,EAA8B,MAAQA,EAAO,OAAU,iBAAiBgW,CAAI,GAE7E,MAAMzE,EAASmQ,EAAW,WACpB1X,EAAOwN,EAAa,kBAAkB,KAGtCzN,EAAcH,GAAYC,EAAI7J,EAAQ,iBAAkB,cAAc,EAE5E6J,EAAG,gBAAgBA,EAAG,eAAgBzC,EAAO2C,EAAawH,EAAQvH,CAAI,CAC1E,CAAC,CAET,CC7JO,SAAS2X,GAAe9X,EAA2B8R,EAC1D,CACI,GAAI,CAACA,EAAS,OAEd,MAAMiG,EAAcxH,EAAO,UAAUuB,EAAQ,MAAM,EAE9CiG,EAAY,QAEb3Z,EAAS2Z,CAAW,EAAE,MAAS,QAAQC,IAAW,IAGtD,MAAM7hB,EAAS4J,GAAYC,EAAI+X,EAAa,uBAAwB,aAAa,EAEjF/X,EAAG,WAAWA,EAAG,qBAAsB7J,CAAM,CACjD,CAEA,IAAI6hB,GAAY,EChBT,SAASC,GAAmBjY,EAA2BoM,EAAkB8L,EAChF,CACI,KAAM,CAAE,SAAAC,EAAU,OAAA9hB,EAAQ,KAAAkK,CAAA,EAAS2X,EACnC,GAAI,CAAE,YAAAE,EAAa,OAAA1Q,CAAA,EAAWwQ,EAE9B,MAAMG,EAAiB3iB,GAAgBW,CAAM,EACvC,CAAE,cAAAiiB,EAAe,WAAAC,EAAY,KAAAhd,CAAA,EAAS8c,EAE5CrY,EAAG,wBAAwBoM,CAAQ,EAE/B+L,IAAa,aAETnY,aAAc,uBAEdA,EAAG,oBAAoBoM,EAAU,CAAC,EAIhBpM,EAAG,aAAa,wBAAwB,EAEhD,yBAAyBoM,EAAU,CAAC,GAKtDgM,EAAcA,GAAeC,EAAe,SAC5C3Q,EAASnH,EAAK,YAAcmH,GAAU,GAGtC,MAAMvR,EAASoa,EAAO,UAAUhQ,EAAK,MAAM,EAEtCpK,EAAO,QAERiI,EAASjI,CAAM,EAAE,MAAS,QAAQqiB,IAAiB,IAGvD,MAAMtY,EAAcH,GAAYC,EAAI7J,EAAQ,eAAgB,aAAa,EAEzE6J,EAAG,WAAWA,EAAG,aAAcE,CAAW,EAGtCF,aAAc,yBAA2BzE,IAAS,OAASA,IAAS,gBAEpEyE,EAAG,qBAAqBoM,EAAUkM,EAAetY,EAAGzE,CAAI,EAAG6c,EAAa1Q,CAAM,EAI9E1H,EAAG,oBAAoBoM,EAAUkM,EAAetY,EAAGzE,CAAI,EAAGgd,EAAYH,EAAa1Q,CAAM,CAEjG,CAEA,IAAI8Q,GAAkB,EC/Cf,SAASC,GAAezY,EAA2BgL,EAA0B0N,EAA4B5G,EAChH,CACI,GAAI,CAAC4G,GAAY,CAAC5G,EAAS,OAE3B,IAAI6G,EAEJ,GAAI3Y,aAAc,uBAClB,CAEI,GADA2Y,EAAyB3Y,EAAG,cAAc,IAAI,CAACgL,EAAU0N,EAAU5G,CAAO,CAAC,EACvE6G,EACJ,CACI3Y,EAAG,gBAAgB2Y,CAAsB,EAEzC,MACJ,CAEAA,EAAyB3Y,EAAG,kBAAA,EAC5BA,EAAG,gBAAgB2Y,CAAsB,EACzC3Y,EAAG,cAAc,IAAI,CAACgL,EAAU0N,EAAU5G,CAAO,EAAG6G,CAAsB,CAC9E,CAEqB5N,GAAa/K,EAAIgL,CAAQ,EAGjC,WAAW,QAASkB,GACjC,CACI,KAAM,CAAE,KAAAC,EAAM,SAAAC,CAAA,EAAaF,EAG3B,GAAIE,EAAW,EAAG,OAElB,MAAM8L,EAAYQ,EAASvM,CAAI,EAE1B+L,GAED,QAAQ,MAAM,QAAQ/L,CAAI,MAAM,EAGpC8L,GAAmBjY,EAAIoM,EAAU8L,CAAS,CAC9C,CAAC,EAEDJ,GAAe9X,EAAI8R,CAAO,CAC9B,CChDO,SAAS8G,GAAY5Y,EAA2ByV,EAAmDoD,EAC1G,CACI,GAAIA,EACJ,CACI,MAAMlD,EAAQkD,EAAS,OAAS,GAC1B3c,EAAI2c,EAAS,GAAK,EACxB,IAAIjD,EAAIiD,EAAS,GAAK,EACtB,MAAM7W,EAAQ6W,EAAS,OAASpD,EAAe,MACzCxT,EAAS4W,EAAS,QAAUpD,EAAe,OAE5CE,IAEDC,EAAIH,EAAe,OAASG,EAAI3T,GAGpCjC,EAAG,SAAS9D,EAAG0Z,EAAG5T,EAAOC,CAAM,CACnC,MAGIjC,EAAG,SAAS,EAAG,EAAGyV,EAAe,MAAOA,EAAe,MAAM,CAErE,CCZO,SAASqD,GAAgB9Y,EAA2ByV,EAAmDsD,EAA4B9F,EAAqB,GAC/J,CACI,KAAM,CAAE,SAAA4F,EAAU,YAAAG,EAAa,SAAAxB,EAAU,SAAAkB,EAAU,QAAA5G,EAAS,KAAAmH,EAAM,iBAAkBzM,CAAA,EAAauM,EAC3FrG,EAAY8E,GAAA,YAAAA,EAAU,UAE5BoB,GAAY5Y,EAAIyV,EAAgBoD,CAAQ,EAExCrD,GAAWxV,EAAIyV,EAAgBuD,CAAW,EAE1C1D,GAAkBtV,EAAIwX,EAAUvE,CAAkB,EAElDsE,GAAYvX,EAAIwX,EAAUhL,CAAQ,EAElCiM,GAAezY,EAAIwX,EAAUkB,EAAU5G,CAAO,EAE9CW,GAAkBzS,EAAI0S,CAAS,EAE/B,MAAMhB,GAAWgB,GAAA,YAAAA,EAAW,WAAY,gBAClCf,EAAWF,GAAcC,CAAQ,EAEnCuH,EAAK,WAAa,aAElB9G,GAAcnS,EAAI2R,EAAUsH,CAAI,EAIhCpH,GAAe7R,EAAI2R,EAAUG,EAASmH,CAAI,CAElD,CCpCO,SAASC,GAAmBlZ,EAA2B6C,EAC9D,CACI,KAAM,CAAE,KAAAsW,EAAM,KAAAF,EAAM,iBAAAG,CAAA,EAAqBvW,EAEnCwW,EAAkBnQ,GAAiBlJ,EAAImZ,CAAI,EAC3CG,EAAkBpQ,GAAiBlJ,EAAIiZ,CAAI,EAE7CjZ,aAAc,yBAEdA,EAAG,gBAAgBA,EAAG,iBAAkBqZ,CAAe,EACvDrZ,EAAG,gBAAgBA,EAAG,iBAAkBsZ,CAAe,EAEvDL,EAAK,iBAAiB,QAAQ,CAAC3b,EAAMzG,IACrC,CxChBR,IAAAP,EwCiBY,MAAMijB,GAAajjB,EAAA2iB,EAAK,iBAAiBpiB,CAAC,IAAvB,YAAAP,EAA0B,WAEzCijB,GAEAvZ,EAAG,cAAcA,EAAG,MAAOnJ,EAAG0iB,CAAiB,CAEvD,CAAC,EAEDH,EAAiB,QAAS9b,GAC1B,CACI,KAAM,CAACkc,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAMC,CAAM,EAAI3c,EAE/E0C,EAAG,gBAAgBwZ,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAOC,EAAO/Z,EAAGga,CAAI,EAAGha,EAAGia,CAAM,CAAC,CACnG,CAAC,EAET,CC7BO,SAASC,GAAkBla,EAA2ByV,EAAmDrE,EAAgC6B,EAAqB,GACrK,CAEI7B,EAAe,MAAM,MAAA,EAGrBA,EAAe,cAAc,QAAS2H,GACtC,CACID,GAAgB9Y,EAAIyV,EAAgBsD,EAAc9F,CAAkB,CACxE,CAAC,EAGD7B,EAAe,MAAM,IAAA,CACzB,CCbO,SAAS+I,GAAwBna,EAA2B0C,EACnE,C1CJA,IAAApM,E0CKIoM,EAAiBA,GAAkB,CAAA,EAGnC,MAAM0X,EAAclR,GAAiBlJ,EAAI0C,CAAc,EAEvD1C,EAAG,gBAAgBA,EAAG,YAAaoa,CAAW,EAG9C,MAAMtQ,GAAkBxT,EAAAoM,EAAe,mBAAf,YAAApM,EAAkC,GAEpDijB,GAAazP,GAAA,YAAAA,EAAiB,aAAc,CAAC,EAAG,EAAG,EAAG,CAAC,EACvDuQ,GAASvQ,GAAA,YAAAA,EAAiB,SAAU,QAE1C9J,EAAG,WAAWuZ,EAAW,CAAC,EAAGA,EAAW,CAAC,EAAGA,EAAW,CAAC,EAAGA,EAAW,CAAC,CAAC,EAGxE,MAAM1P,EAAyBnH,EAAe,uBAE9C,GAAImH,EACJ,CACI,MAAMyQ,EAAkBzQ,EAAuB,iBAAmB,EAC5D0Q,EAAc1Q,EAAuB,aAAe,QACpD2Q,EAAoB3Q,EAAuB,mBAAqB,EAChE4Q,EAAgB5Q,EAAuB,eAAiB,OAG9D7J,EAAG,WAAWsa,CAAe,EAC7Bta,EAAG,aAAawa,CAAiB,EAGjCxa,EAAG,OAAOqa,IAAW,QAAUra,EAAG,iBAAmB,IAC9Cua,IAAgB,QAAUva,EAAG,iBAAmB,IAChDya,IAAkB,QAAUza,EAAG,mBAAqB,EAAA,CAE/D,MAIIA,EAAG,MAAOqa,IAAW,QAAUra,EAAG,iBAAmB,CAAE,CAE/D,CCrCO,SAAS0a,GAAc1a,EAA2BkR,EAAwByJ,EACjF,C3CTA,IAAArkB,EAAAe,E2CUI,MAAMiP,EAAa4K,EAAW,YAAcyJ,EAEtClF,EAAiBmF,GAA8B5a,EAAIsG,CAAU,EAG7D2M,EAAqB,CAAC,EAAE3M,GAAA,MAAAA,EAAY,wBAGpC8K,EAAiBV,GAA0B1Q,EAAIkR,EAAW,iBAAiB,EAKjF,GAFAE,EAAe,KAAA,EAEX9K,GAAA,MAAAA,EAAY,aAAgBA,EAAW,iBAAiB,CAAC,EAAE,KAAqB,QACpF,CACI,KAAM,CAAE,eAAA5D,EAAgB,gBAAAG,GAAoBR,GAAyCiE,CAAU,EAE/F6T,GAAwBna,EAAI0C,CAAc,GAE1CpM,EAAA4a,EAAW,oBAAX,MAAA5a,EAA8B,QAASyiB,GACvC,CACQA,EAAa,WAAa,iBAE1BmB,GAAkBla,EAAIyV,EAAgBsD,EAAc9F,CAAkB,EAItE6F,GAAgB9Y,EAAIyV,EAAgBsD,EAA8B9F,CAAkB,CAE5F,GAEAiG,GAAmBlZ,EAAI6C,CAAe,CAC1C,MAGIsX,GAAwBna,EAAIsG,CAAU,GAEtCjP,EAAA6Z,EAAW,oBAAX,MAAA7Z,EAA8B,QAAS0hB,GACvC,CACQA,EAAa,WAAa,iBAE1BmB,GAAkBla,EAAIyV,EAAgBsD,EAAc9F,CAAkB,EAItE6F,GAAgB9Y,EAAIyV,EAAgBsD,EAA8B9F,CAAkB,CAE5F,GAGJ7B,EAAe,QAAQF,CAAU,CACrC,CAQA,SAAS0J,GAA8B5a,EAA2BsG,EAClE,C3CtEA,IAAAhQ,E2CuEI,GAAI,CAACgQ,EAAY,MAAO,CAAE,MAAOtG,EAAG,mBAAoB,OAAQA,EAAG,mBAAA,EAEnE,MAAM6a,EAAmBvU,EAAW,iBAEpC,GAAIuU,EACJ,CACI,MAAMvR,GAAOhT,EAAAukB,EAAiB,CAAC,IAAlB,YAAAvkB,EAAqB,KAElC,GAAIgT,EACJ,CACI,MAAM3G,EAAU2G,EAAK,QAGrB,GAAI,YAAa3G,EACjB,CAEI,MAAMmY,EAAgBnY,EAChBvB,EAAS,OAAO0Z,EAAc,QAAQ,UAAa,SACnD,SAAS,eAAeA,EAAc,QAAQ,QAAQ,EACtDA,EAAc,QAAQ,SAE5B,GAAI1Z,EAEA,MAAO,CAAE,MAAOA,EAAO,MAAO,OAAQA,EAAO,MAAA,CAErD,SACS,eAAgBuB,EACzB,CAEI,MAAMoY,EAAiBpY,EAEvB,MAAO,CAAE,MAAOoY,EAAe,WAAW,KAAK,CAAC,EAAG,OAAQA,EAAe,WAAW,KAAK,CAAC,CAAA,CAC/F,CACJ,CAEA,MAAO,CAAE,MAAO/a,EAAG,mBAAoB,OAAQA,EAAG,mBAAA,CACtD,CAEA,MAAM6J,EAAyBvD,EAAW,uBAE1C,GAAIuD,EACJ,CACI,MAAMP,EAAOO,EAAuB,KAEpC,GAAIP,EACJ,CACI,MAAM3G,EAAU2G,EAAK,QAGrB,GAAI,YAAa3G,EACjB,CAEI,MAAMmY,EAAgBnY,EAChBvB,EAAS,OAAO0Z,EAAc,QAAQ,UAAa,SACnD,SAAS,eAAeA,EAAc,QAAQ,QAAQ,EACtDA,EAAc,QAAQ,SAE5B,GAAI1Z,EAEA,MAAO,CAAE,MAAOA,EAAO,MAAO,OAAQA,EAAO,MAAA,CAErD,SACS,eAAgBuB,EACzB,CAEI,MAAMoY,EAAiBpY,EAEvB,MAAO,CAAE,MAAOoY,EAAe,WAAW,KAAK,CAAC,EAAG,OAAQA,EAAe,WAAW,KAAK,CAAC,CAAA,CAC/F,CACJ,CAEA,MAAO,CAAE,MAAO/a,EAAG,mBAAoB,OAAQA,EAAG,mBAAA,CACtD,CAEA,MAAO,CAAE,MAAOA,EAAG,mBAAoB,OAAQA,EAAG,mBAAA,CACtD,CC/IO,SAASgb,GAA6Bhb,EAA2BuV,EACxE,CACI,MAAMzJ,EAAUf,GAAa/K,EAAIuV,CAAc,EAE/CvV,EAAG,WAAW8L,CAAO,CACzB,CCJO,SAASmP,GAAqBjb,EAA2BqQ,EAAsCqB,EACtG,CACI,GAAI1R,aAAc,uBAEd,GAAIqQ,EACJ,CACI,MAAMC,EAAyBF,GAAuBpQ,EAAIqQ,CAAiB,EAE3ErQ,EAAG,sBAAsBA,EAAG,mBAAoBsQ,CAAsB,EAEtEtQ,EAAG,uBAAuBA,EAAG0R,CAAQ,CAAC,CAC1C,MAGI1R,EAAG,sBAAsBA,EAAG,mBAAoB,IAAI,OAGnDqQ,GAEL,QAAQ,IAAI,wBAAwB,CAE5C,CCvBO,SAAS6K,GAAqBlb,EAA2BqQ,EAChE,CAEQA,GAEIrQ,aAAc,yBAEdA,EAAG,qBAAA,EACHA,EAAG,sBAAsBA,EAAG,mBAAoB,IAAI,EACpDA,EAAG,WAAWA,EAAG,aAAc,IAAI,EACnCA,EAAG,WAAWA,EAAG,0BAA2B,IAAI,EAG5D,CCNO,SAASmb,GAA2Bnb,EAA2B+Y,EACtE,CACI,KAAM,CAAE,SAAU/N,EAAU,SAAA0N,EAAU,SAAAlM,EAAU,kBAAA6D,EAAmB,KAAA4I,GAASF,EAEtEpH,EAAWF,GAAc,YAAY,EAE3CuJ,GAA6Bhb,EAAIgL,CAAQ,EAEzCyN,GAAezY,EAAIgL,EAAU0N,EAAU,MAAS,EAEhDnB,GAAYvX,EAAIgL,EAAUwB,CAAQ,EAElCyO,GAAqBjb,EAAIqQ,EAAmBsB,CAAQ,EAEpDQ,GAAcnS,EAAI2R,EAAUsH,CAAI,EAEhCiC,GAAqBlb,EAAIqQ,CAAiB,CAC9C,CCvBO,SAAS+K,GAAyBpb,EAA2Bqb,EACpE,CAEQrb,aAAc,wBAEdA,EAAG,OAAOA,EAAG,kBAAkB,EAEnCqb,EAAsB,yBAAyB,QAASC,GACxD,CACIH,GAA2Bnb,EAAIsb,CAAuB,CAC1D,CAAC,EACGtb,aAAc,wBAEdA,EAAG,QAAQA,EAAG,kBAAkB,CAExC,CCTO,SAASub,GAAqBC,EACrC,CACI,KAAM,CAAE,OAAAC,EAAQ,YAAAC,EAAa,SAAAC,CAAA,EAAaH,EAEpCI,EAAeH,EAAO,QAAU,MAChCI,EAAoBH,EAAY,QAAU,MAEhD,QAAQ,OAAOE,IAAiBC,EAAmB,yBAAyB,EAE5E,MAAMC,EAAsD,CAAA,EAC5D,IAAIC,EACJ,MAAMC,EAA2D,CAAA,EACjE,IAAIC,EAGAjC,EAEA4B,IAAiB,OAEjB5B,EAAO,mBACP8B,EAAuB,KAAK,CAAE,KAAMI,GAAiBT,CAAM,EAAG,EAC9DO,EAA4B,KAAK,CAAE,KAAME,GAAiBR,CAAW,EAAG,GAEnEE,IAAiB,cAEtB5B,EAAO,mBACP+B,EAA+B,CAAE,KAAMG,GAAiBT,CAAM,CAAA,EAC9DQ,EAAoC,CAAE,KAAMC,GAAiBR,CAAW,CAAA,GAEnEE,IAAiB,iBAEtB5B,EAAO,qBACP+B,EAA+B,CAAE,KAAMG,GAAiBT,CAAM,CAAA,EAC9DQ,EAAoC,CAAE,KAAMC,GAAiBR,CAAW,CAAA,GAG5E,MAAMS,EAAeV,EAAO,QAAU,CAAC,EAAG,CAAC,EACrCW,EAAoBV,EAAY,QAAU,CAAC,EAAG,CAAC,EAE/CW,EAA2C,CAC7CF,EAAa,CAAC,EAAGA,EAAa,CAAC,EAAGA,EAAa,CAAC,EAAIR,EAAS,CAAC,EAAGQ,EAAa,CAAC,EAAIR,EAAS,CAAC,EAC7FS,EAAkB,CAAC,EAAGA,EAAkB,CAAC,EAAGA,EAAkB,CAAC,EAAIT,EAAS,CAAC,EAAGS,EAAkB,CAAC,EAAIT,EAAS,CAAC,EACjH3B,EAAM,SAAA,EAgBV,MAbyC,CACrC,SAAU,kBACV,KAAM,CACF,iBAAkB8B,EAClB,uBAAwBC,CAAA,EAE5B,KAAM,CACF,iBAAkBC,EAClB,uBAAwBC,CAAA,EAE5B,iBAAkB,CAACI,CAAmB,CAAA,CAI9C,CAEA,SAASH,GAAiBT,EAC1B,CjDvEA,IAAAnlB,EiDwEI,OAAKmlB,EAAO,QAEqB,CAC7B,QAASA,EAAO,QAChB,aAAcA,EAAO,SACrB,gBAAgBnlB,EAAAmlB,EAAO,SAAP,YAAAnlB,EAAgB,EAAC,EALhB,MASzB,CC7EO,SAASgmB,GAAwBtc,EAA2Bwb,EACnE,CACI,MAAM3Y,EAAkB0Y,GAAqBC,CAAoB,EAEjEtC,GAAmBlZ,EAAI6C,CAAe,CAC1C,CCNO,SAAS0Z,GAAsBvc,EAA2Bwc,EACjE,CACI,GAAIxc,aAAc,uBAClB,CACI,MAAMyc,EAAK1c,GAAYC,EAAIuQ,EAAO,UAAUiM,EAAmB,OAAO,MAAM,EAAG,kBAAkB,EAC3FE,EAAK3c,GAAYC,EAAIuQ,EAAO,UAAUiM,EAAmB,YAAY,MAAM,EAAG,mBAAmB,EAEjGG,EAAeH,EAAmB,OAAO,WACzCI,EAAoBJ,EAAmB,YAAY,WAGnDrc,EAAOqc,EAAmB,MAAQ,KAAK,IAAIA,EAAmB,OAAO,WAAYA,EAAmB,YAAY,UAAU,EAEhIxc,EAAG,WAAWA,EAAG,iBAAkByc,CAAE,EACrCzc,EAAG,WAAWA,EAAG,kBAAmB0c,CAAE,EACtC1c,EAAG,kBAAkBA,EAAG,iBAAkBA,EAAG,kBAAmB2c,EAAcC,EAAmBzc,CAAI,EAGrGH,EAAG,WAAWA,EAAG,iBAAkB,IAAI,EACvCA,EAAG,WAAWA,EAAG,kBAAmB,IAAI,CAC5C,MAGI,QAAQ,MAAM,oBAAoB,CAE1C,CCrBO,SAAS6c,GAAkB7c,EAA2B8c,EAAgCnC,EAC7F,CACImC,EAAe,aAAa,QAASC,GACrC,CACI,GAAI,CAACA,EAAY,UAAYA,EAAY,WAAa,aACtD,CACIrC,GAAc1a,EAAI+c,EAA2BpC,CAA2B,EAExE,MACJ,CACA,GAAIoC,EAAY,WAAa,wBAC7B,CACI3B,GAAyBpb,EAAI+c,CAAW,EAExC,MACJ,CACA,GAAIA,EAAY,WAAa,kBAC7B,CACI7D,GAAmBlZ,EAAI+c,CAAW,EAElC,MACJ,CACA,GAAIA,EAAY,WAAa,uBAC7B,CACIT,GAAwBtc,EAAI+c,CAAW,EAEvC,MACJ,CACA,GAAIA,EAAY,WAAa,qBAC7B,CACIR,GAAsBvc,EAAI+c,CAAW,EAErC,MACJ,CAEA,QAAQ,MAAM,mBAAmBA,CAAW,EAAE,CAClD,CAAC,CACL,CCxCO,SAASC,GAAUhd,EAA2Bid,EAAgBtC,EACrE,CAC2BsC,EAAO,gBAAgB,IAAK3hB,GAEzBuhB,GAAkB7c,EAAI1E,EAAGqf,CAA2B,CAG7E,EAGD3a,EAAGyQ,EAAgB,EAAI,CAAC,CAACzQ,EAAGyQ,EAAgB,EAAI,CACpD,CCXO,SAASyM,GAAWld,EAA2Bkd,EACtD,CACI,IAAIC,EAEJ,GAAInd,aAAc,uBAClB,CACI,KAAM,CAAE,YAAAod,EAAa,OAAAC,EAAQ,SAAA1B,CAAA,EAAauB,EACpC,CAAClb,EAAOC,CAAM,EAAI0Z,EAGxB,GAAKyB,EA6BL,GACS,YAAaA,EAAY,QAClC,CAE0BA,EAAY,QAClC,MAAME,EAA+B,aAC/B,CAAE,OAAAjnB,EAAQ,KAAAkF,GAAS4G,GAAoBmb,CAAa,EACpD/mB,EAAgBH,EAAQ,wBAAwBknB,CAAa,EAC7DC,EAAkBnnB,EAAQ,0BAA0BknB,CAAa,EAGjEE,EADcxb,EAAQzL,EACK0L,EAEjCkb,EAAa,IAAII,EAAgBC,EAAaD,EAAgB,iBAAiB,EAG/Evd,EAAG,gBAAgBA,EAAG,YAAa,IAAI,EAGvCA,EAAG,WAAWA,EAAG,IAAI,EAGrB,MAAMyd,EAAMxb,IAAW,EACjBjC,EAAG,oBAAsBqd,EAAO,CAAC,EAAI,EACrCrd,EAAG,oBAAsBqd,EAAO,CAAC,EAAIpb,EAE3CjC,EAAG,WAAWqd,EAAO,CAAC,EAAGI,EAAKzb,EAAOC,EAAQjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAG4hB,EAAY,CAAC,CACpF,KAEA,CAEI,MAAMO,EAAqC,oBAErCpX,EADU8W,EAAY,QACD,WACrB,CAAE,OAAA/mB,EAAQ,KAAAkF,CAAA,EAAS4G,GAAoBmE,EAAW,MAAM,EACxD/P,EAAgBH,EAAQ,wBAAwBkQ,EAAW,MAAM,EACjEiX,EAAkBnnB,EAAQ,0BAA0BkQ,EAAW,MAAM,EAGrEkX,EADcxb,EAAQzL,EACK0L,EAEjCkb,EAAa,IAAII,EAAgBC,EAAaD,EAAgB,iBAAiB,EAG/E,MAAMI,EAAoC,CAAE,iBAAkB,CAAC,CAAE,KAAMP,CAAA,CAAa,CAAA,EAE9E7T,EAAmBL,GAAiBlJ,EAAI2d,CAAW,EAEzD3d,EAAG,gBAAgBA,EAAG,YAAauJ,CAAgB,EAEnDvJ,EAAG,WAAWA,EAAG0d,CAAe,CAAC,EACjC1d,EAAG,WAAWqd,EAAO,CAAC,EAAGA,EAAO,CAAC,EAAGrb,EAAOC,EAAQjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAG4hB,EAAY,CAAC,EAGtFlT,GAAkBjK,EAAI2d,CAAW,CACrC,KAnFA,CAEI,MAAML,EAA+B,aAC/B,CAAE,OAAAjnB,EAAQ,KAAAkF,GAAS4G,GAAoBmb,CAAa,EACpD/mB,EAAgBH,EAAQ,wBAAwBknB,CAAa,EAC7DC,EAAkBnnB,EAAQ,0BAA0BknB,CAAa,EAGjEE,EADcxb,EAAQzL,EACK0L,EAEjCkb,EAAa,IAAII,EAAgBC,EAAaD,EAAgB,iBAAiB,EAG/Evd,EAAG,gBAAgBA,EAAG,YAAa,IAAI,EAGvCA,EAAG,WAAWA,EAAG,IAAI,EAOrB,MAAMyd,EAAMxb,IAAW,EACjBjC,EAAG,oBAAsBqd,EAAO,CAAC,EAAI,EACrCrd,EAAG,oBAAsBqd,EAAO,CAAC,EAAIpb,EAE3CjC,EAAG,WAAWqd,EAAO,CAAC,EAAGI,EAAKzb,EAAOC,EAAQjC,EAAG3J,CAAM,EAAG2J,EAAGzE,CAAI,EAAG4hB,EAAY,CAAC,CACpF,CAwDJ,MAGI,QAAQ,MAAM,oCAAoC,EAGtD,OAAOA,CACX,CCtFO,MAAMS,EACb,CAII,YAAYzc,EACZ,CAJQ1L,EAAA,0BACAA,EAAA,YAMJ,KAAK,kBAAoB0L,EACzB,KAAK,IAAMD,GAAmB,KAAK,iBAAiB,CACxD,CAQA,OAAO+b,EACP,CACID,GAAU,KAAK,IAAKC,CAAM,CAC9B,CAEA,WAAWY,EACX,CACI,MAAM7mB,EAASkmB,GAAW,KAAK,IAAKW,CAAY,EAG1CT,EAAcS,EAAa,YAEjC,GAAIT,EACJ,CACI,MAAMza,EAAUya,EAAY,QAExB,YAAaza,EAGbkb,EAAa,OAAS,aAEjB,eAAgBlb,IAGrBkb,EAAa,OAASlb,EAAQ,WAAW,QAAU,aAE3D,MAIIkb,EAAa,OAAS,aAG1B,OAAAA,EAAa,OAAS7mB,EAEfA,CACX,CAEA,kBAAkB0L,EAClB,CACIuH,GAAkB,KAAK,IAAKvH,CAAc,CAC9C,CAEA,mBAAmBd,EACnB,CACIM,GAAmB,KAAK,IAAKN,CAAY,CAC7C,CAEA,aAAazL,EACb,CACIyK,GAAa,KAAK,IAAKzK,CAAM,CACjC,CAEA,cAAcwM,EACd,CACIuF,GAAc,KAAK,IAAKvF,CAAO,CACnC,CAEA,cAAcmM,EACd,CACIc,GAAc,KAAK,IAAKd,CAAO,CACnC,CAEA,cAAc9D,EACd,CACIQ,GAAc,KAAK,IAAKR,CAAQ,CACpC,CAEA,wBAAwBqF,EACxB,CACIG,GAAwB,KAAK,IAAKH,CAAiB,CACvD,CACJ","x_google_ignoreList":[0,2,9]}